import{ab as Yr,b as er,aB as tr,R as gt,h as Q,T as Xr,a as Qr,j as sn,i as ei,Z as ti,_ as cn,$ as Ie,d as Te,al as ni,a0 as nr,c as Mt,p as ri,aC as vt,ao as rr,a4 as Rt,aa as fn,aD as Lt,aE as ln,aF as Ft,m as ii,aG as hn,aj as oi,aH as ai,aI as ui,an as si,aJ as ci,U as ir,aK as fi,N as li,E as hi,F as pi,aL as di,as as gi,aM as vi,aN as mi,aO as yi,aP as wi,u as or,a3 as Wt,au as bi,a5 as _i,k as Si}from"./D8QEN0Si.js";import{b as ki,i as Ti,c as Ai,d as Ei,f as $i,n as Oi,g as Ci,l as Bt}from"./BdftctrX.js";import{d as de,w as X,g as F}from"./H1Cc9yE9.js";function Mc(e,t){return t}function xi(e,t,n,r){for(var i=[],o=t.length,a=0;a<o;a++)ui(t[a].e,i,!0);var l=o>0&&i.length===0&&n!==null;if(l){var c=n.parentNode;si(c),c.append(n),r.clear(),ve(e,t[0].prev,t[o-1].next)}ci(i,()=>{for(var u=0;u<o;u++){var v=t[u];l||(r.delete(v.k),ve(e,v.prev,v.next)),ir(v.e,!l)}})}function Lc(e,t,n,r,i,o=null){var a=e,l={flags:t,items:new Map,first:null},c=(t&tr)!==0;if(c){var u=e;a=Q?gt(Xr(u)):u.appendChild(Yr())}Q&&Qr();var v=null,d=!1,h=ei(()=>{var S=n();return oi(S)?S:S==null?[]:rr(S)});er(()=>{var S=sn(h),g=S.length;if(d&&g===0)return;d=g===0;let _=!1;if(Q){var y=a.data===ti;y!==(g===0)&&(a=cn(),gt(a),Ie(!1),_=!0)}if(Q){for(var w=null,f,s=0;s<g;s++){if(Te.nodeType===8&&Te.data===ni){a=Te,_=!0,Ie(!1);break}var p=S[s],m=r(p,s);f=ar(Te,l,w,null,p,m,s,i,t,n),l.items.set(m,f),w=f}g>0&&gt(cn())}Q||ji(S,l,a,i,t,r,n),o!==null&&(g===0?v?nr(v):v=Mt(()=>o(a)):v!==null&&ri(v,()=>{v=null})),_&&Ie(!0),sn(h)}),Q&&(a=Te)}function ji(e,t,n,r,i,o,a){var $,C,z,j;var l=(i&ai)!==0,c=(i&(Lt|Ft))!==0,u=e.length,v=t.items,d=t.first,h=d,S,g=null,_,y=[],w=[],f,s,p,m;if(l)for(m=0;m<u;m+=1)f=e[m],s=o(f,m),p=v.get(s),p!==void 0&&(($=p.a)==null||$.measure(),(_??(_=new Set)).add(p));for(m=0;m<u;m+=1){if(f=e[m],s=o(f,m),p=v.get(s),p===void 0){var A=h?h.e.nodes_start:n;g=ar(A,t,g,g===null?t.first:g.next,f,s,m,r,i,a),v.set(s,g),y=[],w=[],h=g.next;continue}if(c&&Ni(p,f,m,i),(p.e.f&vt)!==0&&(nr(p.e),l&&((C=p.a)==null||C.unfix(),(_??(_=new Set)).delete(p))),p!==h){if(S!==void 0&&S.has(p)){if(y.length<w.length){var T=w[0],k;g=T.prev;var O=y[0],R=y[y.length-1];for(k=0;k<y.length;k+=1)pn(y[k],T,n);for(k=0;k<w.length;k+=1)S.delete(w[k]);ve(t,O.prev,R.next),ve(t,g,O),ve(t,R,T),h=T,g=R,m-=1,y=[],w=[]}else S.delete(p),pn(p,h,n),ve(t,p.prev,p.next),ve(t,p,g===null?t.first:g.next),ve(t,g,p),g=p;continue}for(y=[],w=[];h!==null&&h.k!==s;)(h.e.f&vt)===0&&(S??(S=new Set)).add(h),w.push(h),h=h.next;if(h===null)continue;p=h}y.push(p),g=p,h=p.next}if(h!==null||S!==void 0){for(var x=S===void 0?[]:rr(S);h!==null;)(h.e.f&vt)===0&&x.push(h),h=h.next;var E=x.length;if(E>0){var b=(i&tr)!==0&&u===0?n:null;if(l){for(m=0;m<E;m+=1)(z=x[m].a)==null||z.measure();for(m=0;m<E;m+=1)(j=x[m].a)==null||j.fix()}xi(t,x,b,v)}}l&&Rt(()=>{var N;if(_!==void 0)for(p of _)(N=p.a)==null||N.apply()}),fn.first=t.first&&t.first.e,fn.last=g&&g.e}function Ni(e,t,n,r){(r&Lt)!==0&&ln(e.v,t),(r&Ft)!==0?ln(e.i,n):e.i=n}function ar(e,t,n,r,i,o,a,l,c,u){var v=(c&Lt)!==0,d=(c&fi)===0,h=v?d?ii(i):hn(i):i,S=(c&Ft)===0?a:hn(a),g={i:S,v:h,k:o,a:null,e:null,prev:n,next:r};try{return g.e=Mt(()=>l(e,h,S,u),Q),g.e.prev=n&&n.e,g.e.next=r&&r.e,n===null?t.first=g:(n.next=g,n.e.next=g.e),r!==null&&(r.prev=g,r.e.prev=g.e),g}finally{}}function pn(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,i=t?t.e.nodes_start:n,o=e.e.nodes_start;o!==r;){var a=li(o);i.before(o),o=a}}function ve(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function Fc(e,t,...n){var r=e,i=pi,o;er(()=>{i!==(i=t())&&(o&&(ir(o),o=null),o=Mt(()=>i(r,...n)))},hi),Q&&(r=Te)}function ur(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(n=ur(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function Ri(){for(var e,t,n=0,r="",i=arguments.length;n<i;n++)(e=arguments[n])&&(t=ur(e))&&(r&&(r+=" "),r+=t);return r}function zi(e){return typeof e=="object"?Ri(e):e??""}const dn=[...` 	
\r\fÂ \v\uFEFF`];function Ii(e,t,n){var r=e==null?"":""+e;if(t&&(r=r?r+" "+t:t),n){for(var i in n)if(n[i])r=r?r+" "+i:i;else if(r.length)for(var o=i.length,a=0;(a=r.indexOf(i,a))>=0;){var l=a+o;(a===0||dn.includes(r[a-1]))&&(l===r.length||dn.includes(r[l]))?r=(a===0?"":r.substring(0,a))+r.substring(l+1):a=l}}return r===""?null:r}function gn(e,t=!1){var n=t?" !important;":";",r="";for(var i in e){var o=e[i];o!=null&&o!==""&&(r+=" "+i+": "+o+n)}return r}function mt(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function Di(e,t){if(t){var n="",r,i;if(Array.isArray(t)?(r=t[0],i=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var o=!1,a=0,l=!1,c=[];r&&c.push(...Object.keys(r).map(mt)),i&&c.push(...Object.keys(i).map(mt));var u=0,v=-1;const _=e.length;for(var d=0;d<_;d++){var h=e[d];if(l?h==="/"&&e[d-1]==="*"&&(l=!1):o?o===h&&(o=!1):h==="/"&&e[d+1]==="*"?l=!0:h==='"'||h==="'"?o=h:h==="("?a++:h===")"&&a--,!l&&o===!1&&a===0){if(h===":"&&v===-1)v=d;else if(h===";"||d===_-1){if(v!==-1){var S=mt(e.substring(u,v).trim());if(!c.includes(S)){h!==";"&&d++;var g=e.substring(u,d).trim();n+=" "+g+";"}}u=d+1,v=-1}}}}return r&&(n+=gn(r)),i&&(n+=gn(i,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function Pi(e,t,n,r,i,o){var a=e.__className;if(Q||a!==n||a===void 0){var l=Ii(n,r,o);(!Q||l!==e.getAttribute("class"))&&(l==null?e.removeAttribute("class"):t?e.className=l:e.setAttribute("class",l)),e.__className=n}else if(o&&i!==o)for(var c in o){var u=!!o[c];(i==null||u!==!!i[c])&&e.classList.toggle(c,u)}return o}function yt(e,t={},n,r){for(var i in n){var o=n[i];t[i]!==o&&(n[i]==null?e.style.removeProperty(i):e.style.setProperty(i,o,r))}}function Zi(e,t,n,r){var i=e.__style;if(Q||i!==t){var o=Di(t,r);(!Q||o!==e.getAttribute("style"))&&(o==null?e.removeAttribute("style"):e.style.cssText=o),e.__style=t}else r&&(Array.isArray(r)?(yt(e,n==null?void 0:n[0],r[0]),yt(e,n==null?void 0:n[1],r[1],"important")):yt(e,n,r));return r}const Ne=Symbol("class"),Re=Symbol("style"),sr=Symbol("is custom element"),cr=Symbol("is html");function Wc(e){if(Q){var t=!1,n=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var r=e.value;rt(e,"value",null),e.value=r}if(e.hasAttribute("checked")){var i=e.checked;rt(e,"checked",null),e.checked=i}}};e.__on_r=n,mi(n),ki()}}function Bc(e,t){var n=Jt(e);n.checked!==(n.checked=t??void 0)&&(e.checked=t)}function Ui(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function rt(e,t,n,r){var i=Jt(e);Q&&(i[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||i[t]!==(i[t]=n)&&(t==="loading"&&(e[yi]=n),n==null?e.removeAttribute(t):typeof n!="string"&&fr(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function Jc(e,t,n,r,i=!1){var o=Jt(e),a=o[sr],l=!o[cr];let c=Q&&a;c&&Ie(!1);var u=t||{},v=e.tagName==="OPTION";for(var d in t)d in n||(n[d]=null);n.class?n.class=zi(n.class):(r||n[Ne])&&(n.class=null),n[Re]&&(n.style??(n.style=null));var h=fr(e);for(const s in n){let p=n[s];if(v&&s==="value"&&p==null){e.value=e.__value="",u[s]=p;continue}if(s==="class"){var S=e.namespaceURI==="http://www.w3.org/1999/xhtml";Pi(e,S,p,r,t==null?void 0:t[Ne],n[Ne]),u[s]=p,u[Ne]=n[Ne];continue}if(s==="style"){Zi(e,p,t==null?void 0:t[Re],n[Re]),u[s]=p,u[Re]=n[Re];continue}var g=u[s];if(p!==g){u[s]=p;var _=s[0]+s[1];if(_!=="$$")if(_==="on"){const m={},A="$$"+s;let T=s.slice(2);var y=Ci(T);if(Ti(T)&&(T=T.slice(0,-7),m.capture=!0),!y&&g){if(p!=null)continue;e.removeEventListener(T,u[A],m),u[A]=null}if(p!=null)if(y)e[`__${T}`]=p,Ei([T]);else{let k=function(O){u[s].call(this,O)};u[A]=Ai(T,e,k,m)}else y&&(e[`__${T}`]=void 0)}else if(s==="style")rt(e,s,p);else if(s==="autofocus")$i(e,!!p);else if(!a&&(s==="__value"||s==="value"&&p!=null))e.value=e.__value=p;else if(s==="selected"&&v)Ui(e,p);else{var w=s;l||(w=Oi(w));var f=w==="defaultValue"||w==="defaultChecked";if(p==null&&!a&&!f)if(o[s]=null,w==="value"||w==="checked"){let m=e;const A=t===void 0;if(w==="value"){let T=m.defaultValue;m.removeAttribute(w),m.defaultValue=T,m.value=m.__value=A?T:null}else{let T=m.defaultChecked;m.removeAttribute(w),m.defaultChecked=T,m.checked=A?T:!1}}else e.removeAttribute(s);else f||h.includes(w)&&(a||typeof p!="string")?e[w]=p:typeof p!="function"&&rt(e,w,p)}}}return c&&Ie(!0),u}function Jt(e){return e.__attributes??(e.__attributes={[sr]:e.nodeName.includes("-"),[cr]:e.namespaceURI===di})}var vn=new Map;function fr(e){var t=vn.get(e.nodeName);if(t)return t;vn.set(e.nodeName,t=[]);for(var n,r=e,i=Element.prototype;i!==r;){n=vi(r);for(var o in n)n[o].set&&t.push(o);r=gi(r)}return t}function Gc(e,t,n=t){var r=wi();Bt(e,"input",i=>{var o=i?e.defaultValue:e.value;if(o=bt(e)?_t(o):o,n(o),r&&o!==(o=t())){var a=e.selectionStart,l=e.selectionEnd;e.value=o??"",l!==null&&(e.selectionStart=a,e.selectionEnd=Math.min(l,e.value.length))}}),(Q&&e.defaultValue!==e.value||or(t)==null&&e.value)&&n(bt(e)?_t(e.value):e.value),Wt(()=>{var i=t();bt(e)&&i===_t(e.value)||e.type==="date"&&!i&&!e.value||i!==e.value&&(e.value=i??"")})}const wt=new Set;function Kc(e,t,n,r,i=r){var o=n.getAttribute("type")==="checkbox",a=e;let l=!1;if(t!==null)for(var c of t)a=a[c]??(a[c]=[]);a.push(n),Bt(n,"change",()=>{var u=n.__value;o&&(u=mn(a,u,n.checked)),i(u)},()=>i(o?[]:null)),Wt(()=>{var u=r();if(Q&&n.defaultChecked!==n.checked){l=!0;return}o?(u=u||[],n.checked=u.includes(n.__value)):n.checked=bi(n.__value,u)}),_i(()=>{var u=a.indexOf(n);u!==-1&&a.splice(u,1)}),wt.has(a)||(wt.add(a),Rt(()=>{a.sort((u,v)=>u.compareDocumentPosition(v)===4?-1:1),wt.delete(a)})),Rt(()=>{if(l){var u;if(o)u=mn(a,u,n.checked);else{var v=a.find(d=>d.checked);u=v==null?void 0:v.__value}i(u)}})}function Hc(e,t,n=t){Bt(e,"change",r=>{var i=r?e.defaultChecked:e.checked;n(i)}),(Q&&e.defaultChecked!==e.checked||or(t)==null)&&n(e.checked),Wt(()=>{var r=t();e.checked=!!r})}function mn(e,t,n){for(var r=new Set,i=0;i<e.length;i+=1)e[i].checked&&r.add(e[i].__value);return n||r.delete(t),Array.from(r)}function bt(e){var t=e.type;return t==="number"||t==="range"}function _t(e){return e===""?null:+e}var De=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var et={exports:{}},Mi=et.exports,yn;function Li(){return yn||(yn=1,function(e,t){(function(n,r){e.exports=r()})(Mi,function(){Array.isArray||(Array.isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"});function n(o){for(var a=[],l=0,c=o.length;l<c;l++)a.indexOf(o[l])===-1&&a.push(o[l]);return a}var r={},i={"==":function(o,a){return o==a},"===":function(o,a){return o===a},"!=":function(o,a){return o!=a},"!==":function(o,a){return o!==a},">":function(o,a){return o>a},">=":function(o,a){return o>=a},"<":function(o,a,l){return l===void 0?o<a:o<a&&a<l},"<=":function(o,a,l){return l===void 0?o<=a:o<=a&&a<=l},"!!":function(o){return r.truthy(o)},"!":function(o){return!r.truthy(o)},"%":function(o,a){return o%a},log:function(o){return console.log(o),o},in:function(o,a){return!a||typeof a.indexOf>"u"?!1:a.indexOf(o)!==-1},cat:function(){return Array.prototype.join.call(arguments,"")},substr:function(o,a,l){if(l<0){var c=String(o).substr(a);return c.substr(0,c.length+l)}return String(o).substr(a,l)},"+":function(){return Array.prototype.reduce.call(arguments,function(o,a){return parseFloat(o,10)+parseFloat(a,10)},0)},"*":function(){return Array.prototype.reduce.call(arguments,function(o,a){return parseFloat(o,10)*parseFloat(a,10)})},"-":function(o,a){return a===void 0?-o:o-a},"/":function(o,a){return o/a},min:function(){return Math.min.apply(this,arguments)},max:function(){return Math.max.apply(this,arguments)},merge:function(){return Array.prototype.reduce.call(arguments,function(o,a){return o.concat(a)},[])},var:function(o,a){var l=a===void 0?null:a,c=this;if(typeof o>"u"||o===""||o===null)return c;for(var u=String(o).split("."),v=0;v<u.length;v++)if(c==null||(c=c[u[v]],c===void 0))return l;return c},missing:function(){for(var o=[],a=Array.isArray(arguments[0])?arguments[0]:arguments,l=0;l<a.length;l++){var c=a[l],u=r.apply({var:c},this);(u===null||u==="")&&o.push(c)}return o},missing_some:function(o,a){var l=r.apply({missing:a},this);return a.length-l.length>=o?[]:l}};return r.is_logic=function(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)&&Object.keys(o).length===1},r.truthy=function(o){return Array.isArray(o)&&o.length===0?!1:!!o},r.get_operator=function(o){return Object.keys(o)[0]},r.get_values=function(o){return o[r.get_operator(o)]},r.apply=function(o,a){if(Array.isArray(o))return o.map(function(y){return r.apply(y,a)});if(!r.is_logic(o))return o;var l=r.get_operator(o),c=o[l],u,v,d,h,S;if(Array.isArray(c)||(c=[c]),l==="if"||l=="?:"){for(u=0;u<c.length-1;u+=2)if(r.truthy(r.apply(c[u],a)))return r.apply(c[u+1],a);return c.length===u+1?r.apply(c[u],a):null}else if(l==="and"){for(u=0;u<c.length;u+=1)if(v=r.apply(c[u],a),!r.truthy(v))return v;return v}else if(l==="or"){for(u=0;u<c.length;u+=1)if(v=r.apply(c[u],a),r.truthy(v))return v;return v}else{if(l==="filter")return h=r.apply(c[0],a),d=c[1],Array.isArray(h)?h.filter(function(y){return r.truthy(r.apply(d,y))}):[];if(l==="map")return h=r.apply(c[0],a),d=c[1],Array.isArray(h)?h.map(function(y){return r.apply(d,y)}):[];if(l==="reduce")return h=r.apply(c[0],a),d=c[1],S=typeof c[2]<"u"?r.apply(c[2],a):null,Array.isArray(h)?h.reduce(function(y,w){return r.apply(d,{current:w,accumulator:y})},S):S;if(l==="all"){if(h=r.apply(c[0],a),d=c[1],!Array.isArray(h)||!h.length)return!1;for(u=0;u<h.length;u+=1)if(!r.truthy(r.apply(d,h[u])))return!1;return!0}else if(l==="none"){if(h=r.apply(c[0],a),d=c[1],!Array.isArray(h)||!h.length)return!0;for(u=0;u<h.length;u+=1)if(r.truthy(r.apply(d,h[u])))return!1;return!0}else if(l==="some"){if(h=r.apply(c[0],a),d=c[1],!Array.isArray(h)||!h.length)return!1;for(u=0;u<h.length;u+=1)if(r.truthy(r.apply(d,h[u])))return!0;return!1}}if(c=c.map(function(y){return r.apply(y,a)}),i.hasOwnProperty(l)&&typeof i[l]=="function")return i[l].apply(a,c);if(l.indexOf(".")>0){var g=String(l).split("."),_=i;for(u=0;u<g.length;u++){if(!_.hasOwnProperty(g[u]))throw new Error("Unrecognized operation "+l+" (failed at "+g.slice(0,u+1).join(".")+")");_=_[g[u]]}return _.apply(a,c)}throw new Error("Unrecognized operation "+l)},r.uses_data=function(o){var a=[];if(r.is_logic(o)){var l=r.get_operator(o),c=o[l];Array.isArray(c)||(c=[c]),l==="var"?a.push(c[0]):c.forEach(function(u){a.push.apply(a,r.uses_data(u))})}return n(a)},r.add_operation=function(o,a){i[o]=a},r.rm_operation=function(o){delete i[o]},r.rule_like=function(o,a){if(a===o||a==="@")return!0;if(a==="number")return typeof o=="number";if(a==="string")return typeof o=="string";if(a==="array")return Array.isArray(o)&&!r.is_logic(o);if(r.is_logic(a)){if(r.is_logic(o)){var l=r.get_operator(a),c=r.get_operator(o);if(l==="@"||l===c)return r.rule_like(r.get_values(o,!1),r.get_values(a,!1))}return!1}if(Array.isArray(a))if(Array.isArray(o)){if(a.length!==o.length)return!1;for(var u=0;u<a.length;u+=1)if(!r.rule_like(o[u],a[u]))return!1;return!0}else return!1;return!1},r})}(et)),et.exports}var Fi=Li();const Wi=Gt(Fi);function Bi(e,t,n){const r=Object.entries(e).filter(([i,o])=>t(i,o,n));return We(Object.fromEntries(r))}const Vc={includeNodes:e=>({in:[{var:"nodeId"},e]}),excludeNodes:e=>({"!":{in:[{var:"nodeId"},e]}}),aboveThreshold:e=>({">=":[{var:"share"},e]}),byCategory:e=>({some:[{var:"node.categories"},{in:[{var:""},e]}]}),inSubtrees:e=>({some:[e,{"!!":{var:["subtreeContributors",{var:""},{var:"nodeId"}]}}]}),inSubtree:e=>({in:[{var:"nodeId"},{var:["subtreeContributors",e]}]}),and:(...e)=>({and:e}),or:(...e)=>({or:e}),not:e=>({"!":e})};function Ji(e){return(t,n,r={})=>{var o;const i={nodeId:t,share:n,node:((o=r.node)==null?void 0:o[t])||null,subtreeContributors:r.subtreeContributors||{},...r};return!!Wi.apply(e,i)}}function Gi(e,t,n){if(!e.filter_rule){const i=We({...t});return wn(e,i)}const r=Bi(t,Ji(e.filter_rule),n);return wn(e,r)}function wn(e,t){const n=e.max_percentage_div||1,r=e.max_natural_div||1,i=e.quantity||0;if(n>=1&&r<=1||i===0)return t;const o={},a=r/i,c=Math.min(a,n);for(const[u,v]of Object.entries(t)){const d=Math.round(v/c)*c;d>0&&(o[u]=Math.min(d,1))}return We(o)}function We(e){const t=Object.values(e).reduce((n,r)=>n+r,0);return t===0?e:Object.fromEntries(Object.entries(e).map(([n,r])=>[n,r/t]))}function Kt(e,t){if(e.id===t)return e;for(const n of e.children){const r=Kt(n,t);if(r)return r}return null}function it(e){const t=[];function n(r){for(const i of r.children)t.push(i),n(i)}return n(e),t}function lr(e,t){for(const n of e.children){if(n.id===t)return e;const r=lr(n,t);if(r)return r}return null}function Ki(e){return e.children.filter(t=>t.type==="NonRootNode").reduce((t,n)=>t+(n.points||0),0)}function Ht(e,t){if(e.type==="RootNode"||e.id===t.id)return 1;const n=lr(t,e.id);if(!n||e.type!=="NonRootNode")return 1;const r=Ki(n),i=r===0?0:e.points/r,o=Ht(n,t);return i*o}function Pe(e){var t;return e.type==="NonRootNode"&&((t=e.contributor_ids)==null?void 0:t.length)>0}function hr(e,t){const n=e.manual_fulfillment!==void 0,r=e.children.length===0,i=Pe(e),o=e.children.some(h=>Pe(h)),a=e.children.some(h=>!Pe(h)),l=e.manual_fulfillment??0;if(r&&i)return 1;if(r)return 0;if(n&&o&&!a)return l;const c=e.children.map(h=>Ht(h,t)),u=e.children.map(h=>hr(h,t)),v=c.reduce((h,S,g)=>h+S*u[g],0),d=c.reduce((h,S)=>h+S,0);return d===0?0:v/d}function Hi(e,t,n){return[e,...it(e)].filter(a=>a.type==="RootNode"?!1:a.contributor_ids.includes(t)&&Pe(a)).map(a=>{const l=Ht(a,e),c=hr(a,e),u=a.type==="RootNode"?1:a.contributor_ids.length;return l*c/u}).reduce((a,l)=>a+l,0)}function Vi(e){const t=new Set,n=[e,...it(e)];for(const r of n)if(r.type==="NonRootNode")for(const i of r.contributor_ids)t.add(i);return[...t]}function qi(e,t,n){const r={},i=n||Object.keys(t).filter(o=>o!==e.id);for(const o of i){const a=Hi(e,o);r[o]=a}return We(r)}function Yi(e,t){const n=Math.round((e.quantity||0)*t),r=e.max_natural_div||1,i=e.max_percentage_div||1,o=t>i?Math.round((e.quantity||0)*i):n;return Math.floor(o/r)*r}function qc(e,t){e[t.id]=t}function pr(e){return e===void 0?null:Math.max(0,Math.min(1,e))}function Xi(e,t,n,r){return{id:e,name:t,type:"RootNode",user_id:n,children:[],manual_fulfillment:pr(r),created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}function Qi(e,t,n,r,i=[],o){return{id:e,name:t,type:"NonRootNode",points:r,parent_id:n,children:[],contributor_ids:i,manual_fulfillment:pr(o)}}function Z(e,t,n,r,i=[],o){if(e.type==="NonRootNode"&&e.contributor_ids.length>0)throw new Error("Cannot add children to nodes with contributors");const a=Qi(t,n,e.id,r,i,o);e.children.push(a)}function Yc(e,t){e.type==="NonRootNode"?(e.contributor_ids=[...t],e.children=[]):e.children=[]}function eo(e,t,n){if(e.id===t)return n(e),!0;for(const r of e.children)if(eo(r,t,n))return!0;return!1}function Xc(e,t){e.points=t}function Qc(e,t){e.name=t}function dr(e,t){const n={};function r(o){const a=new Set;return[o,...it(o)].forEach(c=>{c.type==="NonRootNode"&&c.contributor_ids.forEach(u=>a.add(u))}),[...a]}return n[e.id]=Object.fromEntries(r(e).map(o=>[o,!0])),it(e).forEach(o=>{n[o.id]=Object.fromEntries(r(o).map(a=>[a,!0]))}),n}function I(e,t,n){const r=(n==null?void 0:n.Parent)??Object;class i extends r{constructor(a){var l;super();const c=this;i.init(c,a),(l=c._zod).deferred??(l.deferred=[]);for(const u of c._zod.deferred)u()}static init(a,l){var c;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(c=a._zod).traits??(c.traits=new Set),a._zod.traits.add(e),t(a,l);for(const u in i.prototype)Object.defineProperty(a,u,{value:i.prototype[u].bind(a)});a._zod.constr=i,a._zod.def=l}static[Symbol.hasInstance](a){var l,c;return n!=null&&n.Parent&&a instanceof n.Parent?!0:(c=(l=a==null?void 0:a._zod)==null?void 0:l.traits)==null?void 0:c.has(e)}}return Object.defineProperty(i,"name",{value:e}),i}class Me extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const gr={};function me(e){return gr}function to(e,t){return typeof t=="bigint"?t.toString():t}function vr(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function Vt(e){return e==null}function qt(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function no(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,i=n>r?n:r,o=Number.parseInt(e.toFixed(i).replace(".","")),a=Number.parseInt(t.toFixed(i).replace(".",""));return o%a/10**i}function Y(e,t,n){Object.defineProperty(e,t,{get(){{const r=n();return e[t]=r,r}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function Yt(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function mr(e=10){const t="abcdefghijklmnopqrstuvwxyz";let n="";for(let r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n}function ze(e){return JSON.stringify(e)}function ro(e){return typeof e=="object"&&e!==null}const io=vr(()=>{try{const e=Function;return new e(""),!0}catch{return!1}});function zt(e){return typeof e=="object"&&e!==null&&Object.getPrototypeOf(e)===Object.prototype}const oo=new Set(["string","number","symbol"]);function $e(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Se(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(r._zod.parent=e),r}function U(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function ao(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional")}const uo={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function so(e,t){const n={},r=e._zod.def;for(const i in t){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&(n[i]=r.shape[i])}return Se(e,{...e._zod.def,shape:n,checks:[]})}function co(e,t){const n={...e._zod.def.shape},r=e._zod.def;for(const i in t){if(!(i in r.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&delete n[i]}return Se(e,{...e._zod.def,shape:n,checks:[]})}function fo(e,t){const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return Yt(this,"shape",r),r},checks:[]};return Se(e,n)}function lo(e,t){return Se(e,{...e._zod.def,get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return Yt(this,"shape",n),n},catchall:t._zod.def.catchall,checks:[]})}function ho(e,t,n){const r=t._zod.def.shape,i={...r};if(n)for(const o in n){if(!(o in r))throw new Error(`Unrecognized key: "${o}"`);n[o]&&(i[o]=e?new e({type:"optional",innerType:r[o]}):r[o])}else for(const o in r)i[o]=e?new e({type:"optional",innerType:r[o]}):r[o];return Se(t,{...t._zod.def,shape:i,checks:[]})}function po(e,t,n){const r=t._zod.def.shape,i={...r};if(n)for(const o in n){if(!(o in i))throw new Error(`Unrecognized key: "${o}"`);n[o]&&(i[o]=new e({type:"nonoptional",innerType:r[o]}))}else for(const o in r)i[o]=new e({type:"nonoptional",innerType:r[o]});return Se(t,{...t._zod.def,shape:i,checks:[]})}function Ze(e,t=0){for(let n=t;n<e.issues.length;n++)if(e.issues[n].continue!==!0)return!0;return!1}function _e(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function Ve(e){return typeof e=="string"?e:e==null?void 0:e.message}function ye(e,t,n){var i,o,a,l,c,u;const r={...e,path:e.path??[]};if(!e.message){const v=Ve((a=(o=(i=e.inst)==null?void 0:i._zod.def)==null?void 0:o.error)==null?void 0:a.call(o,e))??Ve((l=t==null?void 0:t.error)==null?void 0:l.call(t,e))??Ve((c=n.customError)==null?void 0:c.call(n,e))??Ve((u=n.localeError)==null?void 0:u.call(n,e))??"Invalid input";r.message=v}return delete r.inst,delete r.continue,t!=null&&t.reportInput||delete r.input,r}function Xt(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function Le(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const yr=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,to,2)},enumerable:!0})},wr=I("$ZodError",yr),br=I("$ZodError",yr,{Parent:Error});function go(e,t=n=>n.message){const n={},r=[];for(const i of e.issues)i.path.length>0?(n[i.path[0]]=n[i.path[0]]||[],n[i.path[0]].push(t(i))):r.push(t(i));return{formErrors:r,fieldErrors:n}}function vo(e,t){const n=t||function(o){return o.message},r={_errors:[]},i=o=>{for(const a of o.issues)if(a.code==="invalid_union")a.errors.map(l=>i({issues:l}));else if(a.code==="invalid_key")i({issues:a.issues});else if(a.code==="invalid_element")i({issues:a.issues});else if(a.path.length===0)r._errors.push(n(a));else{let l=r,c=0;for(;c<a.path.length;){const u=a.path[c];c===a.path.length-1?(l[u]=l[u]||{_errors:[]},l[u]._errors.push(n(a))):l[u]=l[u]||{_errors:[]},l=l[u],c++}}};return i(e),r}const mo=e=>(t,n,r,i)=>{const o=r?Object.assign(r,{async:!1}):{async:!1},a=t._zod.run({value:n,issues:[]},o);if(a instanceof Promise)throw new Me;if(a.issues.length){const l=new((i==null?void 0:i.Err)??e)(a.issues.map(c=>ye(c,o,me())));throw Error.captureStackTrace(l,i==null?void 0:i.callee),l}return a.value},yo=e=>async(t,n,r,i)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let a=t._zod.run({value:n,issues:[]},o);if(a instanceof Promise&&(a=await a),a.issues.length){const l=new((i==null?void 0:i.Err)??e)(a.issues.map(c=>ye(c,o,me())));throw Error.captureStackTrace(l,i==null?void 0:i.callee),l}return a.value},_r=e=>(t,n,r)=>{const i=r?{...r,async:!1}:{async:!1},o=t._zod.run({value:n,issues:[]},i);if(o instanceof Promise)throw new Me;return o.issues.length?{success:!1,error:new(e??wr)(o.issues.map(a=>ye(a,i,me())))}:{success:!0,data:o.value}},wo=_r(br),Sr=e=>async(t,n,r)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let o=t._zod.run({value:n,issues:[]},i);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new e(o.issues.map(a=>ye(a,i,me())))}:{success:!0,data:o.value}},bo=Sr(br),_o=/^[cC][^\s-]{8,}$/,So=/^[0-9a-z]+$/,ko=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,To=/^[0-9a-vA-V]{20}$/,Ao=/^[A-Za-z0-9]{27}$/,Eo=/^[a-zA-Z0-9_-]{21}$/,$o=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,Oo=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,bn=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,Co=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,xo="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function jo(){return new RegExp(xo,"u")}const No=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ro=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,zo=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,Io=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Do=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,kr=/^[A-Za-z0-9_-]*$/,St=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,Po=/^\+(?:[0-9]){6,14}[0-9]$/,Tr="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Zo=new RegExp(`^${Tr}$`);function Ar(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`),t}function Uo(e){return new RegExp(`^${Ar(e)}$`)}function Mo(e){let t=`${Tr}T${Ar(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}const Lo=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Fo=/^\d+$/,Wo=/^-?\d+(?:\.\d+)?/i,Bo=/true|false/i,Jo=/^[^A-Z]*$/,Go=/^[^a-z]*$/,ie=I("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),Er={number:"number",bigint:"bigint",object:"date"},$r=I("$ZodCheckLessThan",(e,t)=>{ie.init(e,t);const n=Er[typeof t.value];e._zod.onattach.push(r=>{const i=r._zod.bag,o=(t.inclusive?i.maximum:i.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<o&&(t.inclusive?i.maximum=t.value:i.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Or=I("$ZodCheckGreaterThan",(e,t)=>{ie.init(e,t);const n=Er[typeof t.value];e._zod.onattach.push(r=>{const i=r._zod.bag,o=(t.inclusive?i.minimum:i.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>o&&(t.inclusive?i.minimum=t.value:i.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Ko=I("$ZodCheckMultipleOf",(e,t)=>{ie.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):no(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),Ho=I("$ZodCheckNumberFormat",(e,t)=>{var a;ie.init(e,t),t.format=t.format||"float64";const n=(a=t.format)==null?void 0:a.includes("int"),r=n?"int":"number",[i,o]=uo[t.format];e._zod.onattach.push(l=>{const c=l._zod.bag;c.format=t.format,c.minimum=i,c.maximum=o,n&&(c.pattern=Fo)}),e._zod.check=l=>{const c=l.value;if(n){if(!Number.isInteger(c)){l.issues.push({expected:r,format:t.format,code:"invalid_type",input:c,inst:e});return}if(!Number.isSafeInteger(c)){c>0?l.issues.push({input:c,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the the safe integer range.",inst:e,origin:r,continue:!t.abort}):l.issues.push({input:c,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}c<i&&l.issues.push({origin:"number",input:c,code:"too_small",minimum:i,inclusive:!0,inst:e,continue:!t.abort}),c>o&&l.issues.push({origin:"number",input:c,code:"too_big",maximum:o,inst:e})}}),Vo=I("$ZodCheckMaxLength",(e,t)=>{ie.init(e,t),e._zod.when=n=>{const r=n.value;return!Vt(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const r=n.value;if(r.length<=t.maximum)return;const o=Xt(r);n.issues.push({origin:o,code:"too_big",maximum:t.maximum,input:r,inst:e,continue:!t.abort})}}),qo=I("$ZodCheckMinLength",(e,t)=>{ie.init(e,t),e._zod.when=n=>{const r=n.value;return!Vt(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const r=n.value;if(r.length>=t.minimum)return;const o=Xt(r);n.issues.push({origin:o,code:"too_small",minimum:t.minimum,input:r,inst:e,continue:!t.abort})}}),Yo=I("$ZodCheckLengthEquals",(e,t)=>{ie.init(e,t),e._zod.when=n=>{const r=n.value;return!Vt(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=n=>{const r=n.value,i=r.length;if(i===t.length)return;const o=Xt(r),a=i>t.length;n.issues.push({origin:o,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},input:n.value,inst:e,continue:!t.abort})}}),ft=I("$ZodCheckStringFormat",(e,t)=>{var n;ie.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.format=t.format,t.pattern&&(r._zod.bag.pattern=t.pattern)}),(n=e._zod).check??(n.check=r=>{if(!t.pattern)throw new Error("Not implemented.");t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})})}),Xo=I("$ZodCheckRegex",(e,t)=>{ft.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Qo=I("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Jo),ft.init(e,t)}),ea=I("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=Go),ft.init(e,t)}),ta=I("$ZodCheckIncludes",(e,t)=>{ie.init(e,t);const n=new RegExp($e(t.includes));t.pattern=n,e._zod.onattach.push(r=>{r._zod.bag.pattern=n}),e._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:e,continue:!t.abort})}}),na=I("$ZodCheckStartsWith",(e,t)=>{ie.init(e,t);const n=new RegExp(`^${$e(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{r._zod.bag.pattern=n}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),ra=I("$ZodCheckEndsWith",(e,t)=>{ie.init(e,t);const n=new RegExp(`.*${$e(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{r._zod.bag.pattern=new RegExp(`.*${$e(t.suffix)}$`)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),ia=I("$ZodCheckOverwrite",(e,t)=>{ie.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class oa{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(a=>a),i=Math.min(...r.map(a=>a.length-a.trimStart().length)),o=r.map(a=>a.slice(i)).map(a=>" ".repeat(this.indent*2)+a);for(const a of o)this.content.push(a)}compile(){const t=Function,n=this==null?void 0:this.args,i=[...((this==null?void 0:this.content)??[""]).map(o=>`  ${o}`)];return new t(...n,i.join(`
`))}}const aa={major:4,minor:0,patch:0},K=I("$ZodType",(e,t)=>{var i;var n;e??(e={}),e._zod.id=t.type+"_"+mr(10),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=aa;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const o of r)for(const a of o._zod.onattach)a(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),(i=e._zod.deferred)==null||i.push(()=>{e._zod.run=e._zod.parse});else{const o=(a,l,c)=>{let u=Ze(a),v;for(const d of l){if(d._zod.when){if(!d._zod.when(a))continue}else if(u)continue;const h=a.issues.length,S=d._zod.check(a);if(S instanceof Promise&&(c==null?void 0:c.async)===!1)throw new Me;if(v||S instanceof Promise)v=(v??Promise.resolve()).then(async()=>{await S,a.issues.length!==h&&(u||(u=Ze(a,h)))});else{if(a.issues.length===h)continue;u||(u=Ze(a,h))}}return v?v.then(()=>a):a};e._zod.run=(a,l)=>{const c=e._zod.parse(a,l);if(c instanceof Promise){if(l.async===!1)throw new Me;return c.then(u=>o(u,r,l))}return o(c,r,l)}}e["~standard"]={validate:o=>{var a;try{const l=wo(e,o);return l.success?{value:l.data}:{issues:(a=l.error)==null?void 0:a.issues}}catch{return bo(e,o).then(c=>{var u;return c.success?{value:c.data}:{issues:(u=c.error)==null?void 0:u.issues}})}},vendor:"zod",version:1}}),Qt=I("$ZodString",(e,t)=>{var n;K.init(e,t),e._zod.pattern=((n=e==null?void 0:e._zod.bag)==null?void 0:n.pattern)??Lo(e._zod.bag),e._zod.parse=(r,i)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),H=I("$ZodStringFormat",(e,t)=>{ft.init(e,t),Qt.init(e,t)}),ua=I("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=Oo),H.init(e,t)}),sa=I("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=bn(r))}else t.pattern??(t.pattern=bn());H.init(e,t)}),ca=I("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=Co),H.init(e,t)}),fa=I("$ZodURL",(e,t)=>{H.init(e,t),e._zod.check=n=>{try{const r=new URL(n.value);St.lastIndex=0,St.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:St.source,input:n.value,inst:e}),t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:n.value,inst:e})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e}));return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e})}}}),la=I("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=jo()),H.init(e,t)}),ha=I("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=Eo),H.init(e,t)}),pa=I("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=_o),H.init(e,t)}),da=I("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=So),H.init(e,t)}),ga=I("$ZodULID",(e,t)=>{t.pattern??(t.pattern=ko),H.init(e,t)}),va=I("$ZodXID",(e,t)=>{t.pattern??(t.pattern=To),H.init(e,t)}),ma=I("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=Ao),H.init(e,t)}),ya=I("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=Mo(t)),H.init(e,t)}),wa=I("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=Zo),H.init(e,t)}),ba=I("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=Uo(t)),H.init(e,t)}),_a=I("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=$o),H.init(e,t)}),Sa=I("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=No),H.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.format="ipv4"})}),ka=I("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=Ro),H.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.format="ipv6"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e})}}}),Ta=I("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=zo),H.init(e,t)}),Aa=I("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=Io),H.init(e,t),e._zod.check=n=>{const[r,i]=n.value.split("/");try{if(!i)throw new Error;const o=Number(i);if(`${o}`!==i)throw new Error;if(o<0||o>128)throw new Error;new URL(`http://[${r}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e})}}});function Cr(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const Ea=I("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Do),H.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),e._zod.check=n=>{Cr(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e})}});function $a(e){if(!kr.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return Cr(n)}const Oa=I("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=kr),H.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),e._zod.check=n=>{$a(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e})}}),Ca=I("$ZodE164",(e,t)=>{t.pattern??(t.pattern=Po),H.init(e,t)});function xa(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n,i=JSON.parse(atob(r));return!("typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||t&&(!("alg"in i)||i.alg!==t))}catch{return!1}}const ja=I("$ZodJWT",(e,t)=>{H.init(e,t),e._zod.check=n=>{xa(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e})}}),xr=I("$ZodNumber",(e,t)=>{K.init(e,t),e._zod.pattern=e._zod.bag.pattern??Wo,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const i=n.value;if(typeof i=="number"&&!Number.isNaN(i)&&Number.isFinite(i))return n;const o=typeof i=="number"?Number.isNaN(i)?"NaN":Number.isFinite(i)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:i,inst:e,...o?{received:o}:{}}),n}}),Na=I("$ZodNumber",(e,t)=>{Ho.init(e,t),xr.init(e,t)}),Ra=I("$ZodBoolean",(e,t)=>{K.init(e,t),e._zod.pattern=Bo,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}const i=n.value;return typeof i=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:i,inst:e}),n}}),za=I("$ZodAny",(e,t)=>{K.init(e,t),e._zod.parse=n=>n}),Ia=I("$ZodUnknown",(e,t)=>{K.init(e,t),e._zod.parse=n=>n}),Da=I("$ZodNever",(e,t)=>{K.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function _n(e,t,n){e.issues.length&&t.issues.push(..._e(n,e.issues)),t.value[n]=e.value}const Pa=I("$ZodArray",(e,t)=>{K.init(e,t),e._zod.parse=(n,r)=>{const i=n.value;if(!Array.isArray(i))return n.issues.push({expected:"array",code:"invalid_type",input:i,inst:e}),n;n.value=Array(i.length);const o=[];for(let a=0;a<i.length;a++){const l=i[a],c=t.element._zod.run({value:l,issues:[]},r);c instanceof Promise?o.push(c.then(u=>_n(u,n,a))):_n(c,n,a)}return o.length?Promise.all(o).then(()=>n):n}});function qe(e,t,n){e.issues.length&&t.issues.push(..._e(n,e.issues)),t.value[n]=e.value}function Sn(e,t,n,r){e.issues.length?r[n]===void 0?n in r?t.value[n]=void 0:t.value[n]=e.value:t.issues.push(..._e(n,e.issues)):e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}const Za=I("$ZodObject",(e,t)=>{K.init(e,t);const n=vr(()=>{const d=Object.keys(t.shape),h=ao(t.shape);return{shape:t.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(h)}});Y(e._zod,"disc",()=>{const d=t.shape,h=new Map;let S=!1;for(const g in d){const _=d[g]._zod;if(_.values||_.disc){S=!0;const y={values:new Set(_.values??[]),maps:_.disc?[_.disc]:[]};h.set(g,y)}}if(S)return h});const r=d=>{const h=new oa(["shape","payload","ctx"]),{keys:S,optionalKeys:g}=n.value,_=f=>{const s=ze(f);return`shape[${s}]._zod.run({ value: input[${s}], issues: [] }, ctx)`};h.write("const input = payload.value;");const y=Object.create(null);for(const f of S)y[f]=mr(15);h.write("const newResult = {}");for(const f of S)if(g.has(f)){const s=y[f];h.write(`const ${s} = ${_(f)};`);const p=ze(f);h.write(`
        if (${s}.issues.length) {
          if (input[${p}] === undefined) {
            if (${p} in input) {
              newResult[${p}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${s}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${p}, ...iss.path] : [${p}],
              }))
            );
          }
        } else if (${s}.value === undefined) {
          if (${p} in input) newResult[${p}] = undefined;
        } else {
          newResult[${p}] = ${s}.value;
        }
        `)}else{const s=y[f];h.write(`const ${s} = ${_(f)};`),h.write(`
          if (${s}.issues.length) payload.issues = payload.issues.concat(${s}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${ze(f)}, ...iss.path] : [${ze(f)}]
          })));`),h.write(`newResult[${ze(f)}] = ${s}.value`)}h.write("payload.value = newResult;"),h.write("return payload;");const w=h.compile();return(f,s)=>w(d,f,s)};let i;const o=ro,a=!gr.jitless,c=a&&io.value,{catchall:u}=t;let v;e._zod.parse=(d,h)=>{v??(v=n.value);const S=d.value;if(!o(S))return d.issues.push({expected:"object",code:"invalid_type",input:S,inst:e}),d;const g=[];if(a&&c&&(h==null?void 0:h.async)===!1&&h.jitless!==!0)i||(i=r(t.shape)),d=i(d,h);else{d.value={};const s=v.shape;for(const p of v.keys){const m=s[p],A=m._zod.run({value:S[p],issues:[]},h),T=m._zod.optin==="optional";A instanceof Promise?g.push(A.then(k=>T?Sn(k,d,p,S):qe(k,d,p))):T?Sn(A,d,p,S):qe(A,d,p)}}if(!u)return g.length?Promise.all(g).then(()=>d):d;const _=[],y=v.keySet,w=u._zod,f=w.def.type;for(const s of Object.keys(S)){if(y.has(s))continue;if(f==="never"){_.push(s);continue}const p=w.run({value:S[s],issues:[]},h);p instanceof Promise?g.push(p.then(m=>qe(m,d,s))):qe(p,d,s)}return _.length&&d.issues.push({code:"unrecognized_keys",keys:_,input:S,inst:e}),g.length?Promise.all(g).then(()=>d):d}});function kn(e,t,n,r){for(const i of e)if(i.issues.length===0)return t.value=i.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(i=>i.issues.map(o=>ye(o,r,me())))}),t}const Ua=I("$ZodUnion",(e,t)=>{K.init(e,t),Y(e._zod,"values",()=>{if(t.options.every(n=>n._zod.values))return new Set(t.options.flatMap(n=>Array.from(n._zod.values)))}),Y(e._zod,"pattern",()=>{if(t.options.every(n=>n._zod.pattern)){const n=t.options.map(r=>r._zod.pattern);return new RegExp(`^(${n.map(r=>qt(r.source)).join("|")})$`)}}),e._zod.parse=(n,r)=>{let i=!1;const o=[];for(const a of t.options){const l=a._zod.run({value:n.value,issues:[]},r);if(l instanceof Promise)o.push(l),i=!0;else{if(l.issues.length===0)return l;o.push(l)}}return i?Promise.all(o).then(a=>kn(a,n,e,r)):kn(o,n,e,r)}}),Ma=I("$ZodIntersection",(e,t)=>{K.init(e,t),e._zod.parse=(n,r)=>{const{value:i}=n,o=t.left._zod.run({value:i,issues:[]},r),a=t.right._zod.run({value:i,issues:[]},r);return o instanceof Promise||a instanceof Promise?Promise.all([o,a]).then(([c,u])=>Tn(n,c,u)):Tn(n,o,a)}});function It(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(zt(e)&&zt(t)){const n=Object.keys(t),r=Object.keys(e).filter(o=>n.indexOf(o)!==-1),i={...e,...t};for(const o of r){const a=It(e[o],t[o]);if(!a.valid)return{valid:!1,mergeErrorPath:[o,...a.mergeErrorPath]};i[o]=a.data}return{valid:!0,data:i}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const i=e[r],o=t[r],a=It(i,o);if(!a.valid)return{valid:!1,mergeErrorPath:[r,...a.mergeErrorPath]};n.push(a.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Tn(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),Ze(e))return e;const r=It(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const La=I("$ZodRecord",(e,t)=>{K.init(e,t),e._zod.parse=(n,r)=>{const i=n.value;if(!zt(i))return n.issues.push({expected:"record",code:"invalid_type",input:i,inst:e}),n;const o=[];if(t.keyType._zod.values){const a=t.keyType._zod.values;n.value={};for(const c of a)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){const u=t.valueType._zod.run({value:i[c],issues:[]},r);u instanceof Promise?o.push(u.then(v=>{v.issues.length&&n.issues.push(..._e(c,v.issues)),n.value[c]=v.value})):(u.issues.length&&n.issues.push(..._e(c,u.issues)),n.value[c]=u.value)}let l;for(const c in i)a.has(c)||(l=l??[],l.push(c));l&&l.length>0&&n.issues.push({code:"unrecognized_keys",input:i,inst:e,keys:l})}else{n.value={};for(const a of Reflect.ownKeys(i)){if(a==="__proto__")continue;const l=t.keyType._zod.run({value:a,issues:[]},r);if(l instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(l.issues.length){n.issues.push({origin:"record",code:"invalid_key",issues:l.issues.map(u=>ye(u,r,me())),input:a,path:[a],inst:e}),n.value[l.value]=l.value;continue}const c=t.valueType._zod.run({value:i[a],issues:[]},r);c instanceof Promise?o.push(c.then(u=>{u.issues.length&&n.issues.push(..._e(a,u.issues)),n.value[l.value]=u.value})):(c.issues.length&&n.issues.push(..._e(a,c.issues)),n.value[l.value]=c.value)}}return o.length?Promise.all(o).then(()=>n):n}}),Fa=I("$ZodEnum",(e,t)=>{K.init(e,t);const n=Object.values(t.entries).filter(i=>typeof i=="number"),r=Object.entries(t.entries).filter(([i,o])=>n.indexOf(+i)===-1).map(([i,o])=>o);e._zod.values=new Set(r),e._zod.pattern=new RegExp(`^(${r.filter(i=>oo.has(typeof i)).map(i=>typeof i=="string"?$e(i):i.toString()).join("|")})$`),e._zod.parse=(i,o)=>{const a=i.value;return e._zod.values.has(a)||i.issues.push({code:"invalid_value",values:r,input:a,inst:e}),i}}),Wa=I("$ZodLiteral",(e,t)=>{K.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?$e(n):n?n.toString():String(n)).join("|")})$`),e._zod.parse=(n,r)=>{const i=n.value;return e._zod.values.has(i)||n.issues.push({code:"invalid_value",values:t.values,input:i,inst:e}),n}}),Ba=I("$ZodTransform",(e,t)=>{K.init(e,t),e._zod.parse=(n,r)=>{const i=t.transform(n.value,n);if(r.async)return(i instanceof Promise?i:Promise.resolve(i)).then(a=>(n.value=a,n));if(i instanceof Promise)throw new Me;return n.value=i,n}}),Ja=I("$ZodOptional",(e,t)=>{K.init(e,t),e._zod.optin="optional",e._zod.optout="optional",Y(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),Y(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${qt(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>n.value===void 0?n:t.innerType._zod.run(n,r)}),Ga=I("$ZodNullable",(e,t)=>{K.init(e,t),Y(e._zod,"optin",()=>t.innerType._zod.optin),Y(e._zod,"optout",()=>t.innerType._zod.optout),Y(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${qt(n.source)}|null)$`):void 0}),Y(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),Ka=I("$ZodDefault",(e,t)=>{K.init(e,t),e._zod.optin="optional",Y(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(n.value===void 0)return n.value=t.defaultValue,n;const i=t.innerType._zod.run(n,r);return i instanceof Promise?i.then(o=>An(o,t)):An(i,t)}});function An(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Ha=I("$ZodPrefault",(e,t)=>{K.init(e,t),e._zod.optin="optional",Y(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),Va=I("$ZodNonOptional",(e,t)=>{K.init(e,t),Y(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const i=t.innerType._zod.run(n,r);return i instanceof Promise?i.then(o=>En(o,e)):En(i,e)}});function En(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const qa=I("$ZodCatch",(e,t)=>{K.init(e,t),Y(e._zod,"optin",()=>t.innerType._zod.optin),Y(e._zod,"optout",()=>t.innerType._zod.optout),Y(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{const i=t.innerType._zod.run(n,r);return i instanceof Promise?i.then(o=>(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(a=>ye(a,r,me()))},input:n.value}),n.issues=[]),n)):(n.value=i.value,i.issues.length&&(n.value=t.catchValue({...n,error:{issues:i.issues.map(o=>ye(o,r,me()))},input:n.value}),n.issues=[]),n)}}),Ya=I("$ZodPipe",(e,t)=>{K.init(e,t),Y(e._zod,"values",()=>t.in._zod.values),Y(e._zod,"optin",()=>t.in._zod.optin),Y(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(n,r)=>{const i=t.in._zod.run(n,r);return i instanceof Promise?i.then(o=>$n(o,t,r)):$n(i,t,r)}});function $n(e,t,n){return Ze(e)?e:t.out._zod.run({value:e.value,issues:e.issues},n)}const Xa=I("$ZodReadonly",(e,t)=>{K.init(e,t),Y(e._zod,"disc",()=>t.innerType._zod.disc),Y(e._zod,"optin",()=>t.innerType._zod.optin),Y(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(n,r)=>{const i=t.innerType._zod.run(n,r);return i instanceof Promise?i.then(On):On(i)}});function On(e){return e.value=Object.freeze(e.value),e}const Qa=I("$ZodCustom",(e,t)=>{ie.init(e,t),K.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,i=t.fn(r);if(i instanceof Promise)return i.then(o=>Cn(o,n,r,e));Cn(i,n,r,e)}});function Cn(e,t,n,r){if(!e){const i={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(i.params=r._zod.def.params),t.issues.push(Le(i))}}class eu{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}remove(t){return this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};return delete r.id,{...r,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}}function tu(){return new eu}const Ye=tu();function nu(e,t){return new e({type:"string",...U(t)})}function ru(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...U(t)})}function xn(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...U(t)})}function iu(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...U(t)})}function ou(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...U(t)})}function au(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...U(t)})}function uu(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...U(t)})}function su(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...U(t)})}function cu(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...U(t)})}function fu(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...U(t)})}function lu(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...U(t)})}function hu(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...U(t)})}function pu(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...U(t)})}function du(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...U(t)})}function gu(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...U(t)})}function vu(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...U(t)})}function mu(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...U(t)})}function yu(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...U(t)})}function wu(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...U(t)})}function bu(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...U(t)})}function _u(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...U(t)})}function Su(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...U(t)})}function ku(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...U(t)})}function Tu(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...U(t)})}function Au(e,t){return new e({type:"string",format:"date",check:"string_format",...U(t)})}function Eu(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...U(t)})}function $u(e,t){return new e({type:"string",format:"duration",check:"string_format",...U(t)})}function Ou(e,t){return new e({type:"number",checks:[],...U(t)})}function Cu(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...U(t)})}function xu(e,t){return new e({type:"boolean",...U(t)})}function ju(e){return new e({type:"any"})}function Nu(e){return new e({type:"unknown"})}function Ru(e,t){return new e({type:"never",...U(t)})}function jn(e,t){return new $r({check:"less_than",...U(t),value:e,inclusive:!1})}function kt(e,t){return new $r({check:"less_than",...U(t),value:e,inclusive:!0})}function Nn(e,t){return new Or({check:"greater_than",...U(t),value:e,inclusive:!1})}function Tt(e,t){return new Or({check:"greater_than",...U(t),value:e,inclusive:!0})}function Rn(e,t){return new Ko({check:"multiple_of",...U(t),value:e})}function jr(e,t){return new Vo({check:"max_length",...U(t),maximum:e})}function ot(e,t){return new qo({check:"min_length",...U(t),minimum:e})}function Nr(e,t){return new Yo({check:"length_equals",...U(t),length:e})}function zu(e,t){return new Xo({check:"string_format",format:"regex",...U(t),pattern:e})}function Iu(e){return new Qo({check:"string_format",format:"lowercase",...U(e)})}function Du(e){return new ea({check:"string_format",format:"uppercase",...U(e)})}function Pu(e,t){return new ta({check:"string_format",format:"includes",...U(t),includes:e})}function Zu(e,t){return new na({check:"string_format",format:"starts_with",...U(t),prefix:e})}function Uu(e,t){return new ra({check:"string_format",format:"ends_with",...U(t),suffix:e})}function Be(e){return new ia({check:"overwrite",tx:e})}function Mu(e){return Be(t=>t.normalize(e))}function Lu(){return Be(e=>e.trim())}function Fu(){return Be(e=>e.toLowerCase())}function Wu(){return Be(e=>e.toUpperCase())}function Bu(e,t,n){return new e({type:"array",element:t,...U(n)})}function Ju(e,t,n){return new e({type:"custom",check:"custom",fn:t,...U(n)})}const Gu=I("ZodISODateTime",(e,t)=>{ya.init(e,t),q.init(e,t)});function Ku(e){return Tu(Gu,e)}const Hu=I("ZodISODate",(e,t)=>{wa.init(e,t),q.init(e,t)});function Vu(e){return Au(Hu,e)}const qu=I("ZodISOTime",(e,t)=>{ba.init(e,t),q.init(e,t)});function Yu(e){return Eu(qu,e)}const Xu=I("ZodISODuration",(e,t)=>{_a.init(e,t),q.init(e,t)});function Qu(e){return $u(Xu,e)}const es=(e,t)=>{wr.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>vo(e,n)},flatten:{value:n=>go(e,n)},addIssue:{value:n=>e.issues.push(n)},addIssues:{value:n=>e.issues.push(...n)},isEmpty:{get(){return e.issues.length===0}}})},lt=I("ZodError",es,{Parent:Error}),ts=mo(lt),ns=yo(lt),rs=_r(lt),is=Sr(lt),V=I("ZodType",(e,t)=>(K.init(e,t),e.def=t,e._def=t,e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),e.clone=(n,r)=>Se(e,n,r),e.brand=()=>e,e.register=(n,r)=>(n.add(e,r),e),e.parse=(n,r)=>ts(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>rs(e,n,r),e.parseAsync=async(n,r)=>ns(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>is(e,n,r),e.spa=e.safeParseAsync,e.refine=(n,r)=>e.check(Xs(n,r)),e.superRefine=n=>e.check(Qs(n)),e.overwrite=n=>e.check(Be(n)),e.optional=()=>G(e),e.nullable=()=>ne(e),e.nullish=()=>G(ne(e)),e.nonoptional=n=>Bs(e,n),e.array=()=>at(e),e.or=n=>tn([e,n]),e.and=n=>Rs(e,n),e.transform=n=>Zn(e,Zs(n)),e.default=n=>Ls(e,n),e.prefault=n=>Ws(e,n),e.catch=n=>Gs(e,n),e.pipe=n=>Zn(e,n),e.readonly=()=>Vs(e),e.describe=n=>{const r=e.clone();return Ye.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){var n;return(n=Ye.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return Ye.get(e);const r=e.clone();return Ye.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),Rr=I("_ZodString",(e,t)=>{Qt.init(e,t),V.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(zu(...r)),e.includes=(...r)=>e.check(Pu(...r)),e.startsWith=r=>e.check(Zu(r)),e.endsWith=r=>e.check(Uu(r)),e.min=(...r)=>e.check(ot(...r)),e.max=(...r)=>e.check(jr(...r)),e.length=(...r)=>e.check(Nr(...r)),e.nonempty=(...r)=>e.check(ot(1,...r)),e.lowercase=r=>e.check(Iu(r)),e.uppercase=r=>e.check(Du(r)),e.trim=()=>e.check(Lu()),e.normalize=(...r)=>e.check(Mu(...r)),e.toLowerCase=()=>e.check(Fu()),e.toUpperCase=()=>e.check(Wu())}),os=I("ZodString",(e,t)=>{Qt.init(e,t),Rr.init(e,t),e.email=n=>e.check(ru(as,n)),e.url=n=>e.check(su(us,n)),e.jwt=n=>e.check(ku(Ss,n)),e.emoji=n=>e.check(cu(ss,n)),e.guid=n=>e.check(xn(zn,n)),e.uuid=n=>e.check(iu(Xe,n)),e.uuidv4=n=>e.check(ou(Xe,n)),e.uuidv6=n=>e.check(au(Xe,n)),e.uuidv7=n=>e.check(uu(Xe,n)),e.nanoid=n=>e.check(fu(cs,n)),e.guid=n=>e.check(xn(zn,n)),e.cuid=n=>e.check(lu(fs,n)),e.cuid2=n=>e.check(hu(ls,n)),e.ulid=n=>e.check(pu(hs,n)),e.base64=n=>e.check(bu(ws,n)),e.base64url=n=>e.check(_u(bs,n)),e.xid=n=>e.check(du(ps,n)),e.ksuid=n=>e.check(gu(ds,n)),e.ipv4=n=>e.check(vu(gs,n)),e.ipv6=n=>e.check(mu(vs,n)),e.cidrv4=n=>e.check(yu(ms,n)),e.cidrv6=n=>e.check(wu(ys,n)),e.e164=n=>e.check(Su(_s,n)),e.datetime=n=>e.check(Ku(n)),e.date=n=>e.check(Vu(n)),e.time=n=>e.check(Yu(n)),e.duration=n=>e.check(Qu(n))});function ee(e){return nu(os,e)}const q=I("ZodStringFormat",(e,t)=>{H.init(e,t),Rr.init(e,t)}),as=I("ZodEmail",(e,t)=>{ca.init(e,t),q.init(e,t)}),zn=I("ZodGUID",(e,t)=>{ua.init(e,t),q.init(e,t)}),Xe=I("ZodUUID",(e,t)=>{sa.init(e,t),q.init(e,t)}),us=I("ZodURL",(e,t)=>{fa.init(e,t),q.init(e,t)}),ss=I("ZodEmoji",(e,t)=>{la.init(e,t),q.init(e,t)}),cs=I("ZodNanoID",(e,t)=>{ha.init(e,t),q.init(e,t)}),fs=I("ZodCUID",(e,t)=>{pa.init(e,t),q.init(e,t)}),ls=I("ZodCUID2",(e,t)=>{da.init(e,t),q.init(e,t)}),hs=I("ZodULID",(e,t)=>{ga.init(e,t),q.init(e,t)}),ps=I("ZodXID",(e,t)=>{va.init(e,t),q.init(e,t)}),ds=I("ZodKSUID",(e,t)=>{ma.init(e,t),q.init(e,t)}),gs=I("ZodIPv4",(e,t)=>{Sa.init(e,t),q.init(e,t)}),vs=I("ZodIPv6",(e,t)=>{ka.init(e,t),q.init(e,t)}),ms=I("ZodCIDRv4",(e,t)=>{Ta.init(e,t),q.init(e,t)}),ys=I("ZodCIDRv6",(e,t)=>{Aa.init(e,t),q.init(e,t)}),ws=I("ZodBase64",(e,t)=>{Ea.init(e,t),q.init(e,t)}),bs=I("ZodBase64URL",(e,t)=>{Oa.init(e,t),q.init(e,t)}),_s=I("ZodE164",(e,t)=>{Ca.init(e,t),q.init(e,t)}),Ss=I("ZodJWT",(e,t)=>{ja.init(e,t),q.init(e,t)}),zr=I("ZodNumber",(e,t)=>{xr.init(e,t),V.init(e,t),e.gt=(r,i)=>e.check(Nn(r,i)),e.gte=(r,i)=>e.check(Tt(r,i)),e.min=(r,i)=>e.check(Tt(r,i)),e.lt=(r,i)=>e.check(jn(r,i)),e.lte=(r,i)=>e.check(kt(r,i)),e.max=(r,i)=>e.check(kt(r,i)),e.int=r=>e.check(In(r)),e.safe=r=>e.check(In(r)),e.positive=r=>e.check(Nn(0,r)),e.nonnegative=r=>e.check(Tt(0,r)),e.negative=r=>e.check(jn(0,r)),e.nonpositive=r=>e.check(kt(0,r)),e.multipleOf=(r,i)=>e.check(Rn(r,i)),e.step=(r,i)=>e.check(Rn(r,i)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function se(e){return Ou(zr,e)}const ks=I("ZodNumberFormat",(e,t)=>{Na.init(e,t),zr.init(e,t)});function In(e){return Cu(ks,e)}const Ts=I("ZodBoolean",(e,t)=>{Ra.init(e,t),V.init(e,t)});function Dn(e){return xu(Ts,e)}const As=I("ZodAny",(e,t)=>{za.init(e,t),V.init(e,t)});function en(){return ju(As)}const Es=I("ZodUnknown",(e,t)=>{Ia.init(e,t),V.init(e,t)});function Pn(){return Nu(Es)}const $s=I("ZodNever",(e,t)=>{Da.init(e,t),V.init(e,t)});function Os(e){return Ru($s,e)}const Cs=I("ZodArray",(e,t)=>{Pa.init(e,t),V.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(ot(n,r)),e.nonempty=n=>e.check(ot(1,n)),e.max=(n,r)=>e.check(jr(n,r)),e.length=(n,r)=>e.check(Nr(n,r))});function at(e,t){return Bu(Cs,e,t)}const xs=I("ZodObject",(e,t)=>{Za.init(e,t),V.init(e,t),Y(e,"shape",()=>Object.fromEntries(Object.entries(e._zod.def.shape))),e.keyof=()=>Is(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Pn()}),e.loose=()=>e.clone({...e._zod.def,catchall:Pn()}),e.strict=()=>e.clone({...e._zod.def,catchall:Os()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>fo(e,n),e.merge=n=>lo(e,n),e.pick=n=>so(e,n),e.omit=n=>co(e,n),e.partial=(...n)=>ho(Dr,e,n[0]),e.required=(...n)=>po(Pr,e,n[0])});function xe(e,t){const n={type:"object",get shape(){return Yt(this,"shape",{...e}),this.shape},...U(t)};return new xs(n)}const js=I("ZodUnion",(e,t)=>{Ua.init(e,t),V.init(e,t),e.options=t.options});function tn(e,t){return new js({type:"union",options:e,...U(t)})}const Ns=I("ZodIntersection",(e,t)=>{Ma.init(e,t),V.init(e,t)});function Rs(e,t){return new Ns({type:"intersection",left:e,right:t})}const zs=I("ZodRecord",(e,t)=>{La.init(e,t),V.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function ht(e,t,n){return new zs({type:"record",keyType:e,valueType:t,...U(n)})}const Dt=I("ZodEnum",(e,t)=>{Fa.init(e,t),V.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,i)=>{const o={};for(const a of r)if(n.has(a))o[a]=t.entries[a];else throw new Error(`Key ${a} not found in enum`);return new Dt({...t,checks:[],...U(i),entries:o})},e.exclude=(r,i)=>{const o={...t.entries};for(const a of r)if(n.has(a))delete o[a];else throw new Error(`Key ${a} not found in enum`);return new Dt({...t,checks:[],...U(i),entries:o})}});function Is(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new Dt({type:"enum",entries:n,...U(t)})}const Ds=I("ZodLiteral",(e,t)=>{Wa.init(e,t),V.init(e,t),e.values=new Set(t.values)});function Ir(e,t){return new Ds({type:"literal",values:Array.isArray(e)?e:[e],...U(t)})}const Ps=I("ZodTransform",(e,t)=>{Ba.init(e,t),V.init(e,t),e._zod.parse=(n,r)=>{n.addIssue=o=>{if(typeof o=="string")n.issues.push(Le(o,n.value,t));else{const a=o;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=n.value),a.inst??(a.inst=e),a.continue??(a.continue=!0),n.issues.push(Le(a))}};const i=t.transform(n.value,n);return i instanceof Promise?i.then(o=>(n.value=o,n)):(n.value=i,n)}});function Zs(e){return new Ps({type:"transform",transform:e})}const Dr=I("ZodOptional",(e,t)=>{Ja.init(e,t),V.init(e,t),e.unwrap=()=>e._zod.def.innerType});function G(e){return new Dr({type:"optional",innerType:e})}const Us=I("ZodNullable",(e,t)=>{Ga.init(e,t),V.init(e,t),e.unwrap=()=>e._zod.def.innerType});function ne(e){return new Us({type:"nullable",innerType:e})}const Ms=I("ZodDefault",(e,t)=>{Ka.init(e,t),V.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Ls(e,t){return new Ms({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const Fs=I("ZodPrefault",(e,t)=>{Ha.init(e,t),V.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Ws(e,t){return new Fs({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const Pr=I("ZodNonOptional",(e,t)=>{Va.init(e,t),V.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Bs(e,t){return new Pr({type:"nonoptional",innerType:e,...U(t)})}const Js=I("ZodCatch",(e,t)=>{qa.init(e,t),V.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Gs(e,t){return new Js({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const Ks=I("ZodPipe",(e,t)=>{Ya.init(e,t),V.init(e,t),e.in=t.in,e.out=t.out});function Zn(e,t){return new Ks({type:"pipe",in:e,out:t})}const Hs=I("ZodReadonly",(e,t)=>{Xa.init(e,t),V.init(e,t)});function Vs(e){return new Hs({type:"readonly",innerType:e})}const qs=I("ZodCustom",(e,t)=>{Qa.init(e,t),V.init(e,t)});function Ys(e,t){const n=new ie({check:"custom",...U(t)});return n._zod.check=e,n}function Xs(e,t={}){return Ju(qs,e,t)}function Qs(e,t){const n=Ys(r=>(r.addIssue=i=>{if(typeof i=="string")r.issues.push(Le(i,r.value,n._zod.def));else{const o=i;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=n),o.continue??(o.continue=!n._zod.def.abort),r.issues.push(Le(o))}},e(r.value,r)),t);return n}const ae=ee().min(1),Zr=ee().min(1),ec=se().gte(0),Oe=se().gte(0).lte(1),tc=ht(ae,Oe),nc=xe({id:ae,name:Zr,type:Ir("NonRootNode"),manual_fulfillment:ne(se()),children:at(en()),points:ec,parent_id:ae,contributor_ids:at(ae)}),Ur=xe({id:ae,name:Zr,type:Ir("RootNode"),manual_fulfillment:ne(se()),children:at(en()),user_id:ae,created_at:ee(),updated_at:ee()});tn([Ur,nc]);const Mr=xe({id:ae,name:ee(),emoji:G(ee()),quantity:G(se().gte(0)),unit:G(ee()),location_type:G(ee()),longitude:G(se().min(-180).max(180)),latitude:G(se().min(-90).max(90)),all_day:G(Dn()),recurrence:G(ne(ee())),custom_recurrence_repeat_every:G(ne(se())),custom_recurrence_repeat_unit:G(ne(ee())),custom_recurrence_end_type:G(ne(ee())),custom_recurrence_end_value:G(ne(ee())),start_date:G(ne(ee())),start_time:G(ne(ee())),end_date:G(ne(ee())),end_time:G(ne(ee())),time_zone:G(ee()),max_natural_div:G(se().gte(1)),max_percentage_div:G(Oe),hidden_until_request_accepted:G(Dn()),owner_id:G(ae),filter_rule:G(ne(en()))}),rc=xe({...Mr.shape,recipient_shares:ht(ae,Oe)}),ic=xe({...Mr.shape,share_percentage:Oe,computed_quantity:se().gte(0),provider_id:ae}),oc=tn([rc,ic]),ac=ht(ae,oc),uc=xe({ourShare:Oe,theirShare:Oe,timestamp:se()});ht(ae,uc);const re=X(null),pt=X(null),Je=X(null),Fe=X({}),Ee=X({}),ef=de([Ee,Fe],([e,t])=>{if(!e||!t)return console.log("[NETWORK-CAPACITIES] No network data available, returning empty"),{};console.log("networkCapacityShares",e),console.log("networkCapacities",t);const n={};return Object.entries(e).forEach(([r,i])=>{const o=t[r];o&&Object.entries(i).forEach(([a,l])=>{const c=o[a];c&&(n[a]={...c,share_percentage:l,computed_quantity:Yi(c,l),provider_id:r})})}),console.log(`[NETWORK-CAPACITIES] Found ${Object.keys(n).length} capacities where we have shares`),n}),Ge=X({}),dt=X([]),At=X([]),pe=X({}),nn=de(pe,e=>{console.log(`[MUTUAL-RECOGNITION] ${new Date().toISOString()} Recalculating from cache:`,e);const t={};for(const[n,r]of Object.entries(e)){const i=Math.min(r.ourShare,r.theirShare);t[n]=i,console.log(`[MUTUAL-RECOGNITION] ${n}: our=${r.ourShare.toFixed(4)}, their=${r.theirShare.toFixed(4)}, mutual=${i.toFixed(4)}`)}return console.log("[MUTUAL-RECOGNITION] Final mutual values:",t),t}),Lr=de(nn,e=>Object.entries(e).filter(([n,r])=>r>0).map(([n,r])=>n)),Fr=de(nn,e=>{if(console.log(`[PROVIDER-SHARES] ${new Date().toISOString()} Recalculating from mutual recognition:`,e),Object.keys(e).length===0)return console.log("[PROVIDER-SHARES] No mutual recognition data, returning empty"),{};const t=We(e);return console.log("[PROVIDER-SHARES] Normalized shares:",t),t}),sc=de([re,Ge],([e,t])=>{if(!e)return console.log("[SUBTREE-MAP] No tree available, returning empty map"),{};console.log("[SUBTREE-MAP] Calculating subtree contributor map...");const n=dr(e);return console.log("[SUBTREE-MAP] Generated filter map for",Object.keys(n).length,"subtrees"),n}),Wr=de([Je,Fr,Ge,sc],([e,t,n,r])=>{if(console.log(`[CAPACITY-SHARES] ${new Date().toISOString()} Recalculating from capacities and provider shares`),!e||Object.keys(t).length===0)return console.log("[CAPACITY-SHARES] No capacities or provider shares, returning empty"),{};const i={};return Object.entries(e).forEach(([o,a])=>{try{const c=Gi(a,t,{node:n,subtreeContributors:r});i[o]=c}catch(l){console.error("[CAPACITY-SHARES] Error calculating shares for capacity:",o,l),i[o]={}}}),console.log("[CAPACITY-SHARES] Generated shares for",Object.keys(i).length,"capacities"),i}),Br=de(Wr,e=>{console.log(`[CAPACITY-SHARES] ${new Date().toISOString()} Recalculating from capacity shares`);const t={};return Object.entries(e).forEach(([n,r])=>{Object.entries(r).forEach(([i,o])=>{t[i]||(t[i]={}),t[i][n]=o})}),console.log("[CAPACITY-SHARES] Generated contributor shares map:",t),t}),tf=de([Je,Wr],([e,t])=>{if(console.log(`[CAPACITIES-WITH-SHARES] ${new Date().toISOString()} Combining capacities with shares`),!e)return console.log("[CAPACITIES-WITH-SHARES] No capacities available, returning null"),null;const n={};return Object.entries(e).forEach(([r,i])=>{const o=t[r]||{};n[r]={...i,recipient_shares:o}}),console.log("[CAPACITIES-WITH-SHARES] Generated",Object.keys(n).length,"capacities with shares"),n});de([re,Ge],([e,t])=>{if(!e)return[];const n=dr(e);return Object.entries(n).map(([r,i])=>{const o=Object.keys(i),a=Kt(e,r),l=(a==null?void 0:a.name)||r;return{id:r,name:l,contributorCount:o.length,contributors:o}}).filter(r=>r.contributorCount>0)});const ut=X(!1),Ae=X(!1),Pt=X(!1),Zt=X(!1);function rn(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var tt={exports:{}};tt.exports;var Un;function ke(){return Un||(Un=1,function(e){(function(){function t(r,i){return i?rn(r):r.slice?t[o(r)]:function(a,l){r(a={exports:{}}),t[o(l)]=a.exports};function o(a){return a.split("/").slice(-1).toString().replace(".js","")}}var n=e;t(function(r){String.random=function(o,a){var l="";for(o=o||24,a=a||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";o-- >0;)l+=a.charAt(Math.floor(Math.random()*a.length));return l},String.match=function(o,a){var l,c;return typeof o!="string"?!1:(typeof a=="string"&&(a={"=":a}),a=a||{},l=a["="]||a["*"]||a[">"]||a["<"],o===l?!0:c!==a["="]?!1:(l=a["*"]||a[">"],o.slice(0,(l||"").length)===l?!0:c!==a["*"]?!1:c!==a[">"]&&c!==a["<"]?o>=a[">"]&&o<=a["<"]:c!==a[">"]&&o>=a[">"]||c!==a["<"]&&o<=a["<"]))},String.hash=function(o,a){if(typeof o=="string"){if(a=a||0,!o.length)return a;for(var l=0,c=o.length,u;l<c;++l)u=o.charCodeAt(l),a=(a<<5)-a+u,a|=0;return a}};var i=Object.prototype.hasOwnProperty;Object.plain=function(o){return o?o instanceof Object&&o.constructor===Object||Object.prototype.toString.call(o).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(o,a){for(var l in o)if(i.call(o,l)&&(!a||a.indexOf(l)==-1))return!1;return!0},Object.keys=Object.keys||function(o){var a=[];for(var l in o)i.call(o,l)&&a.push(l);return a},function(){var o,a=setTimeout,l=0,c=0,u=typeof setImmediate!=""+o&&setImmediate||function(d,h){return typeof MessageChannel==""+o?a:((d=new MessageChannel).port1.onmessage=function(S){S.data==""&&h()},function(S){h=S,d.port2.postMessage("")})}(),v=a.check=a.check||typeof performance!=""+o&&performance||{now:function(){return+new Date}};a.hold=a.hold||9,a.poll=a.poll||function(d){if(a.hold>=v.now()-l&&c++<3333){d();return}u(function(){l=v.now(),d()},c=0)}}(),function(){var o=setTimeout,a=o.turn=o.turn||function(h){l.push(h)==1&&c(d)},l=a.s=[],c=o.poll,u=0,v,d=function(){(v=l[u++])&&v(),(u==l.length||u==99)&&(l=a.s=l.slice(u),u=0),l.length&&c(d)}}(),function(){var o,a=setTimeout,l=a.turn;(a.each=a.each||function(c,u,v,d){d=d||9,function h(S,g,_){if(g=(S=(c||[]).splice(0,d)).length){for(var y=0;y<g&&o===(_=u(S[y]));y++);if(o===_){l(h);return}}v&&v(_)}()})()}()})(t,"./shim"),t(function(r){r.exports=function i(v,a,l){if(!v)return{to:i};var c,u=typeof a=="function",v=(this.tag||(this.tag={}))[v]||u&&(this.tag[v]={tag:v,to:i._={next:function(h){var S;(S=this.to)&&S.next(h)}}});if(u){var d={off:i.off||(i.off=function(){if(this.next===i._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=i._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:i._,next:a,the:v,on:this,as:l};return(d.back=v.last||v).to=d,v.last=d}return(v=v.to)&&c!==a&&v.next(a),v}})(t,"./onto"),t(function(r){r.exports=function(i){return i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"&&i!=1/0&&i!=-1/0&&i===i||!!i&&typeof i["#"]=="string"&&Object.keys(i).length===1&&i["#"]}})(t,"./valid"),t(function(r){t("./shim");function i(){var v=+new Date;return c<v?(a=0,c=v+i.drift):c=v+(a+=1)/l+i.drift}i.drift=0;var o=-1/0,a=0,l=999,c=o,u;i.is=function(v,d,h){var S=d&&v&&v._&&v._[">"]||h;if(S)return typeof(S=S[d])=="number"?S:o},i.ify=function(v,d,h,S,g){(v=v||{})._=v._||{},g&&(v._["#"]=g);var _=v._[">"]||(v._[">"]={});return u!==d&&d!=="_"&&(typeof h=="number"&&(_[d]=h),u!==S&&(v[d]=S)),v},r.exports=i})(t,"./state"),t(function(r){t("./shim");function i(o){var a={s:{}},l=a.s;o=o||{max:999,age:1e3*9},a.check=function(u){return l[u]?c(u):!1};var c=a.track=function(u){var v=l[u]||(l[u]={});return v.was=a.now=+new Date,a.to||(a.to=setTimeout(a.drop,o.age+9)),c.ed&&c.ed(u),v};return a.drop=function(u){a.to=null,a.now=+new Date;var v=Object.keys(l);console.STAT&&console.STAT(a.now,+new Date-a.now,"dup drop keys"),setTimeout.each(v,function(d){var h=l[d];h&&(u||o.age)>a.now-h.was||delete l[d]},0,99)},a}r.exports=i})(t,"./dup"),t(function(r){t("./onto"),r.exports=function(a,l){if(this.on){var c=(this.opt||{}).lack||9e3;if(typeof a!="function"){if(!a)return;var v=a["#"]||a,u=(this.tag||"")[v];return u?(l&&(u=this.on(v,l),clearTimeout(u.err),u.err=setTimeout(function(){u.off()},c)),!0):void 0}var v=l&&l["#"]||i(9);if(!a)return v;var d=this.on(v,a,l);return d.err=d.err||setTimeout(function(){d.off(),d.next({err:"Error: No ACK yet.",lack:!0})},c),v}};var i=String.random||function(){return Math.random().toString(36).slice(2)}})(t,"./ask"),t(function(r){function i(g){return g instanceof i?(this._={$:this}).$:this instanceof i?i.create(this._={$:this,opt:g}):new i(g)}i.is=function(g){return g instanceof i||g&&g._&&g===g._.$||!1},i.version=.202,i.chain=i.prototype,i.chain.toJSON=function(){},t("./shim"),i.valid=t("./valid"),i.state=t("./state"),i.on=t("./onto"),i.dup=t("./dup"),i.ask=t("./ask"),function(){i.create=function(b){b.root=b.root||b,b.graph=b.graph||{},b.on=b.on||i.on,b.ask=b.ask||i.ask,b.dup=b.dup||i.dup();var $=b.$.opt(b.opt);return b.once||(b.on("in",g,b),b.on("out",g,b),b.on("put",w,b),i.on("create",b),b.on("create",b)),b.once=1,$};function g(b){if(b){if(b.out===g){this.to.next(b);return}var $=this,C=$.as,z=C.at||C,j=z.$,N=z.dup,D,P=b.DBG;if((D=b["#"])||(D=b["#"]=a(9)),!N.check(D)){if(N.track(D),D=b._,b._=typeof D=="function"?D:function(){},b.$&&b.$===(b.$._||"").$||(b.$=j),b["@"]&&!b.put&&s(b),!z.ask(b["@"],b))if(P&&(P.u=+new Date),b.put){_(b);return}else b.get&&i.on.get(b,j);P&&(P.uc=+new Date),$.to.next(b),P&&(P.ua=+new Date),!(b.nts||b.NTS)&&(b.out=g,z.on("out",b),P&&(P.ue=+new Date))}}}function _(b){if(b){var $=b._||"",C=$.root=(($.$=b.$||"")._||"").root;if(b["@"]&&$.faith&&!$.miss){b.out=g,C.on("out",b);return}$.latch=C.hatch,$.match=C.hatch=[];var z=b.put,j=$.DBG=b.DBG,N=+new Date;if(x=x||N,!(z["#"]&&z["."])){j&&(j.p=N),$["#"]=b["#"],$.msg=b,$.all=0,$.stun=1;var D=Object.keys(z);console.STAT&&console.STAT(N,((j||$).pk=+new Date)-N,"put sort");var P=0,M,W,B,J,te,ue,je;(function we(Ke){if(M!=P){if(M=P,!(B=D[P])){console.STAT&&console.STAT(N,((j||$).pd=+new Date)-N,"put"),f($);return}(J=z[B])?(je=J._)?B!==je["#"]?ue=m+A(B)+"soul not same.":(te=je[">"])||(ue=m+A(B)+"no state."):ue=m+A(B)+"no meta.":ue=m+A(B)+"no node.",W=Object.keys(J||{})}if(ue){b.err=$.err=ue,f($);return}var an=0,be;for(Ke=Ke||0;Ke++<9&&(be=W[an++]);)if(be!=="_"){var He=J[be],un=te[be];if(d===un){ue=m+A(be)+"on"+A(B)+"no state.";break}if(!c(He)){ue=m+A(be)+"on"+A(B)+"bad "+typeof He+A(He);break}y(He,be,B,un,b),++R}if((W=W.slice(an)).length){l(we);return}++P,W=null,we(Ke)})()}}}i.on.put=_;function y(b,$,C,z,j){var N=j._||"",D=N.root,P=D.graph,M,W=P[C]||h,B=u(W,$,1),J=W[$],te=N.DBG;(M=console.STAT)&&(!P[C]||!J)&&(M.has=(M.has||0)+1);var ue=O();if(z>ue){setTimeout(function(){y(b,$,C,z,j)},(M=z-ue)>k?k:M),console.STAT&&console.STAT((te||N).Hf=+new Date,M,"future");return}if(!(z<B)&&!(!N.faith&&z===B&&(b===J||T(b)<=T(J))&&!N.miss)){N.stun++;var je=j["#"]+N.all++,we={toString:function(){return je},_:N};we.toJSON=we.toString,D.dup.track(we)["#"]=j["#"],te&&(te.ph=te.ph||+new Date),D.on("put",{"#":we,"@":j["@"],put:{"#":C,".":$,":":b,">":z},ok:j.ok,_:N})}}function w(b){var $;($=(b._||"").DBG)&&($.pa=+new Date,$.pm=$.pm||+new Date);var C=this,z=C.as,j=z.graph,N=b._,D=b.put,P=D["#"],M=D["."],W=D[":"],B=D[">"];b["#"];var J;(J=N.msg)&&(J=J.put)&&(J=J[P])&&v(J,M,B,W,P),j[P]=v(j[P],M,B,W,P),(J=(z.next||"")[P])&&J.on("in",b),f(N),C.to.next(b)}function f(b,$){var C;if(!b.stop&&!(!b.err&&0<--b.stun)&&(b.stop=1,!!(C=b.root))){var z=b.match;z.end=1,z===C.hatch&&(!(z=b.latch)||z.end?delete C.hatch:C.hatch=z),b.hatch&&b.hatch(),setTimeout.each(b.match,function(j){j&&j()}),!(!($=b.msg)||b.err||$.err)&&($.out=g,b.root.on("out",$),E())}}function s(b){var $=b["@"]||"",C;if(!(C=$._)){var z=(z=b.$)&&(z=z._)&&(z=z.root)&&(z=z.dup);if(!(z=z.check($)))return;b["@"]=z["#"]||b["@"];return}C.acks=(C.acks||0)+1,(C.err=b.err)&&(b["@"]=C["#"],f(C)),C.ok=b.ok||C.ok,!C.stop&&!C.crack&&(C.crack=C.match&&C.match.push(function(){p(C)})),p(C)}function p(b){!b||!b.root||b.stun||b.acks!==b.all||b.root.on("in",{"@":b["#"],err:b.err,ok:b.err?d:b.ok||{"":1}})}var m="Error: Invalid graph!",A=function(b){return" '"+(""+b).slice(0,9)+"...' "},T=JSON.stringify,k=2147483647,O=i.state,R=0,x,E=function(){R>999&&R/-(x-(x=+new Date))>1&&(i.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),E=function(){R=0})}}(),function(){i.on.get=function(_,y){var w=y._,f=_.get,s=f["#"],p=w.graph[s],m=f["."],A=w.next||(w.next={}),T=A[s],k=_._||{},O=k.DBG=_.DBG;if(O&&(O.g=+new Date),!p)return w.on("get",_);if(m){if((typeof m!="string"||d===p[m])&&!((T||"").next||"")[m]){w.on("get",_);return}p=v({},m,u(p,m),p[m],s)}p&&g(_,p),w.on("get",_)};function g(_,y){var w=+new Date,f=_._||{},s=f.DBG=_.DBG,p=_["#"],m=a(9),A=Object.keys(y||"").sort(),T=((y||"")._||"")["#"];A.length;var k=_.$._.root,O=y===k.graph[T];console.STAT&&console.STAT(w,((s||f).gk=+new Date)-w,"got keys"),y&&function R(){w=+new Date;for(var x=0,E,b={},$;x<9&&(E=A[x++]);)v(b,E,u(y,E),y[E],T);A=A.slice(x),($={})[T]=b,b=$;var C;O&&(C=function(){},C.ram=C.faith=!0),$=A.length,console.STAT&&console.STAT(w,-(w-(w=+new Date)),"got copied some"),s&&(s.ga=+new Date),k.on("in",{"@":p,"#":m,put:b,"%":$?m=a(9):d,$:k.$,_:C,DBG:s,FOO:1}),console.STAT&&console.STAT(w,+new Date-w,"got in"),$&&setTimeout.turn(R)}(),y||k.on("in",{"@":_["#"]})}i.on.get.ack=g}(),function(){i.chain.opt=function(g){g=g||{};var _=this,y=_._,w=g.peers||g;return Object.plain(g)||(g={}),Object.plain(y.opt)||(y.opt=g),typeof w=="string"&&(w=[w]),Object.plain(y.opt.peers)||(y.opt.peers={}),w instanceof Array&&(g.peers={},w.forEach(function(f){var s={};s.id=s.url=f,g.peers[f]=y.opt.peers[f]=y.opt.peers[f]||s})),o(g,function f(s){var p=this[s];if(this&&this.hasOwnProperty(s)||typeof p=="string"||Object.empty(p)){this[s]=p;return}p&&p.constructor!==Object&&!(p instanceof Array)||o(p,f)}),y.opt.from=g,i.on("opt",y),y.opt.uuid=y.opt.uuid||function(s){return i.state().toString(36).replace(".","")+String.random(s||12)},_}}();var o=function(g,_){Object.keys(g).forEach(_,g)},a=String.random,l=setTimeout.turn,c=i.valid,u=i.state.is,v=i.state.ify,d,h={},S;i.log=function(){return!i.log.off&&S.log.apply(S,arguments),[].slice.call(arguments).join(" ")},i.log.once=function(g,_,y){return(y=i.log.once)[g]=y[g]||0,y[g]++||i.log(_)},typeof window<"u"&&((window.GUN=window.Gun=i).window=window);try{typeof n<"u"&&(n.exports=i)}catch{}r.exports=i,(i.window||{}).console=(i.window||{}).console||{log:function(){}},(S=console).only=function(g,_){return S.only.i&&g===S.only.i&&S.only.i++&&(S.log.apply(S,arguments)||_)},i.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(t,"./root"),t(function(r){var i=t("./root");i.chain.back=function(l,c){var u;if(l=l||1,l===-1||l===1/0)return this._.root.$;if(l===1)return(this._.back||this._).$;var v=this,d=v._;if(typeof l=="string"&&(l=l.split(".")),l instanceof Array){var h=0,S=l.length,u=d;for(h;h<S;h++)u=(u||o)[l[h]];return a!==u?c?v:u:(u=d.back)?u.$.back(l,c):void 0}if(typeof l=="function"){for(var g,u={back:d};(u=u.back)&&a===(g=l(u,c)););return g}return typeof l=="number"?(d.back||d).$.back(l-1):this};var o={},a})(t,"./back"),t(function(r){var i=t("./root");i.chain.chain=function(f){var s=this,p=s._,m=new(f||s).constructor(s),A=m._,T;return A.root=T=p.root,A.id=++T.once,A.back=s._,A.on=i.on,A.on("in",i.on.in,A),A.on("out",i.on.out,A),m};function o(f){var s,p=this.as,m=p.back,A=p.root,T;if(f.$||(f.$=p.$),this.to.next(f),p.err){p.on("in",{put:p.put=d,$:p.$});return}if(s=f.get){if(A.pass&&(A.pass[p.id]=p),p.lex&&Object.keys(p.lex).forEach(function(k){T[k]=p.lex[k]},T=f.get=f.get||{}),s["#"]||p.soul){if(s["#"]=s["#"]||p.soul,f["#"]||(f["#"]=h(9)),m=A.$.get(s["#"])._,s=s["."]){if(g(m.put,s)&&(T=m.ask&&m.ask[s],(m.ask||(m.ask={}))[s]=m.$.get(s)._,m.on("in",{get:s,put:{"#":m.soul,".":s,":":m.put[s],">":y(A.graph[m.soul],s)}}),T))return}else{if(T=m.ask&&m.ask[""],(m.ask||(m.ask={}))[""]=m,d!==m.put&&(m.on("in",m),T))return;f.$=m.$}return A.ask(u,f),A.on("in",f)}if(s["."])return p.get?(f={get:{".":p.get},$:p.$},(m.ask||(m.ask={}))[p.get]=f.$._,m.on("out",f)):(f={get:p.lex?f.get:{},$:p.$},m.on("out",f));if((p.ask||(p.ask={}))[""]=p,p.get)return s["."]=p.get,(m.ask||(m.ask={}))[p.get]=f.$._,m.on("out",f)}return m.on("out",f)}i.on.out=o;function a(f,s){s=s||this.as;var p=s.root,m=f.$||(f.$=s.$),A=(m||"")._||v,T=f.put||"",k=T["#"],O=T["."],R=d!==T["="]?T["="]:T[":"],x=T[">"]||-1/0,E;if(d!==f.put&&(d===T["#"]||d===T["."]||d===T[":"]&&d===T["="]||d===T[">"])){if(!S(T)){if(!(k=((T||"")._||"")["#"])){console.log("chain not yet supported for",T,"...",f,s);return}return m=s.root.$.get(k),setTimeout.each(Object.keys(T).sort(),function(b){b=="_"||d===(x=y(T,b))||s.on("in",{$:m,put:{"#":k,".":b,"=":T[b],">":x},VIA:f})})}s.on("in",{$:A.back.$,put:{"#":k=A.back.soul,".":O=A.has||A.get,"=":T,">":y(A.back.put,O)},via:f});return}(f.seen||"")[s.id]||((f.seen||(f.seen=function(){}))[s.id]=s,s!==A&&(Object.keys(f).forEach(function(b){T[b]=f[b]},T={}),T.get=s.get||T.get,!s.soul&&!s.has?T.$$$=T.$$$||s.$:A.soul&&(T.$=s.$,T.$$=T.$$||A.$),f=T),c(f,s),(s.soul||f.$$)&&x>=y(p.graph[k],O)&&((T=p.$.get(k)._).put=w(T.put,O,x,R,k)),!A.soul&&x>=y(p.graph[k],O)&&(E=(p.$.get(k)._.next||"")[O])&&(E.put=R,typeof(T=S(R))=="string"&&(E.put=p.$.get(T)._.put||R)),this.to&&this.to.next(f),s.any&&setTimeout.each(Object.keys(s.any),function(b){(b=s.any[b])&&b(f)},0,99),s.echo&&setTimeout.each(Object.keys(s.echo),function(b){(b=s.echo[b])&&b.on("in",f)},0,99),((f.$$||"")._||A).soul&&(E=s.next)&&(E=E[O])&&(T={},Object.keys(f).forEach(function(b){T[b]=f[b]}),T.$=(f.$$||f.$).get(T.get=O),delete T.$$,delete T.$$$,E.on("in",T)),l(f,s))}i.on.in=a;function l(f,s){if(s=s||this.as||f.$._,!(f.$$&&this!==i.on)&&!(!f.put||s.soul)){var p=f.put||"",m=p["="]||p[":"],O,A=s.root,T=A.$.get(p["#"]).get(p["."])._;if(typeof(m=S(m))!="string"){this===i.on&&((T.echo||(T.echo={}))[s.id]=s);return}if(!((T.echo||(T.echo={}))[s.id]&&!(A.pass||"")[s.id])){if(O=A.pass){if(O[m+s.id])return;O[m+s.id]=1}(T.echo||(T.echo={}))[s.id]=s,s.has&&(s.link=m);var k=A.$.get(T.link=m)._;(k.echo||(k.echo={}))[T.id]=T;var O=s.ask||"";(O[""]||s.lex)&&k.on("out",{get:{"#":m}}),setTimeout.each(Object.keys(O),function(R,x){!R||!(x=O[R])||x.on("out",{get:{"#":m,".":R}})},0,99)}}}i.on.link=l;function c(f,s){var p=f.put||"",m=d!==p["="]?p["="]:p[":"],A=s.root,T,k;if(d===m){if(s.soul&&d!==s.put||(k=(f.$$||f.$||"")._||"",f["@"]&&(d!==k.put||d!==s.put)))return;(T=s.link||f.linked)&&delete(A.$.get(T)._.echo||"")[s.id],s.has&&(s.link=null),s.put=d,setTimeout.each(Object.keys(s.next||""),function(O,R){(R=s.next[O])&&(T&&delete(A.$.get(T).get(O)._.echo||"")[R.id],R.on("in",{get:O,put:d,$:R.$}))},0,99);return}s.soul||f.$$||(T=S(m),k=f.$._||"",!((T===k.link||s.has&&!k.link)&&!((A.pass||"")[s.id]&&typeof T!="string"))&&(delete(k.echo||"")[s.id],c({get:s.get,put:d,$:f.$,linked:f.linked=f.linked||k.link},s)))}i.on.unlink=c;function u(f,s){var p=this.as,m=p.$._;m.root;var A=p.get||"",T=(f.put||"")[A["#"]]||"";if(!f.put||typeof A["."]=="string"&&d===T[A["."]]){if(d!==m.put||!m.soul&&!m.has)return;m.ack=(m.ack||0)+1,m.on("in",{get:m.get,put:m.put=d,$:m.$,"@":f["@"]});return}(f._||{}).miss=1,i.on.put(f)}var v={},d,h=String.random,S=i.valid,g=function(f,s){return f&&Object.prototype.hasOwnProperty.call(f,s)},_=i.state,y=_.is,w=_.ify})(t,"./chain"),t(function(r){var i=t("./root");i.chain.get=function(d,h,S){var g,_;if(typeof d=="string"){if(d.length==0)return(g=this.chain())._.err={err:i.log("0 length key!",d)},h&&h.call(g,g._.err),g;var y=this,w=y._,f=w.next||c;(g=f[d])||(g=d&&o(d,y)),g=g&&g.$}else if(typeof d=="function"){let k=function(O,R,x){if(!k.stun&&!((j=p.pass)&&!j[m])){var E=O.$._,b=(O.$$||"")._,$=(b||E).put,C=!E.has&&!E.soul,z={},j;if((C||v===$)&&($=v===((j=O.put)||"")["="]?v===(j||"")[":"]?j:j[":"]:j["="]),typeof(j=i.valid($))=="string"&&($=v===(j=p.$.get(j)._.put)?s.not?v:$:j),!(s.not&&v===$)){if(v===s.stun){if((j=p.stun)&&j.on&&(w.$.back(function(N){if(j.on(""+N.id,z={}),(z.run||0)<k.id)return z}),!z.run&&j.on(""+E.id,z={}),!z.run&&b&&j.on(""+b.id,z={}),k.id>z.run&&((!z.stun||z.stun.end)&&(z.stun=j.on("stun"),z.stun=z.stun&&z.stun.last),z.stun&&!z.stun.end))){(z.stun.add||(z.stun.add={}))[m]=function(){k(O,R,1)};return}if(v===$&&(x=0),(j=p.hatch)&&!j.end&&v===s.hatch&&!x){if(A[E.$._.id])return;A[E.$._.id]=1,j.push(function(){k(O,R,1)});return}A={}}if(p.pass){if(p.pass[m+E.id])return;p.pass[m+E.id]=1}if(s.on){s.ok.call(E.$,$,E.get,O,R||k);return}if(s.v2020){s.ok(O,R||k);return}Object.keys(O).forEach(function(N){j[N]=O[N]},j={}),O=j,O.put=$,s.ok.call(s.as,O,R||k)}}};if(h===!0)return a(this,d,h,S),this;g=this;var w=g._,s=h||{},p=w.root,m;s.at=w,s.ok=d;var A={};return k.at=w,(w.any||(w.any={}))[m=String.random(7)]=k,k.off=function(){k.stun=1,w.any&&delete w.any[m]},k.rid=l,k.id=s.run||++p.once,_=p.pass,(p.pass={})[m]=1,s.out=s.out||{get:{}},w.on("out",s.out),p.pass=_,g}else{if(typeof d=="number")return this.get(""+d,h,S);if(typeof(_=u(d))=="string")return this.get(_,h,S);(_=this.get.next)&&(g=_(this,d))}return g?(h&&typeof h=="function"&&g.get(h,S),g):((g=this.chain())._.err={err:i.log("Invalid get request!",d)},h&&h.call(g,g._.err),g)};function o(d,h){var S=h._,g=S.next,_=h.chain(),y=_._;return g||(g=S.next={}),g[y.get=d]=y,h===S.root.$?y.soul=d:(S.soul||S.has)&&(y.has=d),y}function a(d,h,S,g){var _=d._,y=0,w;return(w=_.soul||_.link)?h(w,g,_):_.jam?_.jam.push([h,g]):(_.jam=[[h,g]],d.get(function(s,p){if(!(v===s.put&&!_.root.opt.super&&(w=Object.keys(_.root.opt.peers).length)&&++y<=w)){p.rid(s);var m=(m=s.$)&&m._||{},A=0,T;for(w=_.jam,delete _.jam;T=w[A++];){var k=T[0];T=T[1],k&&k(m.link||m.soul||i.valid(s.put)||((s.put||{})._||{})["#"],T,s,p)}}},{out:{get:{".":!0}}}),d)}function l(d){var h=this.at||this.on;if(!d||h.soul||h.has)return this.off();if(d=(d=(d=d.$||d)._||d).id){h.map;var S;if((S=this.seen||(this.seen={}))[d])return!0;S[d]=!0}}var c={},u=i.valid,v})(t,"./get"),t(function(r){var i=t("./root");i.chain.put=function(g,_,y){var w=this,f=w._,s=f.root;y=y||{},y.root=f.root,y.run||(y.run=s.once),o(y,f.id),y.ack=y.ack||_,y.via=y.via||w,y.data=y.data||g,y.soul||(y.soul=f.soul||typeof _=="string"&&_);var p=y.state=y.state||i.state();return typeof g=="function"?(g(function(m){y.data=m,w.put(u,u,y)}),w):y.soul?(y.$=s.$.get(y.soul),y.todo=[{it:y.data,ref:y.$}],y.turn=y.turn||d,y.ran=y.ran||a,function m(){var A=y.todo,T=A.pop(),k=T.it;T.ref&&T.ref._.id;var O,R,x,E,b;if(o(y,T.ref),(E=T.todo)&&(R=E.pop(),k=k[R],E.length&&A.push(T)),R&&(A.path||(A.path=[])).push(R),!(O=h(k))&&!(b=i.is(k))){if(!Object.plain(k)){a.err(y,"Invalid data: "+c(k)+" at "+(y.via.back(function(j){j.get&&E.push(j.get)},E=[])||E.join("."))+"."+(A.path||[]).join("."));return}for(var $=y.seen||(y.seen=[]),C=$.length;C--;)if(k===(E=$[C]).it){O=k=E.link;break}}if(R&&O)T.node=S(T.node,R,p,k);else{let j=function(N,D){var P=x.link["#"];D&&(D.off(),D.rid(N));var M=P||N.soul||(E=(N.$$||N.$)._||"").soul||E.link||((E=E.put||"")._||"")["#"]||E["#"]||((E=N.put||"")&&N.$$?E["#"]:(E["="]||E[":"]||"")["#"]);if(!P&&o(y,N.$),!M&&!T.link["#"]){(T.wait||(T.wait=[])).push(function(){j(N,D)});return}M||(M=[],(N.$$||N.$).back(function(W){if(E=W.soul||W.link)return M.push(E);M.push(W.get)}),M=M.reverse().join("/")),x.link["#"]=M,!b&&(((y.graph||(y.graph={}))[M]=x.node||(x.node={_:{}}))._["#"]=M),delete y.wait[z],x.wait&&setTimeout.each(x.wait,function(W){W&&W()}),y.ran(y)};if(!y.seen){a.err(y,"Data at root of graph must be a node (an object).");return}y.seen.push(x={it:k,link:{},todo:b?[]:Object.keys(k).sort().reverse(),path:(A.path||[]).slice(),up:T}),T.node=S(T.node,R,p,x.link),!b&&x.todo.length&&A.push(x);var z=y.seen.length;(y.wait||(y.wait={}))[z]="",E=(x.ref=b?k:R?T.ref.get(R):T.ref)._,(E=k&&(k._||"")["#"]||E.soul||E.link)?j({soul:E}):x.ref.get(j,{run:y.run,v2020:1,out:{get:{".":" "}}})}if(!A.length)return y.ran(y);y.turn(m)}(),w):(l(y),w)};function o(g,_){if(_){_=(_._||"").id||_;var y=g.root.stun||(g.root.stun={on:i.on}),w={},f;g.stun||(g.stun=y.on("stun",function(){})),(f=y.on(""+_))&&f.the.last.next(w),!(w.run>=g.run)&&y.on(""+_,function(s){if(g.stun.end){this.off(),this.to.next(s);return}s.run=s.run||g.run,s.stun=s.stun||g.stun})}}function a(g){if(g.err){a.end(g.stun,g.root);return}if(!(g.todo.length||g.end||!Object.empty(g.wait))){g.end=1;var _=g.$.back(-1)._,y=_.root,w=_.ask(function(m){y.on("ack",m),m.err&&!m.lack&&i.log(m),++f>(g.acks||0)&&this.off(),g.ack&&g.ack(m,this)},g.opt),f=0,s=g.stun,p;(p=function(){s&&(a.end(s,y),setTimeout.each(Object.keys(s=s.add||""),function(m){(m=s[m])&&m()}))}).hatch=p,g.ack&&!g.ok&&(g.ok=g.acks||9),g.via._.on("out",{put:g.out=g.graph,ok:g.ok&&{"@":g.ok+1},opt:g.opt,"#":w,_:p})}}a.end=function(g,_){g.end=v,g.the.to===g&&g===g.the.last&&delete _.stun,g.off()},a.err=function(g,_){(g.ack||v).call(g,g.out={err:g.err=i.log(_)}),g.ran(g)};function l(g){var _=g.via._,y;g.via=g.via.back(function(w){if(w.soul||!w.get)return w.$;y=g.data,(g.data={})[w.get]=y}),(!g.via||!g.via._.soul)&&(g.via=_.root.$.get(((g.data||"")._||"")["#"]||_.$.back("opt.uuid")())),g.via.put(g.data,g.ack,g)}function c(g,_){return g&&(_=g.constructor)&&_.name||typeof g}var u,v=function(){},d=setTimeout.turn,h=i.valid,S=i.state.ify})(t,"./put"),t(function(r){var i=t("./root");t("./chain"),t("./back"),t("./put"),t("./get"),r.exports=i})(t,"./index"),t(function(r){var i=t("./index");i.chain.on=function(l,c,u,v){var d=this,h=d._;h.root;var S;if(typeof l=="string")return c?(S=h.on(l,c,u||h,v),u&&u.$&&(u.subs||(u.subs=[])).push(S),d):h.on(l);var g=c;return(g=g===!0?{change:!0}:g||{}).not=1,g.on=1,d.get(l,g),d},i.chain.once=function(l,c){if(c=c||{},!l)return o(this);var u=this,v=u._,d=v.root;v.put;var h=String.random(7),S;return u.get(function(g,_,y,w){var f=this,s=f._,p=s.one||(s.one={});if(w.stun||p[h]==="")return;if((S=i.valid(g))===!0){m();return}if(typeof S=="string")return;clearTimeout((v.one||"")[h]),clearTimeout(p[h]),p[h]=setTimeout(m,c.wait||99);function m(A){if(!s.has&&!s.soul&&(s={put:g,get:_}),a===(S=s.put)&&(S=((y.$$||"")._||"").put),typeof i.valid(S)=="string"&&(S=d.$.get(S)._.put,S===a&&!A)){p[h]=setTimeout(function(){m(1)},c.wait||99);return}w.stun||p[h]!==""&&(p[h]="",(v.soul||v.has)&&w.off(),l.call(f,S,s.get),clearTimeout(p[h]))}},{on:1}),u};function o(l,c,u){return i.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(u=l.chain())._.nix=l.once(function(v,d){u._.on("in",this._)}),u._.lex=l._.lex,u}i.chain.off=function(){var l=this,c=l._,u,v=c.back;if(v)return c.ack=0,(u=v.next)&&u[c.get]&&delete u[c.get],(u=v.any)&&(delete v.any,v.any={}),(u=v.ask)&&delete u[c.get],(u=v.put)&&delete u[c.get],(u=c.soul)&&delete v.root.graph[u],(u=c.map)&&Object.keys(u).forEach(function(d,h){h=u[d],h.link&&v.root.$.get(h.link).off()}),(u=c.next)&&Object.keys(u).forEach(function(d,h){h=u[d],h.$.off()}),c.on("off",{}),l};var a})(t,"./on"),t(function(r){var i=t("./index"),o=i.chain.get.next;i.chain.get.next=function(u,v){var d;return Object.plain(v)?(d=((d=v["#"])||"")["="]||d)?u.get(d):((d=u.chain()._).lex=v,u.on("in",function(h){String.match(h.get||(h.put||"")["."],v["."]||v["#"]||v)&&d.on("in",h),this.to.next(h)}),d.$):(o||l)(u,v)},i.chain.map=function(u,v,d){var h=this,S=h._,g,_;return Object.plain(u)&&(g=u["."]?u:{".":u},u=c),u?(i.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),_=h.chain(),h.map().on(function(y,w,f,s){var p=(u||l).call(this,y,w,f,s);if(c!==p){if(y===p)return _._.on("in",f);if(i.is(p))return _._.on("in",p._);var m={};Object.keys(f.put).forEach(function(A){m[A]=f.put[A]},m),m["="]=p,_._.on("in",{get:w,put:m})}}),_):((_=S.each)||((S.each=_=h.chain())._.lex=g||_._.lex||S.lex,_._.nix=h.back("nix"),h.on("in",a,_._)),_)};function a(u){this.to.next(u);var v=this.as,d=u.$,h=d._,S=u.put,g;!h.soul&&!u.$$||(g=v.lex)&&!String.match(u.get||(S||"")["."],g["."]||g["#"]||g)||i.on.link(u,v)}var l=function(){},c})(t,"./map"),t(function(r){var i=t("./index");i.chain.set=function(o,a,l){var c=this,u=c.back(-1),v,d;return a=a||function(){},l=l||{},l.item=l.item||o,(v=((o||"")._||"")["#"])&&((o={})["#"]=v),typeof(d=i.valid(o))=="string"?c.get(v=d).put(o,a,l):i.is(o)?(c.put(function(h){o.get(function(S,g,_){if(!S)return a.call(c,{err:i.log('Only a node can be linked! Not "'+_.put+'"!')});(d={})[S]={"#":S},h(d)},!0)}),o):(Object.plain(o)&&(o=u.get(v=c.back("opt.uuid")()).put(o)),c.get(v||u.back("opt.uuid")(7)).put(o,a,l))}})(t,"./set"),t(function(r){t("./shim");var i=function(){},o=JSON.parseAsync||function(u,v,d){var h,S=+new Date;try{v(h,JSON.parse(u,d),a.sucks(+new Date-S))}catch(g){v(g)}},a=JSON.stringifyAsync||function(u,v,d,h){var S,g=+new Date;try{v(S,JSON.stringify(u,d,h),a.sucks(+new Date-g))}catch(_){v(_)}};a.sucks=function(u){u>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),a.sucks=i)};function l(u){var v=function(){},d=u.opt||{};d.log=d.log||console.log,d.gap=d.gap||d.wait||0,d.max=d.max||(d.memory?d.memory*999*999:3e8)*.3,d.pack=d.pack||d.max*.01*.01,d.puff=d.puff||9;var h=setTimeout.turn||setTimeout,S=u.dup,g=S.check,_=S.track,y=v.hear=function(s,p){if(s){if(d.max<=s.length)return v.say({dam:"!",err:"Message too big!"},p);v===this&&(y.d+=s.length||0,++y.c);var m=p.SH=+new Date,A=s[0],T;if(A==="["){o(s,function(k,O){if(k||!O)return v.say({dam:"!",err:"DAM JSON parse error."},p);console.STAT&&console.STAT(+new Date,O.length,"# on hear batch");var R=d.puff;(function x(){for(var E=+new Date,b=0,$;b<R&&($=O[b++]);)v.hear($,p);O=O.slice(b),console.STAT&&console.STAT(E,+new Date-E,"hear loop"),w(p),O.length&&h(x,0)})()}),s="";return}if(A==="{"||(s["#"]||Object.plain(s))&&(T=s)){if(T)return y.one(T,p,m);o(s,function(k,O){if(k||!O)return v.say({dam:"!",err:"DAM JSON parse error."},p);y.one(O,p,m)});return}}};y.one=function(s,p,x){var A,T,k,O,R;if(s.DBG&&(s.DBG=R={DBG:s.DBG}),R&&(R.h=x),R&&(R.hp=+new Date),(A=s["#"])||(A=s["#"]=String.random(9)),!(k=g(A))&&(T=s["##"],!(T&&(k=s["@"]||s.get&&A)&&S.check(O=k+T)))){if((s._=function(){}).via=v.leap=p,(k=s["><"])&&typeof k=="string"&&k.slice(0,99).split(",").forEach(function(E){this[E]=1},s._.yo={}),k=s.dam){(k=v.hear[k])&&k(s,p,u),_(A);return}(k=s.ok)&&(s._.near=k["/"]);var x=+new Date;R&&(R.is=x),p.SI=A,_.ed=function(E){A===E&&(_.ed=0,(E=S.s[A])&&(E.via=p,s.get&&(E.it=s)))},u.on("in",v.last=s),R&&(R.hd=+new Date),console.STAT&&console.STAT(x,+new Date-x,s.get?"msg get":s.put?"msg put":"msg"),_(A),O&&_(O),v.leap=v.last=null}},y.c=y.d=0,function(){var s=0,p;v.hash=function(T,k){var O,R,x,E=+new Date;a(T.put,function b($,C){var z=(R||(R=x=C||"")).slice(0,32768);if(O=String.hash(z,O),R=R.slice(32768),R){h(b,0);return}console.STAT&&console.STAT(E,+new Date-E,"say json+hash"),T._.$put=x,T["##"]=O,v.say(T,k),delete T._.$put},m)};function m(T,k){var O;return k instanceof Object?(Object.keys(k).sort().forEach(A,{to:O={},on:k}),O):k}function A(T){this.to[T]=this.on[T]}v.say=function(T,k){var O;if((O=this)&&(O=O.to)&&O.next&&O.next(T),!T)return!1;var R,x,E,b=T["@"],$=T._||(T._=function(){}),C=T.DBG,z=+new Date;if($.y=$.y||z,k||C&&(C.y=z),(R=T["#"])||(R=T["#"]=String.random(9)),!p&&_(R),!(x=T["##"])&&c!==T.put&&!$.via&&b){v.hash(T,k);return}if(!k&&b&&(k=(O=S.s[b])&&(O.via||(O=O.it)&&(O=O._)&&O.via)||(O=v.last)&&b===O["#"]&&v.leap),!k&&b)return S.s[b]?void 0:(console.STAT&&console.STAT(+new Date,++s,"total no peer to ack to"),!1);if(b&&!T.put&&!x&&((S.s[b]||"").it||"")["##"])return!1;if(!k&&v.way)return v.way(T);if(C&&(C.yh=+new Date),!(E=$.raw)){v.raw(T,k);return}if(C&&(C.yr=+new Date),!k||!k.id){if(!Object.plain(k||d.peers))return!1;var z=+new Date;d.puff;var j=d.peers,N=Object.keys(k||d.peers||{});console.STAT&&console.STAT(z,+new Date-z,"peer keys"),function M(){var W=+new Date;p=1;var B=$.raw;$.raw=E;for(var J=0,te;J<9&&(te=(N||"")[J++]);)(te=j[te]||(k||"")[te])&&v.say(T,te);$.raw=B,p=0,N=N.slice(J),console.STAT&&console.STAT(W,+new Date-W,"say loop"),N.length&&(h(M,0),b&&_(b))}();return}if(!k.wire&&v.wire&&v.wire(k),R!==k.last){if(k.last=R,k===$.via||(O=$.yo)&&(O[k.url]||O[k.pid]||O[k.id]))return!1;if(console.STAT&&console.STAT(z,((C||$).yp=+new Date)-($.y||z),"say prep"),!p&&b&&_(b),k.batch){if(k.tail=(O=k.tail||0)+E.length,k.tail<=d.pack){k.batch+=(O?",":"")+E;return}w(k)}k.batch="[";var D=+new Date;setTimeout(function(){console.STAT&&console.STAT(D,+new Date-D,"0ms TO"),w(k)},d.gap),f(E,k),console.STAT&&b===k.SI&&console.STAT(z,+new Date-k.SH,"say ack")}},v.say.c=v.say.d=0,v.raw=function(T,k){if(!T)return"";var O=T._||{},R,x;if(x=O.raw)return x;if(typeof T=="string")return T;var E=T["##"],b=T["@"];if(E&&b){if(!O.via&&g(b+E))return!1;if(x=(S.s[b]||"").it){if(E===x["##"])return!1;x["##"]||(x["##"]=E)}}if(!T.dam&&!T["@"]){var $=0,C=[];x=d.peers;for(var z in x){var j=x[z];if(C.push(j.url||j.pid||j.id),++$>6)break}$>1&&(T["><"]=C.join())}if(T.put&&(x=T.ok)&&(T.ok={"@":(x["@"]||1)-1,"/":x["/"]==T._.near?v.near:x["/"]}),R=O.$put){x={},Object.keys(T).forEach(function(D){x[D]=T[D]}),x.put=":])([:",a(x,function(D,P){if(!D){var M=+new Date;x=P.indexOf('"put":":])([:"'),N(c,P=P.slice(0,x+6)+R+P.slice(x+14)),console.STAT&&console.STAT(M,+new Date-M,"say slice")}});return}a(T,N);function N(D,P){D||(O.raw=P,v.say(T,k))}}}();function w(s){var p=s.batch,m=typeof p=="string";if(m&&(p+="]"),s.batch=s.tail=null,!!p&&!(m?3>p.length:!p.length)){if(!m)try{p=p.length===1?p[0]:JSON.stringify(p)}catch(A){return d.log("DAM JSON stringify error",A)}p&&f(p,s)}}function f(s,p){try{var m=p.wire;p.say?p.say(s):m.send&&m.send(s),v.say.d+=s.length||0,++v.say.c}catch{(p.queue=p.queue||[]).push(s)}}return v.near=0,v.hi=function(s){var p=s.wire,m;if(!p){v.wire(s.length&&{url:s,id:s}||s);return}s.id?d.peers[s.url||s.id]=s:(m=s.id=s.id||s.url||String.random(9),v.say({dam:"?",pid:u.opt.pid},d.peers[m]=s),delete S.s[s.last]),s.met||(v.near++,s.met=+new Date,u.on("hi",s)),m=s.queue,s.queue=[],setTimeout.each(m||[],function(A){f(A,s)},0,9)},v.bye=function(s){s.met&&--v.near,delete s.met,u.on("bye",s);var p=+new Date;p=p-(s.met||p),v.bye.time=((v.bye.time||p)+p)/2},v.hear["!"]=function(s,p){d.log("Error:",s.err)},v.hear["?"]=function(s,p){s.pid&&(p.pid||(p.pid=s.pid),s["@"])||(v.say({dam:"?",pid:d.pid,"@":s["#"]},p),delete S.s[p.last])},v.hear.mob=function(s,p){if(s.peers){var m=Object.keys(s.peers),A=m[Math.random()*m.length>>0];A&&(v.bye(p),v.hi(A))}},u.on("create",function(s){s.opt.pid=s.opt.pid||String.random(9),this.to.next(s),s.on("out",v.say)}),u.on("bye",function(s,p){s=d.peers[s.id||s]||s,this.to.next(s),s.bye?s.bye():(p=s.wire)&&p.close&&p.close(),delete d.peers[s.id],s.wire=null}),u.on("bye",function(s,p){this.to.next(s),(p=console.STAT)&&(p.peers=v.near),(p=s.url)&&setTimeout(function(){},d.lack||9e3)}),u.on("hi",function(s,p){if(this.to.next(s),(p=console.STAT)&&(p.peers=v.near),!d.super){var m=Object.keys(u.next||"");m.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(m,function(A){var T=u.next[A];if(d.super||(T.ask||"")[""]){v.say({get:{"#":A}},s);return}setTimeout.each(Object.keys(T.ask||""),function(k){k&&v.say({"##":String.hash((u.graph[A]||"")[k]),get:{"#":A,".":k}},s)})})}}),v}var c;try{r.exports=l}catch{}})(t,"./mesh"),t(function(r){var i=t("./index");i.Mesh=t("./mesh"),i.on("opt",function(a){if(this.to.next(a),a.once)return;var l=a.opt;if(l.WebSocket===!1)return;var c=i.window||{},u=l.WebSocket||c.WebSocket||c.webkitWebSocket||c.mozWebSocket;if(!u)return;l.WebSocket=u;var v=l.mesh=l.mesh||i.Mesh(a);v.wire||l.wire,v.wire=l.wire=d;function d(_){try{if(!_||!_.url)return w&&w(_);var y=_.url.replace(/^http/,"ws"),w=_.wire=new l.WebSocket(y);return w.onclose=function(){S(_),l.mesh.bye(_)},w.onerror=function(f){S(_)},w.onopen=function(){l.mesh.hi(_)},w.onmessage=function(f){f&&l.mesh.hear(f.data||f,_)},w}catch{l.mesh.bye(_)}}setTimeout(function(){!l.super&&a.on("out",{dam:"hi"})},1);var h=2*999;function S(_){clearTimeout(_.defer),l.peers[_.url]&&(g&&_.retry<=0||(_.retry=(_.retry||l.retry+1||60)-(-_.tried+(_.tried=+new Date)<h*4?1:0),_.defer=setTimeout(function y(){if(g&&g.hidden)return setTimeout(y,h);d(_)},h)))}var g=""+o!=typeof document&&document});var o})(t,"./websocket"),t(function(r){if(!(typeof Gun>"u")){var i=function(){},o;try{o=(Gun.window||i).localStorage}catch{}o||(Gun.log("Warning: No localStorage exists to persist data to!"),o={setItem:function(l,c){this[l]=c},removeItem:function(l){delete this[l]},getItem:function(l){return this[l]}});var a=JSON.stringifyAsync||function(l,c,u,v){var d;try{c(d,JSON.stringify(l,u,v))}catch(h){c(h)}};Gun.on("create",function l(c){this.to.next(c);var u=c.opt;c.graph;var v=[],d,h,S,g;if(u.localStorage===!1)return;u.prefix=u.file||"gun/";try{d=l[u.prefix]=l[u.prefix]||JSON.parse(S=o.getItem(u.prefix))||{}}catch{d=l[u.prefix]={}}S=(S||"").length,c.on("get",function(y){this.to.next(y);var w=y.get,f,s,p,m;!w||!(f=w["#"])||(s=d[f]||m,s&&(p=w["."])&&!Object.plain(p)&&(s=Gun.state.ify({},p,Gun.state.is(s,p),s[p],f)),Gun.on.get.ack(y,s))}),c.on("put",function(y){this.to.next(y);var w=y.put,f=w["#"],s=w["."],p=y["#"],m=y.ok||"";if(d[f]=Gun.state.ify(d[f],s,w[">"],w[":"],f),g&&S>4999880){c.on("in",{"@":p,err:"localStorage max!"});return}!y["@"]&&(!y._.via||Math.random()<m["@"]/m["/"])&&v.push(p),!h&&(h=setTimeout(_,9+S/333))});function _(){if(!v.length&&((setTimeout.turn||"").s||"").length){setTimeout(_,99);return}var y=v;clearTimeout(h),h=!1,v=[],a(d,function(w,f){try{!w&&o.setItem(u.prefix,f)}catch(s){w=g=s||"localStorage failure"}w&&(Gun.log(w+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),c.on("localStorage:error",{err:w,get:u.prefix,put:d})),S=f.length,setTimeout.each(y,function(s){c.on("in",{"@":s,err:w,ok:0})},0,99)})}})}})(t,"./localStorage")})(),function(){var x;if(""+x!=typeof Gun){var t=function(E){console.warn("Warning! Deprecated internal utility will break in next version:",E)},n=Gun;n.fn=n.fn||{is:function(E){return t("fn"),!!E&&typeof E=="function"}},n.bi=n.bi||{is:function(E){return t("bi"),E instanceof Boolean||typeof E=="boolean"}},n.num=n.num||{is:function(E){return t("num"),!r(E)&&(E-parseFloat(E)+1>=0||E===1/0||E===-1/0)}},n.text=n.text||{is:function(E){return t("text"),typeof E=="string"}},n.text.ify=n.text.ify||function(E){return t("text.ify"),n.text.is(E)?E:typeof JSON<"u"?JSON.stringify(E):E&&E.toString?E.toString():E},n.text.random=n.text.random||function(E,b){t("text.random");var $="";for(E=E||24,b=b||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";E>0;)$+=b.charAt(Math.floor(Math.random()*b.length)),E--;return $},n.text.match=n.text.match||function(E,b){var $,C;return t("text.match"),typeof E!="string"?!1:(typeof b=="string"&&(b={"=":b}),b=b||{},$=b["="]||b["*"]||b[">"]||b["<"],E===$?!0:C!==b["="]?!1:($=b["*"]||b[">"]||b["<"],E.slice(0,($||"").length)===$?!0:C!==b["*"]?!1:C!==b[">"]&&C!==b["<"]?E>=b[">"]&&E<=b["<"]:C!==b[">"]&&E>=b[">"]||C!==b["<"]&&E<=b["<"]))},n.text.hash=n.text.hash||function(E,b){if(t("text.hash"),typeof E=="string"){if(b=b||0,!E.length)return b;for(var $=0,C=E.length,z;$<C;++$)z=E.charCodeAt($),b=(b<<5)-b+z,b|=0;return b}},n.list=n.list||{is:function(E){return t("list"),E instanceof Array}},n.list.slit=n.list.slit||Array.prototype.slice,n.list.sort=n.list.sort||function(E){return t("list.sort"),function(b,$){return!b||!$?0:(b=b[E],$=$[E],b<$?-1:b>$?1:0)}},n.list.map=n.list.map||function(E,b,$){return t("list.map"),O(E,b,$)},n.list.index=1,n.obj=n.boj||{is:function(E){return t("obj"),E?E instanceof Object&&E.constructor===Object||Object.prototype.toString.call(E).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},n.obj.put=n.obj.put||function(E,b,$){return t("obj.put"),(E||{})[b]=$,E},n.obj.has=n.obj.has||function(E,b){return t("obj.has"),E&&Object.prototype.hasOwnProperty.call(E,b)},n.obj.del=n.obj.del||function(E,b){if(t("obj.del"),!!E)return E[b]=null,delete E[b],E},n.obj.as=n.obj.as||function(E,b,$,C){return t("obj.as"),E[b]=E[b]||(C===$?{}:$)},n.obj.ify=n.obj.ify||function(E){if(t("obj.ify"),p(E))return E;try{E=JSON.parse(E)}catch{E={}}return E},function(){var E;function b($,C){A(this,C)&&E!==this[C]||(this[C]=$)}n.obj.to=n.obj.to||function($,C){return t("obj.to"),C=C||{},O($,b,C),C}}(),n.obj.copy=n.obj.copy||function(E){return t("obj.copy"),E&&JSON.parse(JSON.stringify(E))},function(){function E(b,$){var C=this.n,z;if(!(C&&($===C||p(C)&&A(C,$)))&&z!==$)return!0}n.obj.empty=n.obj.empty||function(b,$){return t("obj.empty"),b?!O(b,E,{n:$}):!0}}(),function(){function E(C,z){if(arguments.length===2){E.r=E.r||{},E.r[C]=z;return}E.r=E.r||[],E.r.push(C)}var b=Object.keys,$;Object.keys=Object.keys||function(C){return $(C,function(z,j,N){N(j)})},n.obj.map=$=n.obj.map||function(C,z,j){t("obj.map");var N,D=0,P,M,W,B,J=typeof z=="function";if(E.r=N,b&&p(C)&&(W=b(C),B=!0),j=j||{},r(C)||W)for(P=(W||C).length;D<P;D++){var te=D+n.list.index;if(J){if(M=B?z.call(j,C[W[D]],W[D],E):z.call(j,C[D],te,E),M!==N)return M}else if(z===C[B?W[D]:D])return W?W[D]:te}else for(D in C)if(J){if(A(C,D)&&(M=j?z.call(j,C[D],D,E):z(C[D],D,E),M!==N))return M}else if(z===C[D])return D;return J?E.r:n.list.index?0:-1}}(),n.time=n.time||{},n.time.is=n.time.is||function(E){return t("time"),E?E instanceof Date:+new Date().getTime()};var f=n.fn.is,r=n.list.is,s=n.obj,p=s.is,A=s.has,O=s.map,i={};i.is=function(E){return t("val.is"),E===x?!1:E===null?!0:E===1/0?!1:l(E)||a(E)||g(E)?!0:i.link.is(E)||!1},i.link=i.rel={_:"#"},function(){i.link.is=function(b){if(t("val.link.is"),b&&b[o]&&!b._&&p(b)){var $={};if(O(b,E,$),$.id)return $.id}return!1};function E(b,$){var C=this;if(C.id)return C.id=!1;if($==o&&l(b))C.id=b;else return C.id=!1}}(),i.link.ify=function(E){return t("val.link.ify"),k({},o,E)},n.obj.has._=".";var o=i.link._,x,a=n.bi.is,g=n.num.is,l=n.text.is,s=n.obj,p=s.is,k=s.put,O=s.map;n.val=n.val||i;var c={_:"_"};c.soul=function(E,b){return t("node.soul"),E&&E._&&E._[b||d]},c.soul.ify=function(E,b){return t("node.soul.ify"),b=typeof b=="string"?{soul:b}:b||{},E=E||{},E._=E._||{},E._[d]=b.soul||E._[d]||v(),E},c.soul._=i.link._,function(){c.is=function(b,$,C){t("node.is");var z;return p(b)&&(z=c.soul(b))?!O(b,E,{as:C,cb:$,s:z,n:b}):!1};function E(b,$){if($!==c._){if(!i.is(b))return!0;this.cb&&this.cb.call(this.as,b,$,this.n,this.s)}}}(),function(){c.ify=function(b,$,C){return t("node.ify"),$?typeof $=="string"?$={soul:$}:typeof $=="function"&&($={map:$}):$={},$.map&&($.node=$.map.call(C,b,x,$.node||{})),($.node=c.soul.ify($.node||{},$))&&O(b,E,{o:$,as:C}),$.node};function E(b,$){var C=this.o,z,j;if(C.map){z=C.map.call(this.as,b,""+$,C.node),j===z?m(C.node,$):C.node&&(C.node[$]=z);return}i.is(b)&&(C.node[$]=b)}}();var s=n.obj,p=s.is,m=s.del,O=s.map,u=n.text,v=u.random,d=c.soul._,x;n.node=n.node||c;var h=n.state;h.lex=function(){return t("state.lex"),h().toString(36).replace(".","")},h.to=function(E,b,$){t("state.to");var C=(E||{})[b];return p(C)&&(C=R(C)),h.ify($,b,h.is(E,b),C,c.soul(E))},function(){h.map=function(b,$,C){t("state.map");var z,j=p(j=b||$)?j:null;return b=f(b=b||$)?b:null,j&&!b?($=g($)?$:h(),j[y]=j[y]||{},O(j,E,{o:j,s:$}),j):(C=C||p($)?$:z,$=g($)?$:h(),function(N,D,P,M){if(!b)return E.call({o:P,s:$},N,D),N;b.call(C||this||{},N,D,P,M),!(A(P,D)&&z===P[D])&&E.call({o:P,s:$},N,D)})};function E(b,$){y!==$&&h.ify(this.o,$,this.s)}}();var s=n.obj;s.as;var A=s.has,p=s.is,O=s.map,R=s.copy,S=n.num,g=S.is,_=n.fn,f=_.is,y=c._,x,w={};(function(){w.is=function($,C,z,j){return t("graph.is"),!$||!p($)||T($)?!1:!O($,E,{cb:C,fn:z,as:j})};function E($,C){if(!$||C!==c.soul($)||!c.is($,this.fn,this.as))return!0;this.cb&&(b.n=$,b.as=this.as,this.cb.call(b.as,$,C,b))}function b($){$&&c.is(b.n,$,b.as)}})(),function(){w.ify=function(j,N,D){t("graph.ify");var P={path:[],obj:j};return N?typeof N=="string"?N={soul:N}:typeof N=="function"&&(N.map=N):N={},typeof D=="string"&&(N.soul=N.soul||D,D=x),N.soul&&(P.link=i.link.ify(N.soul)),N.shell=(D||{}).shell,N.graph=N.graph||{},N.seen=N.seen||[],N.as=N.as||D,E(N,P),N.root=P.node,N.graph};function E(j,N){var D;return(D=z(j,N))?D:(N.env=j,N.soul=$,c.ify(N.obj,b,N)&&(N.link=N.link||i.link.ify(c.soul(N.node)),N.obj!==j.shell&&(j.graph[i.link.is(N.link)]=N.node)),N)}function b(j,N,D){var P=this,M=P.env,W,B;if(c._===N&&A(j,i.link._))return D._;if(W=C(j,N,D,P,M)){if(N||(P.node=P.node||D||{},A(j,c._)&&c.soul(j)&&(P.node._=R(j._)),P.node=c.soul.ify(P.node,i.link.is(P.link)),P.link=P.link||i.link.ify(c.soul(P.node))),(B=M.map)&&(B.call(M.as||{},j,N,D,P),A(D,N))){if(j=D[N],x===j){m(D,N);return}if(!(W=C(j,N,D,P,M)))return}if(!N)return P.node;if(W===!0)return j;if(B=E(M,{obj:j,path:P.path.concat(N)}),!!B.node)return B.link}}function $(j){var N=this,D=i.link.is(N.link),P=N.env.graph;N.link=N.link||i.link.ify(j),N.link[i.link._]=j,N.node&&N.node[c._]&&(N.node[c._][i.link._]=j),A(P,D)&&(P[j]=P[D],m(P,D))}function C(j,N,D,P,M){var W;if(i.is(j))return!0;if(p(j))return 1;if(W=M.invalid)return j=W.call(M.as||{},j,N,D),C(j,N,D,P,M);M.err="Invalid value at '"+P.path.concat(N).join(".")+"'!",n.list.is(j)&&(M.err+=" Use `.set(item)` instead of an Array.")}function z(j,N){for(var D=j.seen,P=D.length,M;P--;)if(M=D[P],N.obj===M.obj)return M;D.push(N)}}(),w.node=function(E){t("graph.node");var b=c.soul(E);if(b)return k({},b,E)},function(){w.to=function(b,$,C){if(t("graph.to"),!!b){var z={};return C=C||{seen:{}},O(b[$],E,{obj:z,graph:b,opt:C}),z}};function E(b,$){var C,z;if(c._===$){if(T(b,i.link._))return;this.obj[$]=R(b);return}if(!(C=i.link.is(b))){this.obj[$]=b;return}if(z=this.opt.seen[C]){this.obj[$]=z;return}this.obj[$]=this.opt.seen[C]=w.to(this.graph,C,this.opt)}}();var f=n.fn.is,s=n.obj,p=s.is,m=s.del,A=s.has,T=s.empty,k=s.put,O=s.map,R=s.copy,x;n.graph=n.graph||w}}()}(tt)),tt.exports}var Et,Mn;function cc(){return Mn||(Mn=1,Et=ke()),Et}var fc=cc();const st=Gt(fc);var nt={exports:{}};nt.exports;var Ln;function lc(){return Ln||(Ln=1,function(e){(function(){function t(r,i){return i?rn(r):r.slice?t[o(r)]:function(a,l){r(a={exports:{}}),t[o(l)]=a.exports};function o(a){return a.split("/").slice(-1).toString().replace(".js","")}}var n=e;t(function(r){typeof self<"u"&&(r.window=self),typeof window<"u"&&(r.window=window);var i=r.window||r,o,a=i.SEA||{};(a.window=r.window)&&(a.window.SEA=a);try{o+""!=typeof n&&(n.exports=a)}catch{}r.exports=a})(t,"./root"),t(function(r){var i=t("./root");try{i.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(t,"./https"),t(function(r){var i;if(i+""==typeof btoa){if(i+""==typeof Buffer)try{De.Buffer=t("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}De.btoa=function(o){return Buffer.from(o,"binary").toString("base64")},De.atob=function(o){return Buffer.from(o,"base64").toString("binary")}}})(t,"./base64"),t(function(r){t("./base64");function i(){}Object.assign(i,{from:Array.from}),i.prototype=Object.create(Array.prototype),i.prototype.toString=function(o,a,l){o=o||"utf8",a=a||0;const c=this.length;if(o==="hex"){const u=new Uint8Array(this);return[...Array((l&&l+1||c)-a).keys()].map(v=>u[v+a].toString(16).padStart(2,"0")).join("")}if(o==="utf8")return Array.from({length:(l||c)-a},(u,v)=>String.fromCharCode(this[v+a])).join("");if(o==="base64")return btoa(this)},r.exports=i})(t,"./array"),t(function(r){t("./base64");var i=t("./array");function o(...a){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),o.from(...a)}o.prototype=Object.create(Array.prototype),Object.assign(o,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const a=arguments[0];let l;if(typeof a=="string"){const u=arguments[1]||"utf8";if(u==="hex"){const v=a.match(/([\da-fA-F]{2})/g).map(d=>parseInt(d,16));if(!v||!v.length)throw new TypeError("Invalid first argument for type 'hex'.");l=i.from(v)}else if(u==="utf8"||u==="binary"){const v=a.length,d=new Uint16Array(v);Array.from({length:v},(h,S)=>d[S]=a.charCodeAt(S)),l=i.from(d)}else if(u==="base64"){const v=atob(a),d=v.length,h=new Uint8Array(d);Array.from({length:d},(S,g)=>h[g]=v.charCodeAt(g)),l=i.from(h)}else u==="binary"?l=i.from(a):console.info("SafeBuffer.from unknown encoding: "+u);return l}if(a.byteLength,a.byteLength?a.byteLength:a.length){let u;return a instanceof ArrayBuffer&&(u=new Uint8Array(a)),i.from(u||a)}},alloc(a,l=0){return i.from(new Uint8Array(Array.from({length:a},()=>l)))},allocUnsafe(a){return i.from(new Uint8Array(Array.from({length:a})))},concat(a){if(!Array.isArray(a))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return i.from(a.reduce((l,c)=>l.concat(Array.from(c)),[]))}}),o.prototype.from=o.from,o.prototype.toString=i.prototype.toString,r.exports=o})(t,"./buffer"),t(function(r){const i=t("./root"),o={Buffer:t("./buffer")};var a={},l;if(JSON.parseAsync=JSON.parseAsync||function(u,v,d){var h;try{v(h,JSON.parse(u,d))}catch(S){v(S)}},JSON.stringifyAsync=JSON.stringifyAsync||function(u,v,d,h){var S;try{v(S,JSON.stringify(u,d,h))}catch(g){v(g)}},o.parse=function(u,v){return new Promise(function(d,h){JSON.parseAsync(u,function(S,g){S?h(S):d(g)},v)})},o.stringify=function(u,v,d){return new Promise(function(h,S){JSON.stringifyAsync(u,function(g,_){g?S(g):h(_)},v,d)})},i.window&&(o.crypto=i.window.crypto||i.window.msCrypto,o.subtle=(o.crypto||a).subtle||(o.crypto||a).webkitSubtle,o.TextEncoder=i.window.TextEncoder,o.TextDecoder=i.window.TextDecoder,o.random=u=>o.Buffer.from(o.crypto.getRandomValues(new Uint8Array(o.Buffer.alloc(u))))),!o.TextDecoder){const{TextEncoder:u,TextDecoder:v}=t((l+""==typeof n?".":"")+"./lib/text-encoding",1);o.TextDecoder=v,o.TextEncoder=u}if(!o.crypto)try{var c=t("crypto",1);Object.assign(o,{crypto:c,random:v=>o.Buffer.from(c.randomBytes(v))});const{Crypto:u}=t("@peculiar/webcrypto",1);o.ossl=o.subtle=new u({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}r.exports=o})(t,"./shim"),t(function(r){var i=t("./root"),o=t("./shim"),a={};a.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},a.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},a.ecdh={name:"ECDH",namedCurve:"P-256"},a.jwk=function(l,c){l=l.split(".");var u=l[0],v=l[1],d={kty:"EC",crv:"P-256",x:u,y:v,ext:!0};return d.key_ops=c?["sign"]:["verify"],c&&(d.d=c),d},a.keyToJwk=function(l){return{kty:"oct",k:l.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},a.recall={validity:12*60*60,hook:function(l){return l}},a.check=function(l){return typeof l=="string"&&l.slice(0,4)==="SEA{"},a.parse=async function(c){try{var u=typeof c=="string";return u&&c.slice(0,4)==="SEA{"&&(c=c.slice(3)),u?await o.parse(c):c}catch{}return c},i.opt=a,r.exports=a})(t,"./settings"),t(function(r){var i=t("./shim");r.exports=async function(o,a){var l=typeof o=="string"?o:await i.stringify(o),c=await i.subtle.digest({name:a||"SHA-256"},new i.TextEncoder().encode(l));return i.Buffer.from(c)}})(t,"./sha256"),t(function(r){const i=t("./shim"),o=i.subtle,a=i.ossl?i.ossl:o,l=c=>a.digest({name:"SHA-1"},new ArrayBuffer(c));r.exports=l})(t,"./sha1"),t(function(r){var i=t("./root"),o=t("./shim"),a=t("./settings"),l=t("./sha256"),c;i.work=i.work||(async(u,v,d,h)=>{try{var S=(v||{}).epub||v;if(h=h||{},S instanceof Function&&(d=S,S=c),u=typeof u=="string"?u:await o.stringify(u),(h.name||"").toLowerCase().slice(0,3)==="sha"){var g=o.Buffer.from(await l(u,h.name),"binary").toString(h.encode||"base64");if(d)try{d(g)}catch(f){console.log(f)}return g}S=S||o.random(9);var _=await(o.ossl||o.subtle).importKey("raw",new o.TextEncoder().encode(u),{name:h.name||"PBKDF2"},!1,["deriveBits"]),y=await(o.ossl||o.subtle).deriveBits({name:h.name||"PBKDF2",iterations:h.iterations||a.pbkdf2.iter,salt:new o.TextEncoder().encode(h.salt||S),hash:h.hash||a.pbkdf2.hash},_,h.length||a.pbkdf2.ks*8);u=o.random(u.length);var w=o.Buffer.from(y,"binary").toString(h.encode||"base64");if(d)try{d(w)}catch(f){console.log(f)}return w}catch(f){if(console.log(f),i.err=f,i.throw)throw f;d&&d();return}}),r.exports=i.work})(t,"./work"),t(function(r){var i=t("./root"),o=t("./shim");t("./settings"),i.name=i.name||(async(a,l)=>{try{if(a)try{a()}catch(c){console.log(c)}return}catch(c){if(console.log(c),i.err=c,i.throw)throw c;a&&a();return}}),i.pair=i.pair||(async(a,l)=>{try{var c=o.ossl||o.subtle,u=await o.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async h=>{var S={};S.priv=(await o.subtle.exportKey("jwk",h.privateKey)).d;var g=await o.subtle.exportKey("jwk",h.publicKey);return S.pub=g.x+"."+g.y,S});try{var v=await c.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async h=>{var S={};S.epriv=(await c.exportKey("jwk",h.privateKey)).d;var g=await c.exportKey("jwk",h.publicKey);return S.epub=g.x+"."+g.y,S})}catch(h){if(i.window)throw h;if(h=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw h}v=v||{};var d={pub:u.pub,priv:u.priv,epub:v.epub,epriv:v.epriv};if(a)try{a(d)}catch(h){console.log(h)}return d}catch(h){if(console.log(h),i.err=h,i.throw)throw h;a&&a();return}}),r.exports=i.pair})(t,"./pair"),t(function(r){var i=t("./root"),o=t("./shim"),a=t("./settings"),l=t("./sha256"),c;i.sign=i.sign||(async(u,v,d,h)=>{try{if(h=h||{},!(v||h).priv){if(!i.I)throw"No signing key.";v=await i.I(null,{what:u,how:"sign",why:h.why})}if(c===u)throw"`undefined` not allowed.";var S=await a.parse(u),g=h.check=h.check||S;if(i.verify&&(i.opt.check(g)||g&&g.s&&g.m)&&c!==await i.verify(g,v)){var p=await a.parse(g);if(h.raw||(p="SEA"+await o.stringify(p)),d)try{d(p)}catch(A){console.log(A)}return p}var _=v.pub,y=v.priv,w=a.jwk(_,y),f=await l(S),s=await(o.ossl||o.subtle).importKey("jwk",w,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(m=>(o.ossl||o.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},m,new Uint8Array(f))),p={m:S,s:o.Buffer.from(s,"binary").toString(h.encode||"base64")};if(h.raw||(p="SEA"+await o.stringify(p)),d)try{d(p)}catch(m){console.log(m)}return p}catch(m){if(console.log(m),i.err=m,i.throw)throw m;d&&d();return}}),r.exports=i.sign})(t,"./sign"),t(function(r){var i=t("./root"),o=t("./shim"),a=t("./settings"),l=t("./sha256"),c;i.verify=i.verify||(async(d,h,S,g)=>{try{var _=await a.parse(d);if(h===!1){var y=await a.parse(_.m);if(S)try{S(y)}catch(O){console.log(O)}return y}g=g||{};var w=h.pub||h,f=i.opt.slow_leak?await i.opt.slow_leak(w):await(o.ossl||o.subtle).importKey("jwk",a.jwk(w),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),s=await l(_.m),p,m,A,T;try{if(p=o.Buffer.from(_.s,g.encode||"base64"),m=new Uint8Array(p),A=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},f,m,new Uint8Array(s)),!A)throw"Signature did not match."}catch{if(i.opt.fallback)return await i.opt.fall_verify(d,h,S,g)}var k=A?await a.parse(_.m):c;if(S)try{S(k)}catch(O){console.log(O)}return k}catch(O){if(console.log(O),i.err=O,i.throw)throw O;S&&S();return}}),r.exports=i.verify;var u={};i.opt.slow_leak=d=>{if(u[d])return u[d];var h=a.jwk(d);return u[d]=(o.ossl||o.subtle).importKey("jwk",h,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),u[d]};var v=i.opt;i.opt.fall_verify=async function(d,h,S,g,_){if(_===i.opt.fallback)throw"Signature did not match";_=_||1;var y=d||"";d=i.opt.unpack(d)||d;var w=await a.parse(d),f=h.pub||h,s=await i.opt.slow_leak(f),p=_<=i.opt.fallback?o.Buffer.from(await o.subtle.digest({name:"SHA-256"},new o.TextEncoder().encode(await a.parse(w.m)))):await l(w.m),m,A,T;try{if(m=o.Buffer.from(w.s,g.encode||"base64"),A=new Uint8Array(m),T=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},s,A,new Uint8Array(p)),!T)throw"Signature did not match."}catch{try{m=o.Buffer.from(w.s,"utf8"),A=new Uint8Array(m),T=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},s,A,new Uint8Array(p))}catch{if(!T)throw"Signature did not match."}}var k=T?await a.parse(w.m):c;if(v.fall_soul=y["#"],v.fall_key=y["."],v.fall_val=d,v.fall_state=y[">"],S)try{S(k)}catch(O){console.log(O)}return k},i.opt.fallback=2})(t,"./verify"),t(function(r){var i=t("./shim"),o=t("./settings"),a=t("./sha256");const l=async(c,u,v)=>{const d=c+(u||i.random(8)).toString("utf8"),h=i.Buffer.from(await a(d),"binary"),S=o.keyToJwk(h);return await i.subtle.importKey("jwk",S,{name:"AES-GCM"},!1,["encrypt","decrypt"])};r.exports=l})(t,"./aeskey"),t(function(r){var i=t("./root"),o=t("./shim");t("./settings");var a=t("./aeskey"),l;i.encrypt=i.encrypt||(async(c,u,v,d)=>{try{d=d||{};var h=(u||d).epriv||u;if(l===c)throw"`undefined` not allowed.";if(!h){if(!i.I)throw"No encryption key.";u=await i.I(null,{what:c,how:"encrypt",why:d.why}),h=u.epriv||u}var S=typeof c=="string"?c:await o.stringify(c),g={s:o.random(9),iv:o.random(15)},_=await a(h,g.s,d).then(w=>o.subtle.encrypt({name:d.name||"AES-GCM",iv:new Uint8Array(g.iv)},w,new o.TextEncoder().encode(S))),y={ct:o.Buffer.from(_,"binary").toString(d.encode||"base64"),iv:g.iv.toString(d.encode||"base64"),s:g.s.toString(d.encode||"base64")};if(d.raw||(y="SEA"+await o.stringify(y)),v)try{v(y)}catch(w){console.log(w)}return y}catch(w){if(console.log(w),i.err=w,i.throw)throw w;v&&v();return}}),r.exports=i.encrypt})(t,"./encrypt"),t(function(r){var i=t("./root"),o=t("./shim"),a=t("./settings"),l=t("./aeskey");i.decrypt=i.decrypt||(async(c,u,v,d)=>{try{d=d||{};var h=(u||d).epriv||u;if(!h){if(!i.I)throw"No decryption key.";u=await i.I(null,{what:c,how:"decrypt",why:d.why}),h=u.epriv||u}var S=await a.parse(c),g,_,y;try{g=o.Buffer.from(S.s,d.encode||"base64"),_=o.Buffer.from(S.iv,d.encode||"base64"),y=o.Buffer.from(S.ct,d.encode||"base64");var w=await l(h,g,d).then(s=>o.subtle.decrypt({name:d.name||"AES-GCM",iv:new Uint8Array(_),tagLength:128},s,new Uint8Array(y)))}catch{if(d.encode==="utf8")throw"Could not decrypt";if(i.opt.fallback)return d.encode="utf8",await i.decrypt(c,u,v,d)}var f=await a.parse(new o.TextDecoder("utf8").decode(w));if(v)try{v(f)}catch(s){console.log(s)}return f}catch(s){if(console.log(s),i.err=s,i.throw)throw s;v&&v();return}}),r.exports=i.decrypt})(t,"./decrypt"),t(function(r){var i=t("./root"),o=t("./shim");t("./settings"),i.secret=i.secret||(async(l,c,u,v)=>{try{if(v=v||{},!c||!c.epriv||!c.epub){if(!i.I)throw"No secret mix.";c=await i.I(null,{what:l,how:"secret",why:v.why})}var d=l.epub||l,h=c.epub,S=c.epriv,g=o.ossl||o.subtle,_=a(d),y=Object.assign({public:await g.importKey(..._,!0,[])},{name:"ECDH",namedCurve:"P-256"}),w=a(h,S),f=await g.importKey(...w,!1,["deriveBits"]).then(async p=>{var m=await g.deriveBits(y,p,256),A=new Uint8Array(m),T=await g.importKey("raw",A,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return g.exportKey("jwk",T).then(({k})=>k)}),s=f;if(u)try{u(s)}catch(p){console.log(p)}return s}catch(p){if(console.log(p),i.err=p,i.throw)throw p;u&&u();return}});var a=(l,c)=>{var[u,v]=l.split("."),d=c?{d:c}:{};return["jwk",Object.assign(d,{x:u,y:v,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};r.exports=i.secret})(t,"./secret"),t(function(r){var i=t("./root");i.certify=i.certify||(async(o,a={},l,c,u={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),o=(()=>{var s=[];if(o){if((typeof o=="string"||Array.isArray(o))&&o.indexOf("*")>-1)return"*";if(typeof o=="string")return o;if(Array.isArray(o)){if(o.length===1&&o[0])return typeof o[0]=="object"&&o[0].pub?o[0].pub:typeof o[0]=="string"?o[0]:null;o.map(p=>{typeof p=="string"?s.push(p):typeof p=="object"&&p.pub&&s.push(p.pub)})}return typeof o=="object"&&o.pub?o.pub:s.length>0?s:null}})(),!o)return console.log("No certificant found.");const d=u.expiry&&(typeof u.expiry=="number"||typeof u.expiry=="string")?parseFloat(u.expiry):null,h=(a||{}).read?a.read:null,S=(a||{}).write?a.write:typeof a=="string"||Array.isArray(a)||a["+"]||a["#"]||a["."]||a["="]||a["*"]||a[">"]||a["<"]?a:null,g=(u||{}).block||(u||{}).blacklist||(u||{}).ban||{},_=g.read&&(typeof g.read=="string"||(g.read||{})["#"])?g.read:null,y=typeof g=="string"?g:g.write&&(typeof g.write=="string"||g.write["#"])?g.write:null;if(!h&&!S)return console.log("No policy found.");const w=JSON.stringify({c:o,...d?{e:d}:{},...h?{r:h}:{},...S?{w:S}:{},..._?{rb:_}:{},...y?{wb:y}:{}});var v=await i.sign(w,l,null,{raw:1});if(u.raw||(v="SEA"+JSON.stringify(v)),c)try{c(v)}catch(s){console.log(s)}return v}catch(d){if(i.err=d,i.throw)throw d;c&&c();return}}),r.exports=i.certify})(t,"./certify"),t(function(r){var i=t("./shim"),o=t("./root");o.work=t("./work"),o.sign=t("./sign"),o.verify=t("./verify"),o.encrypt=t("./encrypt"),o.decrypt=t("./decrypt"),o.certify=t("./certify"),o.random=o.random||i.random,o.Buffer=o.Buffer||t("./buffer"),o.keyid=o.keyid||(async a=>{try{const l=i.Buffer.concat(a.replace(/-/g,"+").replace(/_/g,"/").split(".").map(d=>i.Buffer.from(d,"base64"))),c=i.Buffer.concat([i.Buffer.from([153,l.length/256,l.length%256]),l]),u=await sha1hash(c),v=i.Buffer.from(u,"binary");return v.toString("hex",v.length-8)}catch(l){throw console.log(l),l}}),((o.window||{}).GUN||{}).SEA=o,r.exports=o})(t,"./sea"),t(function(r){var i=t("./sea"),o,a;i.window?o=i.window.GUN||{chain:{}}:o=t((a+""==typeof n?".":"")+"./gun",1),i.GUN=o;function l(u){this._={$:this}}l.prototype=function(){function u(){}return u.prototype=o.chain,new u}(),l.prototype.constructor=l,o.chain.user=function(u){var v=this,h=v.back(-1),d;if(u)return u=i.opt.pub((u._||"")["#"])||u,h.get("~"+u);if(d=h.back("user"))return d;var h=h._,S=h,g=S.opt.uuid||c;return(S=(d=S.user=v.chain(new l))._).opt={},S.opt.uuid=function(_){var y=g(),w=h.user;return!w||!(w=w.is)||!(w=w.pub)||(y="~"+w+"/"+y,_&&_.call&&_(null,y)),y},d};function c(){return o.state().toString(36).replace(".","")}o.User=l,l.GUN=o,l.SEA=o.SEA=i,r.exports=l})(t,"./user"),t(function(r){var i,o=""+i!=typeof GUN?GUN||{chain:{}}:t((""+i==typeof n?".":"")+"./gun",1);o.chain.then=function(a,l){var c=this,u=new Promise(function(v,d){c.once(v,l)});return a?u.then(a):u}})(t,"./then"),t(function(r){var i=t("./user"),o=i.SEA,a=i.GUN,l=function(){};i.prototype.create=function(...c){var u=typeof c[0]=="object"&&(c[0].pub||c[0].epub)?c[0]:typeof c[1]=="object"&&(c[1].pub||c[1].epub)?c[1]:null,v=u&&(u.pub||u.epub)?u.pub:typeof c[0]=="string"?c[0]:null,d=u&&(u.pub||u.epub)?u:v&&typeof c[1]=="string"?c[1]:null,h=c.filter(s=>typeof s=="function")[0]||null,S=c&&c.length>1&&typeof c[c.length-1]=="object"?c[c.length-1]:{},g=this,_=g._,y=g.back(-1);if(h=h||l,S=S||{},S.check!==!1){var w;if(v||(w="No user."),(d||"").length<8&&(w="Password too short!"),w)return h({err:a.log(w)}),g}if(_.ing)return(h||l)({err:a.log("User is already being created or authenticated!"),wait:!0}),g;_.ing=!0;var f={};return f.a=function(s){if(f.pubs=s,s&&!S.already){var p={err:a.log("User already created!")};_.ing=!1,(h||l)(p),g.leave();return}f.salt=String.random(64),o.work(d,f.salt,f.b)},f.b=function(s){f.proof=s,u?f.c(u):o.pair(f.c)},f.c=function(s){var p;f.pair=s||{},(p=_.root.user)&&(p._.sea=s,p.is={pub:s.pub,epub:s.epub,alias:v}),f.data={pub:s.pub},f.d()},f.d=function(){f.data.alias=v,f.e()},f.e=function(){f.data.epub=f.pair.epub,o.encrypt({priv:f.pair.priv,epriv:f.pair.epriv},f.proof,f.f,{raw:1})},f.f=function(s){f.data.auth=JSON.stringify({ek:s,s:f.salt}),f.g(f.data.auth)},f.g=function(s){var p;f.data.auth=f.data.auth||s,y.get(p="~"+f.pair.pub).put(f.data).on(f.h);var m={};m[p]={"#":p},y.get("~@"+v).put(m).get(p).on(f.i)},f.h=function(s,p,m,A){A.off(),f.h.ok=1,f.i()},f.i=function(s,p,m,A){A&&(f.i.ok=1,A.off()),!(!f.h.ok||!f.i.ok)&&(_.ing=!1,h({ok:0,pub:f.pair.pub}),l===h&&(u?g.auth(u):g.auth(v,d)))},y.get("~@"+v).once(f.a),g},i.prototype.leave=function(c,u){var v=this,d=v.back(-1)._.user;if(d&&(delete d.is,delete d._.is,delete d._.sea),o.window)try{var h={};h=o.window.sessionStorage,delete h.recall,delete h.pair}catch{}return v}})(t,"./create"),t(function(r){var i=t("./user"),o=i.SEA,a=i.GUN,l=function(){};i.prototype.auth=function(...u){var v=typeof u[0]=="object"&&(u[0].pub||u[0].epub)?u[0]:typeof u[1]=="object"&&(u[1].pub||u[1].epub)?u[1]:null,d=!v&&typeof u[0]=="string"?u[0]:null,h=(d||v&&!(v.priv&&v.epriv))&&typeof u[1]=="string"?u[1]:null,S=u.filter(m=>typeof m=="function")[0]||null,g=u&&u.length>1&&typeof u[u.length-1]=="object"?u[u.length-1]:{},_=this,y=_._,w=_.back(-1);if(y.ing)return(S||l)({err:a.log("User is already being created or authenticated!"),wait:!0}),_;y.ing=!0;var f={},s,p=9;return f.a=function(m){if(!m)return f.b();if(!m.pub){var A=[];return Object.keys(m).forEach(function(T){T!="_"&&A.push(m[T])}),f.b(A)}if(f.name)return f.f(m);f.c((f.data=m).auth)},f.b=function(m){var A=(f.list=(f.list||[]).concat(m||[])).shift();if(s===A){if(f.name)return f.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(d&&p--){w.get("~@"+d).once(f.a);return}return f.err("Wrong user or password.")}w.get(A).once(f.a)},f.c=function(m){if(s===m)return f.b();if(typeof m=="string")return f.c(c(m));o.work(h,(f.auth=m).s,f.d,f.enc)},f.d=function(m){o.decrypt(f.auth.ek,m,f.e,f.enc)},f.e=function(m){if(s===m)return f.enc?(f.enc=null,f.b()):(f.enc={encode:"utf8"},f.c(f.auth));f.half=m,f.f(f.data)},f.f=function(m){var A=f.half||{},T=f.data||{};f.g(f.lol={pub:m.pub||T.pub,epub:m.epub||T.epub,priv:m.priv||A.priv,epriv:m.epriv||A.epriv})},f.g=function(m){if(!m||!m.pub||!m.epub)return f.b();f.pair=m;var A=w._.user,T=A._;T.tag;var k=T.opt;T=A._=w.get("~"+m.pub)._,T.opt=k,A.is={pub:m.pub,epub:m.epub,alias:d||m.pub},T.sea=f.pair,y.ing=!1;try{h&&s==(c(y.root.graph["~"+m.pub].auth)||"")[":"]&&(g.shuffle=g.change=h)}catch{}if(g.change?f.z():(S||l)(T),o.window&&(_.back("user")._.opt||g).remember)try{var O={};O=o.window.sessionStorage,O.recall=!0,O.pair=JSON.stringify(m)}catch{}try{w._.tag.auth?w._.on("auth",T):setTimeout(function(){w._.on("auth",T)},1)}catch(R){a.log("Your 'auth' callback crashed with:",R)}},f.h=function(m){if(!m)return f.b();if(d=m.alias,d||(d=m.alias="~"+v.pub),!m.auth)return f.g(v);v=null,f.c((f.data=m).auth)},f.z=function(){f.salt=String.random(64),o.work(g.change,f.salt,f.y)},f.y=function(m){o.encrypt({priv:f.pair.priv,epriv:f.pair.epriv},m,f.x,{raw:1})},f.x=function(m){f.w(JSON.stringify({ek:m,s:f.salt}))},f.w=function(m){if(g.shuffle){console.log("migrate core account from UTF8 & shuffle");var A={};Object.keys(f.data).forEach(function(T){A[T]=f.data[T]}),delete A._,A.auth=m,w.get("~"+f.pair.pub).put(A)}w.get("~"+f.pair.pub).get("auth").put(m,S||l)},f.err=function(m){var A={err:a.log(m||"User cannot be found!")};y.ing=!1,(S||l)(A)},f.plugin=function(m){if(!(f.name=m))return f.err();var A=[m];m[0]!=="~"&&(A[1]="~"+m,A[2]="~@"+m),f.b(A)},v?v.priv&&v.epriv?f.g(v):w.get("~"+v.pub).once(f.h):d?w.get("~@"+d).once(f.a):!d&&!h&&o.name(f.plugin),_};function c(u){if(typeof u!="string")return u;try{u=JSON.parse(u)}catch{u={}}return u}})(t,"./auth"),t(function(r){var i=t("./user"),o=i.SEA;i.GUN,i.prototype.recall=function(a,l){var c=this,u=c.back(-1);if(a=a||{},a&&a.sessionStorage){if(o.window)try{var v={};v=o.window.sessionStorage,v&&(u._.opt.remember=!0,(c.back("user")._.opt||a).remember=!0,(v.recall||v.pair)&&u.user().auth(JSON.parse(v.pair),l))}catch{}return c}return c}})(t,"./recall"),t(function(r){var i=t("./user"),o=i.SEA,a=i.GUN,l=function(){};i.prototype.pair=function(){var c=this,u;try{u=new Proxy({DANGER:"â "},{get:function(v,d,h){if(!(!c.is||!(c._||"").sea))return c._.sea[d]}})}catch{}return u},i.prototype.delete=async function(c,u,v){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var d=this;d.back(-1);var h=d.back("user");try{h.auth(c,u,function(S){var g=(h.is||{}).pub;h.map().once(function(){this.put(null)}),h.leave(),(v||l)({ok:0})})}catch(S){a.log("User.delete failed! Error:",S)}return d},i.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const c=this.back(-1);try{return await authRecall(c),c._.user._}catch{const v="No session!";throw a.log(v),{err:v}}},i.prototype.trust=async function(c){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),a.is(c)&&c.get("pub").get((u,v)=>{console.log(u,v)}),c.get("trust").get(path).put(theirPubkey)},i.prototype.grant=function(c,u){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var v=this,d=v.back(-1).user(),h=d._.sea,S="";return v.back(function(g){g.is||(S+=g.get||"")}),async function(){var g,_=await d.get("grant").get(h.pub).get(S).then();_=await o.decrypt(_,h),_||(_=o.random(16).toString(),g=await o.encrypt(_,h),d.get("grant").get(h.pub).get(S).put(g));var y=c.get("pub").then(),w=c.get("epub").then();y=await y,w=await w;var f=await o.secret(w,h);g=await o.encrypt(_,f),d.get("grant").get(y).get(S).put(g,u)}(),v},i.prototype.secret=function(c,u){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var v=this,d=v.back(-1).user(),h=d.pair(),S="";return v.back(function(g){g.is||(S+=g.get||"")}),async function(){var g,_=await d.get("trust").get(h.pub).get(S).then();_=await o.decrypt(_,h),_||(_=o.random(16).toString(),g=await o.encrypt(_,h),d.get("trust").get(h.pub).get(S).put(g)),g=await o.encrypt(c,_),v.put(g,u)}(),v},r.exports=i})(t,"./share"),t(function(r){var i=t("./sea"),o=t("./settings"),a,l=(i.window||"").GUN||t((""+a==typeof n?".":"")+"./gun",1);l.on("opt",function(g){g.sea||(g.sea={own:{}},g.on("put",c,g)),this.to.next(g)});function c(g){var _=this,y=_.as,w=g.put,f=w["#"],s=w["."],p=w[":"],m=w[">"],A=g["#"],T;if(!(!f||!s)){if((g._||"").faith&&(y.opt||"").faith&&typeof g._=="function"){i.opt.pack(w,function(O){i.verify(O,!1,function(R){w["="]=i.opt.unpack(R),_.to.next(g)})});return}var k=function(O){y.on("in",{"@":A,err:g.err=O})};if((g._||"").DBG&&((g._||"").DBG.c=+new Date),0<=f.indexOf("<?")&&(T=parseFloat(f.split("<?")[1]||""),T&&m<l.state()-T*1e3)){(T=g._)&&T.stun&&T.stun--;return}if(f==="~@"){c.alias(_,g,p,s,f,y,k);return}if(f.slice(0,2)==="~@"){c.pubs(_,g,p,s,f,y,k);return}if(T=i.opt.pub(f)){c.pub(_,g,p,s,f,y,k,y.user||"",T);return}if(0<=f.indexOf("#")){c.hash(_,g,p,s,f,y,k);return}c.any(_,g,p,s,f,y,k,y.user||"")}}c.hash=function(g,_,y,w,f,s,p){i.work(y,null,function(m){function A(T){let k="";for(let O=0;O<T.length;O++)k+=O-1&1?"":String.fromCharCode(parseInt(T.substring(O-1,O+1),16));return btoa(k)}if(m&&m===w.split("#").slice(-1)[0])return g.to.next(_);if(m&&m===A(w.split("#").slice(-1)[0]))return g.to.next(_);p("Data hash not same as hash!")},{name:"SHA-256"})},c.alias=function(g,_,y,w,f,s,p){if(!y)return p("Data must exist!");if("~@"+w===v(y))return g.to.next(_);p("Alias not same!")},c.pubs=function(g,_,y,w,f,s,p){if(!y)return p("Alias must exist!");if(w===v(y))return g.to.next(_);p("Alias not same!")},c.pub=async function(g,_,y,w,f,s,p,m,A){var T;const k=await o.parse(y)||{},O=(R,x,E)=>{if(R.m&&R.s&&x&&A)return i.verify(R,A,b=>{if(a!==b&&a!==b.e&&_.put[">"]&&_.put[">"]>parseFloat(b.e))return p("Certificate expired.");if(a!==b&&b.c&&b.w&&(b.c===x||b.c.indexOf("*")>-1)){let C=f.indexOf("/")>-1?f.replace(f.substring(0,f.indexOf("/")+1),""):"";String.match=String.match||l.text.match;const z=Array.isArray(b.w)?b.w:typeof b.w=="object"||typeof b.w=="string"?[b.w]:[];for(const j of z)if(String.match(C,j["#"])&&String.match(w,j["."])||!j["."]&&String.match(C,j["#"])||!j["#"]&&String.match(w,j["."])||String.match(C?C+"/"+w:w,j["#"]||j)){if(j["+"]&&j["+"].indexOf("*")>-1&&C&&C.indexOf(x)==-1&&w.indexOf(x)==-1)return p(`Path "${C}" or key "${w}" must contain string "${x}".`);if(b.wb&&(typeof b.wb=="string"||(b.wb||{})["#"])){var $=g.as.root.$.back(-1);return typeof b.wb=="string"&&b.wb.slice(0,1)!=="~"&&($=$.get("~"+A)),$.get(b.wb).get(x).once(N=>N&&(N===1||N===!0)?p(`Certificant ${x} blocked.`):E(b))}return E(b)}return p("Certificate verification fail.")}})};if(w==="pub"&&"~"+A===f)return y===A?g.to.next(_):p("Account not same!");if((T=m.is)&&T.pub&&!k["*"]&&!k["+"]&&(A===T.pub||A!==T.pub&&((_._.msg||{}).opt||{}).cert)){i.opt.pack(_.put,R=>{i.sign(R,m._.sea,async function(x){if(a===x)return p(i.err||"Signature fail.");if(_.put[":"]={":":T=i.opt.unpack(x.m),"~":x.s},_.put["="]=T,A===m.is.pub){(T=v(y))&&((s.sea.own[T]=s.sea.own[T]||{})[A]=1),JSON.stringifyAsync(_.put[":"],function(E,b){return E?p(E||"Stringify error."):(_.put[":"]=b,g.to.next(_))});return}if(A!==m.is.pub&&((_._.msg||{}).opt||{}).cert){const E=await o.parse(_._.msg.opt.cert);E&&E.m&&E.s&&O(E,m.is.pub,b=>{_.put[":"]["+"]=E,_.put[":"]["*"]=m.is.pub,JSON.stringifyAsync(_.put[":"],function($,C){return $?p($||"Stringify error."):(_.put[":"]=C,g.to.next(_))})})}},{raw:1})});return}i.opt.pack(_.put,R=>{i.verify(R,k["*"]||A,function(x){var E;if(x=i.opt.unpack(x),a===x)return p("Unverified data.");if((E=v(x))&&A===i.opt.pub(E)&&((s.sea.own[E]=s.sea.own[E]||{})[A]=1),k["+"]&&k["+"].m&&k["+"].s&&k["*"])O(k["+"],k["*"],b=>(_.put["="]=x,g.to.next(_)));else return _.put["="]=x,g.to.next(_)})})},c.any=function(g,_,y,w,f,s,p,m){if(s.opt.secure)return p("Soul missing public key at '"+w+"'.");s.on("secure",function(A){if(this.off(),!s.opt.secure)return g.to.next(A);p("Data cannot be changed.")}).on.on("secure",_)};var u=l.valid,v=function(g,_){return typeof(_=u(g))=="string"&&_};(l.state||"").ify;var d=/[^\w_-]/;i.opt.pub=function(g){if(g&&(g=g.split("~"),!(!g||!(g=g[1]))&&(g=g.split(d).slice(0,2),!(!g||g.length!=2)&&(g[0]||"")[0]!=="@")))return g=g.slice(0,2).join("."),g},i.opt.stringy=function(g){},i.opt.pack=function(g,_,y,w,f){var s,p;if(i.opt.check(g))return _(g);g&&g["#"]&&g["."]&&g[">"]&&(s=g[":"],p=1),JSON.parseAsync(p?s:g,function(m,A){var T=a!==(A||"")[":"]&&(A||"")["~"];if(!T){_(g);return}_({m:{"#":f||g["#"],".":y||g["."],":":(A||"")[":"],">":g[">"]||l.state.is(w,y)},s:T})})};var h=i.opt;i.opt.unpack=function(g,_,y){var w;if(a!==g){if(g&&a!==(w=g[":"]))return w;if(_=_||h.fall_key,!y&&h.fall_val&&(y={},y[_]=h.fall_val),!(!_||!y)){if(g===y[_]||!i.opt.check(y[_]))return g;var f=y&&y._&&y._["#"]||h.fall_soul,s=l.state.is(y,_)||h.fall_state;if(g&&g.length===4&&f===g[0]&&_===g[1]&&S(s)===S(g[3]))return g[2];if(s<i.opt.shuffle_attack)return g}}},i.opt.shuffle_attack=15463296e5;var S=Math.floor})(t,"./index")})()}(nt)),nt.exports}var hc=lc();const pc=Gt(hc);var $t={exports:{}},Fn={},Wn;function dc(){if(Wn)return Fn;Wn=1;var e={},t=typeof window<"u"?window.Gun:ke(),n;t.on("opt",function(i){r(i),this.to.next(i)});function r(i){if(i.axe)return;var o=i.opt;if(o.peers,o.axe===!1||typeof process<"u"&&""+(e||"").AXE=="false")return;t.log.once("AXE","AXE relay enabled!");var a=i.axe={},l=o.mesh=o.mesh||t.Mesh(i),c=i.dup;l.way=function(y){if(y){if(y.get)return u(y);y.put||v(y)}};function u(y){if(y){var w=(y._||"").via,f;if(!w||!w.id||!(f=d(y)._))return v(y);f.asked=+new Date,u.turn(y,f.route,0)}}u.turn=function(y,w,f){var s=y["#"],p=c.s[s],m;if(!(!s||!p)&&(clearTimeout(p.lack),!(p.ack&&(s=p["##"])&&y["##"]===s))){if(m=Object.maps(w||o.peers).slice(f=f||0),!m.length){if(!w)return;u.turn(y,n,0);return}setTimeout.each(m,function(A){var T=o.peers[A];if(f++,!T||!T.wire){w&&w.delete(A);return}if(l.say(y,T)!==!1&&f%3==0)return 1},function(){p["##"]=y["##"],p.lack=setTimeout(function(){u.turn(y,w,f)},25)},3)}};function v(y){l.say(y,o.peers)}function d(y){var w="",f,s,p;if(!y||!y.get)return w;typeof(f=y.get["#"])=="string"&&(w=i.$.get(f)),typeof(p=y.get["."])=="string"?s=p:s="";var m=(y._||"").via,A=m.sub||(m.sub=new Object.Map);return(A.get(f)||A.set(f,p=new Object.Map)&&p).set(s,1),m.id&&w._&&(w._.route||(w._.route=new Object.Map)).set(m.id,m),w}function h(y){return(y=y||"")["="]||y["*"]||y[">"]||y}i.on("in",function(y){var w=this.to,f;if((f=y["@"])&&(f=c.s[f])){if(f.ack=(f.ack||0)+1,f.it&&f.it.get&&y.put){var s=f.it.get||"",p=d(f.it)._,m=(f.it._||"").via||"",A;if(m&&p&&(m.id&&(p.route||(p.route=new Object.Map)).set(m.id,m),A=m.sub||(m.sub=new Object.Map),p&&(A.get(h(s["#"]))||A.set(h(s["#"]),A=new Object.Map)&&A).set(h(s["."]),1),m=(y._||"").via||"",m&&(m.id&&(p.route||(p.route=new Object.Map)).set(m.id,m),A=m.sub||(m.sub=new Object.Map),p))){var T=h(s["#"]),k=A.get(T),O=h(s["."]);O?(k||A.set(T,k=new Object.Map)&&k).set(O,1):k||(A.set(T,k=new Object.Map),k.set("",1))}}if(f=f.back){setTimeout.each(Object.keys(f),function(R){w.next({"#":y["#"],"@":R,ok:y.ok})});return}}w.next(y)}),i.on("create",function(y){this.to.next(y),y.on("put",function(w){var f=this;f.as;var s=w.put,p=s["#"],m=s["."],A=s[":"],T=s[">"];if(f.to.next(w),!w["@"]&&!(!p||!m)){var k=y.$.get(p)._,O=(k||"").route;if(O){if(k.skip&&k.skip.has==m){k.skip.now=w["#"];return}(k.skip={now:w["#"],has:m}).to=setTimeout(function(){setTimeout.each(Object.maps(O),function(R){var x,z,E=k.skip||"";if(k.skip=null,!!(x=O.get(R))){if(!x.wire){O.delete(R);return}var b=(x.sub||(x.sub=new Object.Map)).get(p);if(b&&!(!b.get(m)&&!b.get(""))){var $=x.put||(x.put={}),C=y.graph[p],z;C&&n!==(z=C[m])&&(T=_(C,m),A=z),$[p]=g($[p],m,T,A,p),z=c.track(x.next=x.next||String.random(9)),(z.back||(z.back={}))[""+(E.now||w["#"])]=1,!x.to&&(x.to=setTimeout(function(){S(x)},o.gap))}}})},9)}}})});function S(y){var w={"#":y.next,put:y.put,ok:{"@":3,"/":l.near}};y.next=y.put=y.to=null,l.say(w,y)}var g=t.state.ify,_=t.state.is;(function(){a.up={};var y=l.hear["?"];l.hear["?"]=function(w,f){var s;if(y(w,f),!!f.pid){if(f.pid===o.pid){l.bye(f);return}if(s=a.up[f.pid]){if(s===f)return;o.pid>f.pid&&(s=f,f=a.up[s.pid]),s.url=s.url||f.url,l.bye(f),a.up[s.pid]=s;return}f.url&&(a.up[f.pid]=f,a.stay&&a.stay())}},l.hear.opt=function(w,f){if(!w.ok){var s=w.opt;s&&(s=s.peers,!(!s||typeof s!="string")&&(99<=Object.keys(a.up).length||(l.hi({id:s,url:s,retry:9}),f&&l.say({dam:"opt",ok:1,"@":w["#"]},f))))}},a.stay=function(){clearTimeout(a.stay.to),a.stay.to=setTimeout(function(w,f){(w=i.stats&&i.stats.stay)&&(f={},Object.keys(a.up||"").forEach(function(s){s=(a.up||"")[s],s.url&&(f[s.url]={})}),(w.axe=w.axe||{}).up=f)},1e3*9)},setTimeout(function(w){(w=i.stats&&i.stats.stay&&i.stats.stay.axe)&&(w=w.up)&&(w instanceof Array||(w=Object.keys(w)),setTimeout.each(w||[],function(f){l.hear.opt({opt:{peers:f}})}))},1e3)})(),function(){o.mob=o.mob||9900,i.on("hi",function(y){if(this.to.next(y),!y.url){var w=l.near;if(!(o.mob>=w)){var f={};Object.keys(a.up).forEach(function(s){s=a.up[s],s.url&&(f[s.url]={})}),l.say({dam:"mob",mob:w,peers:f},y),setTimeout(function(){l.bye(y)},9)}}}),i.on("bye",function(y){this.to.next(y)})}()}return function(){var i=Array.from;if(Object.maps=function(o){return i&&o instanceof Map?i(o.keys()):(o instanceof Object.Map&&(o=o.s),Object.keys(o))},i)return Object.Map=Map;(Object.Map=function(){this.s={}}).prototype={set:function(o,a){return this.s[o]=a,this},get:function(o){return this.s[o]},delete:function(o){delete this.s[o]}}}(),Fn}var Bn;function gc(){return Bn||(Bn=1,function(e){(function(){var t=setTimeout||{},n;typeof window!=""+n&&(t.window=window);var r=(t.window||"").AXE||function(){};(r.window=t.window)&&(r.window.AXE=r);var i=(r.window||"").GUN||ke();(i.AXE=r).GUN=r.Gun=i,i.window||dc(),i.on("opt",function(a){o(a),this.to.next(a)});function o(a){if(a.axe)return;var l=a.opt,c=l.peers;if(l.axe===!1||!i.window)return;var u=i.window,v=u.localStorage||l.localStorage||{},d=u.location||l.location||{},h=u.navigator||l.navigator||{},S=a.axe={},g,_,y=l.mesh=l.mesh||i.Mesh(a);g=c[_=d.origin+"/gun"]=c[_]||{},g.id=g.url=_,g.retry=g.retry||0,g=c[_="http://localhost:8765/gun"]=c[_]||{},g.id=g.url=_,g.retry=g.retry||0,i.log.once("AXE","AXE enabled: Trying to find network via (1) local peer (2) last used peers (3) a URL parameter, and last (4) hard coded peers."),i.log.once("AXEWarn","Warning: AXE is in alpha, use only for testing!");var w=v.peers||"";w&&(w+=" "),w+=((d.search||"").split("peers=")[1]||"").split("&")[0],a.on("bye",function(s){this.to.next(s),s.url&&(h.onLine||(s.retry=1),!s.retry&&(S.fall&&delete S.fall[s.url||s.id],function p(){if(!S.fall){setTimeout(p,9);return}var m=Object.keys(S.fall||""),A=m[Math.random()*m.length>>0];if(m.length||(v.peers="",A="https://gunjs.herokuapp.com/gun"),c[A]){p();return}y.hi(A)}()))}),a.on("hi",function(s){this.to.next(s),s.url});function f(s){S.fall={},((s||"").match(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/ig)||[]).forEach(function(p){S.fall[p]={url:p,id:p,retry:0}})}if(w){f(w);return}try{fetch(((d.search||"").split("axe=")[1]||"").split("&")[0]||d.axe||"https://raw.githubusercontent.com/wiki/amark/gun/volunteer.dht.md").then(function(s){return s.text()}).then(function(s){f(v.peers=s)}).catch(function(){f()})}catch{f()}}try{""+n!="object"&&(e.exports=r)}catch{}})()}($t)),$t.exports}gc();var Ot={exports:{}},Jn;function Jr(){return Jn||(Jn=1,function(e){(function(){var t={},n,r=setTimeout.turn||typeof setImmediate!=""+n&&setImmediate||setTimeout;t.parseAsync=function(o,a,l,c){if(typeof o!="string"){try{a(n,JSON.parse(o))}catch(d){a(d)}return}var u={i:0,text:o,done:a,l:o.length,up:[]};c=c||1024*32,v();function v(){for(var d=u.text,h=u.i,S=u.l,g=0,_=u.w,y,w;g++<c;){var f=d[h++];if(h>S){u.end=!0;break}if(_){for(h=d.indexOf('"',h-1),f=d[h],w=0;d[h-++w]=="\\";);w=!(w%2),y=y||w,f=='"'&&!w&&(_=n,w=u.s,u.a?(w=d.slice(u.sl,h),(y||1+w.indexOf("\\"))&&(w=JSON.parse('"'+w+'"')),u.at instanceof Array?u.at.push(u.s=w):(u.at||(u.end=g=c,w=n),(u.at||{})[u.s]=u.s=w),u.s=n):(u.s=d.slice(u.sl,h),(y||1+u.s.indexOf("\\"))&&(u.s=JSON.parse('"'+u.s+'"'))),u.a=y=n),++h}else switch(f){case'"':u.sl=h,_=!0;break;case":":u.ai=h,u.a=!0;break;case",":(u.a||u.at instanceof Array)&&(w=d.slice(u.ai,h-1))&&n!==(w=i(w))&&(u.at instanceof Array?u.at.push(w):u.at[u.s]=w),u.a=n,u.at instanceof Array&&(u.a=!0,u.ai=h);break;case"{":u.up.push(u.at||(u.at={})),u.at instanceof Array?u.at.push(u.at={}):n!==(w=u.s)&&(u.at[w]=u.at={}),u.a=n;break;case"}":u.a&&(w=d.slice(u.ai,h-1))&&n!==(w=i(w))&&(u.at instanceof Array?u.at.push(w):(u.at||(u.end=g=c,w=n),(u.at||{})[u.s]=w)),u.a=n,u.at=u.up.pop();break;case"[":n!==(w=u.s)?(u.up.push(u.at),u.at[w]=u.at=[]):u.at||u.up.push(u.at=[]),u.a=!0,u.ai=h;break;case"]":u.a&&(w=d.slice(u.ai,h-1))&&n!==(w=i(w))&&(u.at instanceof Array?u.at.push(w):u.at[u.s]=w),u.a=n,u.at=u.up.pop();break}}if(u.s=n,u.i=h,u.w=_,u.end){if(w=u.at,n===w)try{w=JSON.parse(o)}catch(s){return u.done(s)}u.done(n,w)}else r(v)}};function i(o){var a=parseFloat(o);if(!isNaN(a))return a;if(o=o.trim(),o=="true")return!0;if(o=="false")return!1;if(o=="null")return null}t.stringifyAsync=function(o,a,l,c,u){u=u||{},u.text=u.text||"",u.up=[u.at={d:o}],u.done=a,u.i=0;var v=0;d();function d(){var h=u.at,S=h.d,g="",_;switch(h.i&&h.i-h.j>0&&(g+=","),n!==(_=h.k)&&(g+=JSON.stringify(_)+":"),typeof S){case"boolean":g+=""+S;break;case"string":g+=JSON.stringify(S);break;case"number":g+=isNaN(S)?"null":S;break;case"object":if(!S){g+="null";break}if(S instanceof Array){g+="[",h={i:-1,as:S,up:h,j:0},h.l=S.length,u.up.push(u.at=h);break}if(typeof(S||"").toJSON!="function"){g+="{",h={i:-1,ok:Object.keys(S).sort(),as:S,up:h,j:0},h.l=h.ok.length,u.up.push(u.at=h);break}if(_=S.toJSON()){g+=_;break}case"function":if(h.as instanceof Array){g+="null";break}default:g="",h.j++}for(u.text+=g;1+h.i>=h.l;)u.text+=h.ok?"}":"]",h=u.at=h.up;if(++h.i<h.l){if((_=h.ok)?h.d=h.as[h.k=_[h.i]]:h.d=h.as[h.i],++v<9)return d();v=0,r(d);return}u.done(n,u.text)}},typeof window!=""+n&&(window.YSON=t);try{""+n!="object"&&(e.exports=t)}catch{}typeof JSON!=""+n&&(JSON.parseAsync=t.parseAsync,JSON.stringifyAsync=t.stringifyAsync)})()}(Ot)),Ot.exports}Jr();var Ct={exports:{}},Gn;function on(){return Gn||(Gn=1,function(){function e(){var o=function(a,l,c){if(o.unit=0,!c&&r!==l&&(o.last=""+a<o.last?o.last:""+a,delete(o.$||{})[i]),c=c||o.$||(o.$={}),!a&&Object.keys(c).length)return c;a=""+a;for(var u=0,v=a.length-1,d=a[u],h,S;!(h=c[d])&&u<v;)d+=a[++u];if(h)if(u==v){if(r===l)return r===(S=h[""])?h:(o.unit=1)&&S;h[""]=l}else return r!==l&&delete h[i],o(a.slice(++u),l,h||(h={}));else{if(!t(c,function(g,_){var y=0,w="";if((_||"").length)for(;_[y]==a[y];)w+=_[y++];if(w){if(r===l)return y<=v?void 0:((S||(S={}))[_.slice(y)]=g,g);var f={};if(f[_.slice(y)]=g,y=a.slice(y),y===""?f[""]=l:(f[y]={})[""]=l,c[w]=f,e.debug&&""+w=="undefined"){console.log(0,w);debugger}return delete c[_],!0}})){if(r===l)return;if((c[d]||(c[d]={}))[""]=l,e.debug&&""+d=="undefined"){console.log(1,d);debugger}}if(r===l)return S}};return o}if(e.map=function o(a,l,c,u){try{u=u||[];var v=typeof a=="function"?a.$||{}:a;//!opt && console.log("WHAT IS T?", JSON.stringify(t).length);
if(!v)return;if(typeof v=="string"){if(e.debug)throw["BUG:",a,l,c,u];return}var d=(v[i]||n).sort||(v[i]=function k(){return k.sort=Object.keys(v).sort(),k}()).sort,h;c=c===!0?{branch:!0}:c||{},(h=c.reverse)&&(d=d.slice(0).reverse());for(var S=c.start,g=c.end,_="ï¿¿",y=0,w=d.length;y<w;y++){var f=d[y],s=v[f],p,m,A;if(!(!s||f===""||i===f||f==="undefined")&&(m=u.slice(0),m.push(f),A=m.join(""),!(r!==S&&A<(S||"").slice(0,A.length))&&!(r!==g&&(g||_)<A))){if(h&&(p=o(s,l,c,m),r!==p))return p;if(r!==(p=s[""])){var T=1;if(r!==S&&A<(S||"")&&(T=0),r!==g&&A>(g||_)&&(T=0),T&&(p=l(p,A,f,u),r!==p))return p}else if(c.branch&&(p=l(r,A,f,u),r!==p))return p;if(u=m,!h&&(p=o(s,l,c,u),r!==p))return p;u.pop()}}}catch(k){console.error(k)}},typeof window<"u")window.Radix=e;else try{Ct.exports=e}catch{}var t=e.object=function(o,a,l){for(var c in o)if(o.hasOwnProperty(c)&&(l=a(o[c],c))!==r)return l},n={},r,i=""}()),Ct.exports}on();var xt={exports:{}},jt,Kn;function vc(){return Kn||(Kn=1,jt=function(e){var t=on();e.find("a",function(){var n=[];t.map(e.list,function(o,a){a.indexOf("%1B")+1&&o&&n.push([a,o])}),n.length&&console.log(`
! ! ! WARNING ! ! !
RAD v0.2020.x has detected OLD v0.2019.x data & automatically migrating. Automatic migration will be turned OFF in future versions! If you are just developing/testing, we recommend you reset your data. Please contact us if you have any concerns.
This message should only log once.`);var r,i;n.forEach(function(o){r=o[0],i=o[1],e.list(decodeURIComponent(r),i),e.list(r,0)}),r&&e.find.bad(r)})}),jt}var Hn;function Gr(){return Hn||(Hn=1,function(){function e(r){r=r||{},r.log=r.log||console.log,r.file=String(r.file||"radata");var i=(e.has||(e.has={}))[r.file];if(i)return i;r.max=r.max||(r.memory?r.memory*999*999:3e8)*.3,r.until=r.until||r.wait||250,r.batch=r.batch||10*1e3,r.chunk=r.chunk||1024*1024*1,r.code=r.code||{},r.code.from=r.code.from||"!",r.jsonify=!0;function o(y){return encodeURIComponent(y).replace(/\*/g,"%2A")}function a(y){return _!==y&&(!y||typeof y!="object")}var l=""+_==typeof setImmediate?setTimeout:setImmediate,c=setTimeout.turn||l,_,u=n.object,v=0;if(!r.store)return r.log("ERROR: Radisk needs `opt.store` interface with `{get: fn, put: fn (, list: fn)}`!");if(!r.store.put)return r.log("ERROR: Radisk needs `store.put` interface with `(file, data, cb)`!");if(!r.store.get)return r.log("ERROR: Radisk needs `store.get` interface with `(file, cb)`!");r.store.list,""+_!=typeof rn&&Jr();var d=JSON.parseAsync||function(y,w,f){var s;try{w(s,JSON.parse(y,f))}catch(p){w(p)}},h=function(y,w,f,s,p){if(typeof w=="function"){var m=f||{};f=w,h.read(y,f,m,p||s);return}h.save(y,w,f,s,p)};h.save=function(y,w,f,s,p){var m={key:y},A,T;m.find=function(k){var O;if(m.file=k||(k=r.code.from),p&&(p=p[k]=p[k]||{}),p&&(p.sf=p.sf||+new Date),O=h.disk[k]){m.mix(_,O);return}h.parse(k,m.mix,_,p)},m.mix=function(k,O){if(p&&(p.sml=+new Date),p&&(p.sm=p.sm||+new Date),m.err=k||m.err){f(k);return}var R=m.file=(O||"").file||m.file,x;if(!O&&R!==r.code.from){h.find.bad(R),h.save(y,w,f,s);return}if((O=h.disk[R]||(h.disk[R]=O||n())).file||(O.file=R),r.compare&&(w=r.compare(O(y),w,y,R),_===w)){f(k,-1);return}if((m.disk=O)(y,w),s&&((x=(x=O.tags||(O.tags={}))[s]||(x[s]=h.tags[s]||(h.tags[s]={})))[R]||(x[R]=h.one[s]||(h.one[s]=f)),f=null),p&&(p.st=p.st||+new Date),O.Q){f&&O.Q.push(f);return}O.Q=f?[f]:[],O.to=setTimeout(m.write,r.until)},m.write=function(){p&&(p.sto=p.sto||+new Date);var k=A=m.file,O=m.disk;T=m.q=O.Q,m.tags=O.tags,delete O.Q,delete h.disk[k],delete O.tags,h.write(k,O,m.ack,_,p)},m.ack=function(k,O){p&&(p.sa=p.sa||+new Date),p&&(p.sal=T.length);var R,x;for(var E in h.tags)if(h.tags.hasOwnProperty(E)){var b=h.tags[E];if(!((x=h.disk[A])&&(x=x.tags)&&x[b])){R=b[A],delete b[A];var $;for(var C in b)if(b.hasOwnProperty(C)){$=!0;break}$||(delete h.tags[b],R&&R(k,O))}}!T&&(T="");for(var z=T.length,j=0,N=+new Date;j<z;j++)(R=T[j])&&R(k,O);console.STAT&&console.STAT(N,+new Date-N,"rad acks",o(m.file)),console.STAT&&console.STAT(N,T.length,"rad acks #",o(m.file))},f||(f=function(k,O){}),h.find(y,m.find)},h.disk={},h.one={},h.tags={};var S=0;h.write=function(y,w,f,s,p){if(!w){f("No radix!");return}s=typeof s=="object"?s:{force:s};var m=function(){},A,T;if(m.text="",m.file=y=w.file||(w.file=y),!y){f("What file?");return}if(m.write=function(){var k=w.raw=m.text;h.disk[y=w.file||m.file||y]=w;var O=+new Date;p&&(p.wd=O),h.find.add(y,function(x){if(p&&(p.wa=+new Date),x){f(x);return}r.store.put(o(y),k,function(b,$){p&&(p.wp=+new Date),console.STAT&&console.STAT(O,v=+new Date-O,"wrote disk",JSON.stringify(y),++S,"total all writes."),f(b,$||1),w.Q||delete h.disk[y]})})},m.split=function(){var k=+new Date;p&&(p.wf=k),m.text="",m.count||(m.count=0,n.map(w,function(){m.count++})),p&&(p.wfc=m.count),m.limit=Math.ceil(m.count/2);var O=m.count;return m.count=0,p&&(p.wf1=+new Date),m.sub=n(),n.map(w,m.slice,{reverse:1}),p&&(p.wf2=+new Date),h.write(m.end,m.sub,m.both,s),p&&(p.wf3=+new Date),m.hub=n(),n.map(w,m.stop),p&&(p.wf4=+new Date),h.write(w.file,m.hub,m.both,s),p&&(p.wf5=+new Date),console.STAT&&console.STAT(k,+new Date-k,"rad split",o(w.file),O),!0},m.slice=function(k,O){if(m.sub(m.end=O,k),m.limit<=++m.count)return!0},m.stop=function(k,O){if(O>=m.end)return!0;m.hub(O,k)},m.both=function(k,O){if(p&&(p.wfd=+new Date),T){f(k||T);return}if(A){f(k,O);return}A=!0,T=k},m.each=function(k,O,R,x){if(_!==k&&m.count++,r.max<=(k||"").length)return f("Data too big!"),!0;var E=e.encode(x.length)+"#"+e.encode(R)+(_===k?"":":"+e.encode(k))+`
`;if(r.chunk<m.text.length+E.length&&1<m.count&&!s.force)return m.split();m.text+=E},r.jsonify){h.write.jsonify(m,w,f,s,p);return}n.map(w,m.each,!0)||m.write()},h.write.jsonify=function(y,w,f,s,p){var m,A=+new Date;p&&(p.w=A);try{m=JSON.stringify(w.$)}catch{f("Cannot radisk!");return}if(p&&(p.ws=+new Date),console.STAT&&console.STAT(A,+new Date-A,"rad stringified JSON"),r.chunk<m.length&&!s.force){var T=0;if(n.map(w,function(){if(T++)return!0}),T>1)return y.split()}y.text=m,y.write()},h.range=function(y,w){if(!(!y||!w)){if(_===w.start&&_===w.end||a(y))return y;var f=n();return n.map(y,function(s,p){f(p,s)},w),f("")}},function(){h.read=function(y,w,f,s){f=f||{};var p={key:y};p.find=function(m){var A;if(p.file=m||(m=r.code.from),s&&(s=s[m]=s[m]||{}),s&&(s.rf=s.rf||+new Date),A=h.disk[p.file=m]){p.check(_,A);return}h.parse(m,p.check,_,s)},p.get=function(m,A,T){if(s&&(s.rgl=+new Date),s&&(s.rg=s.rg||+new Date),p.err=m||p.err){w(m);return}var k=p.file=(A||"").file||p.file;if(!A&&k!==r.code.from){h.find.bad(k),h.read(y,w,f);return}if(A=h.disk[k]||(h.disk[k]=A),!A){w(k===r.code.from?_:"No file!");return}A.file||(A.file=k);var O=h.range(A(y),f);if(s&&(s.rr=+new Date),f.unit=A.unit,f.chunks=(f.chunks||0)+1,f.parsed=(f.parsed||0)+((T||"").parsed||f.chunks*r.chunk),f.more=1,f.next=_,n.map(h.list,function(b,$){if(!(!b||k===$))return f.next=$,1},f.reverse?{reverse:1,end:k}:{start:k}),s&&(s.rl=+new Date),f.next||(f.more=0),f.next&&(!f.reverse&&(y<f.next&&f.next.indexOf(y)!=0||_!==f.end&&(f.end||"ï¿¿")<f.next)&&(f.more=0),f.reverse&&(y>f.next&&y.indexOf(f.next)!=0||_!==f.start&&(f.start||"")>f.next&&k<=f.start)&&(f.more=0)),!f.more){w(p.err,O,f);return}if(O&&w(p.err,O,f),!(f.parsed>=f.limit)){var R=+new Date;s&&(s.rm=R);var x=f.next;l(function(){console.STAT&&console.STAT(R,+new Date-R,"rad more"),h.parse(x,p.check)},0)}},p.check=function(m,A,T){if(p.get(m,A,T),!(!A||A.check)){A.check=1;var k=+new Date;(T||(T={})).file||(T.file=p.file),n.map(A,function(O,R){h.find(R,function(x){if((x||(x=r.code.from))!==T.file){var E=(""+Math.random()).slice(-3);c(function(){h.save(R,O,function b($,C){if($){h.save(R,O,b);return}console.STAT&&console.STAT("MISLOCATED DATA CORRECTED",E,o(R),o(T.file),o(x))})},0)}})}),console.STAT&&console.STAT(k,+new Date-k,"rad check")}},h.find(y||(f.reverse?f.end||"":f.start||""),p.find)}}(),function(){var y=0,w={},f="";h.parse=function(s,p,m,A){var T;if(!s)return p();if(T=w[s]){T.push(p);return}T=w[s]=[p];var k=function(){},O={file:s};(k.disk=n()).file=s,k.read=function(x,E){if(A&&(A.rpg=+new Date),console.STAT&&console.STAT(R,+new Date-R,"read disk",JSON.stringify(s),++y,"total all parses."),(k.err=x)||(k.not=!E)){delete w[s],k.map(T,k.ack);return}if(typeof E!="string"){try{r.max<=E.length?k.err="Chunk too big!":E=E.toString()}catch(b){k.err=b}if(k.err){delete w[s],k.map(T,k.ack);return}}if(O.parsed=E.length,A&&(A.rpl=O.parsed),A&&(A.rpa=T.length),R=+new Date,!(r.jsonify||E[0]==="{")){k.radec(x,E);return}d(E,function(b,$){if(!b){delete w[s],k.disk.$=$,console.STAT&&(v=+new Date-R)>9&&console.STAT(R,v,"rad parsed JSON"),A&&(A.rpd=+new Date),k.map(T,k.ack);return}if(E[0]==="{"){delete w[s],k.err="JSON error!",k.map(T,k.ack);return}k.radec(b,E)})},k.map=function(){if(!(!T||!T.length)){for(var x=+new Date,E=k.err,b=k.not?_:k.disk,$=0,C;$<9&&(C=T[$++]);)C(E,b,O);console.STAT&&console.STAT(x,+new Date-x,"rad packs",o(s)),console.STAT&&console.STAT(x,$,"rad packs #",o(s)),(T=T.slice($)).length&&c(k.map,0)}},k.ack=function(x){if(x){if(k.err||k.not){x(k.err,_,O);return}x(_,k.disk,O)}},k.radec=function(x,E){delete w[s],R=+new Date;var b=k.split(E),$=[],C,z,j;if(!b||b[1]!==0){k.err="File '"+s+"' does not have root radix! ",k.map(T,k.ack);return}for(;b;)z=j=_,C=b[1],b=k.split(b[2])||"",b[0]=="#"&&(z=b[1],$=$.slice(0,C),C<=$.length&&$.push(z)),b=k.split(b[2])||"",b[0]!=`
`&&((b[0]=="="||b[0]==":")&&(j=b[1]),_!==z&&_!==j&&k.disk($.join(""),j),b=k.split(b[2]));console.STAT&&console.STAT(R,+new Date-R,"parsed RAD"),k.map(T,k.ack)},k.split=function(x){if(x){var E=[],b={},$=-1,C="";if($=x.indexOf(f),!!x[$])return C=x.slice(0,$),E[0]=C,E[1]=e.decode(x.slice($),b),E[2]=x.slice($+b.i),E}},h.disk&&(m||(m=(h.disk[s]||"").raw));var R=+new Date;if(A&&(A.rp=R),m)return c(function(){k.read(_,m)},0);r.store.get(o(s),k.read)}}(),function(){var y,w="",f;h.find=function(m,A){if(!y){if(f){f.push([m,A]);return}f=[[m,A]],h.parse(w,s);return}n.map(h.list=y,function(T,k){if(T)return A(k)||!0},{reverse:1,end:m})||A(r.code.from)},h.find.add=function(m,A){var T=y(m);if(T||m===w){A(_,1);return}y(m,1),A.found=(A.found||0)+1,h.write(w,y,function(k,O){if(k){A(k);return}A.found=(A.found||0)-1,A.found===0&&A(_,1)},!0)},h.find.bad=function(m,A){y(m,0),h.write(w,y,A||g)};function s(m,A){if(m){r.log("list",m),setTimeout(function(){h.parse(w,s)},1e3);return}if(A){p(A);return}if(y=y||A||n(),!r.store.list){p(y);return}r.store.list(function(T){if(!T){p(y);return}h.find.add(T,g)})}function p(m,A){y=y||m,y.file=w,A=f,f=null,u(A,function(T){h.find(T[0],T[1])})}}();try{!t.window&&vc()(h)}catch{}var g=function(){},_;return e.has[r.file]=h,h}if(function(){var r="";e.encode=function(i,o,a){a=a||r;var l=a,c;if(typeof i=="string"){for(var u=i.indexOf(a);u!=-1;)l+=a,u=i.indexOf(a,u+1);return l+'"'+i+a}else{if(i&&i["#"]&&Object.keys(i).length==1)return l+"#"+c+l;if(typeof i=="number")return l+"+"+(i||0)+l;if(i===null)return l+" "+l;if(i===!0)return l+"+"+l;if(i===!1)return l+"-"+l}},e.decode=function(i,o,a){a=a||r;var l="",c=-1,u=0,v,d;if(a===i[0]){for(;a===i[++c];)++u;for(d=i[v=u]||!0;--u>=0;)c=i.indexOf(a,c+1);if(c==-1&&(c=i.length),l=i.slice(v+1,c),o&&(o.i=c+1),d==='"')return l;if(d==="#")return{"#":l};if(d==="+")return l.length===0?!0:parseFloat(l);if(d===" ")return null;if(d==="-")return!1}}}(),typeof window<"u"){var t=window.Gun,n=window.Radix;window.Radisk=e}else{var t=ke(),n=on();try{xt.exports=e}catch{}}e.Radix=n}()),xt.exports}Gr();var Vn={},qn;function mc(){if(qn)return Vn;qn=1;var e={},t=typeof window<"u"?window.Gun:ke();return t.on("create",function(n){t.TESTING&&(n.opt.file="radatatest"),this.to.next(n);var r=n.opt,i;if(!(r.rad===!1||r.radisk===!1)&&!(i+""!=typeof process&&""+(e||"").RAD=="false")){var o=t.window&&t.window.Radisk||Gr(),a=o.Radix,l=o(r),c="\x1B",u=0;n.on("put",function(d){if(this.to.next(d),!(d._||"").rad){var h=d["#"],S=d.put,g=S["#"],_=S["."],y=S[":"],w=S[">"],f=(d._||"").DBG;f&&(f.sp=f.sp||+new Date);var s=(d._||"").RPS||((d._||"").RPS=+new Date);l(g+c+_,{":":y,">":w},function(p,m){if(f&&(f.spd=f.spd||+new Date),console.STAT&&console.STAT(s,+new Date-s,"put"),p){n.on("in",{"@":h,err:p,DBG:f});return}n.on("in",{"@":h,ok:m,DBG:f})},!1,f&&(f.r=f.r||{})),f&&(f.sps=f.sps||+new Date)}}),n.on("get",function(d){this.to.next(d);var h=d._||"",S=h.DBG=d.DBG;S&&(S.sg=+new Date);var g=d["#"],_=d.get,y=d.get["#"],w=d.get["."]||"",f={},s,p,m,A;if(typeof y=="string"?p=y:y&&(i!==(m=y["*"])&&(f.limit=A=1),i!==y[">"]&&(f.start=y[">"]),i!==y["<"]&&(f.end=y["<"]),p=A?""+m:m||y["="],A=null),p&&!f.limit&&(typeof w=="string"?p=p+c+(f.atom=w):w&&(i!==w[">"]&&(f.start=w[">"],f.limit=1),i!==w["<"]&&(f.end=w["<"],f.limit=1),i!==(m=w["*"])&&(f.limit=A=1),p&&(p=p+c+(A?""+(m||""):m||(f.atom=w["="]||""))))),((m=_["%"])||f.limit)&&(f.limit=m<=(f.pack||1e3*100)?m:1),(w["-"]||(y||{})["-"]||_["-"])&&(f.reverse=!0),(m=(n.next||"")[y])&&m.put){if(f.atom){if(m=(m.next||"")[f.atom],m&&m.root&&m.root.graph&&m.root.graph[y]&&m.root.graph[y][f.atom])return}else if(m&&m.rad)return}var T=t.state(),k=+new Date,O=0;S&&(S.sgm=k),l(p||"",function(x,E,b){S&&(S.sgr=+new Date),S&&(S.sgi=b);try{r.store.stats.get.time[v%50]=+new Date-k,++v,r.store.stats.get.count++,x&&(r.store.stats.get.err=x)}catch{}console.STAT&&console.STAT(k,+new Date-k,"got",JSON.stringify(p)),k=+new Date,b=b||"";var $,C;if(b.unit&&E&&i!==($=E[":"])&&i!==(C=E[">"])){var z=p.split(c),j=z[0],N=z[1];(s=s||{})[j]=t.state.ify(s[j],N,C,$,j),n.$.get(j).get(N)._.rad=T}else E&&(typeof E!="string"&&(f.atom?E=i:a.map(E,R,f)),!s&&E&&R(E,""),!f.atom&&!w&typeof y=="string"&&!f.limit&&!f.more&&(n.$.get(y)._.rad=T));S&&(S.sgp=+new Date),console.STAT&&(u=+new Date-k)>9&&(console.STAT(k,u,"got prep time"),console.STAT(k,O,"got prep #")),O=0,k=+new Date;var D=function(){};D.faith=!0,D.rad=_,n.on("in",{"@":g,put:s,"%":b.more?1:i,err:x||i,_:D,DBG:S}),console.STAT&&(u=+new Date-k)>9&&console.STAT(k,u,"got emit",Object.keys(s||{}).length),s=i},f,S&&(S.r=S.r||{})),S&&(S.sgd=+new Date),console.STAT&&(u=+new Date-k)>9&&console.STAT(k,u,"get call");function R(x,E,b,$){if(O++,!!x){E=(p+E).split(c);var C=E.slice(0,1)[0];if(E=E.slice(-1)[0],f.limit&&f.limit<=f.count)return!0;var z,j,N=C,D=E;if(typeof x!="string"){z=x[":"],j=x[">"],(s=s||{})[N]=t.state.ify(s[N],D,j,z,N),f.count=(f.count||0)+((z||"").length||9);return}f.count=(f.count||0)+x.length;var P=x.lastIndexOf(">"),M=o.decode(x.slice(P+1),null,c);x=o.decode(x.slice(0,P),null,c),(s=s||{})[C]=t.state.ify(s[C],E,M,x,C)}}}),t.valid,(r.store||{}).stats={get:{time:{},count:0},put:{time:{},count:0}};var v=0}}),Vn}mc();var Nt={exports:{}},Yn;function yc(){return Yn||(Yn=1,function(){function e(n){n=n||{},n.file=String(n.file||"radata");var r=e[n.file],i=null,o;if(r)return console.log("Warning: reusing same IndexedDB store and options as 1st."),e[n.file];r=e[n.file]=function(){};try{n.indexedDB=n.indexedDB||e.indexedDB||indexedDB}catch{}try{if(!n.indexedDB||location.protocol=="file:"){var a=r.d||(r.d={});return r.put=function(l,c,u){a[l]=c,setTimeout(function(){u(null,1)},250)},r.get=function(l,c){setTimeout(function(){c(null,a[l]||o)},5)},console.log("Warning: No indexedDB exists to persist data to!"),r}}catch{}return r.start=function(){var l=indexedDB.open(n.file,1);l.onupgradeneeded=function(c){c.target.result.createObjectStore(n.file)},l.onsuccess=function(){i=l.result},l.onerror=function(c){console.log(c||1)}},r.start(),r.put=function(l,c,u){if(!i){setTimeout(function(){r.put(l,c,u)},1);return}var v=i.transaction([n.file],"readwrite"),d=v.objectStore(n.file),h=d.put(c,""+l);h.onsuccess=d.onsuccess=v.onsuccess=function(){u(null,1)},h.onabort=d.onabort=v.onabort=function(S){u(S||"put.tx.abort")},h.onerror=d.onerror=v.onerror=function(S){u(S||"put.tx.error")}},r.get=function(l,c){if(!i){setTimeout(function(){r.get(l,c)},9);return}var u=i.transaction([n.file],"readonly"),v=u.objectStore(n.file),d=v.get(""+l);d.onsuccess=function(){c(null,d.result)},d.onabort=function(h){c(h||4)},d.onerror=function(h){c(h||5)}},setInterval(function(){i&&i.close(),i=null,r.start()},1e3*15),r}if(typeof window<"u")(e.window=window).RindexedDB=e,e.indexedDB=window.indexedDB;else try{Nt.exports=e}catch{}try{var t=e.window.Gun||ke();t.on("create",function(n){this.to.next(n),n.opt.store=n.opt.store||e(n.opt)})}catch{}}()),Nt.exports}yc();var Xn={},Qn;function wc(){return Qn||(Qn=1,function(){var e=typeof window<"u"?window.Gun:ke();e.on("opt",function(t){this.to.next(t);var n=t.opt;if(t.once||!e.Mesh||n.RTCPeerConnection===!1)return;var r;typeof window<"u"&&(r=window),typeof De<"u"&&(r=De),r=r||{};var i=n.RTCPeerConnection||r.RTCPeerConnection||r.webkitRTCPeerConnection||r.mozRTCPeerConnection,o=n.RTCSessionDescription||r.RTCSessionDescription||r.webkitRTCSessionDescription||r.mozRTCSessionDescription,a=n.RTCIceCandidate||r.RTCIceCandidate||r.webkitRTCIceCandidate||r.mozRTCIceCandidate;if(!i||!o||!a)return;n.RTCPeerConnection=i,n.RTCSessionDescription=o,n.RTCIceCandidate=a,n.rtc=n.rtc||{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.sipgate.net:3478"}]},n.rtc.dataChannel=n.rtc.dataChannel||{ordered:!1,maxRetransmits:2},n.rtc.sdp=n.rtc.sdp||{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},n.rtc.max=n.rtc.max||55,n.rtc.room=n.rtc.room||e.window&&(location.hash.slice(1)||location.pathname.slice(1)),n.announce=function(u){n.rtc.start=+new Date,t.$.get("/RTC/"+n.rtc.room+"<?99").get("+").put(n.pid,function(v){!v.ok||!v.ok.rtc||c(v)},{acks:n.rtc.max}).on(function(v,d,h){v===n.pid||n.rtc.start>h.put[">"]||c({"#":""+h["#"],ok:{rtc:{id:v}}})})};var l=n.mesh=n.mesh||e.Mesh(t);t.on("create",function(u){this.to.next(u),setTimeout(n.announce,1)});function c(u){if(this&&this.off&&this.off(),!!u.ok){var v=u.ok.rtc,d,h;if(!(!v||!v.id||v.id===n.pid)){if(h=v.answer)return!(d=n.peers[v.id]||c[v.id])||d.remoteSet?void 0:(h.sdp=h.sdp.replace(/\\r\\n/g,`\r
`),d.setRemoteDescription(d.remoteSet=new n.RTCSessionDescription(h)));if(h=v.candidate)return d=n.peers[v.id]||c[v.id]||c({ok:{rtc:{id:v.id}}}),d.addIceCandidate(new n.RTCIceCandidate(h));if(!c[v.id]){(d=new n.RTCPeerConnection(n.rtc)).id=v.id;var S=d.wire=d.createDataChannel("dc",n.rtc.dataChannel);if(c[v.id]=d,S.to=setTimeout(function(){delete c[v.id]},1e3*60),S.onclose=function(){l.bye(d)},S.onerror=function(g){},S.onopen=function(g){delete c[v.id],l.hi(d)},S.onmessage=function(g){g&&l.hear(g.data||g,d)},d.onicecandidate=function(g){g.candidate&&t.on("out",{"@":u["#"],ok:{rtc:{candidate:g.candidate,id:n.pid}}})},d.ondatachannel=function(g){var _=g.channel;_.onmessage=S.onmessage,_.onopen=S.onopen,_.onclose=S.onclose},h=v.offer){v.offer.sdp=v.offer.sdp.replace(/\\r\\n/g,`\r
`),d.setRemoteDescription(new n.RTCSessionDescription(h)),d.createAnswer(function(g){d.setLocalDescription(g),t.on("out",{"@":u["#"],ok:{rtc:{answer:g,id:n.pid}}})},function(){},n.rtc.sdp);return}return d.createOffer(function(g){d.setLocalDescription(g),t.on("out",{"@":u["#"],"#":t.ask(c),ok:{rtc:{offer:g,id:n.pid}}})},function(){},n.rtc.sdp),d}}}}})}()),Xn}wc();function Kr(e){if(!e||typeof e!="object"||Array.isArray(e))return e;const t={};for(const[n,r]of Object.entries(e))n.startsWith("_")||(t[n]=r);return t}function bc(e){try{let t;if(typeof e=="string")try{t=JSON.parse(e)}catch(r){return console.error("Error parsing tree data JSON:",r),null}else t=e;const n=Ur.safeParse(t);return n.success?n.data:(console.error("Tree data validation failed:",n.error),null)}catch(t){return console.error("Error parsing tree data:",t),null}}function Hr(e){try{let t;if(typeof e=="string")try{t=JSON.parse(e)}catch(r){return console.error("[VALIDATION] Error parsing capacities data JSON:",r),{}}else t=e;t=Kr(t),console.log("[VALIDATION] Pre-validation capacities data:",t);const n=ac.safeParse(t);if(n.success){let r=function(o,a,l=[]){const c={};return typeof o!=typeof a?(c[l.join(".")]={original:o,validated:a},c):(typeof o=="object"&&o!==null?Object.keys({...o,...a}).forEach(u=>{const v=r(o[u],a[u],[...l,u]);Object.assign(c,v)}):o!==a&&(c[l.join(".")]={original:o,validated:a}),c)};console.log("[VALIDATION] Capacities validation successful");const i=r(t,n.data);return Object.keys(i).length>0?console.log("[VALIDATION] Validation made the following changes:",i):console.log("[VALIDATION] Validation made no changes to data"),console.log("[VALIDATION] Validated Capacities data:",n.data),n.data}else return console.error("[VALIDATION] Capacities validation failed. Data:",t),console.error("[VALIDATION] Validation errors:",n.error.issues),console.error("[VALIDATION] Validation error paths:",n.error.issues.map(r=>r.path)),{}}catch(t){return console.error("[VALIDATION] Error during capacities validation:",t),{}}}function _c(e){try{let t;if(typeof e=="string")try{t=JSON.parse(e)}catch(r){return console.error("Error parsing share map JSON:",r),{}}else t=e;t=Kr(t);const n=tc.safeParse(t);return n.success?n.data:(console.error("Share map validation failed:",n.error),{})}catch(t){return console.error("Error parsing share map:",t),{}}}function Ut(e){Z(e,"space","Space & Environment",25);const t=e.children.find(h=>h.id==="space");Z(t,"indoorSpace","Indoor/Outdoor Space",15),Z(t,"seating","Comfortable Seating",15),Z(t,"lighting","Lighting",12),Z(t,"temperature","Temperature Control",12),Z(t,"bathroom","Bathroom Access",12),Z(t,"waterAccess","Water Access",12),Z(t,"cleaning","Cleaning Supplies",11),Z(t,"waste","Trash/Recycling",11);const n=t.children.find(h=>h.id==="indoorSpace");Z(n,"hosts","Space Providers/Hosts",14),Z(n,"infrastructure","Infra(de)structure & Bottom-secret Spaces",25);const r=n.children.find(h=>h.id==="infrastructure");Z(e,"subverse","Subverse ð",25);const i=e.children.find(h=>h.id==="subverse");Z(i,"magicalTech","Magical Technologies & Systems",25),Z(i,"substances","Transformative Substances",20),Z(i,"realityHacking","Reality Hacking & Manifestation",20),Z(i,"loreSystem","Lore & Knowledge Systems",10);const o=i.children.find(h=>h.id==="magicalTech"),a=i.children.find(h=>h.id==="substances"),l=i.children.find(h=>h.id==="realityHacking"),c=i.children.find(h=>h.id==="loreSystem");Z(e,"money","ð¸",10),Z(e,"freeAssociation","Free Association",10),Z(e,"automation","Automation of Useful & Repetitive Tasks",10),Z(e,"commons","Socialization of Land & Means of Production",10),Z(e,"property","Maintaining Personal Property Relations",10);const u=e.children.find(h=>h.id==="money"),v=e.children.find(h=>h.id==="freeAssociation"),d=e.children.find(h=>h.id==="property");return Z(d,"securingLaptop","Securing my Laptop",10),Z(d,"securingBackpack","Securing my Backpack",10),Z(u,"openCollective","Playnet Open Collective",10),Z(u,"personalDonations","Personal Donations",10),Z(v,"development","Development",10),Z(v,"communications","Communications",10),Z(r,"secretStairs","Secret stairways",10),Z(r,"wellsTunnels","Wells & tunnels",8),Z(r,"basements","Basements",7),Z(r,"subLakes","Subterranean lakes",6),Z(r,"alleysRoots","Alleys & Roots",9),Z(r,"trapDoors","Trap-doors",8),Z(r,"warpZones","Warp zones",7),Z(r,"driveIns","Liberation Drive-ins",8),Z(r,"trainYards","Train-yards",7),Z(r,"fleaMarkets","Flea Markets",6),Z(r,"roofs","Roofs",5),Z(r,"ufoLanding","*ufo* Landing Pads",5),Z(o,"cloudBusting","Cloud Busting",9),Z(o,"cameraAbatement","Camera Abatement",8),Z(o,"systemOfframp","System (off/out)-ramp Drive-thrus",7),Z(o,"bioSlimes","Bioluminescent Slimes",8),Z(o,"butterflyWings","Butterfly-wing-iridescence Materiality",8),Z(o,"eventHorizons","Event Horizons & Vanishing Points",7),Z(o,"libraryStacks","Library Stacks",8),Z(o,"saunaLore","Pagan Sauna Lore",7),Z(o,"ritualSpaces","Ritual Spaces",6),Z(o,"candyWisdom","Candy Store Wisdom",6),Z(a,"pixieDust","Pixie Dust & Silly Powders",9),Z(a,"oozeSlimes","Oozes & slimes",8),Z(a,"potionsBalms","Potions & Balms",7),Z(a,"veganWaters","Vegan & Non-vegan Waters",8),Z(a,"mistsSprays","Mists & Sprays",7),Z(a,"lozengesBonbons","Lozenges & Bonbons",6),Z(a,"pheromones","Pheromonal Inflection Points",8),Z(a,"darkMatter","Dark Matter Manipulation",7),Z(a,"globulation","Nebulatory Coagular Globulation",6),Z(l,"trueFakes","TrueFakes & FakeUntruths",9),Z(l,"memeDrives","MemeDrives & GeneEngines",8),Z(l,"cosmicBabble","Cosmic Psychobabble",7),Z(l,"dimPortals","Interdimensional portals",8),Z(l,"infinityPools","Infinity Pools",7),Z(l,"deprivationTanks","Sensory Deprivation Tankage",6),Z(l,"girlMath","GirlMath",8),Z(l,"moonMath","Moonlight Mathematicians",7),Z(l,"angelicNums","Angelic Numbers",6),Z(c,"comicBooks","Comic Books & Stories",8),Z(c,"poemsAndMaps","Poems & Maps",7),Z(c,"priestesses","Interdimensional Priestesses",8),Z(c,"crimeLords","Alien Crime Lords",7),Z(c,"ballerinas","Sci-fi Ballerinas",6),console.log("Populated root node with example data:",e),e}typeof window<"u"&&(window.populateWithExampleData=Ut,window.populateCurrentTreeWithExampleData=()=>{const e=F(re);if(!e)return console.error("[DEBUG] No userTree available to populate with example data"),null;console.log("[DEBUG] Populating current userTree with example data");const t=Ut(e);return re.set(t),t},console.log("[DEBUG] populateWithExampleData and populateCurrentTreeWithExampleData functions exposed to window"));typeof st.SEA>"u"&&(st.SEA=pc);const nf=st,ge=new st({peers:["https://gun-manhattan.herokuapp.com/gun","https://peer.wallie.io/gun","https://gun.defucc.me/gun"],localStorage:!1}),Ce=X(!0);let L;typeof window<"u"?L=ge.user().recall({sessionStorage:!0}):L={_:{sea:null},is:null};const le=X(""),ce=X(""),he=ge.get("freely-associating-players"),Ue=X({}),Sc=X([]);function kc(){if(typeof window>"u")return;console.log("[USERS] Setting up centralized usersList subscription");const e=new Map;he.map().on((t,n)=>{if(console.log(`[USERS] User update: ${n}`,t),!n||n==="_")return;if(t==null)console.log(`[USERS] User removed: ${n}`),e.delete(n),Ue.update(i=>{const{[n]:o,...a}=i;return a});else{console.log(`[USERS] User added/updated: ${n}`,t),e.set(n,t);const i=t.name;i&&typeof i=="string"?Ue.update(o=>({...o,[n]:i})):ge.get(`~${n}`).get("alias").once(o=>{o&&typeof o=="string"&&(console.log(`[USERS] Got alias from protected space for ${n}: ${o}`),Ue.update(a=>({...a,[n]:o})))})}const r=Array.from(e.keys());console.log(`[USERS] Updating userIds store with ${r.length} users`),Sc.set(r)})}async function rf(e){const t=F(Ue);if(t[e])return t[e];try{const r=ge.get(`~${e}`).get("alias").once(i=>i);if(r&&typeof r=="string")return Ue.update(i=>({...i,[e]:r})),r}catch(r){console.log(`[USER-NAME] Could not fetch alias for user ${e}:`,r)}return e.substring(0,8)+"..."}typeof window<"u"&&kc();typeof window<"u"&&(async()=>{var t,n,r,i,o;try{if(Ce.set(!0),await new Promise(a=>setTimeout(a,100)),L._.sea&&((t=L.is)!=null&&t.alias)){console.log("[RECALL] User authenticated via SEA check:",L.is.alias),le.set(L.is.alias),ce.set(L.is.pub),he.get((n=L.is)==null?void 0:n.pub).put({name:L.is.alias,lastSeen:Date.now()}),ct();return}(r=L==null?void 0:L.is)!=null&&r.pub&&((i=L.is)!=null&&i.alias)?(console.log("[RECALL] User authenticated via pub check:",L.is.alias),le.set(L.is.alias),ce.set(L.is.pub),he.get((o=L.is)==null?void 0:o.pub).put({name:L.is.alias,lastSeen:Date.now()}),ct()):(console.log("[RECALL] No authenticated user found after recall"),le.set(""),ce.set(""))}catch(a){console.error("[RECALL] Error during authentication check:",a),le.set(""),ce.set("")}finally{Ce.set(!1)}})();ge.on("auth",async()=>{var e,t,n,r,i,o;try{if(Ce.set(!0),L._.sea){console.log("[AUTH] User authenticated via SEA check:",L.is.alias),le.set(L.is.alias),ce.set((e=L.is)==null?void 0:e.pub),he.get((t=L.is)==null?void 0:t.pub).put({name:L.is.alias,lastSeen:Date.now()}),console.log(`signed in as ${L.is.alias}`),console.log(`userPub: ${(n=L.is)==null?void 0:n.pub}`),ct();return}if(L.is.alias)console.log("[AUTH] User authenticated via alias check:",L.is.alias),le.set(L.is.alias),ce.set((r=L.is)==null?void 0:r.pub),he.get((i=L.is)==null?void 0:i.pub).put({name:L.is.alias,lastSeen:Date.now()}),console.log(`signed in as ${L.is.alias}`),console.log(`userPub: ${(o=L.is)==null?void 0:o.pub}`),ct();else throw new Error("Authentication failed - no alias found")}catch(a){console.error("[AUTH] Error during authentication:",a),le.set(""),ce.set("")}finally{Ce.set(!1)}});function Tc(e,t){L.auth(e,t,({err:n})=>n&&alert(n))}function of(e,t){ge.get(`~@${e}`).once(n=>{if(n){console.log("[SIGNUP] checking alias user data",n),alert("Username already taken");return}L.create(e,t,({err:r})=>{r?alert(r):Tc(e,t)})},{wait:2e3})}async function af(){for(L.leave();L._.sea!=null;)await new Promise(requestAnimationFrame);le.set(""),ce.set("")}function Vr(){if(F(Ae)){console.log("[PERSIST] Skipping tree persistence because tree is being loaded");return}const e=F(re);if(e){console.log("[PERSIST] Starting tree persistence..."),console.log("[PERSIST] Tree structure before serialization:",{id:e.id,childCount:e.children.length});const t=JSON.stringify(structuredClone(e));console.log("[PERSIST] Serialized tree length:",t.length),console.log("[PERSIST] Tree JSON preview:",t.substring(0,100)+"..."),L.get("tree").put(t,n=>{n.err?console.error("[PERSIST] Error saving tree to Gun:",n.err):console.log("[PERSIST] Tree successfully saved to Gun")})}}function Ac(){if(F(Pt)){console.log("[PERSIST] Skipping SOGF persistence because SOGF is being loaded");return}const e=F(pt);e&&L.get("sogf").put(structuredClone(e))}function Ec(){if(F(ut)){console.log("[PERSIST] Skipping capacities persistence because capacities are being loaded");return}const e=F(Je);if(e){console.log("[PERSIST] Starting capacities persistence..."),console.log("[PERSIST] Capacities count:",Object.keys(e).length);try{const t=structuredClone(e);console.log("[PERSIST] Saving capacities:",t);const n=JSON.stringify(t);console.log("[PERSIST] Serialized capacities length:",n.length),L.get("capacities").put(n,r=>{r.err?console.error("[PERSIST] Error saving capacities to Gun:",r.err):console.log("[PERSIST] Capacities successfully saved to Gun")})}catch(t){console.error("[PERSIST] Error serializing capacities:",t)}}}function $c(){var n;if(!((n=L.is)==null?void 0:n.pub)){console.log("[PERSIST] No user ID available, cannot persist contributor capacity shares");return}const t=F(Br);console.log("[PERSIST] Persisting contributor capacity shares:",t),Object.entries(t).forEach(([r,i])=>{L.get("capacityShares").get(r).put(JSON.stringify(i),o=>{o.err?console.error(`[PERSIST] Error persisting capacity shares for contributor ${r}:`,o.err):console.log(`[PERSIST] Successfully persisted capacity shares for contributor ${r}`)})})}function ct(){console.log("[MANIFEST] Loading data from Gun"),Ae.set(!0);let e=!1;const t=(n,r=!1)=>{var o,a,l,c;if(console.log(`[MANIFEST] Raw tree data from Gun (${r?"retry":"initial"}):`,typeof n=="string"?`String of length ${n.length}`:"Object:",n),n!=null){const u=bc(n);if(u&&((o=L.is)!=null&&o.pub)){console.log("[MANIFEST] Loaded tree with children count:",((a=u.children)==null?void 0:a.length)||0),((l=u.children)==null?void 0:l.length)>0&&console.log("[MANIFEST] First child:",u.children[0]),re.set(u),e=!0,Ae.set(!1),setTimeout(()=>{console.log("[MANIFEST] Triggering tree recalculation after load"),re.set(u)},50);return}}if(r&&((c=L.is)!=null&&c.pub)&&!e){console.log("[MANIFEST] No valid tree data found after retry, creating initial tree with example data");const u=Xi(F(ce),F(le),F(ce));Ut(u),re.set(u),L.get("tree").put(JSON.stringify(u)),Ae.set(!1)}else!r&&n==null?(console.log("[MANIFEST] Tree data undefined, retrying in 2s..."),setTimeout(()=>{e||L.get("tree").once(u=>t(u,!0))},2e3)):r&&(console.log("[MANIFEST] No tree data available and no user context"),Ae.set(!1))};L.get("tree").once(t),Pt.set(!0),L.get("sogf").once(n=>{if(n){const r=_c(n);pt.set(r)}Pt.set(!1)}),ut.set(!0),L.get("capacities").once(n=>{if(console.log("[MANIFEST] Loading capacities data..."),n){console.log("[MANIFEST] Capacities data:",n);const r=Hr(n);console.log("[MANIFEST] Loaded capacities count:",Object.keys(r).length),console.log("[MANIFEST] Post-Validation capacities:",r),Je.set(r)}else console.log("[MANIFEST] No capacities data found");ut.set(!1)})}function Oc(e){const t=/^(\d+)(s|m|h|d|w|mo)$/i,n=e.match(t);if(!n)throw new Error(`Invalid duration format: '${e}'`);const r=parseInt(n[1],10),i=n[2].toLowerCase(),o={s:1e3,m:60*1e3,h:60*60*1e3,d:24*60*60*1e3,w:7*24*60*60*1e3,mo:30*24*60*60*1e3};return r*o[i]}function Cc(e="30m"){let t;try{t=Oc(e)}catch(r){console.error(`[PRUNE] ${r}`);return}console.log(`[PRUNE] Starting to prune users inactive for more than ${e}...`);const n=Date.now()-t;he.once(r=>{if(r){const i=Object.keys(r);console.log(`[PRUNE] Found ${i.length} users to check`);let o=0,a=0;i.forEach(l=>{he.get(l).once(c=>{if(a++,c&&c.lastSeen){const u=c.lastSeen;u<n?he.get(l).put(null,v=>{v.err?console.error(`[PRUNE] Error removing inactive user ${l}:`,v.err):(console.log(`[PRUNE] Removed inactive user ${l} (last seen: ${new Date(u).toLocaleString()})`),o++)}):console.log(`[PRUNE] User ${l} is active (last seen: ${new Date(u).toLocaleString()})`)}else console.log(`[PRUNE] User ${l} has no lastSeen data, removing...`),he.get(l).put(null,u=>{u.err?console.error(`[PRUNE] Error removing user without lastSeen ${l}:`,u.err):(console.log(`[PRUNE] Removed user without lastSeen data: ${l}`),o++)});a===i.length&&console.log(`[PRUNE] Pruning complete. Checked ${a} users, removed ${o} inactive users.`)})})}else console.log("[PRUNE] No users found to prune")})}typeof window<"u"&&(window.clearUsersList=Cc,console.log("[DEBUG] clearUsersList function exposed to window"));function xc(){console.log("[RECALC] Starting tree recalculation...");const e=F(re);if(!e){console.error("[RECALC] Tree is missing, cannot proceed with recalculation");return}console.log("[RECALC] Processing tree with",e.children.length,"children");try{Zt.set(!0);try{console.log("[RECALC] Collecting contributors from tree...");const t=Vi(e);dt.set(t),console.log("[RECALC] Found",t.length,"contributors");const n=F(At),r=[...new Set([...n,...t])];At.set(r),console.log("[RECALC] Total known contributors:",r.length)}catch(t){console.error("[RECALC] Error collecting contributors:",t)}try{console.log("[RECALC] Calculating SOGF...");const t=F(At),n=F(Ge),r=qi(e,n,t);pt.set(r),Ac(),console.log("[RECALC] SOGF calculation complete for",t.length,"known contributors"),t.forEach(i=>{const o=r[i]||0,a=F(pe)[i],l=(a==null?void 0:a.theirShare)||0;console.log(`[RECALC] Updating recognition for ${i}: ourShare=${o.toFixed(4)}, theirShare=${l.toFixed(4)}`),jc(i,o,l)})}catch(t){console.error("[RECALC] Error calculating SOGF:",t)}console.log("[RECALC] Tree recalculation process complete")}finally{Zt.set(!1)}}function jc(e,t,n){console.log(`[MUTUAL] Updating cache for ${e}: our=${t.toFixed(4)}, their=${n.toFixed(4)}`),pe.update(i=>{const o=i[e];return i[e]={ourShare:t,theirShare:n,timestamp:Date.now()},console.log(`[MUTUAL] Cache entry for ${e}:`,{old:o,new:i[e]}),i});const r=F(pe);console.log("[MUTUAL] Full recognition cache after update:",r)}function Nc(e,t){console.log(`[NETWORK] Received share from ${e}: ${t.toFixed(4)}`);const r=F(pe)[e];console.log(`[NETWORK] Existing cache entry for ${e}:`,r),pe.update(o=>(r?(console.log(`[NETWORK] Updating existing entry for ${e}`),o[e]={...o[e],theirShare:t,timestamp:Date.now()}):(console.log(`[NETWORK] Creating new entry for ${e} with ourShare=0`),o[e]={ourShare:0,theirShare:t,timestamp:Date.now()}),console.log(`[NETWORK] Updated cache entry for ${e}:`,o[e]),o));const i=F(pe);console.log(`[NETWORK] Cache after network update from ${e}:`,i)}function qr(e){console.log(`[NETWORK] Setting up subscription to ${e}'s SOGF`),ge.get(`~${e}`).get("sogf").on(n=>{var c;if(!n)return;console.log(`[NETWORK] Received SOGF update from ${e}`);const r=(c=L.is)==null?void 0:c.pub;if(!r)return;const i=n[r]||0,a=F(pe)[e];if(a&&a.theirShare===i){console.log(`[NETWORK] Ignoring duplicate SOGF update from contributor ${e}: share=${i}`);return}Nc(e,i)})}function Rc(e){console.log(`[NETWORK] Setting up subscription to ${e}'s capacities`),ge.get(`~${e}`).get("capacities").on(n=>{var l;if(!n||(console.log(`[NETWORK] Received capacities update from ${e}:`,n),!((l=L.is)==null?void 0:l.pub)))return;const i=Hr(n);if(!i||Object.keys(i).length===0){console.error("[NETWORK] Failed to validate capacities from contributor:",e);return}const o=F(Fe)[e]||{};if(JSON.stringify(i)===JSON.stringify(o)){console.log(`[NETWORK] Ignoring duplicate capacities update for contributor ${e}`);return}Fe.update(c=>{const u={...c};return u[e]=i,console.log(`[NETWORK] Updated networkCapacities for ${e}: added ${Object.keys(i).length} capacities`),u})})}function zc(e){var n;const t=(n=L.is)==null?void 0:n.pub;if(!t){console.log("[NETWORK] Cannot subscribe to capacity shares - not authenticated");return}console.log(`[NETWORK] Setting up capacity shares subscription for contributor: ${e}`),ge.get(`~${e}`).get("capacityShares").get(t).on(r=>{if(!r){console.log(`[NETWORK] No capacity shares from contributor ${e}`),Ee.update(i=>{const{[e]:o,...a}=i;return a});return}try{let i;typeof r=="string"?i=JSON.parse(r):i=r;const o={};Object.entries(i).forEach(([c,u])=>{typeof u=="number"&&u>=0&&u<=1?o[c]=u:console.warn(`[NETWORK] Invalid share value for capacity ${c}:`,u)});const a=F(Ee)[e]||{};if(JSON.stringify(o)===JSON.stringify(a)){console.log(`[NETWORK] Ignoring duplicate update for contributor ${e}`);return}console.log(`[NETWORK] Received new capacity shares from contributor ${e}:`,o),Ee.update(c=>({...c,[e]:o}))}catch(i){console.error(`[NETWORK] Error parsing/validating capacity shares from contributor ${e}:`,i)}})}dt.subscribe(e=>{var t;if(F(Ce)){console.log("[NETWORK] Skipping contributor subscription while authenticating");return}if(!e.length){console.log("[NETWORK] No contributors to subscribe to");return}if(!((t=L.is)!=null&&t.pub)){console.log("[NETWORK] Cannot subscribe to contributors - not authenticated");return}console.log(`[NETWORK] Contributors changed, now have ${e.length}, setting up subscriptions`),e.forEach(n=>{try{console.log(`[NETWORK] Setting up subscription for contributor: ${n}`),qr(n)}catch(r){console.error(`[NETWORK] Error subscribing to contributor ${n}:`,r)}})});Lr.subscribe(e=>{var t;if(F(Ce)){console.log("[NETWORK] Skipping mutual contributor subscription while authenticating");return}if(!e.length){Fe.set({}),Ee.set({});return}if(!((t=L.is)!=null&&t.pub)){console.log("[NETWORK] Cannot subscribe to mutual contributors - not authenticated");return}console.log(`[NETWORK] Mutual contributors changed, now have ${e.length}, setting up subscriptions`),Fe.update(n=>{if(!n)return{};const r={};return Object.entries(n).forEach(([i,o])=>{e.includes(i)&&(r[i]=o)}),console.log(`[NETWORK] Cleaned network capacities: kept ${Object.keys(r).length} contributors from ${Object.keys(n).length} total`),r}),Ee.update(n=>{const r={};return Object.entries(n).forEach(([i,o])=>{e.includes(i)&&(r[i]=o)}),console.log(`[NETWORK] Cleaned capacity shares: kept ${Object.keys(r).length} contributors from ${Object.keys(n).length} total`),r}),e.forEach(n=>{try{console.log(`[NETWORK] Setting up subscriptions for mutual contributor: ${n}`),Rc(n),zc(n)}catch(r){console.error(`[NETWORK] Error subscribing to mutual contributor ${n}:`,r)}})});re.subscribe(e=>{if(e){let t=function(r){n[r.id]=r,r.children.forEach(t)};console.log("[TREE-SUB] Tree updated in store, rebuilding nodes map"),console.log("[TREE-SUB] Tree has",e.children.length,"children");const n={};t(e),Ge.set(n),console.log("[TREE-SUB] Rebuilt nodes map with",Object.keys(n).length,"nodes"),console.log("[TREE-SUB] Forcing immediate tree persistence"),Vr()}});let Qe=null;re.subscribe(e=>{if(e){if(console.log("[TREE-RECALC-SUB] Tree updated, scheduling recalculation"),console.log("[TREE-RECALC-SUB] Tree has",e.children.length,"children"),F(Ae)){console.log("[TREE-RECALC-SUB] Skipping recalculation because tree is being loaded");return}if(F(Zt)){console.log("[TREE-RECALC-SUB] Skipping recalculation because update is from recalculation");return}Qe&&(console.log("[TREE-RECALC-SUB] Clearing previous recalc timer"),clearTimeout(Qe)),console.log("[TREE-RECALC-SUB] Setting new recalc timer for 300ms"),Qe=setTimeout(()=>{console.log("[TREE-RECALC-SUB] Timer fired, running recalculation");try{xc()}catch(t){console.error("[TREE-RECALC-SUB] Error during recalculation:",t),console.log("[TREE-RECALC-SUB] Forcing tree persistence after error"),Vr()}Qe=null},300)}});Je.subscribe(e=>{if(e)if(console.log("[CAPACITIES-SUB] Capacities updated"),console.log("[CAPACITIES-SUB] Capacities count:",Object.keys(e).length),F(ut))console.log("[CAPACITIES-SUB] Skipping persistence because capacities are being loaded");else{console.log("[CAPACITIES-SUB] Persisting capacities");try{Ec()}catch(t){console.error("[CAPACITIES-SUB] Error during persistence:",t)}}});Br.subscribe(e=>{console.log("[CONTRIBUTOR-CAPACITY-SHARES-SUB] Contributor capacity shares updated"),console.log("[CONTRIBUTOR-CAPACITY-SHARES-SUB] Contributor capacity shares count:",Object.keys(e).length),$c()});function Ic(){console.log("=== RECOGNITION DEBUG STATE ===");const e=F(dt),t=F(Lr),n=F(pe),r=F(nn),i=F(Fr),o=F(pt);console.log("Contributors:",e),console.log("Mutual Contributors:",t),console.log("User SOGF:",o),console.log("=== DETAILED RECOGNITION CACHE ==="),Object.entries(n).forEach(([a,l])=>{console.log(`${a}:`,{ourShare:l.ourShare,theirShare:l.theirShare,mutual:Math.min(l.ourShare,l.theirShare),timestamp:new Date(l.timestamp).toISOString()})}),console.log("Mutual Recognition:",r),console.log("Provider Shares:",i),console.log("=== END DEBUG ===")}function Dc(){console.log("[DEBUG] Manually triggering subscriptions for all contributors");const e=F(dt);e.forEach(t=>{console.log(`[DEBUG] Setting up subscription for: ${t}`),qr(t)}),console.log(`[DEBUG] Set up ${e.length} subscriptions`)}typeof window<"u"&&(window.debugRecognition=Ic,window.debugTriggerSubscriptions=Dc);const fe=X([]);{let e="";ce.subscribe(t=>{t&&t!==e?(fe.set([t]),e=t,console.log("Initialized currentPath with user public key:",t)):!t&&e&&(fe.set([]),e="")})}const oe=Si({deleteMode:!1,nodeToEdit:"",initializationStarted:!1,toast:{visible:!1,message:"",type:"info",timeoutId:null},navigateToPath:async e=>{console.log("Navigating to path",e),!(!e.length||!F(re))&&fe.set(e)},navigateToPathIndex:e=>{const t=F(fe);e<0||e>=t.length||e!==t.length-1&&fe.set(t.slice(0,e+1))},zoomInto:e=>{const t=F(fe),n=F(re);if(!n)return;const r=Kt(n,e);if(r){if(Pe(r)){oe.showToast("Cannot zoom into nodes with contributors","warning");return}fe.set([...t,e])}},zoomOut:()=>{const e=F(fe);e.length<=1||fe.set(e.slice(0,-1))},resetState:()=>{re.set(null),fe.set([])},toggleDeleteMode:()=>{oe.deleteMode=!oe.deleteMode,oe.showToast(oe.deleteMode?"Delete mode activated. Click a node to delete it.":"Delete mode deactivated.",oe.deleteMode?"warning":"info")},setNodeToEditMode:e=>{oe.nodeToEdit=e,setTimeout(()=>{oe.nodeToEdit===e&&(oe.nodeToEdit="")},1e3)},showToast:(e,t="info")=>{oe.toast.timeoutId&&clearTimeout(oe.toast.timeoutId),oe.toast={visible:!0,message:e,type:t,timeoutId:window.setTimeout(()=>{oe.toast.visible=!1},3e3)}}});export{Je as A,tf as B,Gt as C,rf as D,ef as E,Jc as F,nf as G,Xc as H,hr as I,eo as J,Qc as K,lr as L,Yc as M,pt as N,Fr as O,xc as P,Sc as Q,Vc as R,pc as S,Ue as T,Ge as U,dr as V,Z as a,ce as b,fe as c,le as d,Lc as e,Kt as f,oe as g,Pi as h,Ce as i,Mc as j,zi as k,Gc as l,af as m,of as n,Tc as o,Hc as p,Fc as q,Wc as r,rt as s,Zi as t,re as u,ge as v,L as w,Kc as x,Bc as y,qc as z};
