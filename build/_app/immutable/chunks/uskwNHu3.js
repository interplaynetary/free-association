import{ab as Gr,b as Yn,aB as Xn,R as pt,h as X,T as Vr,a as qr,j as un,i as Hr,Z as Yr,_ as an,$ as ze,d as Te,al as Xr,a0 as Qn,c as Pt,p as Qr,aC as dt,ao as er,a4 as Nt,aa as sn,aD as Ut,aE as cn,aF as Mt,m as eo,aG as fn,aj as to,aH as no,aI as ro,an as oo,aJ as io,U as tr,aK as uo,N as ao,E as so,K as co,aL as fo,aM as lo,aN as ho,as as po,aO as go,aP as vo,u as nr,a3 as Lt,au as yo,a5 as mo,k as wo}from"./DbFEi_cg.js";import{b as bo,i as _o,c as So,d as ko,f as To,n as Ao,g as Eo,l as Ft}from"./C1WlvAqj.js";import{w as Q,g as L,d as pe}from"./LezPCy1M.js";function Rc(e,t){return t}function Oo(e,t,n,r){for(var o=[],i=t.length,u=0;u<i;u++)ro(t[u].e,o,!0);var l=i>0&&o.length===0&&n!==null;if(l){var f=n.parentNode;oo(f),f.append(n),r.clear(),de(e,t[0].prev,t[i-1].next)}io(o,()=>{for(var a=0;a<i;a++){var v=t[a];l||(r.delete(v.k),de(e,v.prev,v.next)),tr(v.e,!l)}})}function zc(e,t,n,r,o,i=null){var u=e,l={flags:t,items:new Map,first:null},f=(t&Xn)!==0;if(f){var a=e;u=X?pt(Vr(a)):a.appendChild(Gr())}X&&qr();var v=null,g=!1,h=Hr(()=>{var S=n();return to(S)?S:S==null?[]:er(S)});Yn(()=>{var S=un(h),d=S.length;if(g&&d===0)return;g=d===0;let _=!1;if(X){var m=u.data===Yr;m!==(d===0)&&(u=an(),pt(u),ze(!1),_=!0)}if(X){for(var w=null,c,s=0;s<d;s++){if(Te.nodeType===8&&Te.data===Xr){u=Te,_=!0,ze(!1);break}var p=S[s],y=r(p,s);c=rr(Te,l,w,null,p,y,s,o,t,n),l.items.set(y,c),w=c}d>0&&pt(an())}X||$o(S,l,u,o,t,r,n),i!==null&&(d===0?v?Qn(v):v=Pt(()=>i(u)):v!==null&&Qr(v,()=>{v=null})),_&&ze(!0),un(h)}),X&&(u=Te)}function $o(e,t,n,r,o,i,u){var O,C,z,N;var l=(o&no)!==0,f=(o&(Ut|Mt))!==0,a=e.length,v=t.items,g=t.first,h=g,S,d=null,_,m=[],w=[],c,s,p,y;if(l)for(y=0;y<a;y+=1)c=e[y],s=i(c,y),p=v.get(s),p!==void 0&&((O=p.a)==null||O.measure(),(_??(_=new Set)).add(p));for(y=0;y<a;y+=1){if(c=e[y],s=i(c,y),p=v.get(s),p===void 0){var A=h?h.e.nodes_start:n;d=rr(A,t,d,d===null?t.first:d.next,c,s,y,r,o,u),v.set(s,d),m=[],w=[],h=d.next;continue}if(f&&Co(p,c,y,o),(p.e.f&dt)!==0&&(Qn(p.e),l&&((C=p.a)==null||C.unfix(),(_??(_=new Set)).delete(p))),p!==h){if(S!==void 0&&S.has(p)){if(m.length<w.length){var T=w[0],k;d=T.prev;var $=m[0],R=m[m.length-1];for(k=0;k<m.length;k+=1)ln(m[k],T,n);for(k=0;k<w.length;k+=1)S.delete(w[k]);de(t,$.prev,R.next),de(t,d,$),de(t,R,T),h=T,d=R,y-=1,m=[],w=[]}else S.delete(p),ln(p,h,n),de(t,p.prev,p.next),de(t,p,d===null?t.first:d.next),de(t,d,p),d=p;continue}for(m=[],w=[];h!==null&&h.k!==s;)(h.e.f&dt)===0&&(S??(S=new Set)).add(h),w.push(h),h=h.next;if(h===null)continue;p=h}m.push(p),d=p,h=p.next}if(h!==null||S!==void 0){for(var x=S===void 0?[]:er(S);h!==null;)(h.e.f&dt)===0&&x.push(h),h=h.next;var E=x.length;if(E>0){var b=(o&Xn)!==0&&a===0?n:null;if(l){for(y=0;y<E;y+=1)(z=x[y].a)==null||z.measure();for(y=0;y<E;y+=1)(N=x[y].a)==null||N.fix()}Oo(t,x,b,v)}}l&&Nt(()=>{var j;if(_!==void 0)for(p of _)(j=p.a)==null||j.apply()}),sn.first=t.first&&t.first.e,sn.last=d&&d.e}function Co(e,t,n,r){(r&Ut)!==0&&cn(e.v,t),(r&Mt)!==0?cn(e.i,n):e.i=n}function rr(e,t,n,r,o,i,u,l,f,a){var v=(f&Ut)!==0,g=(f&uo)===0,h=v?g?eo(o):fn(o):o,S=(f&Mt)===0?u:fn(u),d={i:S,v:h,k:i,a:null,e:null,prev:n,next:r};try{return d.e=Pt(()=>l(e,h,S,a),X),d.e.prev=n&&n.e,d.e.next=r&&r.e,n===null?t.first=d:(n.next=d,n.e.next=d.e),r!==null&&(r.prev=d,r.e.prev=d.e),d}finally{}}function ln(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,o=t?t.e.nodes_start:n,i=e.e.nodes_start;i!==r;){var u=ao(i);o.before(i),i=u}}function de(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function Ic(e,t,...n){var r=e,o=co,i;Yn(()=>{o!==(o=t())&&(i&&(tr(i),i=null),i=Pt(()=>o(r,...n)))},so),X&&(r=Te)}function or(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(n=or(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function xo(){for(var e,t,n=0,r="",o=arguments.length;n<o;n++)(e=arguments[n])&&(t=or(e))&&(r&&(r+=" "),r+=t);return r}function No(e){return typeof e=="object"?xo(e):e??""}const hn=[...` 	
\r\fÂ \v\uFEFF`];function jo(e,t,n){var r=e==null?"":""+e;if(t&&(r=r?r+" "+t:t),n){for(var o in n)if(n[o])r=r?r+" "+o:o;else if(r.length)for(var i=o.length,u=0;(u=r.indexOf(o,u))>=0;){var l=u+i;(u===0||hn.includes(r[u-1]))&&(l===r.length||hn.includes(r[l]))?r=(u===0?"":r.substring(0,u))+r.substring(l+1):u=l}}return r===""?null:r}function pn(e,t=!1){var n=t?" !important;":";",r="";for(var o in e){var i=e[o];i!=null&&i!==""&&(r+=" "+o+": "+i+n)}return r}function gt(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function Ro(e,t){if(t){var n="",r,o;if(Array.isArray(t)?(r=t[0],o=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,u=0,l=!1,f=[];r&&f.push(...Object.keys(r).map(gt)),o&&f.push(...Object.keys(o).map(gt));var a=0,v=-1;const _=e.length;for(var g=0;g<_;g++){var h=e[g];if(l?h==="/"&&e[g-1]==="*"&&(l=!1):i?i===h&&(i=!1):h==="/"&&e[g+1]==="*"?l=!0:h==='"'||h==="'"?i=h:h==="("?u++:h===")"&&u--,!l&&i===!1&&u===0){if(h===":"&&v===-1)v=g;else if(h===";"||g===_-1){if(v!==-1){var S=gt(e.substring(a,v).trim());if(!f.includes(S)){h!==";"&&g++;var d=e.substring(a,g).trim();n+=" "+d+";"}}a=g+1,v=-1}}}}return r&&(n+=pn(r)),o&&(n+=pn(o,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function zo(e,t,n,r,o,i){var u=e.__className;if(X||u!==n||u===void 0){var l=jo(n,r,i);(!X||l!==e.getAttribute("class"))&&(l==null?e.removeAttribute("class"):t?e.className=l:e.setAttribute("class",l)),e.__className=n}else if(i&&o!==i)for(var f in i){var a=!!i[f];(o==null||a!==!!o[f])&&e.classList.toggle(f,a)}return i}function vt(e,t={},n,r){for(var o in n){var i=n[o];t[o]!==i&&(n[o]==null?e.style.removeProperty(o):e.style.setProperty(o,i,r))}}function Io(e,t,n,r){var o=e.__style;if(X||o!==t){var i=Ro(t,r);(!X||i!==e.getAttribute("style"))&&(i==null?e.removeAttribute("style"):e.style.cssText=i),e.__style=t}else r&&(Array.isArray(r)?(vt(e,n==null?void 0:n[0],r[0]),vt(e,n==null?void 0:n[1],r[1],"important")):vt(e,n,r));return r}const Ne=Symbol("class"),je=Symbol("style"),ir=Symbol("is custom element"),ur=Symbol("is html");function Dc(e){if(X){var t=!1,n=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var r=e.value;tt(e,"value",null),e.value=r}if(e.hasAttribute("checked")){var o=e.checked;tt(e,"checked",null),e.checked=o}}};e.__on_r=n,fo(n),bo()}}function Zc(e,t){var n=Wt(e);n.checked!==(n.checked=t??void 0)&&(e.checked=t)}function Do(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function tt(e,t,n,r){var o=Wt(e);X&&(o[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||o[t]!==(o[t]=n)&&(t==="loading"&&(e[lo]=n),n==null?e.removeAttribute(t):typeof n!="string"&&ar(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function Pc(e,t,n,r,o=!1){var i=Wt(e),u=i[ir],l=!i[ur];let f=X&&u;f&&ze(!1);var a=t||{},v=e.tagName==="OPTION";for(var g in t)g in n||(n[g]=null);n.class?n.class=No(n.class):(r||n[Ne])&&(n.class=null),n[je]&&(n.style??(n.style=null));var h=ar(e);for(const s in n){let p=n[s];if(v&&s==="value"&&p==null){e.value=e.__value="",a[s]=p;continue}if(s==="class"){var S=e.namespaceURI==="http://www.w3.org/1999/xhtml";zo(e,S,p,r,t==null?void 0:t[Ne],n[Ne]),a[s]=p,a[Ne]=n[Ne];continue}if(s==="style"){Io(e,p,t==null?void 0:t[je],n[je]),a[s]=p,a[je]=n[je];continue}var d=a[s];if(p!==d){a[s]=p;var _=s[0]+s[1];if(_!=="$$")if(_==="on"){const y={},A="$$"+s;let T=s.slice(2);var m=Eo(T);if(_o(T)&&(T=T.slice(0,-7),y.capture=!0),!m&&d){if(p!=null)continue;e.removeEventListener(T,a[A],y),a[A]=null}if(p!=null)if(m)e[`__${T}`]=p,ko([T]);else{let k=function($){a[s].call(this,$)};a[A]=So(T,e,k,y)}else m&&(e[`__${T}`]=void 0)}else if(s==="style")tt(e,s,p);else if(s==="autofocus")To(e,!!p);else if(!u&&(s==="__value"||s==="value"&&p!=null))e.value=e.__value=p;else if(s==="selected"&&v)Do(e,p);else{var w=s;l||(w=Ao(w));var c=w==="defaultValue"||w==="defaultChecked";if(p==null&&!u&&!c)if(i[s]=null,w==="value"||w==="checked"){let y=e;const A=t===void 0;if(w==="value"){let T=y.defaultValue;y.removeAttribute(w),y.defaultValue=T,y.value=y.__value=A?T:null}else{let T=y.defaultChecked;y.removeAttribute(w),y.defaultChecked=T,y.checked=A?T:!1}}else e.removeAttribute(s);else c||h.includes(w)&&(u||typeof p!="string")?e[w]=p:typeof p!="function"&&tt(e,w,p)}}}return f&&ze(!0),a}function Wt(e){return e.__attributes??(e.__attributes={[ir]:e.nodeName.includes("-"),[ur]:e.namespaceURI===ho})}var dn=new Map;function ar(e){var t=dn.get(e.nodeName);if(t)return t;dn.set(e.nodeName,t=[]);for(var n,r=e,o=Element.prototype;o!==r;){n=go(r);for(var i in n)n[i].set&&t.push(i);r=po(r)}return t}function Uc(e,t,n=t){var r=vo();Ft(e,"input",o=>{var i=o?e.defaultValue:e.value;if(i=mt(e)?wt(i):i,n(i),r&&i!==(i=t())){var u=e.selectionStart,l=e.selectionEnd;e.value=i??"",l!==null&&(e.selectionStart=u,e.selectionEnd=Math.min(l,e.value.length))}}),(X&&e.defaultValue!==e.value||nr(t)==null&&e.value)&&n(mt(e)?wt(e.value):e.value),Lt(()=>{var o=t();mt(e)&&o===wt(e.value)||e.type==="date"&&!o&&!e.value||o!==e.value&&(e.value=o??"")})}const yt=new Set;function Mc(e,t,n,r,o=r){var i=n.getAttribute("type")==="checkbox",u=e;let l=!1;if(t!==null)for(var f of t)u=u[f]??(u[f]=[]);u.push(n),Ft(n,"change",()=>{var a=n.__value;i&&(a=gn(u,a,n.checked)),o(a)},()=>o(i?[]:null)),Lt(()=>{var a=r();if(X&&n.defaultChecked!==n.checked){l=!0;return}i?(a=a||[],n.checked=a.includes(n.__value)):n.checked=yo(n.__value,a)}),mo(()=>{var a=u.indexOf(n);a!==-1&&u.splice(a,1)}),yt.has(u)||(yt.add(u),Nt(()=>{u.sort((a,v)=>a.compareDocumentPosition(v)===4?-1:1),yt.delete(u)})),Nt(()=>{if(l){var a;if(i)a=gn(u,a,n.checked);else{var v=u.find(g=>g.checked);a=v==null?void 0:v.__value}o(a)}})}function Lc(e,t,n=t){Ft(e,"change",r=>{var o=r?e.defaultChecked:e.checked;n(o)}),(X&&e.defaultChecked!==e.checked||nr(t)==null)&&n(e.checked),Lt(()=>{var r=t();e.checked=!!r})}function gn(e,t,n){for(var r=new Set,o=0;o<e.length;o+=1)e[o].checked&&r.add(e[o].__value);return n||r.delete(t),Array.from(r)}function mt(e){var t=e.type;return t==="number"||t==="range"}function wt(e){return e===""?null:+e}var Ie=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Xe={exports:{}},Zo=Xe.exports,vn;function Po(){return vn||(vn=1,function(e,t){(function(n,r){e.exports=r()})(Zo,function(){Array.isArray||(Array.isArray=function(i){return Object.prototype.toString.call(i)==="[object Array]"});function n(i){for(var u=[],l=0,f=i.length;l<f;l++)u.indexOf(i[l])===-1&&u.push(i[l]);return u}var r={},o={"==":function(i,u){return i==u},"===":function(i,u){return i===u},"!=":function(i,u){return i!=u},"!==":function(i,u){return i!==u},">":function(i,u){return i>u},">=":function(i,u){return i>=u},"<":function(i,u,l){return l===void 0?i<u:i<u&&u<l},"<=":function(i,u,l){return l===void 0?i<=u:i<=u&&u<=l},"!!":function(i){return r.truthy(i)},"!":function(i){return!r.truthy(i)},"%":function(i,u){return i%u},log:function(i){return console.log(i),i},in:function(i,u){return!u||typeof u.indexOf>"u"?!1:u.indexOf(i)!==-1},cat:function(){return Array.prototype.join.call(arguments,"")},substr:function(i,u,l){if(l<0){var f=String(i).substr(u);return f.substr(0,f.length+l)}return String(i).substr(u,l)},"+":function(){return Array.prototype.reduce.call(arguments,function(i,u){return parseFloat(i,10)+parseFloat(u,10)},0)},"*":function(){return Array.prototype.reduce.call(arguments,function(i,u){return parseFloat(i,10)*parseFloat(u,10)})},"-":function(i,u){return u===void 0?-i:i-u},"/":function(i,u){return i/u},min:function(){return Math.min.apply(this,arguments)},max:function(){return Math.max.apply(this,arguments)},merge:function(){return Array.prototype.reduce.call(arguments,function(i,u){return i.concat(u)},[])},var:function(i,u){var l=u===void 0?null:u,f=this;if(typeof i>"u"||i===""||i===null)return f;for(var a=String(i).split("."),v=0;v<a.length;v++)if(f==null||(f=f[a[v]],f===void 0))return l;return f},missing:function(){for(var i=[],u=Array.isArray(arguments[0])?arguments[0]:arguments,l=0;l<u.length;l++){var f=u[l],a=r.apply({var:f},this);(a===null||a==="")&&i.push(f)}return i},missing_some:function(i,u){var l=r.apply({missing:u},this);return u.length-l.length>=i?[]:l}};return r.is_logic=function(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&Object.keys(i).length===1},r.truthy=function(i){return Array.isArray(i)&&i.length===0?!1:!!i},r.get_operator=function(i){return Object.keys(i)[0]},r.get_values=function(i){return i[r.get_operator(i)]},r.apply=function(i,u){if(Array.isArray(i))return i.map(function(m){return r.apply(m,u)});if(!r.is_logic(i))return i;var l=r.get_operator(i),f=i[l],a,v,g,h,S;if(Array.isArray(f)||(f=[f]),l==="if"||l=="?:"){for(a=0;a<f.length-1;a+=2)if(r.truthy(r.apply(f[a],u)))return r.apply(f[a+1],u);return f.length===a+1?r.apply(f[a],u):null}else if(l==="and"){for(a=0;a<f.length;a+=1)if(v=r.apply(f[a],u),!r.truthy(v))return v;return v}else if(l==="or"){for(a=0;a<f.length;a+=1)if(v=r.apply(f[a],u),r.truthy(v))return v;return v}else{if(l==="filter")return h=r.apply(f[0],u),g=f[1],Array.isArray(h)?h.filter(function(m){return r.truthy(r.apply(g,m))}):[];if(l==="map")return h=r.apply(f[0],u),g=f[1],Array.isArray(h)?h.map(function(m){return r.apply(g,m)}):[];if(l==="reduce")return h=r.apply(f[0],u),g=f[1],S=typeof f[2]<"u"?r.apply(f[2],u):null,Array.isArray(h)?h.reduce(function(m,w){return r.apply(g,{current:w,accumulator:m})},S):S;if(l==="all"){if(h=r.apply(f[0],u),g=f[1],!Array.isArray(h)||!h.length)return!1;for(a=0;a<h.length;a+=1)if(!r.truthy(r.apply(g,h[a])))return!1;return!0}else if(l==="none"){if(h=r.apply(f[0],u),g=f[1],!Array.isArray(h)||!h.length)return!0;for(a=0;a<h.length;a+=1)if(r.truthy(r.apply(g,h[a])))return!1;return!0}else if(l==="some"){if(h=r.apply(f[0],u),g=f[1],!Array.isArray(h)||!h.length)return!1;for(a=0;a<h.length;a+=1)if(r.truthy(r.apply(g,h[a])))return!0;return!1}}if(f=f.map(function(m){return r.apply(m,u)}),o.hasOwnProperty(l)&&typeof o[l]=="function")return o[l].apply(u,f);if(l.indexOf(".")>0){var d=String(l).split("."),_=o;for(a=0;a<d.length;a++){if(!_.hasOwnProperty(d[a]))throw new Error("Unrecognized operation "+l+" (failed at "+d.slice(0,a+1).join(".")+")");_=_[d[a]]}return _.apply(u,f)}throw new Error("Unrecognized operation "+l)},r.uses_data=function(i){var u=[];if(r.is_logic(i)){var l=r.get_operator(i),f=i[l];Array.isArray(f)||(f=[f]),l==="var"?u.push(f[0]):f.forEach(function(a){u.push.apply(u,r.uses_data(a))})}return n(u)},r.add_operation=function(i,u){o[i]=u},r.rm_operation=function(i){delete o[i]},r.rule_like=function(i,u){if(u===i||u==="@")return!0;if(u==="number")return typeof i=="number";if(u==="string")return typeof i=="string";if(u==="array")return Array.isArray(i)&&!r.is_logic(i);if(r.is_logic(u)){if(r.is_logic(i)){var l=r.get_operator(u),f=r.get_operator(i);if(l==="@"||l===f)return r.rule_like(r.get_values(i,!1),r.get_values(u,!1))}return!1}if(Array.isArray(u))if(Array.isArray(i)){if(u.length!==i.length)return!1;for(var a=0;a<u.length;a+=1)if(!r.rule_like(i[a],u[a]))return!1;return!0}else return!1;return!1},r})}(Xe)),Xe.exports}var Uo=Po();const Mo=Jt(Uo);function Lo(e,t,n){const r=Object.entries(e).filter(([o,i])=>t(o,i,n));return ut(Object.fromEntries(r))}const Fc={includeNodes:e=>({in:[{var:"nodeId"},e]}),excludeNodes:e=>({"!":{in:[{var:"nodeId"},e]}}),aboveThreshold:e=>({">=":[{var:"share"},e]}),byCategory:e=>({some:[{var:"node.categories"},{in:[{var:""},e]}]}),inSubtrees:e=>({some:[e,{"!!":{var:["subtreeContributors",{var:""},{var:"nodeId"}]}}]}),inSubtree:e=>({in:[{var:"nodeId"},{var:["subtreeContributors",e]}]}),and:(...e)=>({and:e}),or:(...e)=>({or:e}),not:e=>({"!":e})};function Fo(e){return(t,n,r={})=>{var i;const o={nodeId:t,share:n,node:((i=r.node)==null?void 0:i[t])||null,subtreeContributors:r.subtreeContributors||{},...r};return!!Mo.apply(e,o)}}function Wo(e,t,n){return e.filter_rule?Lo(t,Fo(e.filter_rule),n):ut({...t})}function ut(e){const t=Object.values(e).reduce((n,r)=>n+r,0);return t===0?e:Object.fromEntries(Object.entries(e).map(([n,r])=>[n,r/t]))}function Kt(e,t){if(e.id===t)return e;for(const n of e.children){const r=Kt(n,t);if(r)return r}return null}function nt(e){const t=[];function n(r){for(const o of r.children)t.push(o),n(o)}return n(e),t}function sr(e,t){for(const n of e.children){if(n.id===t)return e;const r=sr(n,t);if(r)return r}return null}function Jo(e){return e.children.filter(t=>t.type==="NonRootNode").reduce((t,n)=>t+(n.points||0),0)}function Bt(e,t){if(e.type==="RootNode"||e.id===t.id)return 1;const n=sr(t,e.id);if(!n||e.type!=="NonRootNode")return 1;const r=Jo(n),o=r===0?0:e.points/r,i=Bt(n,t);return o*i}function De(e){var t;return e.type==="NonRootNode"&&((t=e.contributor_ids)==null?void 0:t.length)>0}function cr(e,t){const n=e.manual_fulfillment!==void 0,r=e.children.length===0,o=De(e),i=e.children.some(h=>De(h)),u=e.children.some(h=>!De(h)),l=e.manual_fulfillment??0;if(r&&o)return 1;if(r)return 0;if(n&&i&&!u)return l;const f=e.children.map(h=>Bt(h,t)),a=e.children.map(h=>cr(h,t)),v=f.reduce((h,S,d)=>h+S*a[d],0),g=f.reduce((h,S)=>h+S,0);return g===0?0:v/g}function Ko(e,t,n){return[e,...nt(e)].filter(u=>u.type==="RootNode"?!1:u.contributor_ids.includes(t)&&De(u)).map(u=>{const l=Bt(u,e),f=cr(u,e),a=u.type==="RootNode"?1:u.contributor_ids.length;return l*f/a}).reduce((u,l)=>u+l,0)}function Bo(e){const t=new Set,n=[e,...nt(e)];for(const r of n)if(r.type==="NonRootNode")for(const o of r.contributor_ids)t.add(o);return[...t]}function Go(e,t,n){const r={},o=n||Object.keys(t).filter(i=>i!==e.id);for(const i of o){const u=Ko(e,i);r[i]=u}return ut(r)}function Wc(e,t){e[t.id]=t}function fr(e){return e===void 0?null:Math.max(0,Math.min(1,e))}function Vo(e,t,n,r){return{id:e,name:t,type:"RootNode",user_id:n,children:[],manual_fulfillment:fr(r),created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}function qo(e,t,n,r,o=[],i){return{id:e,name:t,type:"NonRootNode",points:r,parent_id:n,children:[],contributor_ids:o,manual_fulfillment:fr(i)}}function Jc(e,t,n,r,o=[],i){if(e.type==="NonRootNode"&&e.contributor_ids.length>0)throw new Error("Cannot add children to nodes with contributors");const u=qo(t,n,e.id,r,o,i);e.children.push(u)}function Kc(e,t){e.type==="NonRootNode"?(e.contributor_ids=[...t],e.children=[]):e.children=[]}function Ho(e,t,n){if(e.id===t)return n(e),!0;for(const r of e.children)if(Ho(r,t,n))return!0;return!1}function Bc(e,t){e.points=t}function Gc(e,t){e.name=t}function lr(e,t){const n={};function r(i){const u=new Set;return[i,...nt(i)].forEach(f=>{f.type==="NonRootNode"&&f.contributor_ids.forEach(a=>u.add(a))}),[...u]}return n[e.id]=Object.fromEntries(r(e).map(i=>[i,!0])),nt(e).forEach(i=>{n[i.id]=Object.fromEntries(r(i).map(u=>[u,!0]))}),n}function I(e,t,n){const r=(n==null?void 0:n.Parent)??Object;class o extends r{constructor(u){var l;super();const f=this;o.init(f,u),(l=f._zod).deferred??(l.deferred=[]);for(const a of f._zod.deferred)a()}static init(u,l){var f;Object.defineProperty(u,"_zod",{value:u._zod??{},enumerable:!1}),(f=u._zod).traits??(f.traits=new Set),u._zod.traits.add(e),t(u,l);for(const a in o.prototype)Object.defineProperty(u,a,{value:o.prototype[a].bind(u)});u._zod.constr=o,u._zod.def=l}static[Symbol.hasInstance](u){var l,f;return n!=null&&n.Parent&&u instanceof n.Parent?!0:(f=(l=u==null?void 0:u._zod)==null?void 0:l.traits)==null?void 0:f.has(e)}}return Object.defineProperty(o,"name",{value:e}),o}class Pe extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const hr={};function ge(e){return hr}function Yo(e,t){return typeof t=="bigint"?t.toString():t}function pr(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function Gt(e){return e==null}function Vt(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function Xo(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=n>r?n:r,i=Number.parseInt(e.toFixed(o).replace(".","")),u=Number.parseInt(t.toFixed(o).replace(".",""));return i%u/10**o}function H(e,t,n){Object.defineProperty(e,t,{get(){{const r=n();return e[t]=r,r}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function qt(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function dr(e=10){const t="abcdefghijklmnopqrstuvwxyz";let n="";for(let r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n}function Re(e){return JSON.stringify(e)}function Qo(e){return typeof e=="object"&&e!==null}const ei=pr(()=>{try{const e=Function;return new e(""),!0}catch{return!1}});function jt(e){return typeof e=="object"&&e!==null&&Object.getPrototypeOf(e)===Object.prototype}const ti=new Set(["string","number","symbol"]);function Oe(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function _e(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(r._zod.parent=e),r}function P(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function ni(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional")}const ri={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function oi(e,t){const n={},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(n[o]=r.shape[o])}return _e(e,{...e._zod.def,shape:n,checks:[]})}function ii(e,t){const n={...e._zod.def.shape},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&delete n[o]}return _e(e,{...e._zod.def,shape:n,checks:[]})}function ui(e,t){const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return qt(this,"shape",r),r},checks:[]};return _e(e,n)}function ai(e,t){return _e(e,{...e._zod.def,get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return qt(this,"shape",n),n},catchall:t._zod.def.catchall,checks:[]})}function si(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const i in n){if(!(i in r))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(o[i]=e?new e({type:"optional",innerType:r[i]}):r[i])}else for(const i in r)o[i]=e?new e({type:"optional",innerType:r[i]}):r[i];return _e(t,{...t._zod.def,shape:o,checks:[]})}function ci(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const i in n){if(!(i in o))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(o[i]=new e({type:"nonoptional",innerType:r[i]}))}else for(const i in r)o[i]=new e({type:"nonoptional",innerType:r[i]});return _e(t,{...t._zod.def,shape:o,checks:[]})}function Ze(e,t=0){for(let n=t;n<e.issues.length;n++)if(e.issues[n].continue!==!0)return!0;return!1}function be(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function Ge(e){return typeof e=="string"?e:e==null?void 0:e.message}function ve(e,t,n){var o,i,u,l,f,a;const r={...e,path:e.path??[]};if(!e.message){const v=Ge((u=(i=(o=e.inst)==null?void 0:o._zod.def)==null?void 0:i.error)==null?void 0:u.call(i,e))??Ge((l=t==null?void 0:t.error)==null?void 0:l.call(t,e))??Ge((f=n.customError)==null?void 0:f.call(n,e))??Ge((a=n.localeError)==null?void 0:a.call(n,e))??"Invalid input";r.message=v}return delete r.inst,delete r.continue,t!=null&&t.reportInput||delete r.input,r}function Ht(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function Ue(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const gr=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,Yo,2)},enumerable:!0})},vr=I("$ZodError",gr),yr=I("$ZodError",gr,{Parent:Error});function fi(e,t=n=>n.message){const n={},r=[];for(const o of e.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:n}}function li(e,t){const n=t||function(i){return i.message},r={_errors:[]},o=i=>{for(const u of i.issues)if(u.code==="invalid_union")u.errors.map(l=>o({issues:l}));else if(u.code==="invalid_key")o({issues:u.issues});else if(u.code==="invalid_element")o({issues:u.issues});else if(u.path.length===0)r._errors.push(n(u));else{let l=r,f=0;for(;f<u.path.length;){const a=u.path[f];f===u.path.length-1?(l[a]=l[a]||{_errors:[]},l[a]._errors.push(n(u))):l[a]=l[a]||{_errors:[]},l=l[a],f++}}};return o(e),r}const hi=e=>(t,n,r,o)=>{const i=r?Object.assign(r,{async:!1}):{async:!1},u=t._zod.run({value:n,issues:[]},i);if(u instanceof Promise)throw new Pe;if(u.issues.length){const l=new((o==null?void 0:o.Err)??e)(u.issues.map(f=>ve(f,i,ge())));throw Error.captureStackTrace(l,o==null?void 0:o.callee),l}return u.value},pi=e=>async(t,n,r,o)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let u=t._zod.run({value:n,issues:[]},i);if(u instanceof Promise&&(u=await u),u.issues.length){const l=new((o==null?void 0:o.Err)??e)(u.issues.map(f=>ve(f,i,ge())));throw Error.captureStackTrace(l,o==null?void 0:o.callee),l}return u.value},mr=e=>(t,n,r)=>{const o=r?{...r,async:!1}:{async:!1},i=t._zod.run({value:n,issues:[]},o);if(i instanceof Promise)throw new Pe;return i.issues.length?{success:!1,error:new(e??vr)(i.issues.map(u=>ve(u,o,ge())))}:{success:!0,data:i.value}},di=mr(yr),wr=e=>async(t,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},o);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(u=>ve(u,o,ge())))}:{success:!0,data:i.value}},gi=wr(yr),vi=/^[cC][^\s-]{8,}$/,yi=/^[0-9a-z]+$/,mi=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,wi=/^[0-9a-vA-V]{20}$/,bi=/^[A-Za-z0-9]{27}$/,_i=/^[a-zA-Z0-9_-]{21}$/,Si=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,ki=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,yn=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,Ti=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,Ai="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function Ei(){return new RegExp(Ai,"u")}const Oi=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,$i=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,Ci=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,xi=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ni=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,br=/^[A-Za-z0-9_-]*$/,bt=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,ji=/^\+(?:[0-9]){6,14}[0-9]$/,_r="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Ri=new RegExp(`^${_r}$`);function Sr(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`),t}function zi(e){return new RegExp(`^${Sr(e)}$`)}function Ii(e){let t=`${_r}T${Sr(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}const Di=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},Zi=/^\d+$/,Pi=/^-?\d+(?:\.\d+)?/i,Ui=/true|false/i,Mi=/^[^A-Z]*$/,Li=/^[^a-z]*$/,ne=I("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),kr={number:"number",bigint:"bigint",object:"date"},Tr=I("$ZodCheckLessThan",(e,t)=>{ne.init(e,t);const n=kr[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,i=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<i&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Ar=I("$ZodCheckGreaterThan",(e,t)=>{ne.init(e,t);const n=kr[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,i=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>i&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Fi=I("$ZodCheckMultipleOf",(e,t)=>{ne.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):Xo(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),Wi=I("$ZodCheckNumberFormat",(e,t)=>{var u;ne.init(e,t),t.format=t.format||"float64";const n=(u=t.format)==null?void 0:u.includes("int"),r=n?"int":"number",[o,i]=ri[t.format];e._zod.onattach.push(l=>{const f=l._zod.bag;f.format=t.format,f.minimum=o,f.maximum=i,n&&(f.pattern=Zi)}),e._zod.check=l=>{const f=l.value;if(n){if(!Number.isInteger(f)){l.issues.push({expected:r,format:t.format,code:"invalid_type",input:f,inst:e});return}if(!Number.isSafeInteger(f)){f>0?l.issues.push({input:f,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the the safe integer range.",inst:e,origin:r,continue:!t.abort}):l.issues.push({input:f,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}f<o&&l.issues.push({origin:"number",input:f,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),f>i&&l.issues.push({origin:"number",input:f,code:"too_big",maximum:i,inst:e})}}),Ji=I("$ZodCheckMaxLength",(e,t)=>{ne.init(e,t),e._zod.when=n=>{const r=n.value;return!Gt(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const r=n.value;if(r.length<=t.maximum)return;const i=Ht(r);n.issues.push({origin:i,code:"too_big",maximum:t.maximum,input:r,inst:e,continue:!t.abort})}}),Ki=I("$ZodCheckMinLength",(e,t)=>{ne.init(e,t),e._zod.when=n=>{const r=n.value;return!Gt(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const r=n.value;if(r.length>=t.minimum)return;const i=Ht(r);n.issues.push({origin:i,code:"too_small",minimum:t.minimum,input:r,inst:e,continue:!t.abort})}}),Bi=I("$ZodCheckLengthEquals",(e,t)=>{ne.init(e,t),e._zod.when=n=>{const r=n.value;return!Gt(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=n=>{const r=n.value,o=r.length;if(o===t.length)return;const i=Ht(r),u=o>t.length;n.issues.push({origin:i,...u?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},input:n.value,inst:e,continue:!t.abort})}}),at=I("$ZodCheckStringFormat",(e,t)=>{var n;ne.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.format=t.format,t.pattern&&(r._zod.bag.pattern=t.pattern)}),(n=e._zod).check??(n.check=r=>{if(!t.pattern)throw new Error("Not implemented.");t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})})}),Gi=I("$ZodCheckRegex",(e,t)=>{at.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Vi=I("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Mi),at.init(e,t)}),qi=I("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=Li),at.init(e,t)}),Hi=I("$ZodCheckIncludes",(e,t)=>{ne.init(e,t);const n=new RegExp(Oe(t.includes));t.pattern=n,e._zod.onattach.push(r=>{r._zod.bag.pattern=n}),e._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:e,continue:!t.abort})}}),Yi=I("$ZodCheckStartsWith",(e,t)=>{ne.init(e,t);const n=new RegExp(`^${Oe(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{r._zod.bag.pattern=n}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),Xi=I("$ZodCheckEndsWith",(e,t)=>{ne.init(e,t);const n=new RegExp(`.*${Oe(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{r._zod.bag.pattern=new RegExp(`.*${Oe(t.suffix)}$`)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),Qi=I("$ZodCheckOverwrite",(e,t)=>{ne.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class eu{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(u=>u),o=Math.min(...r.map(u=>u.length-u.trimStart().length)),i=r.map(u=>u.slice(o)).map(u=>" ".repeat(this.indent*2)+u);for(const u of i)this.content.push(u)}compile(){const t=Function,n=this==null?void 0:this.args,o=[...((this==null?void 0:this.content)??[""]).map(i=>`  ${i}`)];return new t(...n,o.join(`
`))}}const tu={major:4,minor:0,patch:0},B=I("$ZodType",(e,t)=>{var o;var n;e??(e={}),e._zod.id=t.type+"_"+dr(10),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=tu;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const i of r)for(const u of i._zod.onattach)u(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),(o=e._zod.deferred)==null||o.push(()=>{e._zod.run=e._zod.parse});else{const i=(u,l,f)=>{let a=Ze(u),v;for(const g of l){if(g._zod.when){if(!g._zod.when(u))continue}else if(a)continue;const h=u.issues.length,S=g._zod.check(u);if(S instanceof Promise&&(f==null?void 0:f.async)===!1)throw new Pe;if(v||S instanceof Promise)v=(v??Promise.resolve()).then(async()=>{await S,u.issues.length!==h&&(a||(a=Ze(u,h)))});else{if(u.issues.length===h)continue;a||(a=Ze(u,h))}}return v?v.then(()=>u):u};e._zod.run=(u,l)=>{const f=e._zod.parse(u,l);if(f instanceof Promise){if(l.async===!1)throw new Pe;return f.then(a=>i(a,r,l))}return i(f,r,l)}}e["~standard"]={validate:i=>{var u;try{const l=di(e,i);return l.success?{value:l.data}:{issues:(u=l.error)==null?void 0:u.issues}}catch{return gi(e,i).then(f=>{var a;return f.success?{value:f.data}:{issues:(a=f.error)==null?void 0:a.issues}})}},vendor:"zod",version:1}}),Yt=I("$ZodString",(e,t)=>{var n;B.init(e,t),e._zod.pattern=((n=e==null?void 0:e._zod.bag)==null?void 0:n.pattern)??Di(e._zod.bag),e._zod.parse=(r,o)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),G=I("$ZodStringFormat",(e,t)=>{at.init(e,t),Yt.init(e,t)}),nu=I("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=ki),G.init(e,t)}),ru=I("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=yn(r))}else t.pattern??(t.pattern=yn());G.init(e,t)}),ou=I("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=Ti),G.init(e,t)}),iu=I("$ZodURL",(e,t)=>{G.init(e,t),e._zod.check=n=>{try{const r=new URL(n.value);bt.lastIndex=0,bt.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:bt.source,input:n.value,inst:e}),t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:n.value,inst:e})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e}));return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e})}}}),uu=I("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=Ei()),G.init(e,t)}),au=I("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=_i),G.init(e,t)}),su=I("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=vi),G.init(e,t)}),cu=I("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=yi),G.init(e,t)}),fu=I("$ZodULID",(e,t)=>{t.pattern??(t.pattern=mi),G.init(e,t)}),lu=I("$ZodXID",(e,t)=>{t.pattern??(t.pattern=wi),G.init(e,t)}),hu=I("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=bi),G.init(e,t)}),pu=I("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=Ii(t)),G.init(e,t)}),du=I("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=Ri),G.init(e,t)}),gu=I("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=zi(t)),G.init(e,t)}),vu=I("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=Si),G.init(e,t)}),yu=I("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=Oi),G.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.format="ipv4"})}),mu=I("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=$i),G.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.format="ipv6"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e})}}}),wu=I("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=Ci),G.init(e,t)}),bu=I("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=xi),G.init(e,t),e._zod.check=n=>{const[r,o]=n.value.split("/");try{if(!o)throw new Error;const i=Number(o);if(`${i}`!==o)throw new Error;if(i<0||i>128)throw new Error;new URL(`http://[${r}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e})}}});function Er(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const _u=I("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Ni),G.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),e._zod.check=n=>{Er(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e})}});function Su(e){if(!br.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return Er(n)}const ku=I("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=br),G.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),e._zod.check=n=>{Su(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e})}}),Tu=I("$ZodE164",(e,t)=>{t.pattern??(t.pattern=ji),G.init(e,t)});function Au(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n,o=JSON.parse(atob(r));return!("typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const Eu=I("$ZodJWT",(e,t)=>{G.init(e,t),e._zod.check=n=>{Au(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e})}}),Or=I("$ZodNumber",(e,t)=>{B.init(e,t),e._zod.pattern=e._zod.bag.pattern??Pi,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const i=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...i?{received:i}:{}}),n}}),Ou=I("$ZodNumber",(e,t)=>{Wi.init(e,t),Or.init(e,t)}),$u=I("$ZodBoolean",(e,t)=>{B.init(e,t),e._zod.pattern=Ui,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}const o=n.value;return typeof o=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),n}}),Cu=I("$ZodAny",(e,t)=>{B.init(e,t),e._zod.parse=n=>n}),xu=I("$ZodUnknown",(e,t)=>{B.init(e,t),e._zod.parse=n=>n}),Nu=I("$ZodNever",(e,t)=>{B.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function mn(e,t,n){e.issues.length&&t.issues.push(...be(n,e.issues)),t.value[n]=e.value}const ju=I("$ZodArray",(e,t)=>{B.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),n;n.value=Array(o.length);const i=[];for(let u=0;u<o.length;u++){const l=o[u],f=t.element._zod.run({value:l,issues:[]},r);f instanceof Promise?i.push(f.then(a=>mn(a,n,u))):mn(f,n,u)}return i.length?Promise.all(i).then(()=>n):n}});function Ve(e,t,n){e.issues.length&&t.issues.push(...be(n,e.issues)),t.value[n]=e.value}function wn(e,t,n,r){e.issues.length?r[n]===void 0?n in r?t.value[n]=void 0:t.value[n]=e.value:t.issues.push(...be(n,e.issues)):e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}const Ru=I("$ZodObject",(e,t)=>{B.init(e,t);const n=pr(()=>{const g=Object.keys(t.shape),h=ni(t.shape);return{shape:t.shape,keys:g,keySet:new Set(g),numKeys:g.length,optionalKeys:new Set(h)}});H(e._zod,"disc",()=>{const g=t.shape,h=new Map;let S=!1;for(const d in g){const _=g[d]._zod;if(_.values||_.disc){S=!0;const m={values:new Set(_.values??[]),maps:_.disc?[_.disc]:[]};h.set(d,m)}}if(S)return h});const r=g=>{const h=new eu(["shape","payload","ctx"]),{keys:S,optionalKeys:d}=n.value,_=c=>{const s=Re(c);return`shape[${s}]._zod.run({ value: input[${s}], issues: [] }, ctx)`};h.write("const input = payload.value;");const m=Object.create(null);for(const c of S)m[c]=dr(15);h.write("const newResult = {}");for(const c of S)if(d.has(c)){const s=m[c];h.write(`const ${s} = ${_(c)};`);const p=Re(c);h.write(`
        if (${s}.issues.length) {
          if (input[${p}] === undefined) {
            if (${p} in input) {
              newResult[${p}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${s}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${p}, ...iss.path] : [${p}],
              }))
            );
          }
        } else if (${s}.value === undefined) {
          if (${p} in input) newResult[${p}] = undefined;
        } else {
          newResult[${p}] = ${s}.value;
        }
        `)}else{const s=m[c];h.write(`const ${s} = ${_(c)};`),h.write(`
          if (${s}.issues.length) payload.issues = payload.issues.concat(${s}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Re(c)}, ...iss.path] : [${Re(c)}]
          })));`),h.write(`newResult[${Re(c)}] = ${s}.value`)}h.write("payload.value = newResult;"),h.write("return payload;");const w=h.compile();return(c,s)=>w(g,c,s)};let o;const i=Qo,u=!hr.jitless,f=u&&ei.value,{catchall:a}=t;let v;e._zod.parse=(g,h)=>{v??(v=n.value);const S=g.value;if(!i(S))return g.issues.push({expected:"object",code:"invalid_type",input:S,inst:e}),g;const d=[];if(u&&f&&(h==null?void 0:h.async)===!1&&h.jitless!==!0)o||(o=r(t.shape)),g=o(g,h);else{g.value={};const s=v.shape;for(const p of v.keys){const y=s[p],A=y._zod.run({value:S[p],issues:[]},h),T=y._zod.optin==="optional";A instanceof Promise?d.push(A.then(k=>T?wn(k,g,p,S):Ve(k,g,p))):T?wn(A,g,p,S):Ve(A,g,p)}}if(!a)return d.length?Promise.all(d).then(()=>g):g;const _=[],m=v.keySet,w=a._zod,c=w.def.type;for(const s of Object.keys(S)){if(m.has(s))continue;if(c==="never"){_.push(s);continue}const p=w.run({value:S[s],issues:[]},h);p instanceof Promise?d.push(p.then(y=>Ve(y,g,s))):Ve(p,g,s)}return _.length&&g.issues.push({code:"unrecognized_keys",keys:_,input:S,inst:e}),d.length?Promise.all(d).then(()=>g):g}});function bn(e,t,n,r){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(o=>o.issues.map(i=>ve(i,r,ge())))}),t}const zu=I("$ZodUnion",(e,t)=>{B.init(e,t),H(e._zod,"values",()=>{if(t.options.every(n=>n._zod.values))return new Set(t.options.flatMap(n=>Array.from(n._zod.values)))}),H(e._zod,"pattern",()=>{if(t.options.every(n=>n._zod.pattern)){const n=t.options.map(r=>r._zod.pattern);return new RegExp(`^(${n.map(r=>Vt(r.source)).join("|")})$`)}}),e._zod.parse=(n,r)=>{let o=!1;const i=[];for(const u of t.options){const l=u._zod.run({value:n.value,issues:[]},r);if(l instanceof Promise)i.push(l),o=!0;else{if(l.issues.length===0)return l;i.push(l)}}return o?Promise.all(i).then(u=>bn(u,n,e,r)):bn(i,n,e,r)}}),Iu=I("$ZodIntersection",(e,t)=>{B.init(e,t),e._zod.parse=(n,r)=>{const{value:o}=n,i=t.left._zod.run({value:o,issues:[]},r),u=t.right._zod.run({value:o,issues:[]},r);return i instanceof Promise||u instanceof Promise?Promise.all([i,u]).then(([f,a])=>_n(n,f,a)):_n(n,i,u)}});function Rt(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(jt(e)&&jt(t)){const n=Object.keys(t),r=Object.keys(e).filter(i=>n.indexOf(i)!==-1),o={...e,...t};for(const i of r){const u=Rt(e[i],t[i]);if(!u.valid)return{valid:!1,mergeErrorPath:[i,...u.mergeErrorPath]};o[i]=u.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const o=e[r],i=t[r],u=Rt(o,i);if(!u.valid)return{valid:!1,mergeErrorPath:[r,...u.mergeErrorPath]};n.push(u.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function _n(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),Ze(e))return e;const r=Rt(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const Du=I("$ZodRecord",(e,t)=>{B.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!jt(o))return n.issues.push({expected:"record",code:"invalid_type",input:o,inst:e}),n;const i=[];if(t.keyType._zod.values){const u=t.keyType._zod.values;n.value={};for(const f of u)if(typeof f=="string"||typeof f=="number"||typeof f=="symbol"){const a=t.valueType._zod.run({value:o[f],issues:[]},r);a instanceof Promise?i.push(a.then(v=>{v.issues.length&&n.issues.push(...be(f,v.issues)),n.value[f]=v.value})):(a.issues.length&&n.issues.push(...be(f,a.issues)),n.value[f]=a.value)}let l;for(const f in o)u.has(f)||(l=l??[],l.push(f));l&&l.length>0&&n.issues.push({code:"unrecognized_keys",input:o,inst:e,keys:l})}else{n.value={};for(const u of Reflect.ownKeys(o)){if(u==="__proto__")continue;const l=t.keyType._zod.run({value:u,issues:[]},r);if(l instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(l.issues.length){n.issues.push({origin:"record",code:"invalid_key",issues:l.issues.map(a=>ve(a,r,ge())),input:u,path:[u],inst:e}),n.value[l.value]=l.value;continue}const f=t.valueType._zod.run({value:o[u],issues:[]},r);f instanceof Promise?i.push(f.then(a=>{a.issues.length&&n.issues.push(...be(u,a.issues)),n.value[l.value]=a.value})):(f.issues.length&&n.issues.push(...be(u,f.issues)),n.value[l.value]=f.value)}}return i.length?Promise.all(i).then(()=>n):n}}),Zu=I("$ZodEnum",(e,t)=>{B.init(e,t);const n=Object.values(t.entries).filter(o=>typeof o=="number"),r=Object.entries(t.entries).filter(([o,i])=>n.indexOf(+o)===-1).map(([o,i])=>i);e._zod.values=new Set(r),e._zod.pattern=new RegExp(`^(${r.filter(o=>ti.has(typeof o)).map(o=>typeof o=="string"?Oe(o):o.toString()).join("|")})$`),e._zod.parse=(o,i)=>{const u=o.value;return e._zod.values.has(u)||o.issues.push({code:"invalid_value",values:r,input:u,inst:e}),o}}),Pu=I("$ZodLiteral",(e,t)=>{B.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?Oe(n):n?n.toString():String(n)).join("|")})$`),e._zod.parse=(n,r)=>{const o=n.value;return e._zod.values.has(o)||n.issues.push({code:"invalid_value",values:t.values,input:o,inst:e}),n}}),Uu=I("$ZodTransform",(e,t)=>{B.init(e,t),e._zod.parse=(n,r)=>{const o=t.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(u=>(n.value=u,n));if(o instanceof Promise)throw new Pe;return n.value=o,n}}),Mu=I("$ZodOptional",(e,t)=>{B.init(e,t),e._zod.optin="optional",e._zod.optout="optional",H(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),H(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${Vt(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>n.value===void 0?n:t.innerType._zod.run(n,r)}),Lu=I("$ZodNullable",(e,t)=>{B.init(e,t),H(e._zod,"optin",()=>t.innerType._zod.optin),H(e._zod,"optout",()=>t.innerType._zod.optout),H(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${Vt(n.source)}|null)$`):void 0}),H(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),Fu=I("$ZodDefault",(e,t)=>{B.init(e,t),e._zod.optin="optional",H(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(n.value===void 0)return n.value=t.defaultValue,n;const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>Sn(i,t)):Sn(o,t)}});function Sn(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Wu=I("$ZodPrefault",(e,t)=>{B.init(e,t),e._zod.optin="optional",H(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),Ju=I("$ZodNonOptional",(e,t)=>{B.init(e,t),H(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>kn(i,e)):kn(o,e)}});function kn(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Ku=I("$ZodCatch",(e,t)=>{B.init(e,t),H(e._zod,"optin",()=>t.innerType._zod.optin),H(e._zod,"optout",()=>t.innerType._zod.optout),H(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>(n.value=i.value,i.issues.length&&(n.value=t.catchValue({...n,error:{issues:i.issues.map(u=>ve(u,r,ge()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(i=>ve(i,r,ge()))},input:n.value}),n.issues=[]),n)}}),Bu=I("$ZodPipe",(e,t)=>{B.init(e,t),H(e._zod,"values",()=>t.in._zod.values),H(e._zod,"optin",()=>t.in._zod.optin),H(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(n,r)=>{const o=t.in._zod.run(n,r);return o instanceof Promise?o.then(i=>Tn(i,t,r)):Tn(o,t,r)}});function Tn(e,t,n){return Ze(e)?e:t.out._zod.run({value:e.value,issues:e.issues},n)}const Gu=I("$ZodReadonly",(e,t)=>{B.init(e,t),H(e._zod,"disc",()=>t.innerType._zod.disc),H(e._zod,"optin",()=>t.innerType._zod.optin),H(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(An):An(o)}});function An(e){return e.value=Object.freeze(e.value),e}const Vu=I("$ZodCustom",(e,t)=>{ne.init(e,t),B.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,o=t.fn(r);if(o instanceof Promise)return o.then(i=>En(i,n,r,e));En(o,n,r,e)}});function En(e,t,n,r){if(!e){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),t.issues.push(Ue(o))}}class qu{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}remove(t){return this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};return delete r.id,{...r,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}}function Hu(){return new qu}const qe=Hu();function Yu(e,t){return new e({type:"string",...P(t)})}function Xu(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...P(t)})}function On(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...P(t)})}function Qu(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...P(t)})}function ea(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...P(t)})}function ta(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...P(t)})}function na(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...P(t)})}function ra(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...P(t)})}function oa(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...P(t)})}function ia(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...P(t)})}function ua(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...P(t)})}function aa(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...P(t)})}function sa(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...P(t)})}function ca(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...P(t)})}function fa(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...P(t)})}function la(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...P(t)})}function ha(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...P(t)})}function pa(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...P(t)})}function da(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...P(t)})}function ga(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...P(t)})}function va(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...P(t)})}function ya(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...P(t)})}function ma(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...P(t)})}function wa(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...P(t)})}function ba(e,t){return new e({type:"string",format:"date",check:"string_format",...P(t)})}function _a(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...P(t)})}function Sa(e,t){return new e({type:"string",format:"duration",check:"string_format",...P(t)})}function ka(e,t){return new e({type:"number",checks:[],...P(t)})}function Ta(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...P(t)})}function Aa(e,t){return new e({type:"boolean",...P(t)})}function Ea(e){return new e({type:"any"})}function Oa(e){return new e({type:"unknown"})}function $a(e,t){return new e({type:"never",...P(t)})}function $n(e,t){return new Tr({check:"less_than",...P(t),value:e,inclusive:!1})}function _t(e,t){return new Tr({check:"less_than",...P(t),value:e,inclusive:!0})}function Cn(e,t){return new Ar({check:"greater_than",...P(t),value:e,inclusive:!1})}function St(e,t){return new Ar({check:"greater_than",...P(t),value:e,inclusive:!0})}function xn(e,t){return new Fi({check:"multiple_of",...P(t),value:e})}function $r(e,t){return new Ji({check:"max_length",...P(t),maximum:e})}function rt(e,t){return new Ki({check:"min_length",...P(t),minimum:e})}function Cr(e,t){return new Bi({check:"length_equals",...P(t),length:e})}function Ca(e,t){return new Gi({check:"string_format",format:"regex",...P(t),pattern:e})}function xa(e){return new Vi({check:"string_format",format:"lowercase",...P(e)})}function Na(e){return new qi({check:"string_format",format:"uppercase",...P(e)})}function ja(e,t){return new Hi({check:"string_format",format:"includes",...P(t),includes:e})}function Ra(e,t){return new Yi({check:"string_format",format:"starts_with",...P(t),prefix:e})}function za(e,t){return new Xi({check:"string_format",format:"ends_with",...P(t),suffix:e})}function Fe(e){return new Qi({check:"overwrite",tx:e})}function Ia(e){return Fe(t=>t.normalize(e))}function Da(){return Fe(e=>e.trim())}function Za(){return Fe(e=>e.toLowerCase())}function Pa(){return Fe(e=>e.toUpperCase())}function Ua(e,t,n){return new e({type:"array",element:t,...P(n)})}function Ma(e,t,n){return new e({type:"custom",check:"custom",fn:t,...P(n)})}const La=I("ZodISODateTime",(e,t)=>{pu.init(e,t),q.init(e,t)});function Fa(e){return wa(La,e)}const Wa=I("ZodISODate",(e,t)=>{du.init(e,t),q.init(e,t)});function Ja(e){return ba(Wa,e)}const Ka=I("ZodISOTime",(e,t)=>{gu.init(e,t),q.init(e,t)});function Ba(e){return _a(Ka,e)}const Ga=I("ZodISODuration",(e,t)=>{vu.init(e,t),q.init(e,t)});function Va(e){return Sa(Ga,e)}const qa=(e,t)=>{vr.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>li(e,n)},flatten:{value:n=>fi(e,n)},addIssue:{value:n=>e.issues.push(n)},addIssues:{value:n=>e.issues.push(...n)},isEmpty:{get(){return e.issues.length===0}}})},st=I("ZodError",qa,{Parent:Error}),Ha=hi(st),Ya=pi(st),Xa=mr(st),Qa=wr(st),V=I("ZodType",(e,t)=>(B.init(e,t),e.def=t,e._def=t,e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),e.clone=(n,r)=>_e(e,n,r),e.brand=()=>e,e.register=(n,r)=>(n.add(e,r),e),e.parse=(n,r)=>Ha(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>Xa(e,n,r),e.parseAsync=async(n,r)=>Ya(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>Qa(e,n,r),e.spa=e.safeParseAsync,e.refine=(n,r)=>e.check(Gs(n,r)),e.superRefine=n=>e.check(Vs(n)),e.overwrite=n=>e.check(Fe(n)),e.optional=()=>K(e),e.nullable=()=>te(e),e.nullish=()=>K(te(e)),e.nonoptional=n=>Us(e,n),e.array=()=>Me(e),e.or=n=>Xt([e,n]),e.and=n=>$s(e,n),e.transform=n=>In(e,Rs(n)),e.default=n=>Ds(e,n),e.prefault=n=>Ps(e,n),e.catch=n=>Ls(e,n),e.pipe=n=>In(e,n),e.readonly=()=>Js(e),e.describe=n=>{const r=e.clone();return qe.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){var n;return(n=qe.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return qe.get(e);const r=e.clone();return qe.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),xr=I("_ZodString",(e,t)=>{Yt.init(e,t),V.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(Ca(...r)),e.includes=(...r)=>e.check(ja(...r)),e.startsWith=r=>e.check(Ra(r)),e.endsWith=r=>e.check(za(r)),e.min=(...r)=>e.check(rt(...r)),e.max=(...r)=>e.check($r(...r)),e.length=(...r)=>e.check(Cr(...r)),e.nonempty=(...r)=>e.check(rt(1,...r)),e.lowercase=r=>e.check(xa(r)),e.uppercase=r=>e.check(Na(r)),e.trim=()=>e.check(Da()),e.normalize=(...r)=>e.check(Ia(...r)),e.toLowerCase=()=>e.check(Za()),e.toUpperCase=()=>e.check(Pa())}),es=I("ZodString",(e,t)=>{Yt.init(e,t),xr.init(e,t),e.email=n=>e.check(Xu(ts,n)),e.url=n=>e.check(ra(ns,n)),e.jwt=n=>e.check(ma(ys,n)),e.emoji=n=>e.check(oa(rs,n)),e.guid=n=>e.check(On(Nn,n)),e.uuid=n=>e.check(Qu(He,n)),e.uuidv4=n=>e.check(ea(He,n)),e.uuidv6=n=>e.check(ta(He,n)),e.uuidv7=n=>e.check(na(He,n)),e.nanoid=n=>e.check(ia(os,n)),e.guid=n=>e.check(On(Nn,n)),e.cuid=n=>e.check(ua(is,n)),e.cuid2=n=>e.check(aa(us,n)),e.ulid=n=>e.check(sa(as,n)),e.base64=n=>e.check(ga(ds,n)),e.base64url=n=>e.check(va(gs,n)),e.xid=n=>e.check(ca(ss,n)),e.ksuid=n=>e.check(fa(cs,n)),e.ipv4=n=>e.check(la(fs,n)),e.ipv6=n=>e.check(ha(ls,n)),e.cidrv4=n=>e.check(pa(hs,n)),e.cidrv6=n=>e.check(da(ps,n)),e.e164=n=>e.check(ya(vs,n)),e.datetime=n=>e.check(Fa(n)),e.date=n=>e.check(Ja(n)),e.time=n=>e.check(Ba(n)),e.duration=n=>e.check(Va(n))});function Y(e){return Yu(es,e)}const q=I("ZodStringFormat",(e,t)=>{G.init(e,t),xr.init(e,t)}),ts=I("ZodEmail",(e,t)=>{ou.init(e,t),q.init(e,t)}),Nn=I("ZodGUID",(e,t)=>{nu.init(e,t),q.init(e,t)}),He=I("ZodUUID",(e,t)=>{ru.init(e,t),q.init(e,t)}),ns=I("ZodURL",(e,t)=>{iu.init(e,t),q.init(e,t)}),rs=I("ZodEmoji",(e,t)=>{uu.init(e,t),q.init(e,t)}),os=I("ZodNanoID",(e,t)=>{au.init(e,t),q.init(e,t)}),is=I("ZodCUID",(e,t)=>{su.init(e,t),q.init(e,t)}),us=I("ZodCUID2",(e,t)=>{cu.init(e,t),q.init(e,t)}),as=I("ZodULID",(e,t)=>{fu.init(e,t),q.init(e,t)}),ss=I("ZodXID",(e,t)=>{lu.init(e,t),q.init(e,t)}),cs=I("ZodKSUID",(e,t)=>{hu.init(e,t),q.init(e,t)}),fs=I("ZodIPv4",(e,t)=>{yu.init(e,t),q.init(e,t)}),ls=I("ZodIPv6",(e,t)=>{mu.init(e,t),q.init(e,t)}),hs=I("ZodCIDRv4",(e,t)=>{wu.init(e,t),q.init(e,t)}),ps=I("ZodCIDRv6",(e,t)=>{bu.init(e,t),q.init(e,t)}),ds=I("ZodBase64",(e,t)=>{_u.init(e,t),q.init(e,t)}),gs=I("ZodBase64URL",(e,t)=>{ku.init(e,t),q.init(e,t)}),vs=I("ZodE164",(e,t)=>{Tu.init(e,t),q.init(e,t)}),ys=I("ZodJWT",(e,t)=>{Eu.init(e,t),q.init(e,t)}),Nr=I("ZodNumber",(e,t)=>{Or.init(e,t),V.init(e,t),e.gt=(r,o)=>e.check(Cn(r,o)),e.gte=(r,o)=>e.check(St(r,o)),e.min=(r,o)=>e.check(St(r,o)),e.lt=(r,o)=>e.check($n(r,o)),e.lte=(r,o)=>e.check(_t(r,o)),e.max=(r,o)=>e.check(_t(r,o)),e.int=r=>e.check(jn(r)),e.safe=r=>e.check(jn(r)),e.positive=r=>e.check(Cn(0,r)),e.nonnegative=r=>e.check(St(0,r)),e.negative=r=>e.check($n(0,r)),e.nonpositive=r=>e.check(_t(0,r)),e.multipleOf=(r,o)=>e.check(xn(r,o)),e.step=(r,o)=>e.check(xn(r,o)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function ie(e){return ka(Nr,e)}const ms=I("ZodNumberFormat",(e,t)=>{Ou.init(e,t),Nr.init(e,t)});function jn(e){return Ta(ms,e)}const ws=I("ZodBoolean",(e,t)=>{$u.init(e,t),V.init(e,t)});function Rn(e){return Aa(ws,e)}const bs=I("ZodAny",(e,t)=>{Cu.init(e,t),V.init(e,t)});function ct(){return Ea(bs)}const _s=I("ZodUnknown",(e,t)=>{xu.init(e,t),V.init(e,t)});function zn(){return Oa(_s)}const Ss=I("ZodNever",(e,t)=>{Nu.init(e,t),V.init(e,t)});function ks(e){return $a(Ss,e)}const Ts=I("ZodArray",(e,t)=>{ju.init(e,t),V.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(rt(n,r)),e.nonempty=n=>e.check(rt(1,n)),e.max=(n,r)=>e.check($r(n,r)),e.length=(n,r)=>e.check(Cr(n,r))});function Me(e,t){return Ua(Ts,e,t)}const As=I("ZodObject",(e,t)=>{Ru.init(e,t),V.init(e,t),H(e,"shape",()=>Object.fromEntries(Object.entries(e._zod.def.shape))),e.keyof=()=>xs(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:zn()}),e.loose=()=>e.clone({...e._zod.def,catchall:zn()}),e.strict=()=>e.clone({...e._zod.def,catchall:ks()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>ui(e,n),e.merge=n=>ai(e,n),e.pick=n=>oi(e,n),e.omit=n=>ii(e,n),e.partial=(...n)=>si(Rr,e,n[0]),e.required=(...n)=>ci(zr,e,n[0])});function Se(e,t){const n={type:"object",get shape(){return qt(this,"shape",{...e}),this.shape},...P(t)};return new As(n)}const Es=I("ZodUnion",(e,t)=>{zu.init(e,t),V.init(e,t),e.options=t.options});function Xt(e,t){return new Es({type:"union",options:e,...P(t)})}const Os=I("ZodIntersection",(e,t)=>{Iu.init(e,t),V.init(e,t)});function $s(e,t){return new Os({type:"intersection",left:e,right:t})}const Cs=I("ZodRecord",(e,t)=>{Du.init(e,t),V.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function ft(e,t,n){return new Cs({type:"record",keyType:e,valueType:t,...P(n)})}const zt=I("ZodEnum",(e,t)=>{Zu.init(e,t),V.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,o)=>{const i={};for(const u of r)if(n.has(u))i[u]=t.entries[u];else throw new Error(`Key ${u} not found in enum`);return new zt({...t,checks:[],...P(o),entries:i})},e.exclude=(r,o)=>{const i={...t.entries};for(const u of r)if(n.has(u))delete i[u];else throw new Error(`Key ${u} not found in enum`);return new zt({...t,checks:[],...P(o),entries:i})}});function xs(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new zt({type:"enum",entries:n,...P(t)})}const Ns=I("ZodLiteral",(e,t)=>{Pu.init(e,t),V.init(e,t),e.values=new Set(t.values)});function jr(e,t){return new Ns({type:"literal",values:Array.isArray(e)?e:[e],...P(t)})}const js=I("ZodTransform",(e,t)=>{Uu.init(e,t),V.init(e,t),e._zod.parse=(n,r)=>{n.addIssue=i=>{if(typeof i=="string")n.issues.push(Ue(i,n.value,t));else{const u=i;u.fatal&&(u.continue=!1),u.code??(u.code="custom"),u.input??(u.input=n.value),u.inst??(u.inst=e),u.continue??(u.continue=!0),n.issues.push(Ue(u))}};const o=t.transform(n.value,n);return o instanceof Promise?o.then(i=>(n.value=i,n)):(n.value=o,n)}});function Rs(e){return new js({type:"transform",transform:e})}const Rr=I("ZodOptional",(e,t)=>{Mu.init(e,t),V.init(e,t),e.unwrap=()=>e._zod.def.innerType});function K(e){return new Rr({type:"optional",innerType:e})}const zs=I("ZodNullable",(e,t)=>{Lu.init(e,t),V.init(e,t),e.unwrap=()=>e._zod.def.innerType});function te(e){return new zs({type:"nullable",innerType:e})}const Is=I("ZodDefault",(e,t)=>{Fu.init(e,t),V.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Ds(e,t){return new Is({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const Zs=I("ZodPrefault",(e,t)=>{Wu.init(e,t),V.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Ps(e,t){return new Zs({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const zr=I("ZodNonOptional",(e,t)=>{Ju.init(e,t),V.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Us(e,t){return new zr({type:"nonoptional",innerType:e,...P(t)})}const Ms=I("ZodCatch",(e,t)=>{Ku.init(e,t),V.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Ls(e,t){return new Ms({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const Fs=I("ZodPipe",(e,t)=>{Bu.init(e,t),V.init(e,t),e.in=t.in,e.out=t.out});function In(e,t){return new Fs({type:"pipe",in:e,out:t})}const Ws=I("ZodReadonly",(e,t)=>{Gu.init(e,t),V.init(e,t)});function Js(e){return new Ws({type:"readonly",innerType:e})}const Ks=I("ZodCustom",(e,t)=>{Vu.init(e,t),V.init(e,t)});function Bs(e,t){const n=new ne({check:"custom",...P(t)});return n._zod.check=e,n}function Gs(e,t={}){return Ma(Ks,e,t)}function Vs(e,t){const n=Bs(r=>(r.addIssue=o=>{if(typeof o=="string")r.issues.push(Ue(o,r.value,n._zod.def));else{const i=o;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=n),i.continue??(i.continue=!n._zod.def.abort),r.issues.push(Ue(i))}},e(r.value,r)),t);return n}const oe=Y().min(1),Qt=Y().min(1),qs=ie().gte(0),$e=ie().gte(0).lte(1),Hs=ft(oe,$e);Se({id:oe,name:Qt,type:Y(),manual_fulfillment:te(ie()),children:Me(ct())});const Ys=Se({id:oe,name:Qt,type:jr("NonRootNode"),manual_fulfillment:te(ie()),children:Me(ct()),points:qs,parent_id:oe,contributor_ids:Me(oe)}),Ir=Se({id:oe,name:Qt,type:jr("RootNode"),manual_fulfillment:te(ie()),children:Me(ct()),user_id:oe,created_at:Y(),updated_at:Y()});Xt([Ir,Ys]);const Dr=Se({id:oe,name:Y(),emoji:K(Y()),quantity:K(ie().gte(0)),unit:K(Y()),location_type:K(Y()),longitude:K(ie().min(-180).max(180)),latitude:K(ie().min(-90).max(90)),all_day:K(Rn()),recurrence:K(te(Y())),custom_recurrence_repeat_every:K(te(ie())),custom_recurrence_repeat_unit:K(te(Y())),custom_recurrence_end_type:K(te(Y())),custom_recurrence_end_value:K(te(Y())),start_date:K(te(Y())),start_time:K(te(Y())),end_date:K(te(Y())),end_time:K(te(Y())),time_zone:K(Y()),max_natural_div:K(ie().gte(1)),max_percentage_div:K($e),hidden_until_request_accepted:K(Rn()),owner_id:K(oe),filter_rule:K(te(ct()))}),Xs=Se({...Dr.shape,recipient_shares:ft(oe,$e)}),Qs=Se({...Dr.shape,share_percentage:$e,computed_quantity:ie().gte(0),provider_id:oe}),ec=Xt([Xs,Qs]),tc=ft(oe,ec),nc=Se({ourShare:$e,theirShare:$e,timestamp:ie()});ft(oe,nc);function en(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Qe={exports:{}};Qe.exports;var Dn;function ke(){return Dn||(Dn=1,function(e){(function(){function t(r,o){return o?en(r):r.slice?t[i(r)]:function(u,l){r(u={exports:{}}),t[i(l)]=u.exports};function i(u){return u.split("/").slice(-1).toString().replace(".js","")}}var n=e;t(function(r){String.random=function(i,u){var l="";for(i=i||24,u=u||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";i-- >0;)l+=u.charAt(Math.floor(Math.random()*u.length));return l},String.match=function(i,u){var l,f;return typeof i!="string"?!1:(typeof u=="string"&&(u={"=":u}),u=u||{},l=u["="]||u["*"]||u[">"]||u["<"],i===l?!0:f!==u["="]?!1:(l=u["*"]||u[">"],i.slice(0,(l||"").length)===l?!0:f!==u["*"]?!1:f!==u[">"]&&f!==u["<"]?i>=u[">"]&&i<=u["<"]:f!==u[">"]&&i>=u[">"]||f!==u["<"]&&i<=u["<"]))},String.hash=function(i,u){if(typeof i=="string"){if(u=u||0,!i.length)return u;for(var l=0,f=i.length,a;l<f;++l)a=i.charCodeAt(l),u=(u<<5)-u+a,u|=0;return u}};var o=Object.prototype.hasOwnProperty;Object.plain=function(i){return i?i instanceof Object&&i.constructor===Object||Object.prototype.toString.call(i).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(i,u){for(var l in i)if(o.call(i,l)&&(!u||u.indexOf(l)==-1))return!1;return!0},Object.keys=Object.keys||function(i){var u=[];for(var l in i)o.call(i,l)&&u.push(l);return u},function(){var i,u=setTimeout,l=0,f=0,a=typeof setImmediate!=""+i&&setImmediate||function(g,h){return typeof MessageChannel==""+i?u:((g=new MessageChannel).port1.onmessage=function(S){S.data==""&&h()},function(S){h=S,g.port2.postMessage("")})}(),v=u.check=u.check||typeof performance!=""+i&&performance||{now:function(){return+new Date}};u.hold=u.hold||9,u.poll=u.poll||function(g){if(u.hold>=v.now()-l&&f++<3333){g();return}a(function(){l=v.now(),g()},f=0)}}(),function(){var i=setTimeout,u=i.turn=i.turn||function(h){l.push(h)==1&&f(g)},l=u.s=[],f=i.poll,a=0,v,g=function(){(v=l[a++])&&v(),(a==l.length||a==99)&&(l=u.s=l.slice(a),a=0),l.length&&f(g)}}(),function(){var i,u=setTimeout,l=u.turn;(u.each=u.each||function(f,a,v,g){g=g||9,function h(S,d,_){if(d=(S=(f||[]).splice(0,g)).length){for(var m=0;m<d&&i===(_=a(S[m]));m++);if(i===_){l(h);return}}v&&v(_)}()})()}()})(t,"./shim"),t(function(r){r.exports=function o(v,u,l){if(!v)return{to:o};var f,a=typeof u=="function",v=(this.tag||(this.tag={}))[v]||a&&(this.tag[v]={tag:v,to:o._={next:function(h){var S;(S=this.to)&&S.next(h)}}});if(a){var g={off:o.off||(o.off=function(){if(this.next===o._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=o._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:o._,next:u,the:v,on:this,as:l};return(g.back=v.last||v).to=g,v.last=g}return(v=v.to)&&f!==u&&v.next(u),v}})(t,"./onto"),t(function(r){r.exports=function(o){return o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"&&o!=1/0&&o!=-1/0&&o===o||!!o&&typeof o["#"]=="string"&&Object.keys(o).length===1&&o["#"]}})(t,"./valid"),t(function(r){t("./shim");function o(){var v=+new Date;return f<v?(u=0,f=v+o.drift):f=v+(u+=1)/l+o.drift}o.drift=0;var i=-1/0,u=0,l=999,f=i,a;o.is=function(v,g,h){var S=g&&v&&v._&&v._[">"]||h;if(S)return typeof(S=S[g])=="number"?S:i},o.ify=function(v,g,h,S,d){(v=v||{})._=v._||{},d&&(v._["#"]=d);var _=v._[">"]||(v._[">"]={});return a!==g&&g!=="_"&&(typeof h=="number"&&(_[g]=h),a!==S&&(v[g]=S)),v},r.exports=o})(t,"./state"),t(function(r){t("./shim");function o(i){var u={s:{}},l=u.s;i=i||{max:999,age:1e3*9},u.check=function(a){return l[a]?f(a):!1};var f=u.track=function(a){var v=l[a]||(l[a]={});return v.was=u.now=+new Date,u.to||(u.to=setTimeout(u.drop,i.age+9)),f.ed&&f.ed(a),v};return u.drop=function(a){u.to=null,u.now=+new Date;var v=Object.keys(l);console.STAT&&console.STAT(u.now,+new Date-u.now,"dup drop keys"),setTimeout.each(v,function(g){var h=l[g];h&&(a||i.age)>u.now-h.was||delete l[g]},0,99)},u}r.exports=o})(t,"./dup"),t(function(r){t("./onto"),r.exports=function(u,l){if(this.on){var f=(this.opt||{}).lack||9e3;if(typeof u!="function"){if(!u)return;var v=u["#"]||u,a=(this.tag||"")[v];return a?(l&&(a=this.on(v,l),clearTimeout(a.err),a.err=setTimeout(function(){a.off()},f)),!0):void 0}var v=l&&l["#"]||o(9);if(!u)return v;var g=this.on(v,u,l);return g.err=g.err||setTimeout(function(){g.off(),g.next({err:"Error: No ACK yet.",lack:!0})},f),v}};var o=String.random||function(){return Math.random().toString(36).slice(2)}})(t,"./ask"),t(function(r){function o(d){return d instanceof o?(this._={$:this}).$:this instanceof o?o.create(this._={$:this,opt:d}):new o(d)}o.is=function(d){return d instanceof o||d&&d._&&d===d._.$||!1},o.version=.202,o.chain=o.prototype,o.chain.toJSON=function(){},t("./shim"),o.valid=t("./valid"),o.state=t("./state"),o.on=t("./onto"),o.dup=t("./dup"),o.ask=t("./ask"),function(){o.create=function(b){b.root=b.root||b,b.graph=b.graph||{},b.on=b.on||o.on,b.ask=b.ask||o.ask,b.dup=b.dup||o.dup();var O=b.$.opt(b.opt);return b.once||(b.on("in",d,b),b.on("out",d,b),b.on("put",w,b),o.on("create",b),b.on("create",b)),b.once=1,O};function d(b){if(b){if(b.out===d){this.to.next(b);return}var O=this,C=O.as,z=C.at||C,N=z.$,j=z.dup,D,Z=b.DBG;if((D=b["#"])||(D=b["#"]=u(9)),!j.check(D)){if(j.track(D),D=b._,b._=typeof D=="function"?D:function(){},b.$&&b.$===(b.$._||"").$||(b.$=N),b["@"]&&!b.put&&s(b),!z.ask(b["@"],b))if(Z&&(Z.u=+new Date),b.put){_(b);return}else b.get&&o.on.get(b,N);Z&&(Z.uc=+new Date),O.to.next(b),Z&&(Z.ua=+new Date),!(b.nts||b.NTS)&&(b.out=d,z.on("out",b),Z&&(Z.ue=+new Date))}}}function _(b){if(b){var O=b._||"",C=O.root=((O.$=b.$||"")._||"").root;if(b["@"]&&O.faith&&!O.miss){b.out=d,C.on("out",b);return}O.latch=C.hatch,O.match=C.hatch=[];var z=b.put,N=O.DBG=b.DBG,j=+new Date;if(x=x||j,!(z["#"]&&z["."])){N&&(N.p=j),O["#"]=b["#"],O.msg=b,O.all=0,O.stun=1;var D=Object.keys(z);console.STAT&&console.STAT(j,((N||O).pk=+new Date)-j,"put sort");var Z=0,U,F,W,J,ee,ae,xe;(function me(Ke){if(U!=Z){if(U=Z,!(W=D[Z])){console.STAT&&console.STAT(j,((N||O).pd=+new Date)-j,"put"),c(O);return}(J=z[W])?(xe=J._)?W!==xe["#"]?ae=y+A(W)+"soul not same.":(ee=xe[">"])||(ae=y+A(W)+"no state."):ae=y+A(W)+"no meta.":ae=y+A(W)+"no node.",F=Object.keys(J||{})}if(ae){b.err=O.err=ae,c(O);return}var rn=0,we;for(Ke=Ke||0;Ke++<9&&(we=F[rn++]);)if(we!=="_"){var Be=J[we],on=ee[we];if(g===on){ae=y+A(we)+"on"+A(W)+"no state.";break}if(!f(Be)){ae=y+A(we)+"on"+A(W)+"bad "+typeof Be+A(Be);break}m(Be,we,W,on,b),++R}if((F=F.slice(rn)).length){l(me);return}++Z,F=null,me(Ke)})()}}}o.on.put=_;function m(b,O,C,z,N){var j=N._||"",D=j.root,Z=D.graph,U,F=Z[C]||h,W=a(F,O,1),J=F[O],ee=j.DBG;(U=console.STAT)&&(!Z[C]||!J)&&(U.has=(U.has||0)+1);var ae=$();if(z>ae){setTimeout(function(){m(b,O,C,z,N)},(U=z-ae)>k?k:U),console.STAT&&console.STAT((ee||j).Hf=+new Date,U,"future");return}if(!(z<W)&&!(!j.faith&&z===W&&(b===J||T(b)<=T(J))&&!j.miss)){j.stun++;var xe=N["#"]+j.all++,me={toString:function(){return xe},_:j};me.toJSON=me.toString,D.dup.track(me)["#"]=N["#"],ee&&(ee.ph=ee.ph||+new Date),D.on("put",{"#":me,"@":N["@"],put:{"#":C,".":O,":":b,">":z},ok:N.ok,_:j})}}function w(b){var O;(O=(b._||"").DBG)&&(O.pa=+new Date,O.pm=O.pm||+new Date);var C=this,z=C.as,N=z.graph,j=b._,D=b.put,Z=D["#"],U=D["."],F=D[":"],W=D[">"];b["#"];var J;(J=j.msg)&&(J=J.put)&&(J=J[Z])&&v(J,U,W,F,Z),N[Z]=v(N[Z],U,W,F,Z),(J=(z.next||"")[Z])&&J.on("in",b),c(j),C.to.next(b)}function c(b,O){var C;if(!b.stop&&!(!b.err&&0<--b.stun)&&(b.stop=1,!!(C=b.root))){var z=b.match;z.end=1,z===C.hatch&&(!(z=b.latch)||z.end?delete C.hatch:C.hatch=z),b.hatch&&b.hatch(),setTimeout.each(b.match,function(N){N&&N()}),!(!(O=b.msg)||b.err||O.err)&&(O.out=d,b.root.on("out",O),E())}}function s(b){var O=b["@"]||"",C;if(!(C=O._)){var z=(z=b.$)&&(z=z._)&&(z=z.root)&&(z=z.dup);if(!(z=z.check(O)))return;b["@"]=z["#"]||b["@"];return}C.acks=(C.acks||0)+1,(C.err=b.err)&&(b["@"]=C["#"],c(C)),C.ok=b.ok||C.ok,!C.stop&&!C.crack&&(C.crack=C.match&&C.match.push(function(){p(C)})),p(C)}function p(b){!b||!b.root||b.stun||b.acks!==b.all||b.root.on("in",{"@":b["#"],err:b.err,ok:b.err?g:b.ok||{"":1}})}var y="Error: Invalid graph!",A=function(b){return" '"+(""+b).slice(0,9)+"...' "},T=JSON.stringify,k=2147483647,$=o.state,R=0,x,E=function(){R>999&&R/-(x-(x=+new Date))>1&&(o.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),E=function(){R=0})}}(),function(){o.on.get=function(_,m){var w=m._,c=_.get,s=c["#"],p=w.graph[s],y=c["."],A=w.next||(w.next={}),T=A[s],k=_._||{},$=k.DBG=_.DBG;if($&&($.g=+new Date),!p)return w.on("get",_);if(y){if((typeof y!="string"||g===p[y])&&!((T||"").next||"")[y]){w.on("get",_);return}p=v({},y,a(p,y),p[y],s)}p&&d(_,p),w.on("get",_)};function d(_,m){var w=+new Date,c=_._||{},s=c.DBG=_.DBG,p=_["#"],y=u(9),A=Object.keys(m||"").sort(),T=((m||"")._||"")["#"];A.length;var k=_.$._.root,$=m===k.graph[T];console.STAT&&console.STAT(w,((s||c).gk=+new Date)-w,"got keys"),m&&function R(){w=+new Date;for(var x=0,E,b={},O;x<9&&(E=A[x++]);)v(b,E,a(m,E),m[E],T);A=A.slice(x),(O={})[T]=b,b=O;var C;$&&(C=function(){},C.ram=C.faith=!0),O=A.length,console.STAT&&console.STAT(w,-(w-(w=+new Date)),"got copied some"),s&&(s.ga=+new Date),k.on("in",{"@":p,"#":y,put:b,"%":O?y=u(9):g,$:k.$,_:C,DBG:s,FOO:1}),console.STAT&&console.STAT(w,+new Date-w,"got in"),O&&setTimeout.turn(R)}(),m||k.on("in",{"@":_["#"]})}o.on.get.ack=d}(),function(){o.chain.opt=function(d){d=d||{};var _=this,m=_._,w=d.peers||d;return Object.plain(d)||(d={}),Object.plain(m.opt)||(m.opt=d),typeof w=="string"&&(w=[w]),Object.plain(m.opt.peers)||(m.opt.peers={}),w instanceof Array&&(d.peers={},w.forEach(function(c){var s={};s.id=s.url=c,d.peers[c]=m.opt.peers[c]=m.opt.peers[c]||s})),i(d,function c(s){var p=this[s];if(this&&this.hasOwnProperty(s)||typeof p=="string"||Object.empty(p)){this[s]=p;return}p&&p.constructor!==Object&&!(p instanceof Array)||i(p,c)}),m.opt.from=d,o.on("opt",m),m.opt.uuid=m.opt.uuid||function(s){return o.state().toString(36).replace(".","")+String.random(s||12)},_}}();var i=function(d,_){Object.keys(d).forEach(_,d)},u=String.random,l=setTimeout.turn,f=o.valid,a=o.state.is,v=o.state.ify,g,h={},S;o.log=function(){return!o.log.off&&S.log.apply(S,arguments),[].slice.call(arguments).join(" ")},o.log.once=function(d,_,m){return(m=o.log.once)[d]=m[d]||0,m[d]++||o.log(_)},typeof window<"u"&&((window.GUN=window.Gun=o).window=window);try{typeof n<"u"&&(n.exports=o)}catch{}r.exports=o,(o.window||{}).console=(o.window||{}).console||{log:function(){}},(S=console).only=function(d,_){return S.only.i&&d===S.only.i&&S.only.i++&&(S.log.apply(S,arguments)||_)},o.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(t,"./root"),t(function(r){var o=t("./root");o.chain.back=function(l,f){var a;if(l=l||1,l===-1||l===1/0)return this._.root.$;if(l===1)return(this._.back||this._).$;var v=this,g=v._;if(typeof l=="string"&&(l=l.split(".")),l instanceof Array){var h=0,S=l.length,a=g;for(h;h<S;h++)a=(a||i)[l[h]];return u!==a?f?v:a:(a=g.back)?a.$.back(l,f):void 0}if(typeof l=="function"){for(var d,a={back:g};(a=a.back)&&u===(d=l(a,f)););return d}return typeof l=="number"?(g.back||g).$.back(l-1):this};var i={},u})(t,"./back"),t(function(r){var o=t("./root");o.chain.chain=function(c){var s=this,p=s._,y=new(c||s).constructor(s),A=y._,T;return A.root=T=p.root,A.id=++T.once,A.back=s._,A.on=o.on,A.on("in",o.on.in,A),A.on("out",o.on.out,A),y};function i(c){var s,p=this.as,y=p.back,A=p.root,T;if(c.$||(c.$=p.$),this.to.next(c),p.err){p.on("in",{put:p.put=g,$:p.$});return}if(s=c.get){if(A.pass&&(A.pass[p.id]=p),p.lex&&Object.keys(p.lex).forEach(function(k){T[k]=p.lex[k]},T=c.get=c.get||{}),s["#"]||p.soul){if(s["#"]=s["#"]||p.soul,c["#"]||(c["#"]=h(9)),y=A.$.get(s["#"])._,s=s["."]){if(d(y.put,s)&&(T=y.ask&&y.ask[s],(y.ask||(y.ask={}))[s]=y.$.get(s)._,y.on("in",{get:s,put:{"#":y.soul,".":s,":":y.put[s],">":m(A.graph[y.soul],s)}}),T))return}else{if(T=y.ask&&y.ask[""],(y.ask||(y.ask={}))[""]=y,g!==y.put&&(y.on("in",y),T))return;c.$=y.$}return A.ask(a,c),A.on("in",c)}if(s["."])return p.get?(c={get:{".":p.get},$:p.$},(y.ask||(y.ask={}))[p.get]=c.$._,y.on("out",c)):(c={get:p.lex?c.get:{},$:p.$},y.on("out",c));if((p.ask||(p.ask={}))[""]=p,p.get)return s["."]=p.get,(y.ask||(y.ask={}))[p.get]=c.$._,y.on("out",c)}return y.on("out",c)}o.on.out=i;function u(c,s){s=s||this.as;var p=s.root,y=c.$||(c.$=s.$),A=(y||"")._||v,T=c.put||"",k=T["#"],$=T["."],R=g!==T["="]?T["="]:T[":"],x=T[">"]||-1/0,E;if(g!==c.put&&(g===T["#"]||g===T["."]||g===T[":"]&&g===T["="]||g===T[">"])){if(!S(T)){if(!(k=((T||"")._||"")["#"])){console.log("chain not yet supported for",T,"...",c,s);return}return y=s.root.$.get(k),setTimeout.each(Object.keys(T).sort(),function(b){b=="_"||g===(x=m(T,b))||s.on("in",{$:y,put:{"#":k,".":b,"=":T[b],">":x},VIA:c})})}s.on("in",{$:A.back.$,put:{"#":k=A.back.soul,".":$=A.has||A.get,"=":T,">":m(A.back.put,$)},via:c});return}(c.seen||"")[s.id]||((c.seen||(c.seen=function(){}))[s.id]=s,s!==A&&(Object.keys(c).forEach(function(b){T[b]=c[b]},T={}),T.get=s.get||T.get,!s.soul&&!s.has?T.$$$=T.$$$||s.$:A.soul&&(T.$=s.$,T.$$=T.$$||A.$),c=T),f(c,s),(s.soul||c.$$)&&x>=m(p.graph[k],$)&&((T=p.$.get(k)._).put=w(T.put,$,x,R,k)),!A.soul&&x>=m(p.graph[k],$)&&(E=(p.$.get(k)._.next||"")[$])&&(E.put=R,typeof(T=S(R))=="string"&&(E.put=p.$.get(T)._.put||R)),this.to&&this.to.next(c),s.any&&setTimeout.each(Object.keys(s.any),function(b){(b=s.any[b])&&b(c)},0,99),s.echo&&setTimeout.each(Object.keys(s.echo),function(b){(b=s.echo[b])&&b.on("in",c)},0,99),((c.$$||"")._||A).soul&&(E=s.next)&&(E=E[$])&&(T={},Object.keys(c).forEach(function(b){T[b]=c[b]}),T.$=(c.$$||c.$).get(T.get=$),delete T.$$,delete T.$$$,E.on("in",T)),l(c,s))}o.on.in=u;function l(c,s){if(s=s||this.as||c.$._,!(c.$$&&this!==o.on)&&!(!c.put||s.soul)){var p=c.put||"",y=p["="]||p[":"],$,A=s.root,T=A.$.get(p["#"]).get(p["."])._;if(typeof(y=S(y))!="string"){this===o.on&&((T.echo||(T.echo={}))[s.id]=s);return}if(!((T.echo||(T.echo={}))[s.id]&&!(A.pass||"")[s.id])){if($=A.pass){if($[y+s.id])return;$[y+s.id]=1}(T.echo||(T.echo={}))[s.id]=s,s.has&&(s.link=y);var k=A.$.get(T.link=y)._;(k.echo||(k.echo={}))[T.id]=T;var $=s.ask||"";($[""]||s.lex)&&k.on("out",{get:{"#":y}}),setTimeout.each(Object.keys($),function(R,x){!R||!(x=$[R])||x.on("out",{get:{"#":y,".":R}})},0,99)}}}o.on.link=l;function f(c,s){var p=c.put||"",y=g!==p["="]?p["="]:p[":"],A=s.root,T,k;if(g===y){if(s.soul&&g!==s.put||(k=(c.$$||c.$||"")._||"",c["@"]&&(g!==k.put||g!==s.put)))return;(T=s.link||c.linked)&&delete(A.$.get(T)._.echo||"")[s.id],s.has&&(s.link=null),s.put=g,setTimeout.each(Object.keys(s.next||""),function($,R){(R=s.next[$])&&(T&&delete(A.$.get(T).get($)._.echo||"")[R.id],R.on("in",{get:$,put:g,$:R.$}))},0,99);return}s.soul||c.$$||(T=S(y),k=c.$._||"",!((T===k.link||s.has&&!k.link)&&!((A.pass||"")[s.id]&&typeof T!="string"))&&(delete(k.echo||"")[s.id],f({get:s.get,put:g,$:c.$,linked:c.linked=c.linked||k.link},s)))}o.on.unlink=f;function a(c,s){var p=this.as,y=p.$._;y.root;var A=p.get||"",T=(c.put||"")[A["#"]]||"";if(!c.put||typeof A["."]=="string"&&g===T[A["."]]){if(g!==y.put||!y.soul&&!y.has)return;y.ack=(y.ack||0)+1,y.on("in",{get:y.get,put:y.put=g,$:y.$,"@":c["@"]});return}(c._||{}).miss=1,o.on.put(c)}var v={},g,h=String.random,S=o.valid,d=function(c,s){return c&&Object.prototype.hasOwnProperty.call(c,s)},_=o.state,m=_.is,w=_.ify})(t,"./chain"),t(function(r){var o=t("./root");o.chain.get=function(g,h,S){var d,_;if(typeof g=="string"){if(g.length==0)return(d=this.chain())._.err={err:o.log("0 length key!",g)},h&&h.call(d,d._.err),d;var m=this,w=m._,c=w.next||f;(d=c[g])||(d=g&&i(g,m)),d=d&&d.$}else if(typeof g=="function"){let k=function($,R,x){if(!k.stun&&!((N=p.pass)&&!N[y])){var E=$.$._,b=($.$$||"")._,O=(b||E).put,C=!E.has&&!E.soul,z={},N;if((C||v===O)&&(O=v===((N=$.put)||"")["="]?v===(N||"")[":"]?N:N[":"]:N["="]),typeof(N=o.valid(O))=="string"&&(O=v===(N=p.$.get(N)._.put)?s.not?v:O:N),!(s.not&&v===O)){if(v===s.stun){if((N=p.stun)&&N.on&&(w.$.back(function(j){if(N.on(""+j.id,z={}),(z.run||0)<k.id)return z}),!z.run&&N.on(""+E.id,z={}),!z.run&&b&&N.on(""+b.id,z={}),k.id>z.run&&((!z.stun||z.stun.end)&&(z.stun=N.on("stun"),z.stun=z.stun&&z.stun.last),z.stun&&!z.stun.end))){(z.stun.add||(z.stun.add={}))[y]=function(){k($,R,1)};return}if(v===O&&(x=0),(N=p.hatch)&&!N.end&&v===s.hatch&&!x){if(A[E.$._.id])return;A[E.$._.id]=1,N.push(function(){k($,R,1)});return}A={}}if(p.pass){if(p.pass[y+E.id])return;p.pass[y+E.id]=1}if(s.on){s.ok.call(E.$,O,E.get,$,R||k);return}if(s.v2020){s.ok($,R||k);return}Object.keys($).forEach(function(j){N[j]=$[j]},N={}),$=N,$.put=O,s.ok.call(s.as,$,R||k)}}};if(h===!0)return u(this,g,h,S),this;d=this;var w=d._,s=h||{},p=w.root,y;s.at=w,s.ok=g;var A={};return k.at=w,(w.any||(w.any={}))[y=String.random(7)]=k,k.off=function(){k.stun=1,w.any&&delete w.any[y]},k.rid=l,k.id=s.run||++p.once,_=p.pass,(p.pass={})[y]=1,s.out=s.out||{get:{}},w.on("out",s.out),p.pass=_,d}else{if(typeof g=="number")return this.get(""+g,h,S);if(typeof(_=a(g))=="string")return this.get(_,h,S);(_=this.get.next)&&(d=_(this,g))}return d?(h&&typeof h=="function"&&d.get(h,S),d):((d=this.chain())._.err={err:o.log("Invalid get request!",g)},h&&h.call(d,d._.err),d)};function i(g,h){var S=h._,d=S.next,_=h.chain(),m=_._;return d||(d=S.next={}),d[m.get=g]=m,h===S.root.$?m.soul=g:(S.soul||S.has)&&(m.has=g),m}function u(g,h,S,d){var _=g._,m=0,w;return(w=_.soul||_.link)?h(w,d,_):_.jam?_.jam.push([h,d]):(_.jam=[[h,d]],g.get(function(s,p){if(!(v===s.put&&!_.root.opt.super&&(w=Object.keys(_.root.opt.peers).length)&&++m<=w)){p.rid(s);var y=(y=s.$)&&y._||{},A=0,T;for(w=_.jam,delete _.jam;T=w[A++];){var k=T[0];T=T[1],k&&k(y.link||y.soul||o.valid(s.put)||((s.put||{})._||{})["#"],T,s,p)}}},{out:{get:{".":!0}}}),g)}function l(g){var h=this.at||this.on;if(!g||h.soul||h.has)return this.off();if(g=(g=(g=g.$||g)._||g).id){h.map;var S;if((S=this.seen||(this.seen={}))[g])return!0;S[g]=!0}}var f={},a=o.valid,v})(t,"./get"),t(function(r){var o=t("./root");o.chain.put=function(d,_,m){var w=this,c=w._,s=c.root;m=m||{},m.root=c.root,m.run||(m.run=s.once),i(m,c.id),m.ack=m.ack||_,m.via=m.via||w,m.data=m.data||d,m.soul||(m.soul=c.soul||typeof _=="string"&&_);var p=m.state=m.state||o.state();return typeof d=="function"?(d(function(y){m.data=y,w.put(a,a,m)}),w):m.soul?(m.$=s.$.get(m.soul),m.todo=[{it:m.data,ref:m.$}],m.turn=m.turn||g,m.ran=m.ran||u,function y(){var A=m.todo,T=A.pop(),k=T.it;T.ref&&T.ref._.id;var $,R,x,E,b;if(i(m,T.ref),(E=T.todo)&&(R=E.pop(),k=k[R],E.length&&A.push(T)),R&&(A.path||(A.path=[])).push(R),!($=h(k))&&!(b=o.is(k))){if(!Object.plain(k)){u.err(m,"Invalid data: "+f(k)+" at "+(m.via.back(function(N){N.get&&E.push(N.get)},E=[])||E.join("."))+"."+(A.path||[]).join("."));return}for(var O=m.seen||(m.seen=[]),C=O.length;C--;)if(k===(E=O[C]).it){$=k=E.link;break}}if(R&&$)T.node=S(T.node,R,p,k);else{let N=function(j,D){var Z=x.link["#"];D&&(D.off(),D.rid(j));var U=Z||j.soul||(E=(j.$$||j.$)._||"").soul||E.link||((E=E.put||"")._||"")["#"]||E["#"]||((E=j.put||"")&&j.$$?E["#"]:(E["="]||E[":"]||"")["#"]);if(!Z&&i(m,j.$),!U&&!T.link["#"]){(T.wait||(T.wait=[])).push(function(){N(j,D)});return}U||(U=[],(j.$$||j.$).back(function(F){if(E=F.soul||F.link)return U.push(E);U.push(F.get)}),U=U.reverse().join("/")),x.link["#"]=U,!b&&(((m.graph||(m.graph={}))[U]=x.node||(x.node={_:{}}))._["#"]=U),delete m.wait[z],x.wait&&setTimeout.each(x.wait,function(F){F&&F()}),m.ran(m)};if(!m.seen){u.err(m,"Data at root of graph must be a node (an object).");return}m.seen.push(x={it:k,link:{},todo:b?[]:Object.keys(k).sort().reverse(),path:(A.path||[]).slice(),up:T}),T.node=S(T.node,R,p,x.link),!b&&x.todo.length&&A.push(x);var z=m.seen.length;(m.wait||(m.wait={}))[z]="",E=(x.ref=b?k:R?T.ref.get(R):T.ref)._,(E=k&&(k._||"")["#"]||E.soul||E.link)?N({soul:E}):x.ref.get(N,{run:m.run,v2020:1,out:{get:{".":" "}}})}if(!A.length)return m.ran(m);m.turn(y)}(),w):(l(m),w)};function i(d,_){if(_){_=(_._||"").id||_;var m=d.root.stun||(d.root.stun={on:o.on}),w={},c;d.stun||(d.stun=m.on("stun",function(){})),(c=m.on(""+_))&&c.the.last.next(w),!(w.run>=d.run)&&m.on(""+_,function(s){if(d.stun.end){this.off(),this.to.next(s);return}s.run=s.run||d.run,s.stun=s.stun||d.stun})}}function u(d){if(d.err){u.end(d.stun,d.root);return}if(!(d.todo.length||d.end||!Object.empty(d.wait))){d.end=1;var _=d.$.back(-1)._,m=_.root,w=_.ask(function(y){m.on("ack",y),y.err&&!y.lack&&o.log(y),++c>(d.acks||0)&&this.off(),d.ack&&d.ack(y,this)},d.opt),c=0,s=d.stun,p;(p=function(){s&&(u.end(s,m),setTimeout.each(Object.keys(s=s.add||""),function(y){(y=s[y])&&y()}))}).hatch=p,d.ack&&!d.ok&&(d.ok=d.acks||9),d.via._.on("out",{put:d.out=d.graph,ok:d.ok&&{"@":d.ok+1},opt:d.opt,"#":w,_:p})}}u.end=function(d,_){d.end=v,d.the.to===d&&d===d.the.last&&delete _.stun,d.off()},u.err=function(d,_){(d.ack||v).call(d,d.out={err:d.err=o.log(_)}),d.ran(d)};function l(d){var _=d.via._,m;d.via=d.via.back(function(w){if(w.soul||!w.get)return w.$;m=d.data,(d.data={})[w.get]=m}),(!d.via||!d.via._.soul)&&(d.via=_.root.$.get(((d.data||"")._||"")["#"]||_.$.back("opt.uuid")())),d.via.put(d.data,d.ack,d)}function f(d,_){return d&&(_=d.constructor)&&_.name||typeof d}var a,v=function(){},g=setTimeout.turn,h=o.valid,S=o.state.ify})(t,"./put"),t(function(r){var o=t("./root");t("./chain"),t("./back"),t("./put"),t("./get"),r.exports=o})(t,"./index"),t(function(r){var o=t("./index");o.chain.on=function(l,f,a,v){var g=this,h=g._;h.root;var S;if(typeof l=="string")return f?(S=h.on(l,f,a||h,v),a&&a.$&&(a.subs||(a.subs=[])).push(S),g):h.on(l);var d=f;return(d=d===!0?{change:!0}:d||{}).not=1,d.on=1,g.get(l,d),g},o.chain.once=function(l,f){if(f=f||{},!l)return i(this);var a=this,v=a._,g=v.root;v.put;var h=String.random(7),S;return a.get(function(d,_,m,w){var c=this,s=c._,p=s.one||(s.one={});if(w.stun||p[h]==="")return;if((S=o.valid(d))===!0){y();return}if(typeof S=="string")return;clearTimeout((v.one||"")[h]),clearTimeout(p[h]),p[h]=setTimeout(y,f.wait||99);function y(A){if(!s.has&&!s.soul&&(s={put:d,get:_}),u===(S=s.put)&&(S=((m.$$||"")._||"").put),typeof o.valid(S)=="string"&&(S=g.$.get(S)._.put,S===u&&!A)){p[h]=setTimeout(function(){y(1)},f.wait||99);return}w.stun||p[h]!==""&&(p[h]="",(v.soul||v.has)&&w.off(),l.call(c,S,s.get),clearTimeout(p[h]))}},{on:1}),a};function i(l,f,a){return o.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(a=l.chain())._.nix=l.once(function(v,g){a._.on("in",this._)}),a._.lex=l._.lex,a}o.chain.off=function(){var l=this,f=l._,a,v=f.back;if(v)return f.ack=0,(a=v.next)&&a[f.get]&&delete a[f.get],(a=v.any)&&(delete v.any,v.any={}),(a=v.ask)&&delete a[f.get],(a=v.put)&&delete a[f.get],(a=f.soul)&&delete v.root.graph[a],(a=f.map)&&Object.keys(a).forEach(function(g,h){h=a[g],h.link&&v.root.$.get(h.link).off()}),(a=f.next)&&Object.keys(a).forEach(function(g,h){h=a[g],h.$.off()}),f.on("off",{}),l};var u})(t,"./on"),t(function(r){var o=t("./index"),i=o.chain.get.next;o.chain.get.next=function(a,v){var g;return Object.plain(v)?(g=((g=v["#"])||"")["="]||g)?a.get(g):((g=a.chain()._).lex=v,a.on("in",function(h){String.match(h.get||(h.put||"")["."],v["."]||v["#"]||v)&&g.on("in",h),this.to.next(h)}),g.$):(i||l)(a,v)},o.chain.map=function(a,v,g){var h=this,S=h._,d,_;return Object.plain(a)&&(d=a["."]?a:{".":a},a=f),a?(o.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),_=h.chain(),h.map().on(function(m,w,c,s){var p=(a||l).call(this,m,w,c,s);if(f!==p){if(m===p)return _._.on("in",c);if(o.is(p))return _._.on("in",p._);var y={};Object.keys(c.put).forEach(function(A){y[A]=c.put[A]},y),y["="]=p,_._.on("in",{get:w,put:y})}}),_):((_=S.each)||((S.each=_=h.chain())._.lex=d||_._.lex||S.lex,_._.nix=h.back("nix"),h.on("in",u,_._)),_)};function u(a){this.to.next(a);var v=this.as,g=a.$,h=g._,S=a.put,d;!h.soul&&!a.$$||(d=v.lex)&&!String.match(a.get||(S||"")["."],d["."]||d["#"]||d)||o.on.link(a,v)}var l=function(){},f})(t,"./map"),t(function(r){var o=t("./index");o.chain.set=function(i,u,l){var f=this,a=f.back(-1),v,g;return u=u||function(){},l=l||{},l.item=l.item||i,(v=((i||"")._||"")["#"])&&((i={})["#"]=v),typeof(g=o.valid(i))=="string"?f.get(v=g).put(i,u,l):o.is(i)?(f.put(function(h){i.get(function(S,d,_){if(!S)return u.call(f,{err:o.log('Only a node can be linked! Not "'+_.put+'"!')});(g={})[S]={"#":S},h(g)},!0)}),i):(Object.plain(i)&&(i=a.get(v=f.back("opt.uuid")()).put(i)),f.get(v||a.back("opt.uuid")(7)).put(i,u,l))}})(t,"./set"),t(function(r){t("./shim");var o=function(){},i=JSON.parseAsync||function(a,v,g){var h,S=+new Date;try{v(h,JSON.parse(a,g),u.sucks(+new Date-S))}catch(d){v(d)}},u=JSON.stringifyAsync||function(a,v,g,h){var S,d=+new Date;try{v(S,JSON.stringify(a,g,h),u.sucks(+new Date-d))}catch(_){v(_)}};u.sucks=function(a){a>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),u.sucks=o)};function l(a){var v=function(){},g=a.opt||{};g.log=g.log||console.log,g.gap=g.gap||g.wait||0,g.max=g.max||(g.memory?g.memory*999*999:3e8)*.3,g.pack=g.pack||g.max*.01*.01,g.puff=g.puff||9;var h=setTimeout.turn||setTimeout,S=a.dup,d=S.check,_=S.track,m=v.hear=function(s,p){if(s){if(g.max<=s.length)return v.say({dam:"!",err:"Message too big!"},p);v===this&&(m.d+=s.length||0,++m.c);var y=p.SH=+new Date,A=s[0],T;if(A==="["){i(s,function(k,$){if(k||!$)return v.say({dam:"!",err:"DAM JSON parse error."},p);console.STAT&&console.STAT(+new Date,$.length,"# on hear batch");var R=g.puff;(function x(){for(var E=+new Date,b=0,O;b<R&&(O=$[b++]);)v.hear(O,p);$=$.slice(b),console.STAT&&console.STAT(E,+new Date-E,"hear loop"),w(p),$.length&&h(x,0)})()}),s="";return}if(A==="{"||(s["#"]||Object.plain(s))&&(T=s)){if(T)return m.one(T,p,y);i(s,function(k,$){if(k||!$)return v.say({dam:"!",err:"DAM JSON parse error."},p);m.one($,p,y)});return}}};m.one=function(s,p,x){var A,T,k,$,R;if(s.DBG&&(s.DBG=R={DBG:s.DBG}),R&&(R.h=x),R&&(R.hp=+new Date),(A=s["#"])||(A=s["#"]=String.random(9)),!(k=d(A))&&(T=s["##"],!(T&&(k=s["@"]||s.get&&A)&&S.check($=k+T)))){if((s._=function(){}).via=v.leap=p,(k=s["><"])&&typeof k=="string"&&k.slice(0,99).split(",").forEach(function(E){this[E]=1},s._.yo={}),k=s.dam){(k=v.hear[k])&&k(s,p,a),_(A);return}(k=s.ok)&&(s._.near=k["/"]);var x=+new Date;R&&(R.is=x),p.SI=A,_.ed=function(E){A===E&&(_.ed=0,(E=S.s[A])&&(E.via=p,s.get&&(E.it=s)))},a.on("in",v.last=s),R&&(R.hd=+new Date),console.STAT&&console.STAT(x,+new Date-x,s.get?"msg get":s.put?"msg put":"msg"),_(A),$&&_($),v.leap=v.last=null}},m.c=m.d=0,function(){var s=0,p;v.hash=function(T,k){var $,R,x,E=+new Date;u(T.put,function b(O,C){var z=(R||(R=x=C||"")).slice(0,32768);if($=String.hash(z,$),R=R.slice(32768),R){h(b,0);return}console.STAT&&console.STAT(E,+new Date-E,"say json+hash"),T._.$put=x,T["##"]=$,v.say(T,k),delete T._.$put},y)};function y(T,k){var $;return k instanceof Object?(Object.keys(k).sort().forEach(A,{to:$={},on:k}),$):k}function A(T){this.to[T]=this.on[T]}v.say=function(T,k){var $;if(($=this)&&($=$.to)&&$.next&&$.next(T),!T)return!1;var R,x,E,b=T["@"],O=T._||(T._=function(){}),C=T.DBG,z=+new Date;if(O.y=O.y||z,k||C&&(C.y=z),(R=T["#"])||(R=T["#"]=String.random(9)),!p&&_(R),!(x=T["##"])&&f!==T.put&&!O.via&&b){v.hash(T,k);return}if(!k&&b&&(k=($=S.s[b])&&($.via||($=$.it)&&($=$._)&&$.via)||($=v.last)&&b===$["#"]&&v.leap),!k&&b)return S.s[b]?void 0:(console.STAT&&console.STAT(+new Date,++s,"total no peer to ack to"),!1);if(b&&!T.put&&!x&&((S.s[b]||"").it||"")["##"])return!1;if(!k&&v.way)return v.way(T);if(C&&(C.yh=+new Date),!(E=O.raw)){v.raw(T,k);return}if(C&&(C.yr=+new Date),!k||!k.id){if(!Object.plain(k||g.peers))return!1;var z=+new Date;g.puff;var N=g.peers,j=Object.keys(k||g.peers||{});console.STAT&&console.STAT(z,+new Date-z,"peer keys"),function U(){var F=+new Date;p=1;var W=O.raw;O.raw=E;for(var J=0,ee;J<9&&(ee=(j||"")[J++]);)(ee=N[ee]||(k||"")[ee])&&v.say(T,ee);O.raw=W,p=0,j=j.slice(J),console.STAT&&console.STAT(F,+new Date-F,"say loop"),j.length&&(h(U,0),b&&_(b))}();return}if(!k.wire&&v.wire&&v.wire(k),R!==k.last){if(k.last=R,k===O.via||($=O.yo)&&($[k.url]||$[k.pid]||$[k.id]))return!1;if(console.STAT&&console.STAT(z,((C||O).yp=+new Date)-(O.y||z),"say prep"),!p&&b&&_(b),k.batch){if(k.tail=($=k.tail||0)+E.length,k.tail<=g.pack){k.batch+=($?",":"")+E;return}w(k)}k.batch="[";var D=+new Date;setTimeout(function(){console.STAT&&console.STAT(D,+new Date-D,"0ms TO"),w(k)},g.gap),c(E,k),console.STAT&&b===k.SI&&console.STAT(z,+new Date-k.SH,"say ack")}},v.say.c=v.say.d=0,v.raw=function(T,k){if(!T)return"";var $=T._||{},R,x;if(x=$.raw)return x;if(typeof T=="string")return T;var E=T["##"],b=T["@"];if(E&&b){if(!$.via&&d(b+E))return!1;if(x=(S.s[b]||"").it){if(E===x["##"])return!1;x["##"]||(x["##"]=E)}}if(!T.dam&&!T["@"]){var O=0,C=[];x=g.peers;for(var z in x){var N=x[z];if(C.push(N.url||N.pid||N.id),++O>6)break}O>1&&(T["><"]=C.join())}if(T.put&&(x=T.ok)&&(T.ok={"@":(x["@"]||1)-1,"/":x["/"]==T._.near?v.near:x["/"]}),R=$.$put){x={},Object.keys(T).forEach(function(D){x[D]=T[D]}),x.put=":])([:",u(x,function(D,Z){if(!D){var U=+new Date;x=Z.indexOf('"put":":])([:"'),j(f,Z=Z.slice(0,x+6)+R+Z.slice(x+14)),console.STAT&&console.STAT(U,+new Date-U,"say slice")}});return}u(T,j);function j(D,Z){D||($.raw=Z,v.say(T,k))}}}();function w(s){var p=s.batch,y=typeof p=="string";if(y&&(p+="]"),s.batch=s.tail=null,!!p&&!(y?3>p.length:!p.length)){if(!y)try{p=p.length===1?p[0]:JSON.stringify(p)}catch(A){return g.log("DAM JSON stringify error",A)}p&&c(p,s)}}function c(s,p){try{var y=p.wire;p.say?p.say(s):y.send&&y.send(s),v.say.d+=s.length||0,++v.say.c}catch{(p.queue=p.queue||[]).push(s)}}return v.near=0,v.hi=function(s){var p=s.wire,y;if(!p){v.wire(s.length&&{url:s,id:s}||s);return}s.id?g.peers[s.url||s.id]=s:(y=s.id=s.id||s.url||String.random(9),v.say({dam:"?",pid:a.opt.pid},g.peers[y]=s),delete S.s[s.last]),s.met||(v.near++,s.met=+new Date,a.on("hi",s)),y=s.queue,s.queue=[],setTimeout.each(y||[],function(A){c(A,s)},0,9)},v.bye=function(s){s.met&&--v.near,delete s.met,a.on("bye",s);var p=+new Date;p=p-(s.met||p),v.bye.time=((v.bye.time||p)+p)/2},v.hear["!"]=function(s,p){g.log("Error:",s.err)},v.hear["?"]=function(s,p){s.pid&&(p.pid||(p.pid=s.pid),s["@"])||(v.say({dam:"?",pid:g.pid,"@":s["#"]},p),delete S.s[p.last])},v.hear.mob=function(s,p){if(s.peers){var y=Object.keys(s.peers),A=y[Math.random()*y.length>>0];A&&(v.bye(p),v.hi(A))}},a.on("create",function(s){s.opt.pid=s.opt.pid||String.random(9),this.to.next(s),s.on("out",v.say)}),a.on("bye",function(s,p){s=g.peers[s.id||s]||s,this.to.next(s),s.bye?s.bye():(p=s.wire)&&p.close&&p.close(),delete g.peers[s.id],s.wire=null}),a.on("bye",function(s,p){this.to.next(s),(p=console.STAT)&&(p.peers=v.near),(p=s.url)&&setTimeout(function(){},g.lack||9e3)}),a.on("hi",function(s,p){if(this.to.next(s),(p=console.STAT)&&(p.peers=v.near),!g.super){var y=Object.keys(a.next||"");y.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(y,function(A){var T=a.next[A];if(g.super||(T.ask||"")[""]){v.say({get:{"#":A}},s);return}setTimeout.each(Object.keys(T.ask||""),function(k){k&&v.say({"##":String.hash((a.graph[A]||"")[k]),get:{"#":A,".":k}},s)})})}}),v}var f;try{r.exports=l}catch{}})(t,"./mesh"),t(function(r){var o=t("./index");o.Mesh=t("./mesh"),o.on("opt",function(u){if(this.to.next(u),u.once)return;var l=u.opt;if(l.WebSocket===!1)return;var f=o.window||{},a=l.WebSocket||f.WebSocket||f.webkitWebSocket||f.mozWebSocket;if(!a)return;l.WebSocket=a;var v=l.mesh=l.mesh||o.Mesh(u);v.wire||l.wire,v.wire=l.wire=g;function g(_){try{if(!_||!_.url)return w&&w(_);var m=_.url.replace(/^http/,"ws"),w=_.wire=new l.WebSocket(m);return w.onclose=function(){S(_),l.mesh.bye(_)},w.onerror=function(c){S(_)},w.onopen=function(){l.mesh.hi(_)},w.onmessage=function(c){c&&l.mesh.hear(c.data||c,_)},w}catch{l.mesh.bye(_)}}setTimeout(function(){!l.super&&u.on("out",{dam:"hi"})},1);var h=2*999;function S(_){clearTimeout(_.defer),l.peers[_.url]&&(d&&_.retry<=0||(_.retry=(_.retry||l.retry+1||60)-(-_.tried+(_.tried=+new Date)<h*4?1:0),_.defer=setTimeout(function m(){if(d&&d.hidden)return setTimeout(m,h);g(_)},h)))}var d=""+i!=typeof document&&document});var i})(t,"./websocket"),t(function(r){if(!(typeof Gun>"u")){var o=function(){},i;try{i=(Gun.window||o).localStorage}catch{}i||(Gun.log("Warning: No localStorage exists to persist data to!"),i={setItem:function(l,f){this[l]=f},removeItem:function(l){delete this[l]},getItem:function(l){return this[l]}});var u=JSON.stringifyAsync||function(l,f,a,v){var g;try{f(g,JSON.stringify(l,a,v))}catch(h){f(h)}};Gun.on("create",function l(f){this.to.next(f);var a=f.opt;f.graph;var v=[],g,h,S,d;if(a.localStorage===!1)return;a.prefix=a.file||"gun/";try{g=l[a.prefix]=l[a.prefix]||JSON.parse(S=i.getItem(a.prefix))||{}}catch{g=l[a.prefix]={}}S=(S||"").length,f.on("get",function(m){this.to.next(m);var w=m.get,c,s,p,y;!w||!(c=w["#"])||(s=g[c]||y,s&&(p=w["."])&&!Object.plain(p)&&(s=Gun.state.ify({},p,Gun.state.is(s,p),s[p],c)),Gun.on.get.ack(m,s))}),f.on("put",function(m){this.to.next(m);var w=m.put,c=w["#"],s=w["."],p=m["#"],y=m.ok||"";if(g[c]=Gun.state.ify(g[c],s,w[">"],w[":"],c),d&&S>4999880){f.on("in",{"@":p,err:"localStorage max!"});return}!m["@"]&&(!m._.via||Math.random()<y["@"]/y["/"])&&v.push(p),!h&&(h=setTimeout(_,9+S/333))});function _(){if(!v.length&&((setTimeout.turn||"").s||"").length){setTimeout(_,99);return}var m=v;clearTimeout(h),h=!1,v=[],u(g,function(w,c){try{!w&&i.setItem(a.prefix,c)}catch(s){w=d=s||"localStorage failure"}w&&(Gun.log(w+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),f.on("localStorage:error",{err:w,get:a.prefix,put:g})),S=c.length,setTimeout.each(m,function(s){f.on("in",{"@":s,err:w,ok:0})},0,99)})}})}})(t,"./localStorage")})(),function(){var x;if(""+x!=typeof Gun){var t=function(E){console.warn("Warning! Deprecated internal utility will break in next version:",E)},n=Gun;n.fn=n.fn||{is:function(E){return t("fn"),!!E&&typeof E=="function"}},n.bi=n.bi||{is:function(E){return t("bi"),E instanceof Boolean||typeof E=="boolean"}},n.num=n.num||{is:function(E){return t("num"),!r(E)&&(E-parseFloat(E)+1>=0||E===1/0||E===-1/0)}},n.text=n.text||{is:function(E){return t("text"),typeof E=="string"}},n.text.ify=n.text.ify||function(E){return t("text.ify"),n.text.is(E)?E:typeof JSON<"u"?JSON.stringify(E):E&&E.toString?E.toString():E},n.text.random=n.text.random||function(E,b){t("text.random");var O="";for(E=E||24,b=b||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";E>0;)O+=b.charAt(Math.floor(Math.random()*b.length)),E--;return O},n.text.match=n.text.match||function(E,b){var O,C;return t("text.match"),typeof E!="string"?!1:(typeof b=="string"&&(b={"=":b}),b=b||{},O=b["="]||b["*"]||b[">"]||b["<"],E===O?!0:C!==b["="]?!1:(O=b["*"]||b[">"]||b["<"],E.slice(0,(O||"").length)===O?!0:C!==b["*"]?!1:C!==b[">"]&&C!==b["<"]?E>=b[">"]&&E<=b["<"]:C!==b[">"]&&E>=b[">"]||C!==b["<"]&&E<=b["<"]))},n.text.hash=n.text.hash||function(E,b){if(t("text.hash"),typeof E=="string"){if(b=b||0,!E.length)return b;for(var O=0,C=E.length,z;O<C;++O)z=E.charCodeAt(O),b=(b<<5)-b+z,b|=0;return b}},n.list=n.list||{is:function(E){return t("list"),E instanceof Array}},n.list.slit=n.list.slit||Array.prototype.slice,n.list.sort=n.list.sort||function(E){return t("list.sort"),function(b,O){return!b||!O?0:(b=b[E],O=O[E],b<O?-1:b>O?1:0)}},n.list.map=n.list.map||function(E,b,O){return t("list.map"),$(E,b,O)},n.list.index=1,n.obj=n.boj||{is:function(E){return t("obj"),E?E instanceof Object&&E.constructor===Object||Object.prototype.toString.call(E).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},n.obj.put=n.obj.put||function(E,b,O){return t("obj.put"),(E||{})[b]=O,E},n.obj.has=n.obj.has||function(E,b){return t("obj.has"),E&&Object.prototype.hasOwnProperty.call(E,b)},n.obj.del=n.obj.del||function(E,b){if(t("obj.del"),!!E)return E[b]=null,delete E[b],E},n.obj.as=n.obj.as||function(E,b,O,C){return t("obj.as"),E[b]=E[b]||(C===O?{}:O)},n.obj.ify=n.obj.ify||function(E){if(t("obj.ify"),p(E))return E;try{E=JSON.parse(E)}catch{E={}}return E},function(){var E;function b(O,C){A(this,C)&&E!==this[C]||(this[C]=O)}n.obj.to=n.obj.to||function(O,C){return t("obj.to"),C=C||{},$(O,b,C),C}}(),n.obj.copy=n.obj.copy||function(E){return t("obj.copy"),E&&JSON.parse(JSON.stringify(E))},function(){function E(b,O){var C=this.n,z;if(!(C&&(O===C||p(C)&&A(C,O)))&&z!==O)return!0}n.obj.empty=n.obj.empty||function(b,O){return t("obj.empty"),b?!$(b,E,{n:O}):!0}}(),function(){function E(C,z){if(arguments.length===2){E.r=E.r||{},E.r[C]=z;return}E.r=E.r||[],E.r.push(C)}var b=Object.keys,O;Object.keys=Object.keys||function(C){return O(C,function(z,N,j){j(N)})},n.obj.map=O=n.obj.map||function(C,z,N){t("obj.map");var j,D=0,Z,U,F,W,J=typeof z=="function";if(E.r=j,b&&p(C)&&(F=b(C),W=!0),N=N||{},r(C)||F)for(Z=(F||C).length;D<Z;D++){var ee=D+n.list.index;if(J){if(U=W?z.call(N,C[F[D]],F[D],E):z.call(N,C[D],ee,E),U!==j)return U}else if(z===C[W?F[D]:D])return F?F[D]:ee}else for(D in C)if(J){if(A(C,D)&&(U=N?z.call(N,C[D],D,E):z(C[D],D,E),U!==j))return U}else if(z===C[D])return D;return J?E.r:n.list.index?0:-1}}(),n.time=n.time||{},n.time.is=n.time.is||function(E){return t("time"),E?E instanceof Date:+new Date().getTime()};var c=n.fn.is,r=n.list.is,s=n.obj,p=s.is,A=s.has,$=s.map,o={};o.is=function(E){return t("val.is"),E===x?!1:E===null?!0:E===1/0?!1:l(E)||u(E)||d(E)?!0:o.link.is(E)||!1},o.link=o.rel={_:"#"},function(){o.link.is=function(b){if(t("val.link.is"),b&&b[i]&&!b._&&p(b)){var O={};if($(b,E,O),O.id)return O.id}return!1};function E(b,O){var C=this;if(C.id)return C.id=!1;if(O==i&&l(b))C.id=b;else return C.id=!1}}(),o.link.ify=function(E){return t("val.link.ify"),k({},i,E)},n.obj.has._=".";var i=o.link._,x,u=n.bi.is,d=n.num.is,l=n.text.is,s=n.obj,p=s.is,k=s.put,$=s.map;n.val=n.val||o;var f={_:"_"};f.soul=function(E,b){return t("node.soul"),E&&E._&&E._[b||g]},f.soul.ify=function(E,b){return t("node.soul.ify"),b=typeof b=="string"?{soul:b}:b||{},E=E||{},E._=E._||{},E._[g]=b.soul||E._[g]||v(),E},f.soul._=o.link._,function(){f.is=function(b,O,C){t("node.is");var z;return p(b)&&(z=f.soul(b))?!$(b,E,{as:C,cb:O,s:z,n:b}):!1};function E(b,O){if(O!==f._){if(!o.is(b))return!0;this.cb&&this.cb.call(this.as,b,O,this.n,this.s)}}}(),function(){f.ify=function(b,O,C){return t("node.ify"),O?typeof O=="string"?O={soul:O}:typeof O=="function"&&(O={map:O}):O={},O.map&&(O.node=O.map.call(C,b,x,O.node||{})),(O.node=f.soul.ify(O.node||{},O))&&$(b,E,{o:O,as:C}),O.node};function E(b,O){var C=this.o,z,N;if(C.map){z=C.map.call(this.as,b,""+O,C.node),N===z?y(C.node,O):C.node&&(C.node[O]=z);return}o.is(b)&&(C.node[O]=b)}}();var s=n.obj,p=s.is,y=s.del,$=s.map,a=n.text,v=a.random,g=f.soul._,x;n.node=n.node||f;var h=n.state;h.lex=function(){return t("state.lex"),h().toString(36).replace(".","")},h.to=function(E,b,O){t("state.to");var C=(E||{})[b];return p(C)&&(C=R(C)),h.ify(O,b,h.is(E,b),C,f.soul(E))},function(){h.map=function(b,O,C){t("state.map");var z,N=p(N=b||O)?N:null;return b=c(b=b||O)?b:null,N&&!b?(O=d(O)?O:h(),N[m]=N[m]||{},$(N,E,{o:N,s:O}),N):(C=C||p(O)?O:z,O=d(O)?O:h(),function(j,D,Z,U){if(!b)return E.call({o:Z,s:O},j,D),j;b.call(C||this||{},j,D,Z,U),!(A(Z,D)&&z===Z[D])&&E.call({o:Z,s:O},j,D)})};function E(b,O){m!==O&&h.ify(this.o,O,this.s)}}();var s=n.obj;s.as;var A=s.has,p=s.is,$=s.map,R=s.copy,S=n.num,d=S.is,_=n.fn,c=_.is,m=f._,x,w={};(function(){w.is=function(O,C,z,N){return t("graph.is"),!O||!p(O)||T(O)?!1:!$(O,E,{cb:C,fn:z,as:N})};function E(O,C){if(!O||C!==f.soul(O)||!f.is(O,this.fn,this.as))return!0;this.cb&&(b.n=O,b.as=this.as,this.cb.call(b.as,O,C,b))}function b(O){O&&f.is(b.n,O,b.as)}})(),function(){w.ify=function(N,j,D){t("graph.ify");var Z={path:[],obj:N};return j?typeof j=="string"?j={soul:j}:typeof j=="function"&&(j.map=j):j={},typeof D=="string"&&(j.soul=j.soul||D,D=x),j.soul&&(Z.link=o.link.ify(j.soul)),j.shell=(D||{}).shell,j.graph=j.graph||{},j.seen=j.seen||[],j.as=j.as||D,E(j,Z),j.root=Z.node,j.graph};function E(N,j){var D;return(D=z(N,j))?D:(j.env=N,j.soul=O,f.ify(j.obj,b,j)&&(j.link=j.link||o.link.ify(f.soul(j.node)),j.obj!==N.shell&&(N.graph[o.link.is(j.link)]=j.node)),j)}function b(N,j,D){var Z=this,U=Z.env,F,W;if(f._===j&&A(N,o.link._))return D._;if(F=C(N,j,D,Z,U)){if(j||(Z.node=Z.node||D||{},A(N,f._)&&f.soul(N)&&(Z.node._=R(N._)),Z.node=f.soul.ify(Z.node,o.link.is(Z.link)),Z.link=Z.link||o.link.ify(f.soul(Z.node))),(W=U.map)&&(W.call(U.as||{},N,j,D,Z),A(D,j))){if(N=D[j],x===N){y(D,j);return}if(!(F=C(N,j,D,Z,U)))return}if(!j)return Z.node;if(F===!0)return N;if(W=E(U,{obj:N,path:Z.path.concat(j)}),!!W.node)return W.link}}function O(N){var j=this,D=o.link.is(j.link),Z=j.env.graph;j.link=j.link||o.link.ify(N),j.link[o.link._]=N,j.node&&j.node[f._]&&(j.node[f._][o.link._]=N),A(Z,D)&&(Z[N]=Z[D],y(Z,D))}function C(N,j,D,Z,U){var F;if(o.is(N))return!0;if(p(N))return 1;if(F=U.invalid)return N=F.call(U.as||{},N,j,D),C(N,j,D,Z,U);U.err="Invalid value at '"+Z.path.concat(j).join(".")+"'!",n.list.is(N)&&(U.err+=" Use `.set(item)` instead of an Array.")}function z(N,j){for(var D=N.seen,Z=D.length,U;Z--;)if(U=D[Z],j.obj===U.obj)return U;D.push(j)}}(),w.node=function(E){t("graph.node");var b=f.soul(E);if(b)return k({},b,E)},function(){w.to=function(b,O,C){if(t("graph.to"),!!b){var z={};return C=C||{seen:{}},$(b[O],E,{obj:z,graph:b,opt:C}),z}};function E(b,O){var C,z;if(f._===O){if(T(b,o.link._))return;this.obj[O]=R(b);return}if(!(C=o.link.is(b))){this.obj[O]=b;return}if(z=this.opt.seen[C]){this.obj[O]=z;return}this.obj[O]=this.opt.seen[C]=w.to(this.graph,C,this.opt)}}();var c=n.fn.is,s=n.obj,p=s.is,y=s.del,A=s.has,T=s.empty,k=s.put,$=s.map,R=s.copy,x;n.graph=n.graph||w}}()}(Qe)),Qe.exports}var kt,Zn;function rc(){return Zn||(Zn=1,kt=ke()),kt}var oc=rc();const It=Jt(oc);var et={exports:{}};et.exports;var Pn;function ic(){return Pn||(Pn=1,function(e){(function(){function t(r,o){return o?en(r):r.slice?t[i(r)]:function(u,l){r(u={exports:{}}),t[i(l)]=u.exports};function i(u){return u.split("/").slice(-1).toString().replace(".js","")}}var n=e;t(function(r){typeof self<"u"&&(r.window=self),typeof window<"u"&&(r.window=window);var o=r.window||r,i,u=o.SEA||{};(u.window=r.window)&&(u.window.SEA=u);try{i+""!=typeof n&&(n.exports=u)}catch{}r.exports=u})(t,"./root"),t(function(r){var o=t("./root");try{o.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(t,"./https"),t(function(r){var o;if(o+""==typeof btoa){if(o+""==typeof Buffer)try{Ie.Buffer=t("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}Ie.btoa=function(i){return Buffer.from(i,"binary").toString("base64")},Ie.atob=function(i){return Buffer.from(i,"base64").toString("binary")}}})(t,"./base64"),t(function(r){t("./base64");function o(){}Object.assign(o,{from:Array.from}),o.prototype=Object.create(Array.prototype),o.prototype.toString=function(i,u,l){i=i||"utf8",u=u||0;const f=this.length;if(i==="hex"){const a=new Uint8Array(this);return[...Array((l&&l+1||f)-u).keys()].map(v=>a[v+u].toString(16).padStart(2,"0")).join("")}if(i==="utf8")return Array.from({length:(l||f)-u},(a,v)=>String.fromCharCode(this[v+u])).join("");if(i==="base64")return btoa(this)},r.exports=o})(t,"./array"),t(function(r){t("./base64");var o=t("./array");function i(...u){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),i.from(...u)}i.prototype=Object.create(Array.prototype),Object.assign(i,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const u=arguments[0];let l;if(typeof u=="string"){const a=arguments[1]||"utf8";if(a==="hex"){const v=u.match(/([\da-fA-F]{2})/g).map(g=>parseInt(g,16));if(!v||!v.length)throw new TypeError("Invalid first argument for type 'hex'.");l=o.from(v)}else if(a==="utf8"||a==="binary"){const v=u.length,g=new Uint16Array(v);Array.from({length:v},(h,S)=>g[S]=u.charCodeAt(S)),l=o.from(g)}else if(a==="base64"){const v=atob(u),g=v.length,h=new Uint8Array(g);Array.from({length:g},(S,d)=>h[d]=v.charCodeAt(d)),l=o.from(h)}else a==="binary"?l=o.from(u):console.info("SafeBuffer.from unknown encoding: "+a);return l}if(u.byteLength,u.byteLength?u.byteLength:u.length){let a;return u instanceof ArrayBuffer&&(a=new Uint8Array(u)),o.from(a||u)}},alloc(u,l=0){return o.from(new Uint8Array(Array.from({length:u},()=>l)))},allocUnsafe(u){return o.from(new Uint8Array(Array.from({length:u})))},concat(u){if(!Array.isArray(u))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return o.from(u.reduce((l,f)=>l.concat(Array.from(f)),[]))}}),i.prototype.from=i.from,i.prototype.toString=o.prototype.toString,r.exports=i})(t,"./buffer"),t(function(r){const o=t("./root"),i={Buffer:t("./buffer")};var u={},l;if(JSON.parseAsync=JSON.parseAsync||function(a,v,g){var h;try{v(h,JSON.parse(a,g))}catch(S){v(S)}},JSON.stringifyAsync=JSON.stringifyAsync||function(a,v,g,h){var S;try{v(S,JSON.stringify(a,g,h))}catch(d){v(d)}},i.parse=function(a,v){return new Promise(function(g,h){JSON.parseAsync(a,function(S,d){S?h(S):g(d)},v)})},i.stringify=function(a,v,g){return new Promise(function(h,S){JSON.stringifyAsync(a,function(d,_){d?S(d):h(_)},v,g)})},o.window&&(i.crypto=o.window.crypto||o.window.msCrypto,i.subtle=(i.crypto||u).subtle||(i.crypto||u).webkitSubtle,i.TextEncoder=o.window.TextEncoder,i.TextDecoder=o.window.TextDecoder,i.random=a=>i.Buffer.from(i.crypto.getRandomValues(new Uint8Array(i.Buffer.alloc(a))))),!i.TextDecoder){const{TextEncoder:a,TextDecoder:v}=t((l+""==typeof n?".":"")+"./lib/text-encoding",1);i.TextDecoder=v,i.TextEncoder=a}if(!i.crypto)try{var f=t("crypto",1);Object.assign(i,{crypto:f,random:v=>i.Buffer.from(f.randomBytes(v))});const{Crypto:a}=t("@peculiar/webcrypto",1);i.ossl=i.subtle=new a({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}r.exports=i})(t,"./shim"),t(function(r){var o=t("./root"),i=t("./shim"),u={};u.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},u.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},u.ecdh={name:"ECDH",namedCurve:"P-256"},u.jwk=function(l,f){l=l.split(".");var a=l[0],v=l[1],g={kty:"EC",crv:"P-256",x:a,y:v,ext:!0};return g.key_ops=f?["sign"]:["verify"],f&&(g.d=f),g},u.keyToJwk=function(l){return{kty:"oct",k:l.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},u.recall={validity:12*60*60,hook:function(l){return l}},u.check=function(l){return typeof l=="string"&&l.slice(0,4)==="SEA{"},u.parse=async function(f){try{var a=typeof f=="string";return a&&f.slice(0,4)==="SEA{"&&(f=f.slice(3)),a?await i.parse(f):f}catch{}return f},o.opt=u,r.exports=u})(t,"./settings"),t(function(r){var o=t("./shim");r.exports=async function(i,u){var l=typeof i=="string"?i:await o.stringify(i),f=await o.subtle.digest({name:u||"SHA-256"},new o.TextEncoder().encode(l));return o.Buffer.from(f)}})(t,"./sha256"),t(function(r){const o=t("./shim"),i=o.subtle,u=o.ossl?o.ossl:i,l=f=>u.digest({name:"SHA-1"},new ArrayBuffer(f));r.exports=l})(t,"./sha1"),t(function(r){var o=t("./root"),i=t("./shim"),u=t("./settings"),l=t("./sha256"),f;o.work=o.work||(async(a,v,g,h)=>{try{var S=(v||{}).epub||v;if(h=h||{},S instanceof Function&&(g=S,S=f),a=typeof a=="string"?a:await i.stringify(a),(h.name||"").toLowerCase().slice(0,3)==="sha"){var d=i.Buffer.from(await l(a,h.name),"binary").toString(h.encode||"base64");if(g)try{g(d)}catch(c){console.log(c)}return d}S=S||i.random(9);var _=await(i.ossl||i.subtle).importKey("raw",new i.TextEncoder().encode(a),{name:h.name||"PBKDF2"},!1,["deriveBits"]),m=await(i.ossl||i.subtle).deriveBits({name:h.name||"PBKDF2",iterations:h.iterations||u.pbkdf2.iter,salt:new i.TextEncoder().encode(h.salt||S),hash:h.hash||u.pbkdf2.hash},_,h.length||u.pbkdf2.ks*8);a=i.random(a.length);var w=i.Buffer.from(m,"binary").toString(h.encode||"base64");if(g)try{g(w)}catch(c){console.log(c)}return w}catch(c){if(console.log(c),o.err=c,o.throw)throw c;g&&g();return}}),r.exports=o.work})(t,"./work"),t(function(r){var o=t("./root"),i=t("./shim");t("./settings"),o.name=o.name||(async(u,l)=>{try{if(u)try{u()}catch(f){console.log(f)}return}catch(f){if(console.log(f),o.err=f,o.throw)throw f;u&&u();return}}),o.pair=o.pair||(async(u,l)=>{try{var f=i.ossl||i.subtle,a=await i.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async h=>{var S={};S.priv=(await i.subtle.exportKey("jwk",h.privateKey)).d;var d=await i.subtle.exportKey("jwk",h.publicKey);return S.pub=d.x+"."+d.y,S});try{var v=await f.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async h=>{var S={};S.epriv=(await f.exportKey("jwk",h.privateKey)).d;var d=await f.exportKey("jwk",h.publicKey);return S.epub=d.x+"."+d.y,S})}catch(h){if(o.window)throw h;if(h=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw h}v=v||{};var g={pub:a.pub,priv:a.priv,epub:v.epub,epriv:v.epriv};if(u)try{u(g)}catch(h){console.log(h)}return g}catch(h){if(console.log(h),o.err=h,o.throw)throw h;u&&u();return}}),r.exports=o.pair})(t,"./pair"),t(function(r){var o=t("./root"),i=t("./shim"),u=t("./settings"),l=t("./sha256"),f;o.sign=o.sign||(async(a,v,g,h)=>{try{if(h=h||{},!(v||h).priv){if(!o.I)throw"No signing key.";v=await o.I(null,{what:a,how:"sign",why:h.why})}if(f===a)throw"`undefined` not allowed.";var S=await u.parse(a),d=h.check=h.check||S;if(o.verify&&(o.opt.check(d)||d&&d.s&&d.m)&&f!==await o.verify(d,v)){var p=await u.parse(d);if(h.raw||(p="SEA"+await i.stringify(p)),g)try{g(p)}catch(A){console.log(A)}return p}var _=v.pub,m=v.priv,w=u.jwk(_,m),c=await l(S),s=await(i.ossl||i.subtle).importKey("jwk",w,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(y=>(i.ossl||i.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},y,new Uint8Array(c))),p={m:S,s:i.Buffer.from(s,"binary").toString(h.encode||"base64")};if(h.raw||(p="SEA"+await i.stringify(p)),g)try{g(p)}catch(y){console.log(y)}return p}catch(y){if(console.log(y),o.err=y,o.throw)throw y;g&&g();return}}),r.exports=o.sign})(t,"./sign"),t(function(r){var o=t("./root"),i=t("./shim"),u=t("./settings"),l=t("./sha256"),f;o.verify=o.verify||(async(g,h,S,d)=>{try{var _=await u.parse(g);if(h===!1){var m=await u.parse(_.m);if(S)try{S(m)}catch($){console.log($)}return m}d=d||{};var w=h.pub||h,c=o.opt.slow_leak?await o.opt.slow_leak(w):await(i.ossl||i.subtle).importKey("jwk",u.jwk(w),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),s=await l(_.m),p,y,A,T;try{if(p=i.Buffer.from(_.s,d.encode||"base64"),y=new Uint8Array(p),A=await(i.ossl||i.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},c,y,new Uint8Array(s)),!A)throw"Signature did not match."}catch{if(o.opt.fallback)return await o.opt.fall_verify(g,h,S,d)}var k=A?await u.parse(_.m):f;if(S)try{S(k)}catch($){console.log($)}return k}catch($){if(console.log($),o.err=$,o.throw)throw $;S&&S();return}}),r.exports=o.verify;var a={};o.opt.slow_leak=g=>{if(a[g])return a[g];var h=u.jwk(g);return a[g]=(i.ossl||i.subtle).importKey("jwk",h,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),a[g]};var v=o.opt;o.opt.fall_verify=async function(g,h,S,d,_){if(_===o.opt.fallback)throw"Signature did not match";_=_||1;var m=g||"";g=o.opt.unpack(g)||g;var w=await u.parse(g),c=h.pub||h,s=await o.opt.slow_leak(c),p=_<=o.opt.fallback?i.Buffer.from(await i.subtle.digest({name:"SHA-256"},new i.TextEncoder().encode(await u.parse(w.m)))):await l(w.m),y,A,T;try{if(y=i.Buffer.from(w.s,d.encode||"base64"),A=new Uint8Array(y),T=await(i.ossl||i.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},s,A,new Uint8Array(p)),!T)throw"Signature did not match."}catch{try{y=i.Buffer.from(w.s,"utf8"),A=new Uint8Array(y),T=await(i.ossl||i.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},s,A,new Uint8Array(p))}catch{if(!T)throw"Signature did not match."}}var k=T?await u.parse(w.m):f;if(v.fall_soul=m["#"],v.fall_key=m["."],v.fall_val=g,v.fall_state=m[">"],S)try{S(k)}catch($){console.log($)}return k},o.opt.fallback=2})(t,"./verify"),t(function(r){var o=t("./shim"),i=t("./settings"),u=t("./sha256");const l=async(f,a,v)=>{const g=f+(a||o.random(8)).toString("utf8"),h=o.Buffer.from(await u(g),"binary"),S=i.keyToJwk(h);return await o.subtle.importKey("jwk",S,{name:"AES-GCM"},!1,["encrypt","decrypt"])};r.exports=l})(t,"./aeskey"),t(function(r){var o=t("./root"),i=t("./shim");t("./settings");var u=t("./aeskey"),l;o.encrypt=o.encrypt||(async(f,a,v,g)=>{try{g=g||{};var h=(a||g).epriv||a;if(l===f)throw"`undefined` not allowed.";if(!h){if(!o.I)throw"No encryption key.";a=await o.I(null,{what:f,how:"encrypt",why:g.why}),h=a.epriv||a}var S=typeof f=="string"?f:await i.stringify(f),d={s:i.random(9),iv:i.random(15)},_=await u(h,d.s,g).then(w=>i.subtle.encrypt({name:g.name||"AES-GCM",iv:new Uint8Array(d.iv)},w,new i.TextEncoder().encode(S))),m={ct:i.Buffer.from(_,"binary").toString(g.encode||"base64"),iv:d.iv.toString(g.encode||"base64"),s:d.s.toString(g.encode||"base64")};if(g.raw||(m="SEA"+await i.stringify(m)),v)try{v(m)}catch(w){console.log(w)}return m}catch(w){if(console.log(w),o.err=w,o.throw)throw w;v&&v();return}}),r.exports=o.encrypt})(t,"./encrypt"),t(function(r){var o=t("./root"),i=t("./shim"),u=t("./settings"),l=t("./aeskey");o.decrypt=o.decrypt||(async(f,a,v,g)=>{try{g=g||{};var h=(a||g).epriv||a;if(!h){if(!o.I)throw"No decryption key.";a=await o.I(null,{what:f,how:"decrypt",why:g.why}),h=a.epriv||a}var S=await u.parse(f),d,_,m;try{d=i.Buffer.from(S.s,g.encode||"base64"),_=i.Buffer.from(S.iv,g.encode||"base64"),m=i.Buffer.from(S.ct,g.encode||"base64");var w=await l(h,d,g).then(s=>i.subtle.decrypt({name:g.name||"AES-GCM",iv:new Uint8Array(_),tagLength:128},s,new Uint8Array(m)))}catch{if(g.encode==="utf8")throw"Could not decrypt";if(o.opt.fallback)return g.encode="utf8",await o.decrypt(f,a,v,g)}var c=await u.parse(new i.TextDecoder("utf8").decode(w));if(v)try{v(c)}catch(s){console.log(s)}return c}catch(s){if(console.log(s),o.err=s,o.throw)throw s;v&&v();return}}),r.exports=o.decrypt})(t,"./decrypt"),t(function(r){var o=t("./root"),i=t("./shim");t("./settings"),o.secret=o.secret||(async(l,f,a,v)=>{try{if(v=v||{},!f||!f.epriv||!f.epub){if(!o.I)throw"No secret mix.";f=await o.I(null,{what:l,how:"secret",why:v.why})}var g=l.epub||l,h=f.epub,S=f.epriv,d=i.ossl||i.subtle,_=u(g),m=Object.assign({public:await d.importKey(..._,!0,[])},{name:"ECDH",namedCurve:"P-256"}),w=u(h,S),c=await d.importKey(...w,!1,["deriveBits"]).then(async p=>{var y=await d.deriveBits(m,p,256),A=new Uint8Array(y),T=await d.importKey("raw",A,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return d.exportKey("jwk",T).then(({k})=>k)}),s=c;if(a)try{a(s)}catch(p){console.log(p)}return s}catch(p){if(console.log(p),o.err=p,o.throw)throw p;a&&a();return}});var u=(l,f)=>{var[a,v]=l.split("."),g=f?{d:f}:{};return["jwk",Object.assign(g,{x:a,y:v,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};r.exports=o.secret})(t,"./secret"),t(function(r){var o=t("./root");o.certify=o.certify||(async(i,u={},l,f,a={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),i=(()=>{var s=[];if(i){if((typeof i=="string"||Array.isArray(i))&&i.indexOf("*")>-1)return"*";if(typeof i=="string")return i;if(Array.isArray(i)){if(i.length===1&&i[0])return typeof i[0]=="object"&&i[0].pub?i[0].pub:typeof i[0]=="string"?i[0]:null;i.map(p=>{typeof p=="string"?s.push(p):typeof p=="object"&&p.pub&&s.push(p.pub)})}return typeof i=="object"&&i.pub?i.pub:s.length>0?s:null}})(),!i)return console.log("No certificant found.");const g=a.expiry&&(typeof a.expiry=="number"||typeof a.expiry=="string")?parseFloat(a.expiry):null,h=(u||{}).read?u.read:null,S=(u||{}).write?u.write:typeof u=="string"||Array.isArray(u)||u["+"]||u["#"]||u["."]||u["="]||u["*"]||u[">"]||u["<"]?u:null,d=(a||{}).block||(a||{}).blacklist||(a||{}).ban||{},_=d.read&&(typeof d.read=="string"||(d.read||{})["#"])?d.read:null,m=typeof d=="string"?d:d.write&&(typeof d.write=="string"||d.write["#"])?d.write:null;if(!h&&!S)return console.log("No policy found.");const w=JSON.stringify({c:i,...g?{e:g}:{},...h?{r:h}:{},...S?{w:S}:{},..._?{rb:_}:{},...m?{wb:m}:{}});var v=await o.sign(w,l,null,{raw:1});if(a.raw||(v="SEA"+JSON.stringify(v)),f)try{f(v)}catch(s){console.log(s)}return v}catch(g){if(o.err=g,o.throw)throw g;f&&f();return}}),r.exports=o.certify})(t,"./certify"),t(function(r){var o=t("./shim"),i=t("./root");i.work=t("./work"),i.sign=t("./sign"),i.verify=t("./verify"),i.encrypt=t("./encrypt"),i.decrypt=t("./decrypt"),i.certify=t("./certify"),i.random=i.random||o.random,i.Buffer=i.Buffer||t("./buffer"),i.keyid=i.keyid||(async u=>{try{const l=o.Buffer.concat(u.replace(/-/g,"+").replace(/_/g,"/").split(".").map(g=>o.Buffer.from(g,"base64"))),f=o.Buffer.concat([o.Buffer.from([153,l.length/256,l.length%256]),l]),a=await sha1hash(f),v=o.Buffer.from(a,"binary");return v.toString("hex",v.length-8)}catch(l){throw console.log(l),l}}),((i.window||{}).GUN||{}).SEA=i,r.exports=i})(t,"./sea"),t(function(r){var o=t("./sea"),i,u;o.window?i=o.window.GUN||{chain:{}}:i=t((u+""==typeof n?".":"")+"./gun",1),o.GUN=i;function l(a){this._={$:this}}l.prototype=function(){function a(){}return a.prototype=i.chain,new a}(),l.prototype.constructor=l,i.chain.user=function(a){var v=this,h=v.back(-1),g;if(a)return a=o.opt.pub((a._||"")["#"])||a,h.get("~"+a);if(g=h.back("user"))return g;var h=h._,S=h,d=S.opt.uuid||f;return(S=(g=S.user=v.chain(new l))._).opt={},S.opt.uuid=function(_){var m=d(),w=h.user;return!w||!(w=w.is)||!(w=w.pub)||(m="~"+w+"/"+m,_&&_.call&&_(null,m)),m},g};function f(){return i.state().toString(36).replace(".","")}i.User=l,l.GUN=i,l.SEA=i.SEA=o,r.exports=l})(t,"./user"),t(function(r){var o,i=""+o!=typeof GUN?GUN||{chain:{}}:t((""+o==typeof n?".":"")+"./gun",1);i.chain.then=function(u,l){var f=this,a=new Promise(function(v,g){f.once(v,l)});return u?a.then(u):a}})(t,"./then"),t(function(r){var o=t("./user"),i=o.SEA,u=o.GUN,l=function(){};o.prototype.create=function(...f){var a=typeof f[0]=="object"&&(f[0].pub||f[0].epub)?f[0]:typeof f[1]=="object"&&(f[1].pub||f[1].epub)?f[1]:null,v=a&&(a.pub||a.epub)?a.pub:typeof f[0]=="string"?f[0]:null,g=a&&(a.pub||a.epub)?a:v&&typeof f[1]=="string"?f[1]:null,h=f.filter(s=>typeof s=="function")[0]||null,S=f&&f.length>1&&typeof f[f.length-1]=="object"?f[f.length-1]:{},d=this,_=d._,m=d.back(-1);if(h=h||l,S=S||{},S.check!==!1){var w;if(v||(w="No user."),(g||"").length<8&&(w="Password too short!"),w)return h({err:u.log(w)}),d}if(_.ing)return(h||l)({err:u.log("User is already being created or authenticated!"),wait:!0}),d;_.ing=!0;var c={};return c.a=function(s){if(c.pubs=s,s&&!S.already){var p={err:u.log("User already created!")};_.ing=!1,(h||l)(p),d.leave();return}c.salt=String.random(64),i.work(g,c.salt,c.b)},c.b=function(s){c.proof=s,a?c.c(a):i.pair(c.c)},c.c=function(s){var p;c.pair=s||{},(p=_.root.user)&&(p._.sea=s,p.is={pub:s.pub,epub:s.epub,alias:v}),c.data={pub:s.pub},c.d()},c.d=function(){c.data.alias=v,c.e()},c.e=function(){c.data.epub=c.pair.epub,i.encrypt({priv:c.pair.priv,epriv:c.pair.epriv},c.proof,c.f,{raw:1})},c.f=function(s){c.data.auth=JSON.stringify({ek:s,s:c.salt}),c.g(c.data.auth)},c.g=function(s){var p;c.data.auth=c.data.auth||s,m.get(p="~"+c.pair.pub).put(c.data).on(c.h);var y={};y[p]={"#":p},m.get("~@"+v).put(y).get(p).on(c.i)},c.h=function(s,p,y,A){A.off(),c.h.ok=1,c.i()},c.i=function(s,p,y,A){A&&(c.i.ok=1,A.off()),!(!c.h.ok||!c.i.ok)&&(_.ing=!1,h({ok:0,pub:c.pair.pub}),l===h&&(a?d.auth(a):d.auth(v,g)))},m.get("~@"+v).once(c.a),d},o.prototype.leave=function(f,a){var v=this,g=v.back(-1)._.user;if(g&&(delete g.is,delete g._.is,delete g._.sea),i.window)try{var h={};h=i.window.sessionStorage,delete h.recall,delete h.pair}catch{}return v}})(t,"./create"),t(function(r){var o=t("./user"),i=o.SEA,u=o.GUN,l=function(){};o.prototype.auth=function(...a){var v=typeof a[0]=="object"&&(a[0].pub||a[0].epub)?a[0]:typeof a[1]=="object"&&(a[1].pub||a[1].epub)?a[1]:null,g=!v&&typeof a[0]=="string"?a[0]:null,h=(g||v&&!(v.priv&&v.epriv))&&typeof a[1]=="string"?a[1]:null,S=a.filter(y=>typeof y=="function")[0]||null,d=a&&a.length>1&&typeof a[a.length-1]=="object"?a[a.length-1]:{},_=this,m=_._,w=_.back(-1);if(m.ing)return(S||l)({err:u.log("User is already being created or authenticated!"),wait:!0}),_;m.ing=!0;var c={},s,p=9;return c.a=function(y){if(!y)return c.b();if(!y.pub){var A=[];return Object.keys(y).forEach(function(T){T!="_"&&A.push(y[T])}),c.b(A)}if(c.name)return c.f(y);c.c((c.data=y).auth)},c.b=function(y){var A=(c.list=(c.list||[]).concat(y||[])).shift();if(s===A){if(c.name)return c.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(g&&p--){w.get("~@"+g).once(c.a);return}return c.err("Wrong user or password.")}w.get(A).once(c.a)},c.c=function(y){if(s===y)return c.b();if(typeof y=="string")return c.c(f(y));i.work(h,(c.auth=y).s,c.d,c.enc)},c.d=function(y){i.decrypt(c.auth.ek,y,c.e,c.enc)},c.e=function(y){if(s===y)return c.enc?(c.enc=null,c.b()):(c.enc={encode:"utf8"},c.c(c.auth));c.half=y,c.f(c.data)},c.f=function(y){var A=c.half||{},T=c.data||{};c.g(c.lol={pub:y.pub||T.pub,epub:y.epub||T.epub,priv:y.priv||A.priv,epriv:y.epriv||A.epriv})},c.g=function(y){if(!y||!y.pub||!y.epub)return c.b();c.pair=y;var A=w._.user,T=A._;T.tag;var k=T.opt;T=A._=w.get("~"+y.pub)._,T.opt=k,A.is={pub:y.pub,epub:y.epub,alias:g||y.pub},T.sea=c.pair,m.ing=!1;try{h&&s==(f(m.root.graph["~"+y.pub].auth)||"")[":"]&&(d.shuffle=d.change=h)}catch{}if(d.change?c.z():(S||l)(T),i.window&&(_.back("user")._.opt||d).remember)try{var $={};$=i.window.sessionStorage,$.recall=!0,$.pair=JSON.stringify(y)}catch{}try{w._.tag.auth?w._.on("auth",T):setTimeout(function(){w._.on("auth",T)},1)}catch(R){u.log("Your 'auth' callback crashed with:",R)}},c.h=function(y){if(!y)return c.b();if(g=y.alias,g||(g=y.alias="~"+v.pub),!y.auth)return c.g(v);v=null,c.c((c.data=y).auth)},c.z=function(){c.salt=String.random(64),i.work(d.change,c.salt,c.y)},c.y=function(y){i.encrypt({priv:c.pair.priv,epriv:c.pair.epriv},y,c.x,{raw:1})},c.x=function(y){c.w(JSON.stringify({ek:y,s:c.salt}))},c.w=function(y){if(d.shuffle){console.log("migrate core account from UTF8 & shuffle");var A={};Object.keys(c.data).forEach(function(T){A[T]=c.data[T]}),delete A._,A.auth=y,w.get("~"+c.pair.pub).put(A)}w.get("~"+c.pair.pub).get("auth").put(y,S||l)},c.err=function(y){var A={err:u.log(y||"User cannot be found!")};m.ing=!1,(S||l)(A)},c.plugin=function(y){if(!(c.name=y))return c.err();var A=[y];y[0]!=="~"&&(A[1]="~"+y,A[2]="~@"+y),c.b(A)},v?v.priv&&v.epriv?c.g(v):w.get("~"+v.pub).once(c.h):g?w.get("~@"+g).once(c.a):!g&&!h&&i.name(c.plugin),_};function f(a){if(typeof a!="string")return a;try{a=JSON.parse(a)}catch{a={}}return a}})(t,"./auth"),t(function(r){var o=t("./user"),i=o.SEA;o.GUN,o.prototype.recall=function(u,l){var f=this,a=f.back(-1);if(u=u||{},u&&u.sessionStorage){if(i.window)try{var v={};v=i.window.sessionStorage,v&&(a._.opt.remember=!0,(f.back("user")._.opt||u).remember=!0,(v.recall||v.pair)&&a.user().auth(JSON.parse(v.pair),l))}catch{}return f}return f}})(t,"./recall"),t(function(r){var o=t("./user"),i=o.SEA,u=o.GUN,l=function(){};o.prototype.pair=function(){var f=this,a;try{a=new Proxy({DANGER:"â "},{get:function(v,g,h){if(!(!f.is||!(f._||"").sea))return f._.sea[g]}})}catch{}return a},o.prototype.delete=async function(f,a,v){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var g=this;g.back(-1);var h=g.back("user");try{h.auth(f,a,function(S){var d=(h.is||{}).pub;h.map().once(function(){this.put(null)}),h.leave(),(v||l)({ok:0})})}catch(S){u.log("User.delete failed! Error:",S)}return g},o.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const f=this.back(-1);try{return await authRecall(f),f._.user._}catch{const v="No session!";throw u.log(v),{err:v}}},o.prototype.trust=async function(f){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),u.is(f)&&f.get("pub").get((a,v)=>{console.log(a,v)}),f.get("trust").get(path).put(theirPubkey)},o.prototype.grant=function(f,a){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var v=this,g=v.back(-1).user(),h=g._.sea,S="";return v.back(function(d){d.is||(S+=d.get||"")}),async function(){var d,_=await g.get("grant").get(h.pub).get(S).then();_=await i.decrypt(_,h),_||(_=i.random(16).toString(),d=await i.encrypt(_,h),g.get("grant").get(h.pub).get(S).put(d));var m=f.get("pub").then(),w=f.get("epub").then();m=await m,w=await w;var c=await i.secret(w,h);d=await i.encrypt(_,c),g.get("grant").get(m).get(S).put(d,a)}(),v},o.prototype.secret=function(f,a){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var v=this,g=v.back(-1).user(),h=g.pair(),S="";return v.back(function(d){d.is||(S+=d.get||"")}),async function(){var d,_=await g.get("trust").get(h.pub).get(S).then();_=await i.decrypt(_,h),_||(_=i.random(16).toString(),d=await i.encrypt(_,h),g.get("trust").get(h.pub).get(S).put(d)),d=await i.encrypt(f,_),v.put(d,a)}(),v},r.exports=o})(t,"./share"),t(function(r){var o=t("./sea"),i=t("./settings"),u,l=(o.window||"").GUN||t((""+u==typeof n?".":"")+"./gun",1);l.on("opt",function(d){d.sea||(d.sea={own:{}},d.on("put",f,d)),this.to.next(d)});function f(d){var _=this,m=_.as,w=d.put,c=w["#"],s=w["."],p=w[":"],y=w[">"],A=d["#"],T;if(!(!c||!s)){if((d._||"").faith&&(m.opt||"").faith&&typeof d._=="function"){o.opt.pack(w,function($){o.verify($,!1,function(R){w["="]=o.opt.unpack(R),_.to.next(d)})});return}var k=function($){m.on("in",{"@":A,err:d.err=$})};if((d._||"").DBG&&((d._||"").DBG.c=+new Date),0<=c.indexOf("<?")&&(T=parseFloat(c.split("<?")[1]||""),T&&y<l.state()-T*1e3)){(T=d._)&&T.stun&&T.stun--;return}if(c==="~@"){f.alias(_,d,p,s,c,m,k);return}if(c.slice(0,2)==="~@"){f.pubs(_,d,p,s,c,m,k);return}if(T=o.opt.pub(c)){f.pub(_,d,p,s,c,m,k,m.user||"",T);return}if(0<=c.indexOf("#")){f.hash(_,d,p,s,c,m,k);return}f.any(_,d,p,s,c,m,k,m.user||"")}}f.hash=function(d,_,m,w,c,s,p){o.work(m,null,function(y){function A(T){let k="";for(let $=0;$<T.length;$++)k+=$-1&1?"":String.fromCharCode(parseInt(T.substring($-1,$+1),16));return btoa(k)}if(y&&y===w.split("#").slice(-1)[0])return d.to.next(_);if(y&&y===A(w.split("#").slice(-1)[0]))return d.to.next(_);p("Data hash not same as hash!")},{name:"SHA-256"})},f.alias=function(d,_,m,w,c,s,p){if(!m)return p("Data must exist!");if("~@"+w===v(m))return d.to.next(_);p("Alias not same!")},f.pubs=function(d,_,m,w,c,s,p){if(!m)return p("Alias must exist!");if(w===v(m))return d.to.next(_);p("Alias not same!")},f.pub=async function(d,_,m,w,c,s,p,y,A){var T;const k=await i.parse(m)||{},$=(R,x,E)=>{if(R.m&&R.s&&x&&A)return o.verify(R,A,b=>{if(u!==b&&u!==b.e&&_.put[">"]&&_.put[">"]>parseFloat(b.e))return p("Certificate expired.");if(u!==b&&b.c&&b.w&&(b.c===x||b.c.indexOf("*")>-1)){let C=c.indexOf("/")>-1?c.replace(c.substring(0,c.indexOf("/")+1),""):"";String.match=String.match||l.text.match;const z=Array.isArray(b.w)?b.w:typeof b.w=="object"||typeof b.w=="string"?[b.w]:[];for(const N of z)if(String.match(C,N["#"])&&String.match(w,N["."])||!N["."]&&String.match(C,N["#"])||!N["#"]&&String.match(w,N["."])||String.match(C?C+"/"+w:w,N["#"]||N)){if(N["+"]&&N["+"].indexOf("*")>-1&&C&&C.indexOf(x)==-1&&w.indexOf(x)==-1)return p(`Path "${C}" or key "${w}" must contain string "${x}".`);if(b.wb&&(typeof b.wb=="string"||(b.wb||{})["#"])){var O=d.as.root.$.back(-1);return typeof b.wb=="string"&&b.wb.slice(0,1)!=="~"&&(O=O.get("~"+A)),O.get(b.wb).get(x).once(j=>j&&(j===1||j===!0)?p(`Certificant ${x} blocked.`):E(b))}return E(b)}return p("Certificate verification fail.")}})};if(w==="pub"&&"~"+A===c)return m===A?d.to.next(_):p("Account not same!");if((T=y.is)&&T.pub&&!k["*"]&&!k["+"]&&(A===T.pub||A!==T.pub&&((_._.msg||{}).opt||{}).cert)){o.opt.pack(_.put,R=>{o.sign(R,y._.sea,async function(x){if(u===x)return p(o.err||"Signature fail.");if(_.put[":"]={":":T=o.opt.unpack(x.m),"~":x.s},_.put["="]=T,A===y.is.pub){(T=v(m))&&((s.sea.own[T]=s.sea.own[T]||{})[A]=1),JSON.stringifyAsync(_.put[":"],function(E,b){return E?p(E||"Stringify error."):(_.put[":"]=b,d.to.next(_))});return}if(A!==y.is.pub&&((_._.msg||{}).opt||{}).cert){const E=await i.parse(_._.msg.opt.cert);E&&E.m&&E.s&&$(E,y.is.pub,b=>{_.put[":"]["+"]=E,_.put[":"]["*"]=y.is.pub,JSON.stringifyAsync(_.put[":"],function(O,C){return O?p(O||"Stringify error."):(_.put[":"]=C,d.to.next(_))})})}},{raw:1})});return}o.opt.pack(_.put,R=>{o.verify(R,k["*"]||A,function(x){var E;if(x=o.opt.unpack(x),u===x)return p("Unverified data.");if((E=v(x))&&A===o.opt.pub(E)&&((s.sea.own[E]=s.sea.own[E]||{})[A]=1),k["+"]&&k["+"].m&&k["+"].s&&k["*"])$(k["+"],k["*"],b=>(_.put["="]=x,d.to.next(_)));else return _.put["="]=x,d.to.next(_)})})},f.any=function(d,_,m,w,c,s,p,y){if(s.opt.secure)return p("Soul missing public key at '"+w+"'.");s.on("secure",function(A){if(this.off(),!s.opt.secure)return d.to.next(A);p("Data cannot be changed.")}).on.on("secure",_)};var a=l.valid,v=function(d,_){return typeof(_=a(d))=="string"&&_};(l.state||"").ify;var g=/[^\w_-]/;o.opt.pub=function(d){if(d&&(d=d.split("~"),!(!d||!(d=d[1]))&&(d=d.split(g).slice(0,2),!(!d||d.length!=2)&&(d[0]||"")[0]!=="@")))return d=d.slice(0,2).join("."),d},o.opt.stringy=function(d){},o.opt.pack=function(d,_,m,w,c){var s,p;if(o.opt.check(d))return _(d);d&&d["#"]&&d["."]&&d[">"]&&(s=d[":"],p=1),JSON.parseAsync(p?s:d,function(y,A){var T=u!==(A||"")[":"]&&(A||"")["~"];if(!T){_(d);return}_({m:{"#":c||d["#"],".":m||d["."],":":(A||"")[":"],">":d[">"]||l.state.is(w,m)},s:T})})};var h=o.opt;o.opt.unpack=function(d,_,m){var w;if(u!==d){if(d&&u!==(w=d[":"]))return w;if(_=_||h.fall_key,!m&&h.fall_val&&(m={},m[_]=h.fall_val),!(!_||!m)){if(d===m[_]||!o.opt.check(m[_]))return d;var c=m&&m._&&m._["#"]||h.fall_soul,s=l.state.is(m,_)||h.fall_state;if(d&&d.length===4&&c===d[0]&&_===d[1]&&S(s)===S(d[3]))return d[2];if(s<o.opt.shuffle_attack)return d}}},o.opt.shuffle_attack=15463296e5;var S=Math.floor})(t,"./index")})()}(et)),et.exports}var uc=ic();const ac=Jt(uc);var Tt={exports:{}},Un={},Mn;function sc(){if(Mn)return Un;Mn=1;var e={},t=typeof window<"u"?window.Gun:ke(),n;t.on("opt",function(o){r(o),this.to.next(o)});function r(o){if(o.axe)return;var i=o.opt;if(i.peers,i.axe===!1||typeof process<"u"&&""+(e||"").AXE=="false")return;t.log.once("AXE","AXE relay enabled!");var u=o.axe={},l=i.mesh=i.mesh||t.Mesh(o),f=o.dup;l.way=function(m){if(m){if(m.get)return a(m);m.put||v(m)}};function a(m){if(m){var w=(m._||"").via,c;if(!w||!w.id||!(c=g(m)._))return v(m);c.asked=+new Date,a.turn(m,c.route,0)}}a.turn=function(m,w,c){var s=m["#"],p=f.s[s],y;if(!(!s||!p)&&(clearTimeout(p.lack),!(p.ack&&(s=p["##"])&&m["##"]===s))){if(y=Object.maps(w||i.peers).slice(c=c||0),!y.length){if(!w)return;a.turn(m,n,0);return}setTimeout.each(y,function(A){var T=i.peers[A];if(c++,!T||!T.wire){w&&w.delete(A);return}if(l.say(m,T)!==!1&&c%3==0)return 1},function(){p["##"]=m["##"],p.lack=setTimeout(function(){a.turn(m,w,c)},25)},3)}};function v(m){l.say(m,i.peers)}function g(m){var w="",c,s,p;if(!m||!m.get)return w;typeof(c=m.get["#"])=="string"&&(w=o.$.get(c)),typeof(p=m.get["."])=="string"?s=p:s="";var y=(m._||"").via,A=y.sub||(y.sub=new Object.Map);return(A.get(c)||A.set(c,p=new Object.Map)&&p).set(s,1),y.id&&w._&&(w._.route||(w._.route=new Object.Map)).set(y.id,y),w}function h(m){return(m=m||"")["="]||m["*"]||m[">"]||m}o.on("in",function(m){var w=this.to,c;if((c=m["@"])&&(c=f.s[c])){if(c.ack=(c.ack||0)+1,c.it&&c.it.get&&m.put){var s=c.it.get||"",p=g(c.it)._,y=(c.it._||"").via||"",A;if(y&&p&&(y.id&&(p.route||(p.route=new Object.Map)).set(y.id,y),A=y.sub||(y.sub=new Object.Map),p&&(A.get(h(s["#"]))||A.set(h(s["#"]),A=new Object.Map)&&A).set(h(s["."]),1),y=(m._||"").via||"",y&&(y.id&&(p.route||(p.route=new Object.Map)).set(y.id,y),A=y.sub||(y.sub=new Object.Map),p))){var T=h(s["#"]),k=A.get(T),$=h(s["."]);$?(k||A.set(T,k=new Object.Map)&&k).set($,1):k||(A.set(T,k=new Object.Map),k.set("",1))}}if(c=c.back){setTimeout.each(Object.keys(c),function(R){w.next({"#":m["#"],"@":R,ok:m.ok})});return}}w.next(m)}),o.on("create",function(m){this.to.next(m),m.on("put",function(w){var c=this;c.as;var s=w.put,p=s["#"],y=s["."],A=s[":"],T=s[">"];if(c.to.next(w),!w["@"]&&!(!p||!y)){var k=m.$.get(p)._,$=(k||"").route;if($){if(k.skip&&k.skip.has==y){k.skip.now=w["#"];return}(k.skip={now:w["#"],has:y}).to=setTimeout(function(){setTimeout.each(Object.maps($),function(R){var x,z,E=k.skip||"";if(k.skip=null,!!(x=$.get(R))){if(!x.wire){$.delete(R);return}var b=(x.sub||(x.sub=new Object.Map)).get(p);if(b&&!(!b.get(y)&&!b.get(""))){var O=x.put||(x.put={}),C=m.graph[p],z;C&&n!==(z=C[y])&&(T=_(C,y),A=z),O[p]=d(O[p],y,T,A,p),z=f.track(x.next=x.next||String.random(9)),(z.back||(z.back={}))[""+(E.now||w["#"])]=1,!x.to&&(x.to=setTimeout(function(){S(x)},i.gap))}}})},9)}}})});function S(m){var w={"#":m.next,put:m.put,ok:{"@":3,"/":l.near}};m.next=m.put=m.to=null,l.say(w,m)}var d=t.state.ify,_=t.state.is;(function(){u.up={};var m=l.hear["?"];l.hear["?"]=function(w,c){var s;if(m(w,c),!!c.pid){if(c.pid===i.pid){l.bye(c);return}if(s=u.up[c.pid]){if(s===c)return;i.pid>c.pid&&(s=c,c=u.up[s.pid]),s.url=s.url||c.url,l.bye(c),u.up[s.pid]=s;return}c.url&&(u.up[c.pid]=c,u.stay&&u.stay())}},l.hear.opt=function(w,c){if(!w.ok){var s=w.opt;s&&(s=s.peers,!(!s||typeof s!="string")&&(99<=Object.keys(u.up).length||(l.hi({id:s,url:s,retry:9}),c&&l.say({dam:"opt",ok:1,"@":w["#"]},c))))}},u.stay=function(){clearTimeout(u.stay.to),u.stay.to=setTimeout(function(w,c){(w=o.stats&&o.stats.stay)&&(c={},Object.keys(u.up||"").forEach(function(s){s=(u.up||"")[s],s.url&&(c[s.url]={})}),(w.axe=w.axe||{}).up=c)},1e3*9)},setTimeout(function(w){(w=o.stats&&o.stats.stay&&o.stats.stay.axe)&&(w=w.up)&&(w instanceof Array||(w=Object.keys(w)),setTimeout.each(w||[],function(c){l.hear.opt({opt:{peers:c}})}))},1e3)})(),function(){i.mob=i.mob||9900,o.on("hi",function(m){if(this.to.next(m),!m.url){var w=l.near;if(!(i.mob>=w)){var c={};Object.keys(u.up).forEach(function(s){s=u.up[s],s.url&&(c[s.url]={})}),l.say({dam:"mob",mob:w,peers:c},m),setTimeout(function(){l.bye(m)},9)}}}),o.on("bye",function(m){this.to.next(m)})}()}return function(){var o=Array.from;if(Object.maps=function(i){return o&&i instanceof Map?o(i.keys()):(i instanceof Object.Map&&(i=i.s),Object.keys(i))},o)return Object.Map=Map;(Object.Map=function(){this.s={}}).prototype={set:function(i,u){return this.s[i]=u,this},get:function(i){return this.s[i]},delete:function(i){delete this.s[i]}}}(),Un}var Ln;function cc(){return Ln||(Ln=1,function(e){(function(){var t=setTimeout||{},n;typeof window!=""+n&&(t.window=window);var r=(t.window||"").AXE||function(){};(r.window=t.window)&&(r.window.AXE=r);var o=(r.window||"").GUN||ke();(o.AXE=r).GUN=r.Gun=o,o.window||sc(),o.on("opt",function(u){i(u),this.to.next(u)});function i(u){if(u.axe)return;var l=u.opt,f=l.peers;if(l.axe===!1||!o.window)return;var a=o.window,v=a.localStorage||l.localStorage||{},g=a.location||l.location||{},h=a.navigator||l.navigator||{},S=u.axe={},d,_,m=l.mesh=l.mesh||o.Mesh(u);d=f[_=g.origin+"/gun"]=f[_]||{},d.id=d.url=_,d.retry=d.retry||0,d=f[_="http://localhost:8765/gun"]=f[_]||{},d.id=d.url=_,d.retry=d.retry||0,o.log.once("AXE","AXE enabled: Trying to find network via (1) local peer (2) last used peers (3) a URL parameter, and last (4) hard coded peers."),o.log.once("AXEWarn","Warning: AXE is in alpha, use only for testing!");var w=v.peers||"";w&&(w+=" "),w+=((g.search||"").split("peers=")[1]||"").split("&")[0],u.on("bye",function(s){this.to.next(s),s.url&&(h.onLine||(s.retry=1),!s.retry&&(S.fall&&delete S.fall[s.url||s.id],function p(){if(!S.fall){setTimeout(p,9);return}var y=Object.keys(S.fall||""),A=y[Math.random()*y.length>>0];if(y.length||(v.peers="",A="https://gunjs.herokuapp.com/gun"),f[A]){p();return}m.hi(A)}()))}),u.on("hi",function(s){this.to.next(s),s.url});function c(s){S.fall={},((s||"").match(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/ig)||[]).forEach(function(p){S.fall[p]={url:p,id:p,retry:0}})}if(w){c(w);return}try{fetch(((g.search||"").split("axe=")[1]||"").split("&")[0]||g.axe||"https://raw.githubusercontent.com/wiki/amark/gun/volunteer.dht.md").then(function(s){return s.text()}).then(function(s){c(v.peers=s)}).catch(function(){c()})}catch{c()}}try{""+n!="object"&&(e.exports=r)}catch{}})()}(Tt)),Tt.exports}cc();var At={exports:{}},Fn;function Zr(){return Fn||(Fn=1,function(e){(function(){var t={},n,r=setTimeout.turn||typeof setImmediate!=""+n&&setImmediate||setTimeout;t.parseAsync=function(i,u,l,f){if(typeof i!="string"){try{u(n,JSON.parse(i))}catch(g){u(g)}return}var a={i:0,text:i,done:u,l:i.length,up:[]};f=f||1024*32,v();function v(){for(var g=a.text,h=a.i,S=a.l,d=0,_=a.w,m,w;d++<f;){var c=g[h++];if(h>S){a.end=!0;break}if(_){for(h=g.indexOf('"',h-1),c=g[h],w=0;g[h-++w]=="\\";);w=!(w%2),m=m||w,c=='"'&&!w&&(_=n,w=a.s,a.a?(w=g.slice(a.sl,h),(m||1+w.indexOf("\\"))&&(w=JSON.parse('"'+w+'"')),a.at instanceof Array?a.at.push(a.s=w):(a.at||(a.end=d=f,w=n),(a.at||{})[a.s]=a.s=w),a.s=n):(a.s=g.slice(a.sl,h),(m||1+a.s.indexOf("\\"))&&(a.s=JSON.parse('"'+a.s+'"'))),a.a=m=n),++h}else switch(c){case'"':a.sl=h,_=!0;break;case":":a.ai=h,a.a=!0;break;case",":(a.a||a.at instanceof Array)&&(w=g.slice(a.ai,h-1))&&n!==(w=o(w))&&(a.at instanceof Array?a.at.push(w):a.at[a.s]=w),a.a=n,a.at instanceof Array&&(a.a=!0,a.ai=h);break;case"{":a.up.push(a.at||(a.at={})),a.at instanceof Array?a.at.push(a.at={}):n!==(w=a.s)&&(a.at[w]=a.at={}),a.a=n;break;case"}":a.a&&(w=g.slice(a.ai,h-1))&&n!==(w=o(w))&&(a.at instanceof Array?a.at.push(w):(a.at||(a.end=d=f,w=n),(a.at||{})[a.s]=w)),a.a=n,a.at=a.up.pop();break;case"[":n!==(w=a.s)?(a.up.push(a.at),a.at[w]=a.at=[]):a.at||a.up.push(a.at=[]),a.a=!0,a.ai=h;break;case"]":a.a&&(w=g.slice(a.ai,h-1))&&n!==(w=o(w))&&(a.at instanceof Array?a.at.push(w):a.at[a.s]=w),a.a=n,a.at=a.up.pop();break}}if(a.s=n,a.i=h,a.w=_,a.end){if(w=a.at,n===w)try{w=JSON.parse(i)}catch(s){return a.done(s)}a.done(n,w)}else r(v)}};function o(i){var u=parseFloat(i);if(!isNaN(u))return u;if(i=i.trim(),i=="true")return!0;if(i=="false")return!1;if(i=="null")return null}t.stringifyAsync=function(i,u,l,f,a){a=a||{},a.text=a.text||"",a.up=[a.at={d:i}],a.done=u,a.i=0;var v=0;g();function g(){var h=a.at,S=h.d,d="",_;switch(h.i&&h.i-h.j>0&&(d+=","),n!==(_=h.k)&&(d+=JSON.stringify(_)+":"),typeof S){case"boolean":d+=""+S;break;case"string":d+=JSON.stringify(S);break;case"number":d+=isNaN(S)?"null":S;break;case"object":if(!S){d+="null";break}if(S instanceof Array){d+="[",h={i:-1,as:S,up:h,j:0},h.l=S.length,a.up.push(a.at=h);break}if(typeof(S||"").toJSON!="function"){d+="{",h={i:-1,ok:Object.keys(S).sort(),as:S,up:h,j:0},h.l=h.ok.length,a.up.push(a.at=h);break}if(_=S.toJSON()){d+=_;break}case"function":if(h.as instanceof Array){d+="null";break}default:d="",h.j++}for(a.text+=d;1+h.i>=h.l;)a.text+=h.ok?"}":"]",h=a.at=h.up;if(++h.i<h.l){if((_=h.ok)?h.d=h.as[h.k=_[h.i]]:h.d=h.as[h.i],++v<9)return g();v=0,r(g);return}a.done(n,a.text)}},typeof window!=""+n&&(window.YSON=t);try{""+n!="object"&&(e.exports=t)}catch{}typeof JSON!=""+n&&(JSON.parseAsync=t.parseAsync,JSON.stringifyAsync=t.stringifyAsync)})()}(At)),At.exports}Zr();var Et={exports:{}},Wn;function tn(){return Wn||(Wn=1,function(){function e(){var i=function(u,l,f){if(i.unit=0,!f&&r!==l&&(i.last=""+u<i.last?i.last:""+u,delete(i.$||{})[o]),f=f||i.$||(i.$={}),!u&&Object.keys(f).length)return f;u=""+u;for(var a=0,v=u.length-1,g=u[a],h,S;!(h=f[g])&&a<v;)g+=u[++a];if(h)if(a==v){if(r===l)return r===(S=h[""])?h:(i.unit=1)&&S;h[""]=l}else return r!==l&&delete h[o],i(u.slice(++a),l,h||(h={}));else{if(!t(f,function(d,_){var m=0,w="";if((_||"").length)for(;_[m]==u[m];)w+=_[m++];if(w){if(r===l)return m<=v?void 0:((S||(S={}))[_.slice(m)]=d,d);var c={};if(c[_.slice(m)]=d,m=u.slice(m),m===""?c[""]=l:(c[m]={})[""]=l,f[w]=c,e.debug&&""+w=="undefined"){console.log(0,w);debugger}return delete f[_],!0}})){if(r===l)return;if((f[g]||(f[g]={}))[""]=l,e.debug&&""+g=="undefined"){console.log(1,g);debugger}}if(r===l)return S}};return i}if(e.map=function i(u,l,f,a){try{a=a||[];var v=typeof u=="function"?u.$||{}:u;//!opt && console.log("WHAT IS T?", JSON.stringify(t).length);
if(!v)return;if(typeof v=="string"){if(e.debug)throw["BUG:",u,l,f,a];return}var g=(v[o]||n).sort||(v[o]=function k(){return k.sort=Object.keys(v).sort(),k}()).sort,h;f=f===!0?{branch:!0}:f||{},(h=f.reverse)&&(g=g.slice(0).reverse());for(var S=f.start,d=f.end,_="ï¿¿",m=0,w=g.length;m<w;m++){var c=g[m],s=v[c],p,y,A;if(!(!s||c===""||o===c||c==="undefined")&&(y=a.slice(0),y.push(c),A=y.join(""),!(r!==S&&A<(S||"").slice(0,A.length))&&!(r!==d&&(d||_)<A))){if(h&&(p=i(s,l,f,y),r!==p))return p;if(r!==(p=s[""])){var T=1;if(r!==S&&A<(S||"")&&(T=0),r!==d&&A>(d||_)&&(T=0),T&&(p=l(p,A,c,a),r!==p))return p}else if(f.branch&&(p=l(r,A,c,a),r!==p))return p;if(a=y,!h&&(p=i(s,l,f,a),r!==p))return p;a.pop()}}}catch(k){console.error(k)}},typeof window<"u")window.Radix=e;else try{Et.exports=e}catch{}var t=e.object=function(i,u,l){for(var f in i)if(i.hasOwnProperty(f)&&(l=u(i[f],f))!==r)return l},n={},r,o=""}()),Et.exports}tn();var Ot={exports:{}},$t,Jn;function fc(){return Jn||(Jn=1,$t=function(e){var t=tn();e.find("a",function(){var n=[];t.map(e.list,function(i,u){u.indexOf("%1B")+1&&i&&n.push([u,i])}),n.length&&console.log(`
! ! ! WARNING ! ! !
RAD v0.2020.x has detected OLD v0.2019.x data & automatically migrating. Automatic migration will be turned OFF in future versions! If you are just developing/testing, we recommend you reset your data. Please contact us if you have any concerns.
This message should only log once.`);var r,o;n.forEach(function(i){r=i[0],o=i[1],e.list(decodeURIComponent(r),o),e.list(r,0)}),r&&e.find.bad(r)})}),$t}var Kn;function Pr(){return Kn||(Kn=1,function(){function e(r){r=r||{},r.log=r.log||console.log,r.file=String(r.file||"radata");var o=(e.has||(e.has={}))[r.file];if(o)return o;r.max=r.max||(r.memory?r.memory*999*999:3e8)*.3,r.until=r.until||r.wait||250,r.batch=r.batch||10*1e3,r.chunk=r.chunk||1024*1024*1,r.code=r.code||{},r.code.from=r.code.from||"!",r.jsonify=!0;function i(m){return encodeURIComponent(m).replace(/\*/g,"%2A")}function u(m){return _!==m&&(!m||typeof m!="object")}var l=""+_==typeof setImmediate?setTimeout:setImmediate,f=setTimeout.turn||l,_,a=n.object,v=0;if(!r.store)return r.log("ERROR: Radisk needs `opt.store` interface with `{get: fn, put: fn (, list: fn)}`!");if(!r.store.put)return r.log("ERROR: Radisk needs `store.put` interface with `(file, data, cb)`!");if(!r.store.get)return r.log("ERROR: Radisk needs `store.get` interface with `(file, cb)`!");r.store.list,""+_!=typeof en&&Zr();var g=JSON.parseAsync||function(m,w,c){var s;try{w(s,JSON.parse(m,c))}catch(p){w(p)}},h=function(m,w,c,s,p){if(typeof w=="function"){var y=c||{};c=w,h.read(m,c,y,p||s);return}h.save(m,w,c,s,p)};h.save=function(m,w,c,s,p){var y={key:m},A,T;y.find=function(k){var $;if(y.file=k||(k=r.code.from),p&&(p=p[k]=p[k]||{}),p&&(p.sf=p.sf||+new Date),$=h.disk[k]){y.mix(_,$);return}h.parse(k,y.mix,_,p)},y.mix=function(k,$){if(p&&(p.sml=+new Date),p&&(p.sm=p.sm||+new Date),y.err=k||y.err){c(k);return}var R=y.file=($||"").file||y.file,x;if(!$&&R!==r.code.from){h.find.bad(R),h.save(m,w,c,s);return}if(($=h.disk[R]||(h.disk[R]=$||n())).file||($.file=R),r.compare&&(w=r.compare($(m),w,m,R),_===w)){c(k,-1);return}if((y.disk=$)(m,w),s&&((x=(x=$.tags||($.tags={}))[s]||(x[s]=h.tags[s]||(h.tags[s]={})))[R]||(x[R]=h.one[s]||(h.one[s]=c)),c=null),p&&(p.st=p.st||+new Date),$.Q){c&&$.Q.push(c);return}$.Q=c?[c]:[],$.to=setTimeout(y.write,r.until)},y.write=function(){p&&(p.sto=p.sto||+new Date);var k=A=y.file,$=y.disk;T=y.q=$.Q,y.tags=$.tags,delete $.Q,delete h.disk[k],delete $.tags,h.write(k,$,y.ack,_,p)},y.ack=function(k,$){p&&(p.sa=p.sa||+new Date),p&&(p.sal=T.length);var R,x;for(var E in h.tags)if(h.tags.hasOwnProperty(E)){var b=h.tags[E];if(!((x=h.disk[A])&&(x=x.tags)&&x[b])){R=b[A],delete b[A];var O;for(var C in b)if(b.hasOwnProperty(C)){O=!0;break}O||(delete h.tags[b],R&&R(k,$))}}!T&&(T="");for(var z=T.length,N=0,j=+new Date;N<z;N++)(R=T[N])&&R(k,$);console.STAT&&console.STAT(j,+new Date-j,"rad acks",i(y.file)),console.STAT&&console.STAT(j,T.length,"rad acks #",i(y.file))},c||(c=function(k,$){}),h.find(m,y.find)},h.disk={},h.one={},h.tags={};var S=0;h.write=function(m,w,c,s,p){if(!w){c("No radix!");return}s=typeof s=="object"?s:{force:s};var y=function(){},A,T;if(y.text="",y.file=m=w.file||(w.file=m),!m){c("What file?");return}if(y.write=function(){var k=w.raw=y.text;h.disk[m=w.file||y.file||m]=w;var $=+new Date;p&&(p.wd=$),h.find.add(m,function(x){if(p&&(p.wa=+new Date),x){c(x);return}r.store.put(i(m),k,function(b,O){p&&(p.wp=+new Date),console.STAT&&console.STAT($,v=+new Date-$,"wrote disk",JSON.stringify(m),++S,"total all writes."),c(b,O||1),w.Q||delete h.disk[m]})})},y.split=function(){var k=+new Date;p&&(p.wf=k),y.text="",y.count||(y.count=0,n.map(w,function(){y.count++})),p&&(p.wfc=y.count),y.limit=Math.ceil(y.count/2);var $=y.count;return y.count=0,p&&(p.wf1=+new Date),y.sub=n(),n.map(w,y.slice,{reverse:1}),p&&(p.wf2=+new Date),h.write(y.end,y.sub,y.both,s),p&&(p.wf3=+new Date),y.hub=n(),n.map(w,y.stop),p&&(p.wf4=+new Date),h.write(w.file,y.hub,y.both,s),p&&(p.wf5=+new Date),console.STAT&&console.STAT(k,+new Date-k,"rad split",i(w.file),$),!0},y.slice=function(k,$){if(y.sub(y.end=$,k),y.limit<=++y.count)return!0},y.stop=function(k,$){if($>=y.end)return!0;y.hub($,k)},y.both=function(k,$){if(p&&(p.wfd=+new Date),T){c(k||T);return}if(A){c(k,$);return}A=!0,T=k},y.each=function(k,$,R,x){if(_!==k&&y.count++,r.max<=(k||"").length)return c("Data too big!"),!0;var E=e.encode(x.length)+"#"+e.encode(R)+(_===k?"":":"+e.encode(k))+`
`;if(r.chunk<y.text.length+E.length&&1<y.count&&!s.force)return y.split();y.text+=E},r.jsonify){h.write.jsonify(y,w,c,s,p);return}n.map(w,y.each,!0)||y.write()},h.write.jsonify=function(m,w,c,s,p){var y,A=+new Date;p&&(p.w=A);try{y=JSON.stringify(w.$)}catch{c("Cannot radisk!");return}if(p&&(p.ws=+new Date),console.STAT&&console.STAT(A,+new Date-A,"rad stringified JSON"),r.chunk<y.length&&!s.force){var T=0;if(n.map(w,function(){if(T++)return!0}),T>1)return m.split()}m.text=y,m.write()},h.range=function(m,w){if(!(!m||!w)){if(_===w.start&&_===w.end||u(m))return m;var c=n();return n.map(m,function(s,p){c(p,s)},w),c("")}},function(){h.read=function(m,w,c,s){c=c||{};var p={key:m};p.find=function(y){var A;if(p.file=y||(y=r.code.from),s&&(s=s[y]=s[y]||{}),s&&(s.rf=s.rf||+new Date),A=h.disk[p.file=y]){p.check(_,A);return}h.parse(y,p.check,_,s)},p.get=function(y,A,T){if(s&&(s.rgl=+new Date),s&&(s.rg=s.rg||+new Date),p.err=y||p.err){w(y);return}var k=p.file=(A||"").file||p.file;if(!A&&k!==r.code.from){h.find.bad(k),h.read(m,w,c);return}if(A=h.disk[k]||(h.disk[k]=A),!A){w(k===r.code.from?_:"No file!");return}A.file||(A.file=k);var $=h.range(A(m),c);if(s&&(s.rr=+new Date),c.unit=A.unit,c.chunks=(c.chunks||0)+1,c.parsed=(c.parsed||0)+((T||"").parsed||c.chunks*r.chunk),c.more=1,c.next=_,n.map(h.list,function(b,O){if(!(!b||k===O))return c.next=O,1},c.reverse?{reverse:1,end:k}:{start:k}),s&&(s.rl=+new Date),c.next||(c.more=0),c.next&&(!c.reverse&&(m<c.next&&c.next.indexOf(m)!=0||_!==c.end&&(c.end||"ï¿¿")<c.next)&&(c.more=0),c.reverse&&(m>c.next&&m.indexOf(c.next)!=0||_!==c.start&&(c.start||"")>c.next&&k<=c.start)&&(c.more=0)),!c.more){w(p.err,$,c);return}if($&&w(p.err,$,c),!(c.parsed>=c.limit)){var R=+new Date;s&&(s.rm=R);var x=c.next;l(function(){console.STAT&&console.STAT(R,+new Date-R,"rad more"),h.parse(x,p.check)},0)}},p.check=function(y,A,T){if(p.get(y,A,T),!(!A||A.check)){A.check=1;var k=+new Date;(T||(T={})).file||(T.file=p.file),n.map(A,function($,R){h.find(R,function(x){if((x||(x=r.code.from))!==T.file){var E=(""+Math.random()).slice(-3);f(function(){h.save(R,$,function b(O,C){if(O){h.save(R,$,b);return}console.STAT&&console.STAT("MISLOCATED DATA CORRECTED",E,i(R),i(T.file),i(x))})},0)}})}),console.STAT&&console.STAT(k,+new Date-k,"rad check")}},h.find(m||(c.reverse?c.end||"":c.start||""),p.find)}}(),function(){var m=0,w={},c="";h.parse=function(s,p,y,A){var T;if(!s)return p();if(T=w[s]){T.push(p);return}T=w[s]=[p];var k=function(){},$={file:s};(k.disk=n()).file=s,k.read=function(x,E){if(A&&(A.rpg=+new Date),console.STAT&&console.STAT(R,+new Date-R,"read disk",JSON.stringify(s),++m,"total all parses."),(k.err=x)||(k.not=!E)){delete w[s],k.map(T,k.ack);return}if(typeof E!="string"){try{r.max<=E.length?k.err="Chunk too big!":E=E.toString()}catch(b){k.err=b}if(k.err){delete w[s],k.map(T,k.ack);return}}if($.parsed=E.length,A&&(A.rpl=$.parsed),A&&(A.rpa=T.length),R=+new Date,!(r.jsonify||E[0]==="{")){k.radec(x,E);return}g(E,function(b,O){if(!b){delete w[s],k.disk.$=O,console.STAT&&(v=+new Date-R)>9&&console.STAT(R,v,"rad parsed JSON"),A&&(A.rpd=+new Date),k.map(T,k.ack);return}if(E[0]==="{"){delete w[s],k.err="JSON error!",k.map(T,k.ack);return}k.radec(b,E)})},k.map=function(){if(!(!T||!T.length)){for(var x=+new Date,E=k.err,b=k.not?_:k.disk,O=0,C;O<9&&(C=T[O++]);)C(E,b,$);console.STAT&&console.STAT(x,+new Date-x,"rad packs",i(s)),console.STAT&&console.STAT(x,O,"rad packs #",i(s)),(T=T.slice(O)).length&&f(k.map,0)}},k.ack=function(x){if(x){if(k.err||k.not){x(k.err,_,$);return}x(_,k.disk,$)}},k.radec=function(x,E){delete w[s],R=+new Date;var b=k.split(E),O=[],C,z,N;if(!b||b[1]!==0){k.err="File '"+s+"' does not have root radix! ",k.map(T,k.ack);return}for(;b;)z=N=_,C=b[1],b=k.split(b[2])||"",b[0]=="#"&&(z=b[1],O=O.slice(0,C),C<=O.length&&O.push(z)),b=k.split(b[2])||"",b[0]!=`
`&&((b[0]=="="||b[0]==":")&&(N=b[1]),_!==z&&_!==N&&k.disk(O.join(""),N),b=k.split(b[2]));console.STAT&&console.STAT(R,+new Date-R,"parsed RAD"),k.map(T,k.ack)},k.split=function(x){if(x){var E=[],b={},O=-1,C="";if(O=x.indexOf(c),!!x[O])return C=x.slice(0,O),E[0]=C,E[1]=e.decode(x.slice(O),b),E[2]=x.slice(O+b.i),E}},h.disk&&(y||(y=(h.disk[s]||"").raw));var R=+new Date;if(A&&(A.rp=R),y)return f(function(){k.read(_,y)},0);r.store.get(i(s),k.read)}}(),function(){var m,w="",c;h.find=function(y,A){if(!m){if(c){c.push([y,A]);return}c=[[y,A]],h.parse(w,s);return}n.map(h.list=m,function(T,k){if(T)return A(k)||!0},{reverse:1,end:y})||A(r.code.from)},h.find.add=function(y,A){var T=m(y);if(T||y===w){A(_,1);return}m(y,1),A.found=(A.found||0)+1,h.write(w,m,function(k,$){if(k){A(k);return}A.found=(A.found||0)-1,A.found===0&&A(_,1)},!0)},h.find.bad=function(y,A){m(y,0),h.write(w,m,A||d)};function s(y,A){if(y){r.log("list",y),setTimeout(function(){h.parse(w,s)},1e3);return}if(A){p(A);return}if(m=m||A||n(),!r.store.list){p(m);return}r.store.list(function(T){if(!T){p(m);return}h.find.add(T,d)})}function p(y,A){m=m||y,m.file=w,A=c,c=null,a(A,function(T){h.find(T[0],T[1])})}}();try{!t.window&&fc()(h)}catch{}var d=function(){},_;return e.has[r.file]=h,h}if(function(){var r="";e.encode=function(o,i,u){u=u||r;var l=u,f;if(typeof o=="string"){for(var a=o.indexOf(u);a!=-1;)l+=u,a=o.indexOf(u,a+1);return l+'"'+o+u}else{if(o&&o["#"]&&Object.keys(o).length==1)return l+"#"+f+l;if(typeof o=="number")return l+"+"+(o||0)+l;if(o===null)return l+" "+l;if(o===!0)return l+"+"+l;if(o===!1)return l+"-"+l}},e.decode=function(o,i,u){u=u||r;var l="",f=-1,a=0,v,g;if(u===o[0]){for(;u===o[++f];)++a;for(g=o[v=a]||!0;--a>=0;)f=o.indexOf(u,f+1);if(f==-1&&(f=o.length),l=o.slice(v+1,f),i&&(i.i=f+1),g==='"')return l;if(g==="#")return{"#":l};if(g==="+")return l.length===0?!0:parseFloat(l);if(g===" ")return null;if(g==="-")return!1}}}(),typeof window<"u"){var t=window.Gun,n=window.Radix;window.Radisk=e}else{var t=ke(),n=tn();try{Ot.exports=e}catch{}}e.Radix=n}()),Ot.exports}Pr();var Bn={},Gn;function lc(){if(Gn)return Bn;Gn=1;var e={},t=typeof window<"u"?window.Gun:ke();return t.on("create",function(n){t.TESTING&&(n.opt.file="radatatest"),this.to.next(n);var r=n.opt,o;if(!(r.rad===!1||r.radisk===!1)&&!(o+""!=typeof process&&""+(e||"").RAD=="false")){var i=t.window&&t.window.Radisk||Pr(),u=i.Radix,l=i(r),f="\x1B",a=0;n.on("put",function(g){if(this.to.next(g),!(g._||"").rad){var h=g["#"],S=g.put,d=S["#"],_=S["."],m=S[":"],w=S[">"],c=(g._||"").DBG;c&&(c.sp=c.sp||+new Date);var s=(g._||"").RPS||((g._||"").RPS=+new Date);l(d+f+_,{":":m,">":w},function(p,y){if(c&&(c.spd=c.spd||+new Date),console.STAT&&console.STAT(s,+new Date-s,"put"),p){n.on("in",{"@":h,err:p,DBG:c});return}n.on("in",{"@":h,ok:y,DBG:c})},!1,c&&(c.r=c.r||{})),c&&(c.sps=c.sps||+new Date)}}),n.on("get",function(g){this.to.next(g);var h=g._||"",S=h.DBG=g.DBG;S&&(S.sg=+new Date);var d=g["#"],_=g.get,m=g.get["#"],w=g.get["."]||"",c={},s,p,y,A;if(typeof m=="string"?p=m:m&&(o!==(y=m["*"])&&(c.limit=A=1),o!==m[">"]&&(c.start=m[">"]),o!==m["<"]&&(c.end=m["<"]),p=A?""+y:y||m["="],A=null),p&&!c.limit&&(typeof w=="string"?p=p+f+(c.atom=w):w&&(o!==w[">"]&&(c.start=w[">"],c.limit=1),o!==w["<"]&&(c.end=w["<"],c.limit=1),o!==(y=w["*"])&&(c.limit=A=1),p&&(p=p+f+(A?""+(y||""):y||(c.atom=w["="]||""))))),((y=_["%"])||c.limit)&&(c.limit=y<=(c.pack||1e3*100)?y:1),(w["-"]||(m||{})["-"]||_["-"])&&(c.reverse=!0),(y=(n.next||"")[m])&&y.put){if(c.atom){if(y=(y.next||"")[c.atom],y&&y.root&&y.root.graph&&y.root.graph[m]&&y.root.graph[m][c.atom])return}else if(y&&y.rad)return}var T=t.state(),k=+new Date,$=0;S&&(S.sgm=k),l(p||"",function(x,E,b){S&&(S.sgr=+new Date),S&&(S.sgi=b);try{r.store.stats.get.time[v%50]=+new Date-k,++v,r.store.stats.get.count++,x&&(r.store.stats.get.err=x)}catch{}console.STAT&&console.STAT(k,+new Date-k,"got",JSON.stringify(p)),k=+new Date,b=b||"";var O,C;if(b.unit&&E&&o!==(O=E[":"])&&o!==(C=E[">"])){var z=p.split(f),N=z[0],j=z[1];(s=s||{})[N]=t.state.ify(s[N],j,C,O,N),n.$.get(N).get(j)._.rad=T}else E&&(typeof E!="string"&&(c.atom?E=o:u.map(E,R,c)),!s&&E&&R(E,""),!c.atom&&!w&typeof m=="string"&&!c.limit&&!c.more&&(n.$.get(m)._.rad=T));S&&(S.sgp=+new Date),console.STAT&&(a=+new Date-k)>9&&(console.STAT(k,a,"got prep time"),console.STAT(k,$,"got prep #")),$=0,k=+new Date;var D=function(){};D.faith=!0,D.rad=_,n.on("in",{"@":d,put:s,"%":b.more?1:o,err:x||o,_:D,DBG:S}),console.STAT&&(a=+new Date-k)>9&&console.STAT(k,a,"got emit",Object.keys(s||{}).length),s=o},c,S&&(S.r=S.r||{})),S&&(S.sgd=+new Date),console.STAT&&(a=+new Date-k)>9&&console.STAT(k,a,"get call");function R(x,E,b,O){if($++,!!x){E=(p+E).split(f);var C=E.slice(0,1)[0];if(E=E.slice(-1)[0],c.limit&&c.limit<=c.count)return!0;var z,N,j=C,D=E;if(typeof x!="string"){z=x[":"],N=x[">"],(s=s||{})[j]=t.state.ify(s[j],D,N,z,j),c.count=(c.count||0)+((z||"").length||9);return}c.count=(c.count||0)+x.length;var Z=x.lastIndexOf(">"),U=i.decode(x.slice(Z+1),null,f);x=i.decode(x.slice(0,Z),null,f),(s=s||{})[C]=t.state.ify(s[C],E,U,x,C)}}}),t.valid,(r.store||{}).stats={get:{time:{},count:0},put:{time:{},count:0}};var v=0}}),Bn}lc();var Ct={exports:{}},Vn;function hc(){return Vn||(Vn=1,function(){function e(n){n=n||{},n.file=String(n.file||"radata");var r=e[n.file],o=null,i;if(r)return console.log("Warning: reusing same IndexedDB store and options as 1st."),e[n.file];r=e[n.file]=function(){};try{n.indexedDB=n.indexedDB||e.indexedDB||indexedDB}catch{}try{if(!n.indexedDB||location.protocol=="file:"){var u=r.d||(r.d={});return r.put=function(l,f,a){u[l]=f,setTimeout(function(){a(null,1)},250)},r.get=function(l,f){setTimeout(function(){f(null,u[l]||i)},5)},console.log("Warning: No indexedDB exists to persist data to!"),r}}catch{}return r.start=function(){var l=indexedDB.open(n.file,1);l.onupgradeneeded=function(f){f.target.result.createObjectStore(n.file)},l.onsuccess=function(){o=l.result},l.onerror=function(f){console.log(f||1)}},r.start(),r.put=function(l,f,a){if(!o){setTimeout(function(){r.put(l,f,a)},1);return}var v=o.transaction([n.file],"readwrite"),g=v.objectStore(n.file),h=g.put(f,""+l);h.onsuccess=g.onsuccess=v.onsuccess=function(){a(null,1)},h.onabort=g.onabort=v.onabort=function(S){a(S||"put.tx.abort")},h.onerror=g.onerror=v.onerror=function(S){a(S||"put.tx.error")}},r.get=function(l,f){if(!o){setTimeout(function(){r.get(l,f)},9);return}var a=o.transaction([n.file],"readonly"),v=a.objectStore(n.file),g=v.get(""+l);g.onsuccess=function(){f(null,g.result)},g.onabort=function(h){f(h||4)},g.onerror=function(h){f(h||5)}},setInterval(function(){o&&o.close(),o=null,r.start()},1e3*15),r}if(typeof window<"u")(e.window=window).RindexedDB=e,e.indexedDB=window.indexedDB;else try{Ct.exports=e}catch{}try{var t=e.window.Gun||ke();t.on("create",function(n){this.to.next(n),n.opt.store=n.opt.store||e(n.opt)})}catch{}}()),Ct.exports}hc();var qn={},Hn;function pc(){return Hn||(Hn=1,function(){var e=typeof window<"u"?window.Gun:ke();e.on("opt",function(t){this.to.next(t);var n=t.opt;if(t.once||!e.Mesh||n.RTCPeerConnection===!1)return;var r;typeof window<"u"&&(r=window),typeof Ie<"u"&&(r=Ie),r=r||{};var o=n.RTCPeerConnection||r.RTCPeerConnection||r.webkitRTCPeerConnection||r.mozRTCPeerConnection,i=n.RTCSessionDescription||r.RTCSessionDescription||r.webkitRTCSessionDescription||r.mozRTCSessionDescription,u=n.RTCIceCandidate||r.RTCIceCandidate||r.webkitRTCIceCandidate||r.mozRTCIceCandidate;if(!o||!i||!u)return;n.RTCPeerConnection=o,n.RTCSessionDescription=i,n.RTCIceCandidate=u,n.rtc=n.rtc||{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.sipgate.net:3478"}]},n.rtc.dataChannel=n.rtc.dataChannel||{ordered:!1,maxRetransmits:2},n.rtc.sdp=n.rtc.sdp||{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},n.rtc.max=n.rtc.max||55,n.rtc.room=n.rtc.room||e.window&&(location.hash.slice(1)||location.pathname.slice(1)),n.announce=function(a){n.rtc.start=+new Date,t.$.get("/RTC/"+n.rtc.room+"<?99").get("+").put(n.pid,function(v){!v.ok||!v.ok.rtc||f(v)},{acks:n.rtc.max}).on(function(v,g,h){v===n.pid||n.rtc.start>h.put[">"]||f({"#":""+h["#"],ok:{rtc:{id:v}}})})};var l=n.mesh=n.mesh||e.Mesh(t);t.on("create",function(a){this.to.next(a),setTimeout(n.announce,1)});function f(a){if(this&&this.off&&this.off(),!!a.ok){var v=a.ok.rtc,g,h;if(!(!v||!v.id||v.id===n.pid)){if(h=v.answer)return!(g=n.peers[v.id]||f[v.id])||g.remoteSet?void 0:(h.sdp=h.sdp.replace(/\\r\\n/g,`\r
`),g.setRemoteDescription(g.remoteSet=new n.RTCSessionDescription(h)));if(h=v.candidate)return g=n.peers[v.id]||f[v.id]||f({ok:{rtc:{id:v.id}}}),g.addIceCandidate(new n.RTCIceCandidate(h));if(!f[v.id]){(g=new n.RTCPeerConnection(n.rtc)).id=v.id;var S=g.wire=g.createDataChannel("dc",n.rtc.dataChannel);if(f[v.id]=g,S.to=setTimeout(function(){delete f[v.id]},1e3*60),S.onclose=function(){l.bye(g)},S.onerror=function(d){},S.onopen=function(d){delete f[v.id],l.hi(g)},S.onmessage=function(d){d&&l.hear(d.data||d,g)},g.onicecandidate=function(d){d.candidate&&t.on("out",{"@":a["#"],ok:{rtc:{candidate:d.candidate,id:n.pid}}})},g.ondatachannel=function(d){var _=d.channel;_.onmessage=S.onmessage,_.onopen=S.onopen,_.onclose=S.onclose},h=v.offer){v.offer.sdp=v.offer.sdp.replace(/\\r\\n/g,`\r
`),g.setRemoteDescription(new n.RTCSessionDescription(h)),g.createAnswer(function(d){g.setLocalDescription(d),t.on("out",{"@":a["#"],ok:{rtc:{answer:d,id:n.pid}}})},function(){},n.rtc.sdp);return}return g.createOffer(function(d){g.setLocalDescription(d),t.on("out",{"@":a["#"],"#":t.ask(f),ok:{rtc:{offer:d,id:n.pid}}})},function(){},n.rtc.sdp),g}}}}})}()),qn}pc();function Ur(e){if(!e||typeof e!="object"||Array.isArray(e))return e;const t={};for(const[n,r]of Object.entries(e))n.startsWith("_")||(t[n]=r);return t}function dc(e){try{let t;if(typeof e=="string")try{t=JSON.parse(e)}catch(r){return console.error("Error parsing tree data JSON:",r),null}else t=e;const n=Ir.safeParse(t);return n.success?n.data:(console.error("Tree data validation failed:",n.error),null)}catch(t){return console.error("Error parsing tree data:",t),null}}function Mr(e){try{let t;if(typeof e=="string")try{t=JSON.parse(e)}catch(r){return console.error("[VALIDATION] Error parsing capacities data JSON:",r),{}}else t=e;t=Ur(t),console.log("[VALIDATION] Pre-validation capacities data:",t);const n=tc.safeParse(t);if(n.success){let r=function(i,u,l=[]){const f={};return typeof i!=typeof u?(f[l.join(".")]={original:i,validated:u},f):(typeof i=="object"&&i!==null?Object.keys({...i,...u}).forEach(a=>{const v=r(i[a],u[a],[...l,a]);Object.assign(f,v)}):i!==u&&(f[l.join(".")]={original:i,validated:u}),f)};console.log("[VALIDATION] Capacities validation successful");const o=r(t,n.data);return Object.keys(o).length>0?console.log("[VALIDATION] Validation made the following changes:",o):console.log("[VALIDATION] Validation made no changes to data"),console.log("[VALIDATION] Validated Capacities data:",n.data),n.data}else return console.error("[VALIDATION] Capacities validation failed. Data:",t),console.error("[VALIDATION] Validation errors:",n.error.issues),console.error("[VALIDATION] Validation error paths:",n.error.issues.map(r=>r.path)),{}}catch(t){return console.error("[VALIDATION] Error during capacities validation:",t),{}}}function gc(e){try{let t;if(typeof e=="string")try{t=JSON.parse(e)}catch(r){return console.error("Error parsing share map JSON:",r),{}}else t=e;t=Ur(t);const n=Hs.safeParse(t);return n.success?n.data:(console.error("Share map validation failed:",n.error),{})}catch(t){return console.error("Error parsing share map:",t),{}}}typeof It.SEA>"u"&&(It.SEA=ac);const ye=It({peers:["http://localhost:8765/gun","https://gun-manhattan.herokuapp.com/gun","https://peer.wallie.io/gun","https://gun.defucc.me/gun"],localStorage:!1}),Ce=Q(!0);let M=ye.user().recall({sessionStorage:!0});const fe=Q(""),se=Q(""),le=ye.get("freely-associating-players"),Vc=Q({});async function qc(e){try{return le.get(e).get("name")}catch(t){console.log(`[USER-NAME] Could not fetch from freely-associating-players for ${e}:`,t)}try{return ye.get(`~${e}`).get("alias")}catch(t){console.log(`[USER-NAME] Could not fetch alias for user ${e}:`,t)}return e.substring(0,8)+"..."}typeof window<"u"&&(async()=>{var t,n,r;try{if(Ce.set(!0),await new Promise(o=>setTimeout(o,100)),M._.sea){console.log("[RECALL] User authenticated via SEA check:",M.is.alias),fe.set(M.is.alias),se.set(M.is.pub),le.get((t=M.is)==null?void 0:t.pub).put({name:M.is.alias,lastSeen:Date.now()}),ot();return}(n=M==null?void 0:M.is)!=null&&n.pub?(console.log("[RECALL] User authenticated via pub check:",M.is.alias),fe.set(M.is.alias),se.set(M.is.pub),le.get((r=M.is)==null?void 0:r.pub).put({name:M.is.alias,lastSeen:Date.now()}),ot()):(console.log("[RECALL] No authenticated user found after recall"),fe.set(""),se.set(""))}catch(o){console.error("[RECALL] Error during authentication check:",o),fe.set(""),se.set("")}finally{Ce.set(!1)}})();ye.on("auth",async()=>{var e,t,n,r,o,i;try{if(Ce.set(!0),M._.sea){console.log("[AUTH] User authenticated via SEA check:",M.is.alias);const l=await M.get("alias");fe.set(l),se.set((e=M.is)==null?void 0:e.pub),le.get((t=M.is)==null?void 0:t.pub).put({name:l,lastSeen:Date.now()}),console.log(`signed in as ${l}`),console.log(`userPub: ${(n=M.is)==null?void 0:n.pub}`),ot();return}const u=await M.get("alias");if(u)console.log("[AUTH] User authenticated via alias check:",u),fe.set(u),se.set((r=M.is)==null?void 0:r.pub),le.get((o=M.is)==null?void 0:o.pub).put({name:u,lastSeen:Date.now()}),console.log(`signed in as ${u}`),console.log(`userPub: ${(i=M.is)==null?void 0:i.pub}`),ot();else throw new Error("Authentication failed - no alias found")}catch(u){console.error("[AUTH] Error during authentication:",u),fe.set(""),se.set("")}finally{Ce.set(!1)}});function vc(e,t){M.auth(e,t,({err:n})=>n&&alert(n))}function Hc(e,t){ye.get(`~@${e}`).once(n=>{if(n){console.log("[SIGNUP] checking alias user data",n),alert("Username already taken");return}M.create(e,t,({err:r})=>{r?alert(r):vc(e,t)})},{wait:2e3})}async function Yc(){for(M.leave();M._.sea!=null;)await new Promise(requestAnimationFrame);fe.set(""),se.set("")}function Lr(){if(L(Ae)){console.log("[PERSIST] Skipping tree persistence because tree is being loaded");return}const e=L(ue);if(e){console.log("[PERSIST] Starting tree persistence..."),console.log("[PERSIST] Tree structure before serialization:",{id:e.id,childCount:e.children.length});const t=JSON.stringify(structuredClone(e));console.log("[PERSIST] Serialized tree length:",t.length),console.log("[PERSIST] Tree JSON preview:",t.substring(0,100)+"..."),M.get("tree").put(t,n=>{n.err?console.error("[PERSIST] Error saving tree to Gun:",n.err):console.log("[PERSIST] Tree successfully saved to Gun")})}}function yc(){if(L(Dt)){console.log("[PERSIST] Skipping SOGF persistence because SOGF is being loaded");return}const e=L(lt);e&&M.get("sogf").put(structuredClone(e))}function mc(){if(L(it)){console.log("[PERSIST] Skipping capacities persistence because capacities are being loaded");return}const e=L(We);if(e){console.log("[PERSIST] Starting capacities persistence..."),console.log("[PERSIST] Capacities count:",Object.keys(e).length);try{const t=structuredClone(e);console.log("[PERSIST] Saving capacities:",t);const n=JSON.stringify(t);console.log("[PERSIST] Serialized capacities length:",n.length),M.get("capacities").put(n,r=>{r.err?console.error("[PERSIST] Error saving capacities to Gun:",r.err):console.log("[PERSIST] Capacities successfully saved to Gun")})}catch(t){console.error("[PERSIST] Error serializing capacities:",t)}}}function wc(){var n;if(!((n=M.is)==null?void 0:n.pub)){console.log("[PERSIST] No user ID available, cannot persist contributor capacity shares");return}const t=L(Kr);console.log("[PERSIST] Persisting contributor capacity shares:",t),Object.entries(t).forEach(([r,o])=>{M.get("capacityShares").get(r).put(JSON.stringify(o),i=>{i.err?console.error(`[PERSIST] Error persisting capacity shares for contributor ${r}:`,i.err):console.log(`[PERSIST] Successfully persisted capacity shares for contributor ${r}`)})})}function ot(){console.log("[MANIFEST] Loading data from Gun"),Ae.set(!0);let e=!1;const t=(n,r=!1)=>{var i,u,l,f;if(console.log(`[MANIFEST] Raw tree data from Gun (${r?"retry":"initial"}):`,typeof n=="string"?`String of length ${n.length}`:"Object:",n),n!=null){const a=dc(n);if(a&&((i=M.is)!=null&&i.pub)){console.log("[MANIFEST] Loaded tree with children count:",((u=a.children)==null?void 0:u.length)||0),((l=a.children)==null?void 0:l.length)>0&&console.log("[MANIFEST] First child:",a.children[0]),ue.set(a),e=!0,Ae.set(!1),setTimeout(()=>{console.log("[MANIFEST] Triggering tree recalculation after load"),ue.set(a)},50);return}}if(r&&((f=M.is)!=null&&f.pub)&&!e){console.log("[MANIFEST] No valid tree data found after retry, creating initial tree");const a=Vo(L(se),L(fe),L(se));ue.set(a),M.get("tree").put(JSON.stringify(a)),Ae.set(!1)}else!r&&n==null?(console.log("[MANIFEST] Tree data undefined, retrying in 2s..."),setTimeout(()=>{e||M.get("tree").once(a=>t(a,!0))},2e3)):r&&(console.log("[MANIFEST] No tree data available and no user context"),Ae.set(!1))};M.get("tree").once(t),Dt.set(!0),M.get("sogf").once(n=>{if(n){const r=gc(n);lt.set(r)}Dt.set(!1)}),it.set(!0),M.get("capacities").once(n=>{if(console.log("[MANIFEST] Loading capacities data..."),n){console.log("[MANIFEST] Capacities data:",n);const r=Mr(n);console.log("[MANIFEST] Loaded capacities count:",Object.keys(r).length),console.log("[MANIFEST] Post-Validation capacities:",r),We.set(r)}else console.log("[MANIFEST] No capacities data found");it.set(!1)})}function bc(e){const t=/^(\d+)(s|m|h|d|w|mo)$/i,n=e.match(t);if(!n)throw new Error(`Invalid duration format: '${e}'`);const r=parseInt(n[1],10),o=n[2].toLowerCase(),i={s:1e3,m:60*1e3,h:60*60*1e3,d:24*60*60*1e3,w:7*24*60*60*1e3,mo:30*24*60*60*1e3};return r*i[o]}function _c(e="30m"){let t;try{t=bc(e)}catch(r){console.error(`[PRUNE] ${r}`);return}console.log(`[PRUNE] Starting to prune users inactive for more than ${e}...`);const n=Date.now()-t;le.once(r=>{if(r){const o=Object.keys(r);console.log(`[PRUNE] Found ${o.length} users to check`);let i=0,u=0;o.forEach(l=>{le.get(l).once(f=>{if(u++,f&&f.lastSeen){const a=f.lastSeen;a<n?le.get(l).put(null,v=>{v.err?console.error(`[PRUNE] Error removing inactive user ${l}:`,v.err):(console.log(`[PRUNE] Removed inactive user ${l} (last seen: ${new Date(a).toLocaleString()})`),i++)}):console.log(`[PRUNE] User ${l} is active (last seen: ${new Date(a).toLocaleString()})`)}else console.log(`[PRUNE] User ${l} has no lastSeen data, removing...`),le.get(l).put(null,a=>{a.err?console.error(`[PRUNE] Error removing user without lastSeen ${l}:`,a.err):(console.log(`[PRUNE] Removed user without lastSeen data: ${l}`),i++)});u===o.length&&console.log(`[PRUNE] Pruning complete. Checked ${u} users, removed ${i} inactive users.`)})})}else console.log("[PRUNE] No users found to prune")})}typeof window<"u"&&(window.clearUsersList=_c,console.log("[DEBUG] clearUsersList function exposed to window"));const ue=Q(null),lt=Q(null),We=Q(null),Le=Q({}),Ee=Q({}),Xc=pe([Ee,Le],([e,t])=>{if(!e||!t)return console.log("[NETWORK-CAPACITIES] No network data available, returning empty"),{};console.log("networkCapacityShares",e),console.log("networkCapacities",t);const n={};return Object.entries(e).forEach(([r,o])=>{const i=t[r];i&&Object.entries(o).forEach(([u,l])=>{const f=i[u];f&&(n[u]={...f,share_percentage:l,computed_quantity:(f.quantity||0)*l,provider_id:r})})}),console.log(`[NETWORK-CAPACITIES] Found ${Object.keys(n).length} capacities where we have shares`),n}),Je=Q({}),ht=Q([]),xt=Q([]),he=Q({}),nn=pe(he,e=>{console.log(`[MUTUAL-RECOGNITION] ${new Date().toISOString()} Recalculating from cache:`,e);const t={};for(const[n,r]of Object.entries(e)){const o=Math.min(r.ourShare,r.theirShare);t[n]=o,console.log(`[MUTUAL-RECOGNITION] ${n}: our=${r.ourShare.toFixed(4)}, their=${r.theirShare.toFixed(4)}, mutual=${o.toFixed(4)}`)}return console.log("[MUTUAL-RECOGNITION] Final mutual values:",t),t}),Fr=pe(nn,e=>Object.entries(e).filter(([n,r])=>r>0).map(([n,r])=>n)),Wr=pe(nn,e=>{if(console.log(`[PROVIDER-SHARES] ${new Date().toISOString()} Recalculating from mutual recognition:`,e),Object.keys(e).length===0)return console.log("[PROVIDER-SHARES] No mutual recognition data, returning empty"),{};const t=ut(e);return console.log("[PROVIDER-SHARES] Normalized shares:",t),t}),Sc=pe([ue,Je],([e,t])=>{if(!e)return console.log("[SUBTREE-MAP] No tree available, returning empty map"),{};console.log("[SUBTREE-MAP] Calculating subtree contributor map...");const n=lr(e);return console.log("[SUBTREE-MAP] Generated filter map for",Object.keys(n).length,"subtrees"),n}),Jr=pe([We,Wr,Je,Sc],([e,t,n,r])=>{if(console.log(`[CAPACITY-SHARES] ${new Date().toISOString()} Recalculating from capacities and provider shares`),!e||Object.keys(t).length===0)return console.log("[CAPACITY-SHARES] No capacities or provider shares, returning empty"),{};const o={};return Object.entries(e).forEach(([i,u])=>{try{const f=Wo(u,t,{node:n,subtreeContributors:r});o[i]=f}catch(l){console.error("[CAPACITY-SHARES] Error calculating shares for capacity:",i,l),o[i]={}}}),console.log("[CAPACITY-SHARES] Generated shares for",Object.keys(o).length,"capacities"),o}),Kr=pe(Jr,e=>{console.log(`[CAPACITY-SHARES] ${new Date().toISOString()} Recalculating from capacity shares`);const t={};return Object.entries(e).forEach(([n,r])=>{Object.entries(r).forEach(([o,i])=>{t[o]||(t[o]={}),t[o][n]=i})}),console.log("[CAPACITY-SHARES] Generated contributor shares map:",t),t}),Qc=pe([We,Jr],([e,t])=>{if(console.log(`[CAPACITIES-WITH-SHARES] ${new Date().toISOString()} Combining capacities with shares`),!e)return console.log("[CAPACITIES-WITH-SHARES] No capacities available, returning null"),null;const n={};return Object.entries(e).forEach(([r,o])=>{const i=t[r]||{};n[r]={...o,recipient_shares:i}}),console.log("[CAPACITIES-WITH-SHARES] Generated",Object.keys(n).length,"capacities with shares"),n});pe([ue,Je],([e,t])=>{if(!e)return[];const n=lr(e);return Object.entries(n).map(([r,o])=>{const i=Object.keys(o),u=Kt(e,r),l=(u==null?void 0:u.name)||r;return{id:r,name:l,contributorCount:i.length,contributors:i}}).filter(r=>r.contributorCount>0)});const it=Q(!1),Ae=Q(!1),Dt=Q(!1),Zt=Q(!1);function kc(){console.log("[RECALC] Starting tree recalculation...");const e=L(ue);if(!e){console.error("[RECALC] Tree is missing, cannot proceed with recalculation");return}console.log("[RECALC] Processing tree with",e.children.length,"children");try{Zt.set(!0);try{console.log("[RECALC] Collecting contributors from tree...");const t=Bo(e);ht.set(t),console.log("[RECALC] Found",t.length,"contributors");const n=L(xt),r=[...new Set([...n,...t])];xt.set(r),console.log("[RECALC] Total known contributors:",r.length)}catch(t){console.error("[RECALC] Error collecting contributors:",t)}try{console.log("[RECALC] Calculating SOGF...");const t=L(xt),n=L(Je),r=Go(e,n,t);lt.set(r),yc(),console.log("[RECALC] SOGF calculation complete for",t.length,"known contributors"),t.forEach(o=>{const i=r[o]||0,u=L(he)[o],l=(u==null?void 0:u.theirShare)||0;console.log(`[RECALC] Updating recognition for ${o}: ourShare=${i.toFixed(4)}, theirShare=${l.toFixed(4)}`),Tc(o,i,l)})}catch(t){console.error("[RECALC] Error calculating SOGF:",t)}console.log("[RECALC] Tree recalculation process complete")}finally{Zt.set(!1)}}function Tc(e,t,n){console.log(`[MUTUAL] Updating cache for ${e}: our=${t.toFixed(4)}, their=${n.toFixed(4)}`),he.update(o=>{const i=o[e];return o[e]={ourShare:t,theirShare:n,timestamp:Date.now()},console.log(`[MUTUAL] Cache entry for ${e}:`,{old:i,new:o[e]}),o});const r=L(he);console.log("[MUTUAL] Full recognition cache after update:",r)}function Ac(e,t){console.log(`[NETWORK] Received share from ${e}: ${t.toFixed(4)}`);const r=L(he)[e];console.log(`[NETWORK] Existing cache entry for ${e}:`,r),he.update(i=>(r?(console.log(`[NETWORK] Updating existing entry for ${e}`),i[e]={...i[e],theirShare:t,timestamp:Date.now()}):(console.log(`[NETWORK] Creating new entry for ${e} with ourShare=0`),i[e]={ourShare:0,theirShare:t,timestamp:Date.now()}),console.log(`[NETWORK] Updated cache entry for ${e}:`,i[e]),i));const o=L(he);console.log(`[NETWORK] Cache after network update from ${e}:`,o)}function Br(e){console.log(`[NETWORK] Setting up subscription to ${e}'s SOGF`),ye.get(`~${e}`).get("sogf").on(n=>{var f;if(!n)return;console.log(`[NETWORK] Received SOGF update from ${e}`);const r=(f=M.is)==null?void 0:f.pub;if(!r)return;const o=n[r]||0,u=L(he)[e];if(u&&u.theirShare===o){console.log(`[NETWORK] Ignoring duplicate SOGF update from contributor ${e}: share=${o}`);return}Ac(e,o)})}function Ec(e){console.log(`[NETWORK] Setting up subscription to ${e}'s capacities`),ye.get(`~${e}`).get("capacities").on(n=>{var l;if(!n||(console.log(`[NETWORK] Received capacities update from ${e}:`,n),!((l=M.is)==null?void 0:l.pub)))return;const o=Mr(n);if(!o||Object.keys(o).length===0){console.error("[NETWORK] Failed to validate capacities from contributor:",e);return}const i=L(Le)[e]||{};if(JSON.stringify(o)===JSON.stringify(i)){console.log(`[NETWORK] Ignoring duplicate capacities update for contributor ${e}`);return}Le.update(f=>{const a={...f};return a[e]=o,console.log(`[NETWORK] Updated networkCapacities for ${e}: added ${Object.keys(o).length} capacities`),a})})}function Oc(e){var n;const t=(n=M.is)==null?void 0:n.pub;if(!t){console.log("[NETWORK] Cannot subscribe to capacity shares - not authenticated");return}console.log(`[NETWORK] Setting up capacity shares subscription for contributor: ${e}`),ye.get(`~${e}`).get("capacityShares").get(t).on(r=>{if(!r){console.log(`[NETWORK] No capacity shares from contributor ${e}`),Ee.update(o=>{const{[e]:i,...u}=o;return u});return}try{let o;typeof r=="string"?o=JSON.parse(r):o=r;const i={};Object.entries(o).forEach(([f,a])=>{typeof a=="number"&&a>=0&&a<=1?i[f]=a:console.warn(`[NETWORK] Invalid share value for capacity ${f}:`,a)});const u=L(Ee)[e]||{};if(JSON.stringify(i)===JSON.stringify(u)){console.log(`[NETWORK] Ignoring duplicate update for contributor ${e}`);return}console.log(`[NETWORK] Received new capacity shares from contributor ${e}:`,i),Ee.update(f=>({...f,[e]:i}))}catch(o){console.error(`[NETWORK] Error parsing/validating capacity shares from contributor ${e}:`,o)}})}ht.subscribe(e=>{var t;if(L(Ce)){console.log("[NETWORK] Skipping contributor subscription while authenticating");return}if(!e.length){console.log("[NETWORK] No contributors to subscribe to");return}if(!((t=M.is)!=null&&t.pub)){console.log("[NETWORK] Cannot subscribe to contributors - not authenticated");return}console.log(`[NETWORK] Contributors changed, now have ${e.length}, setting up subscriptions`),e.forEach(n=>{try{console.log(`[NETWORK] Setting up subscription for contributor: ${n}`),Br(n)}catch(r){console.error(`[NETWORK] Error subscribing to contributor ${n}:`,r)}})});Fr.subscribe(e=>{var t;if(L(Ce)){console.log("[NETWORK] Skipping mutual contributor subscription while authenticating");return}if(!e.length){Le.set({}),Ee.set({});return}if(!((t=M.is)!=null&&t.pub)){console.log("[NETWORK] Cannot subscribe to mutual contributors - not authenticated");return}console.log(`[NETWORK] Mutual contributors changed, now have ${e.length}, setting up subscriptions`),Le.update(n=>{if(!n)return{};const r={};return Object.entries(n).forEach(([o,i])=>{e.includes(o)&&(r[o]=i)}),console.log(`[NETWORK] Cleaned network capacities: kept ${Object.keys(r).length} contributors from ${Object.keys(n).length} total`),r}),Ee.update(n=>{const r={};return Object.entries(n).forEach(([o,i])=>{e.includes(o)&&(r[o]=i)}),console.log(`[NETWORK] Cleaned capacity shares: kept ${Object.keys(r).length} contributors from ${Object.keys(n).length} total`),r}),e.forEach(n=>{try{console.log(`[NETWORK] Setting up subscriptions for mutual contributor: ${n}`),Ec(n),Oc(n)}catch(r){console.error(`[NETWORK] Error subscribing to mutual contributor ${n}:`,r)}})});ue.subscribe(e=>{if(e){let t=function(r){n[r.id]=r,r.children.forEach(t)};console.log("[TREE-SUB] Tree updated in store, rebuilding nodes map"),console.log("[TREE-SUB] Tree has",e.children.length,"children");const n={};t(e),Je.set(n),console.log("[TREE-SUB] Rebuilt nodes map with",Object.keys(n).length,"nodes"),console.log("[TREE-SUB] Forcing immediate tree persistence"),Lr()}});let Ye=null;ue.subscribe(e=>{if(e){if(console.log("[TREE-RECALC-SUB] Tree updated, scheduling recalculation"),console.log("[TREE-RECALC-SUB] Tree has",e.children.length,"children"),L(Ae)){console.log("[TREE-RECALC-SUB] Skipping recalculation because tree is being loaded");return}if(L(Zt)){console.log("[TREE-RECALC-SUB] Skipping recalculation because update is from recalculation");return}Ye&&(console.log("[TREE-RECALC-SUB] Clearing previous recalc timer"),clearTimeout(Ye)),console.log("[TREE-RECALC-SUB] Setting new recalc timer for 300ms"),Ye=setTimeout(()=>{console.log("[TREE-RECALC-SUB] Timer fired, running recalculation");try{kc()}catch(t){console.error("[TREE-RECALC-SUB] Error during recalculation:",t),console.log("[TREE-RECALC-SUB] Forcing tree persistence after error"),Lr()}Ye=null},300)}});We.subscribe(e=>{if(e)if(console.log("[CAPACITIES-SUB] Capacities updated"),console.log("[CAPACITIES-SUB] Capacities count:",Object.keys(e).length),L(it))console.log("[CAPACITIES-SUB] Skipping persistence because capacities are being loaded");else{console.log("[CAPACITIES-SUB] Persisting capacities");try{mc()}catch(t){console.error("[CAPACITIES-SUB] Error during persistence:",t)}}});Kr.subscribe(e=>{console.log("[CONTRIBUTOR-CAPACITY-SHARES-SUB] Contributor capacity shares updated"),console.log("[CONTRIBUTOR-CAPACITY-SHARES-SUB] Contributor capacity shares count:",Object.keys(e).length),wc()});function $c(){console.log("=== RECOGNITION DEBUG STATE ===");const e=L(ht),t=L(Fr),n=L(he),r=L(nn),o=L(Wr),i=L(lt);console.log("Contributors:",e),console.log("Mutual Contributors:",t),console.log("User SOGF:",i),console.log("=== DETAILED RECOGNITION CACHE ==="),Object.entries(n).forEach(([u,l])=>{console.log(`${u}:`,{ourShare:l.ourShare,theirShare:l.theirShare,mutual:Math.min(l.ourShare,l.theirShare),timestamp:new Date(l.timestamp).toISOString()})}),console.log("Mutual Recognition:",r),console.log("Provider Shares:",o),console.log("=== END DEBUG ===")}function Cc(){console.log("[DEBUG] Manually triggering subscriptions for all contributors");const e=L(ht);e.forEach(t=>{console.log(`[DEBUG] Setting up subscription for: ${t}`),Br(t)}),console.log(`[DEBUG] Set up ${e.length} subscriptions`)}typeof window<"u"&&(window.debugRecognition=$c,window.debugTriggerSubscriptions=Cc);const ce=Q([]);{let e="";se.subscribe(t=>{t&&t!==e?(ce.set([t]),e=t,console.log("Initialized currentPath with user public key:",t)):!t&&e&&(ce.set([]),e="")})}const re=wo({deleteMode:!1,nodeToEdit:"",initializationStarted:!1,toast:{visible:!1,message:"",type:"info",timeoutId:null},navigateToPath:async e=>{console.log("Navigating to path",e),!(!e.length||!L(ue))&&ce.set(e)},navigateToPathIndex:e=>{const t=L(ce);e<0||e>=t.length||e!==t.length-1&&ce.set(t.slice(0,e+1))},zoomInto:e=>{const t=L(ce),n=L(ue);if(!n)return;const r=Kt(n,e);if(r){if(De(r)){re.showToast("Cannot zoom into nodes with contributors","warning");return}ce.set([...t,e])}},zoomOut:()=>{const e=L(ce);e.length<=1||ce.set(e.slice(0,-1))},resetState:()=>{ue.set(null),ce.set([])},toggleDeleteMode:()=>{re.deleteMode=!re.deleteMode,re.showToast(re.deleteMode?"Delete mode activated. Click a node to delete it.":"Delete mode deactivated.",re.deleteMode?"warning":"info")},setNodeToEditMode:e=>{re.nodeToEdit=e,setTimeout(()=>{re.nodeToEdit===e&&(re.nodeToEdit="")},1e3)},showToast:(e,t="info")=>{re.toast.timeoutId&&clearTimeout(re.toast.timeoutId),re.toast={visible:!0,message:e,type:t,timeoutId:window.setTimeout(()=>{re.toast.visible=!1},3e3)}}});export{We as A,Qc as B,Jt as C,qc as D,Xc as E,Pc as F,Bc as G,cr as H,Ho as I,Gc as J,sr as K,Kc as L,lt as M,Wr as N,kc as O,le as P,Je as Q,Fc as R,ac as S,lr as T,Vc as U,Jc as a,se as b,ce as c,fe as d,zc as e,Kt as f,re as g,zo as h,Ce as i,Rc as j,No as k,Uc as l,Yc as m,Hc as n,vc as o,Lc as p,Ic as q,Dc as r,tt as s,Io as t,ue as u,ye as v,M as w,Mc as x,Zc as y,Wc as z};
