import{ae as I,a1 as O,f as D,j as t,v as r,o as ee,x as j,y as S,J as te,z as p,t as ae,I as ce,ag as T}from"./ZjNQrdaN.js";import{g as N}from"./CUh_UXd4.js";import{u as Q,a as A,b as $,c as de,n as fe,g as ve,f as me,d as H,e as re,s as J,h as W,i as ge,j as he,k as q}from"./6qSDsJxn.js";import{f as E,a as R,d as be}from"./BDgML0BG.js";import{d as we,s as G}from"./eaQsrxS5.js";import{p as _,i as U,b as _e,s as Ce,a as ke}from"./CTLQGSEP.js";function Oe(s=[]){let e=I(O([])),d=!1,u=I("");function f(l=""){const n=N(Q),v=N(A);console.log(`[USERS-PROVIDER] Loading users with query: "${l}"`),console.log("[USERS-PROVIDER] Available user IDs:",n),console.log("[USERS-PROVIDER] Names cache:",v);const h=[];n.forEach(i=>{if(s.includes(i))return;const o=v[i]||i;if(l){const b=l.toLowerCase(),P=o.toLowerCase(),V=i.toLowerCase();if(!P.includes(b)&&!V.includes(b))return}h.push({id:i,name:o,color:void 0})}),console.log("[USERS-PROVIDER] Filtered items:",h),r(e,h,!0)}function g(l){r(u,l,!0),f(l)}function c(){f(t(u))}return D(()=>{N(Q),N(A),f(t(u))}),f(),{get items(){return t(e)},get loading(){return d},search:g,refresh:c}}function Be(){let s=I(O([])),e=I(!0),d=I("");function u(f=""){r(e,!0),r(d,f,!0);try{const g=N(de),c=N(fe);if(!g||!c){r(s,[],!0),r(e,!1);return}const l=ve(g),n=Object.entries(l).map(([v,h])=>{const i=Object.keys(h),o=me(g,v),b=(o==null?void 0:o.name)||v;return{id:v,name:b,metadata:{contributorCount:i.length,contributors:i}}}).filter(v=>v.metadata.contributorCount>0);if(f.trim()){const v=f.toLowerCase();r(s,n.filter(h=>h.name.toLowerCase().includes(v)),!0)}else r(s,n,!0);r(e,!1)}catch(g){console.error("Error loading subtrees:",g),r(s,[],!0),r(e,!1)}}return u(),{get items(){return t(s)},get loading(){return t(e)},search:u,refresh:()=>u(t(d))}}function Fe(s){let e=I(O([])),d=!1,u=I("");async function f(l=""){try{const n=N($);if(!n){r(e,[],!0);return}const v=Object.entries(n).filter(([i])=>i!==s).map(async([i,o])=>{const b=await H(o.owner_id||"");return{id:i,name:`${o.emoji||"ðŸ“¦"} ${o.name} (${b})`,metadata:o}}),h=await Promise.all(v);if(l.trim()){const i=l.toLowerCase();r(e,h.filter(o=>o.name.toLowerCase().includes(i)||o.id.toLowerCase().includes(i)),!0)}else r(e,h,!0)}catch(n){console.error("Error loading capacities:",n),r(e,[],!0)}}function g(l){r(u,l,!0),Promise.resolve(f(l))}function c(){Promise.resolve(f(t(u)))}return D(()=>{N($),f(t(u))}),f(),{get items(){return t(e)},get loading(){return d},search:g,refresh:c}}function Ie(s,e,d){s.target.classList.contains("remove-tag")||(s.stopPropagation(),e()(d.userId,s))}function Le(s,e,d){s.stopPropagation(),e()(d.userId)}var Ne=E('<span class="remove-tag svelte-1ltctw2">Ã—</span>'),ye=E('<div class="tag-pill svelte-1ltctw2"><span class="svelte-1ltctw2"> </span> <!></div>');function Me(s,e){ee(e,!0);let d=_(e,"truncateLength",3,10),u=_(e,"removable",3,!0),f=_(e,"onClick",3,(a,L)=>{}),g=_(e,"onRemove",3,a=>{}),c=I(O(e.displayName||e.userId)),l=I(!e.displayName),n;async function v(){if(e.displayName){r(c,e.displayName,!0),r(l,!1),i(t(c));return}r(l,!0);try{r(c,await H(e.userId),!0),r(l,!1),i(t(c))}catch(a){console.error(`Error loading user data for ${e.userId}:`,a),r(c,e.userId,!0),r(l,!1),i(t(c))}}D(()=>{e.displayName&&(r(c,e.displayName,!0),r(l,!1),i(t(c)))}),D(()=>{e.userId&&v()});function h(a){return(a==null?void 0:a.length)>d()?(a==null?void 0:a.substring(0,d()-2))+"...":a}function i(a){n&&(n.title=u()?`${a}: Click to view tree, click Ã— to remove`:`${a}: Click to view tree`)}var o=ye();o.__click=[Ie,f,e];var b=j(o),P=j(b,!0);S(b);var V=te(b,2);{var y=a=>{var L=Ne();L.__click=[Le,g,e],R(a,L)};U(V,a=>{u()&&a(y)})}S(o),_e(o,a=>n=a,()=>n),p((a,L)=>{J(o,"data-user-id",e.userId),W(o,`background: ${a??""}`),G(P,L)},[()=>re(e.userId),()=>h(t(c))]),R(s,o),ae()}we(["click"]);function Re(s,e,d=!1,u=!1){return!u||e===1?u?"inherit":"0":d?s===0?"999px 999px 0 0":s===e-1?"0 0 999px 999px":"0":s===0?"999px 0 0 999px":s===e-1?"0 999px 999px 0":"0"}var Pe=E("<span> </span>"),xe=E("<span> </span>"),Se=E('<div class="bar-segment svelte-og1zuj"><!> <!></div>'),Ee=E("<div></div>");function Te(s,e){ee(e,!0);const[d,u]=Ce(),f=()=>ke(A,"$userNamesCache",d);let g=_(e,"segments",19,()=>[]),c=_(e,"height",3,"100%"),l=_(e,"width",3,"100%"),n=_(e,"vertical",3,!1),v=_(e,"rounded",3,!1),h=_(e,"showLabels",3,!1),i=_(e,"showValues",3,!1),o=_(e,"backgroundColor",3,"#e0e0e0");const b=T(()=>g().reduce((w,m)=>w+m.value,0)),P=T(()=>g().map(w=>{let m=f()[w.id]||w.id.substring(0,8)+"...";return H(w.id).then(K=>{}),{...w,normalizedValue:t(b)?w.value/t(b)*100:0,label:m,color:re(w.id)}})),V=T(()=>v()?c():"0");var y=Ee();let a,L;ge(y,21,()=>t(P),he,(w,m,K)=>{var X=be(),se=ce(X);{var oe=B=>{var x=Se();let Y;var Z=j(x);{var le=C=>{var k=Pe();let z;var F=j(k,!0);S(k),p(M=>{z=q(k,1,"segment-label svelte-og1zuj",null,z,M),G(F,t(m).label)},[()=>({small:t(m).normalizedValue<10})]),R(C,k)};U(Z,C=>{h()&&t(m).label&&C(le)})}var ie=te(Z,2);{var ne=C=>{var k=xe();let z;var F=j(k);S(k),p((M,ue)=>{z=q(k,1,"segment-value svelte-og1zuj",null,z,M),G(F,`${ue??""}%`)},[()=>({small:t(m).normalizedValue<10}),()=>t(m).value.toFixed(1)]),R(C,k)};U(ie,C=>{i()&&C(ne)})}S(x),p(C=>{J(x,"data-id",t(m).id),J(x,"data-value",t(m).value),Y=W(x,"",Y,{width:n()?"100%":`${t(m).normalizedValue}%`,height:n()?`${t(m).normalizedValue}%`:"100%","background-color":t(m).color,"border-radius":C})},[()=>Re(K,t(P).length,n(),v())]),R(B,x)};U(se,B=>{t(m).normalizedValue>0&&B(oe)})}R(w,X)}),S(y),p(w=>{a=q(y,1,"stacked-bar svelte-og1zuj",null,a,w),L=W(y,"",L,{height:c(),width:l(),"background-color":o(),"border-radius":t(V)})},[()=>({vertical:n()})]),R(s,y),ae(),u()}export{Te as B,Me as T,Fe as a,Oe as b,Be as c};
