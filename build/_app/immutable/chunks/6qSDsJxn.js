import{aa as ps,b as cn,aE as Bo,F as bn,h as te,G as gs,a as vs,j as Mn,_ as ms,K as ys,M as ws,N as $r,O as ut,d as We,an as bs,P as Ko,c as Et,p as _s,aF as _n,aq as Jo,S as Zn,A as Cr,aG as er,aH as Nr,aI as tr,w as Ss,aJ as Rr,ak as Go,aK as ks,aL as Es,ap as Ts,aM as As,aN as pt,aO as xs,C as Os,E as $s,n as Cs,Q as nr,g as rr,aP as Ns,aQ as Ho,aR as Rs,aS as js,ax as Ds,aT as Is,l as Ps,aU as Us,aV as zs,aW as Ms,R as or,V as Zs,a1 as Fs}from"./ZjNQrdaN.js";import{l as fn,i as Ls,c as Ws,d as Bs,f as Ks,n as Js,g as Gs,j as Hs}from"./eaQsrxS5.js";import{d as oe,g as W,w as H}from"./CUh_UXd4.js";import"./BDgML0BG.js";import"./CF2fgOQ-.js";function fv(e,t){return t}function qs(e,t,n,r){for(var o=[],i=t.length,s=0;s<i;s++)Es(t[s].e,o,!0);var u=i>0&&o.length===0&&n!==null;if(u){var c=n.parentNode;Ts(c),c.append(n),r.clear(),Ee(e,t[0].prev,t[i-1].next)}As(o,()=>{for(var a=0;a<i;a++){var f=t[a];u||(r.delete(f.k),Ee(e,f.prev,f.next)),pt(f.e,!u)}})}function lv(e,t,n,r,o,i=null){var s=e,u={flags:t,items:new Map,first:null},c=(t&Bo)!==0;if(c){var a=e;s=te?bn(gs(a)):a.appendChild(ps())}te&&vs();var f=null,d=!1,l=ms(()=>{var b=n();return Go(b)?b:b==null?[]:Jo(b)});cn(()=>{var b=Mn(l),g=b.length;if(d&&g===0)return;d=g===0;let S=!1;if(te){var y=ys(s)===ws;y!==(g===0)&&(s=$r(),bn(s),ut(!1),S=!0)}if(te){for(var w=null,p,h=0;h<g;h++){if(We.nodeType===8&&We.data===bs){s=We,S=!0,ut(!1);break}var v=b[h],m=r(v,h);p=qo(We,u,w,null,v,m,h,o,t,n),u.items.set(m,p),w=p}g>0&&bn($r())}te||Vs(b,u,s,o,t,r,n),i!==null&&(g===0?f?Ko(f):f=Et(()=>i(s)):f!==null&&_s(f,()=>{f=null})),S&&ut(!0),Mn(l)}),te&&(s=We)}function Vs(e,t,n,r,o,i,s){var x,$,D,N;var u=(o&ks)!==0,c=(o&(er|tr))!==0,a=e.length,f=t.items,d=t.first,l=d,b,g=null,S,y=[],w=[],p,h,v,m;if(u)for(m=0;m<a;m+=1)p=e[m],h=i(p,m),v=f.get(h),v!==void 0&&((x=v.a)==null||x.measure(),(S??(S=new Set)).add(v));for(m=0;m<a;m+=1){if(p=e[m],h=i(p,m),v=f.get(h),v===void 0){var T=l?l.e.nodes_start:n;g=qo(T,t,g,g===null?t.first:g.next,p,h,m,r,o,s),f.set(h,g),y=[],w=[],l=g.next;continue}if(c&&Xs(v,p,m,o),(v.e.f&_n)!==0&&(Ko(v.e),u&&(($=v.a)==null||$.unfix(),(S??(S=new Set)).delete(v))),v!==l){if(b!==void 0&&b.has(v)){if(y.length<w.length){var E=w[0],k;g=E.prev;var O=y[0],j=y[y.length-1];for(k=0;k<y.length;k+=1)jr(y[k],E,n);for(k=0;k<w.length;k+=1)b.delete(w[k]);Ee(t,O.prev,j.next),Ee(t,g,O),Ee(t,j,E),l=E,g=j,m-=1,y=[],w=[]}else b.delete(v),jr(v,l,n),Ee(t,v.prev,v.next),Ee(t,v,g===null?t.first:g.next),Ee(t,g,v),g=v;continue}for(y=[],w=[];l!==null&&l.k!==h;)(l.e.f&_n)===0&&(b??(b=new Set)).add(l),w.push(l),l=l.next;if(l===null)continue;v=l}y.push(v),g=v,l=v.next}if(l!==null||b!==void 0){for(var C=b===void 0?[]:Jo(b);l!==null;)(l.e.f&_n)===0&&C.push(l),l=l.next;var A=C.length;if(A>0){var _=(o&Bo)!==0&&a===0?n:null;if(u){for(m=0;m<A;m+=1)(D=C[m].a)==null||D.measure();for(m=0;m<A;m+=1)(N=C[m].a)==null||N.fix()}qs(t,C,_,f)}}u&&Zn(()=>{var R;if(S!==void 0)for(v of S)(R=v.a)==null||R.apply()}),Cr.first=t.first&&t.first.e,Cr.last=g&&g.e}function Xs(e,t,n,r){(r&er)!==0&&Nr(e.v,t),(r&tr)!==0?Nr(e.i,n):e.i=n}function qo(e,t,n,r,o,i,s,u,c,a){var f=(c&er)!==0,d=(c&xs)===0,l=f?d?Ss(o,!1,!1):Rr(o):o,b=(c&tr)===0?s:Rr(s),g={i:b,v:l,k:i,a:null,e:null,prev:n,next:r};try{return g.e=Et(()=>u(e,l,b,a),te),g.e.prev=n&&n.e,g.e.next=r&&r.e,n===null?t.first=g:(n.next=g,n.e.next=g.e),r!==null&&(r.prev=g,r.e.prev=g.e),g}finally{}}function jr(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,o=t?t.e.nodes_start:n,i=e.e.nodes_start;i!==r;){var s=Os(i);o.before(i),i=s}}function Ee(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function hv(e,t,...n){var r=e,o=Cs,i;cn(()=>{o!==(o=t())&&(i&&(pt(i),i=null),i=Et(()=>o(r,...n)))},$s),te&&(r=We)}function Ys(e,t){var n=void 0,r;cn(()=>{n!==(n=t())&&(r&&(pt(r),r=null),n&&(r=Et(()=>{nr(()=>n(e))})))})}function Vo(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(n=Vo(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function Qs(){for(var e,t,n=0,r="",o=arguments.length;n<o;n++)(e=arguments[n])&&(t=Vo(e))&&(r&&(r+=" "),r+=t);return r}function ea(e){return typeof e=="object"?Qs(e):e??""}const Dr=[...` 	
\r\fÂ \v\uFEFF`];function ta(e,t,n){var r=e==null?"":""+e;if(t&&(r=r?r+" "+t:t),n){for(var o in n)if(n[o])r=r?r+" "+o:o;else if(r.length)for(var i=o.length,s=0;(s=r.indexOf(o,s))>=0;){var u=s+i;(s===0||Dr.includes(r[s-1]))&&(u===r.length||Dr.includes(r[u]))?r=(s===0?"":r.substring(0,s))+r.substring(u+1):s=u}}return r===""?null:r}function Ir(e,t=!1){var n=t?" !important;":";",r="";for(var o in e){var i=e[o];i!=null&&i!==""&&(r+=" "+o+": "+i+n)}return r}function Sn(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function na(e,t){if(t){var n="",r,o;if(Array.isArray(t)?(r=t[0],o=t[1]):r=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,s=0,u=!1,c=[];r&&c.push(...Object.keys(r).map(Sn)),o&&c.push(...Object.keys(o).map(Sn));var a=0,f=-1;const S=e.length;for(var d=0;d<S;d++){var l=e[d];if(u?l==="/"&&e[d-1]==="*"&&(u=!1):i?i===l&&(i=!1):l==="/"&&e[d+1]==="*"?u=!0:l==='"'||l==="'"?i=l:l==="("?s++:l===")"&&s--,!u&&i===!1&&s===0){if(l===":"&&f===-1)f=d;else if(l===";"||d===S-1){if(f!==-1){var b=Sn(e.substring(a,f).trim());if(!c.includes(b)){l!==";"&&d++;var g=e.substring(a,d).trim();n+=" "+g+";"}}a=d+1,f=-1}}}}return r&&(n+=Ir(r)),o&&(n+=Ir(o,!0)),n=n.trim(),n===""?null:n}return e==null?null:String(e)}function ra(e,t,n,r,o,i){var s=e.__className;if(te||s!==n||s===void 0){var u=ta(n,r,i);(!te||u!==e.getAttribute("class"))&&(u==null?e.removeAttribute("class"):t?e.className=u:e.setAttribute("class",u)),e.__className=n}else if(i&&o!==i)for(var c in i){var a=!!i[c];(o==null||a!==!!o[c])&&e.classList.toggle(c,a)}return i}function kn(e,t={},n,r){for(var o in n){var i=n[o];t[o]!==i&&(n[o]==null?e.style.removeProperty(o):e.style.setProperty(o,i,r))}}function oa(e,t,n,r){var o=e.__style;if(te||o!==t){var i=na(t,r);(!te||i!==e.getAttribute("style"))&&(i==null?e.removeAttribute("style"):e.style.cssText=i),e.__style=t}else r&&(Array.isArray(r)?(kn(e,n==null?void 0:n[0],r[0]),kn(e,n==null?void 0:n[1],r[1],"important")):kn(e,n,r));return r}function Ht(e,t,n){if(e.multiple){if(t==null)return;if(!Go(t))return Ns();for(var r of e.options)r.selected=t.includes(ct(r));return}for(r of e.options){var o=ct(r);if(Ho(o,t)){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Xo(e,t){let n=!0;nr(()=>{t&&Ht(e,rr(t),n),n=!1;var r=new MutationObserver(()=>{var o=e.__value;Ht(e,o)});return r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function dv(e,t,n=t){var r=!0;fn(e,"change",o=>{var i=o?"[selected]":":checked",s;if(e.multiple)s=[].map.call(e.querySelectorAll(i),ct);else{var u=e.querySelector(i)??e.querySelector("option:not([disabled])");s=u&&ct(u)}n(s)}),nr(()=>{var o=t();if(Ht(e,o,r),r&&o===void 0){var i=e.querySelector(":checked");i!==null&&(o=ct(i),n(o))}e.__value=o,r=!1}),Xo(e)}function ct(e){return"__value"in e?e.__value:e.value}const tt=Symbol("class"),nt=Symbol("style"),Yo=Symbol("is custom element"),Qo=Symbol("is html");function pv(e){if(te){var t=!1,n=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var r=e.value;qt(e,"value",null),e.value=r}if(e.hasAttribute("checked")){var o=e.checked;qt(e,"checked",null),e.checked=o}}};e.__on_r=n,zs(n),Gs()}}function gv(e,t){var n=ir(e);n.checked!==(n.checked=t??void 0)&&(e.checked=t)}function ia(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function qt(e,t,n,r){var o=ir(e);te&&(o[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||o[t]!==(o[t]=n)&&(t==="loading"&&(e[Rs]=n),n==null?e.removeAttribute(t):typeof n!="string"&&ei(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function sa(e,t,n,r,o=!1){var i=ir(e),s=i[Yo],u=!i[Qo];let c=te&&s;c&&ut(!1);var a=t||{},f=e.tagName==="OPTION";for(var d in t)d in n||(n[d]=null);n.class?n.class=ea(n.class):(r||n[tt])&&(n.class=null),n[nt]&&(n.style??(n.style=null));var l=ei(e);for(const h in n){let v=n[h];if(f&&h==="value"&&v==null){e.value=e.__value="",a[h]=v;continue}if(h==="class"){var b=e.namespaceURI==="http://www.w3.org/1999/xhtml";ra(e,b,v,r,t==null?void 0:t[tt],n[tt]),a[h]=v,a[tt]=n[tt];continue}if(h==="style"){oa(e,v,t==null?void 0:t[nt],n[nt]),a[h]=v,a[nt]=n[nt];continue}var g=a[h];if(!(v===g&&!(v===void 0&&e.hasAttribute(h)))){a[h]=v;var S=h[0]+h[1];if(S!=="$$")if(S==="on"){const m={},T="$$"+h;let E=h.slice(2);var y=Hs(E);if(Ls(E)&&(E=E.slice(0,-7),m.capture=!0),!y&&g){if(v!=null)continue;e.removeEventListener(E,a[T],m),a[T]=null}if(v!=null)if(y)e[`__${E}`]=v,Bs([E]);else{let k=function(O){a[h].call(this,O)};a[T]=Ws(E,e,k,m)}else y&&(e[`__${E}`]=void 0)}else if(h==="style")qt(e,h,v);else if(h==="autofocus")Ks(e,!!v);else if(!s&&(h==="__value"||h==="value"&&v!=null))e.value=e.__value=v;else if(h==="selected"&&f)ia(e,v);else{var w=h;u||(w=Js(w));var p=w==="defaultValue"||w==="defaultChecked";if(v==null&&!s&&!p)if(i[h]=null,w==="value"||w==="checked"){let m=e;const T=t===void 0;if(w==="value"){let E=m.defaultValue;m.removeAttribute(w),m.defaultValue=E,m.value=m.__value=T?E:null}else{let E=m.defaultChecked;m.removeAttribute(w),m.defaultChecked=E,m.checked=T?E:!1}}else e.removeAttribute(h);else p||l.includes(w)&&(s||typeof v!="string")?e[w]=v:typeof v!="function"&&qt(e,w,v)}}}return c&&ut(!0),a}function vv(e,t,n=[],r,o=!1,i=Ps){const s=n.map(i);var u=void 0,c={},a=e.nodeName==="SELECT",f=!1;cn(()=>{var d=t(...s.map(Mn)),l=sa(e,u,d,r,o);f&&a&&"value"in d&&Ht(e,d.value,!1);for(let g of Object.getOwnPropertySymbols(c))d[g]||pt(c[g]);for(let g of Object.getOwnPropertySymbols(d)){var b=d[g];g.description===Us&&(!u||b!==u[g])&&(c[g]&&pt(c[g]),c[g]=Et(()=>Ys(e,()=>b))),l[g]=b}u=l}),a&&Xo(e,()=>u.value),f=!0}function ir(e){return e.__attributes??(e.__attributes={[Yo]:e.nodeName.includes("-"),[Qo]:e.namespaceURI===js})}var Pr=new Map;function ei(e){var t=Pr.get(e.nodeName);if(t)return t;Pr.set(e.nodeName,t=[]);for(var n,r=e,o=Element.prototype;o!==r;){n=Is(r);for(var i in n)n[i].set&&t.push(i);r=Ds(r)}return t}function mv(e,t,n=t){var r=Ms();fn(e,"input",o=>{var i=o?e.defaultValue:e.value;if(i=Tn(e)?An(i):i,n(i),r&&i!==(i=t())){var s=e.selectionStart,u=e.selectionEnd;e.value=i??"",u!==null&&(e.selectionStart=s,e.selectionEnd=Math.min(u,e.value.length))}}),(te&&e.defaultValue!==e.value||rr(t)==null&&e.value)&&n(Tn(e)?An(e.value):e.value),or(()=>{var o=t();Tn(e)&&o===An(e.value)||e.type==="date"&&!o&&!e.value||o!==e.value&&(e.value=o??"")})}const En=new Set;function yv(e,t,n,r,o=r){var i=n.getAttribute("type")==="checkbox",s=e;let u=!1;if(t!==null)for(var c of t)s=s[c]??(s[c]=[]);s.push(n),fn(n,"change",()=>{var a=n.__value;i&&(a=Ur(s,a,n.checked)),o(a)},()=>o(i?[]:null)),or(()=>{var a=r();if(te&&n.defaultChecked!==n.checked){u=!0;return}i?(a=a||[],n.checked=a.includes(n.__value)):n.checked=Ho(n.__value,a)}),Zs(()=>{var a=s.indexOf(n);a!==-1&&s.splice(a,1)}),En.has(s)||(En.add(s),Zn(()=>{s.sort((a,f)=>a.compareDocumentPosition(f)===4?-1:1),En.delete(s)})),Zn(()=>{if(u){var a;if(i)a=Ur(s,a,n.checked);else{var f=s.find(d=>d.checked);a=f==null?void 0:f.__value}o(a)}})}function wv(e,t,n=t){fn(e,"change",r=>{var o=r?e.defaultChecked:e.checked;n(o)}),(te&&e.defaultChecked!==e.checked||rr(t)==null)&&n(e.checked),or(()=>{var r=t();e.checked=!!r})}function Ur(e,t,n){for(var r=new Set,o=0;o<e.length;o+=1)e[o].checked&&r.add(e[o].__value);return n||r.delete(t),Array.from(r)}function Tn(e){var t=e.type;return t==="number"||t==="range"}function An(e){return e===""?null:+e}function aa(e,t,n,r){var o,i,s=!1,u=n.length>=2,c=(g,S,y)=>{if(o=S,u&&(i=g),!s){let w=t(g,S,y);if(t.length<2)S(w);else return w}s=!1},a=oe(e,c,r),f=!Array.isArray(e);function d(g){var S=n(g,i);f?(s=!0,e.set(S)):S.forEach((y,w)=>{s=!0,e[w].set(y)}),s=!1}var l=!1;function b(g){var S,y,w,p;if(l){p=g(W(a)),o(p);return}var h=a.subscribe(v=>{l?S?y=!0:S=!0:w=v});p=g(w),l=!0,o(p),h(),l=!1,y&&(p=W(a)),S&&d(p)}return{subscribe:a.subscribe,set(g){b(()=>g)},update:b}}const ua=20,Ze=H([]),sr=H(null),Ft=new Map,zr=e=>{if(Ft.has(e))return;const t=setTimeout(()=>{Ft.delete(e),ti(e)},1e3);Ft.set(e,t)},ca=e=>{const t=Ft.get(e);t&&clearTimeout(t)};function fa(e){e.id&&ca(e.id),Ze.update(t=>t.map(n=>n.id===e.id?{...n,...e}:n))}function la(e){Ze.update(t=>[e,...t].slice(0,ua))}function ha(e){W(Ze).find(t=>t.id===e.id)?fa(e):la(e)}function da(e){Ze.update(t=>(e?zr(e):t.forEach(n=>{zr(n.id)}),t.map(n=>n.id===e||e===void 0?{...n,visible:!1}:n)))}function ti(e){Ze.update(t=>e===void 0?[]:t.filter(n=>n.id!==e))}function bv(e){sr.set(e)}function _v(e){let t;sr.update(n=>(t=e-(n||0),null)),Ze.update(n=>n.map(r=>({...r,pauseDuration:r.pauseDuration+t})))}const pa={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3};function Sv(e={}){return{toasts:aa(Ze,n=>n.map(r=>{var o,i;return{...e,...e[r.type],...r,duration:r.duration||((o=e[r.type])==null?void 0:o.duration)||(e==null?void 0:e.duration)||pa[r.type],style:[e.style,(i=e[r.type])==null?void 0:i.style,r.style].join(";")}}),n=>n),pausedAt:sr}}const ga=e=>typeof e=="function",Mr=(e,t)=>ga(e)?e(t):e,va=(()=>{let e=0;return()=>(e+=1,e.toString())})(),kv=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){const t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),ma=(e,t="blank",n)=>({createdAt:Date.now(),visible:!0,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...n,id:(n==null?void 0:n.id)||va()}),Tt=e=>(t,n)=>{const r=ma(t,e,n);return ha(r),r.id},se=(e,t)=>Tt("blank")(e,t);se.error=Tt("error");se.success=Tt("success");se.loading=Tt("loading");se.custom=Tt("custom");se.dismiss=e=>{da(e)};se.remove=e=>ti(e);se.promise=(e,t,n)=>{const r=se.loading(t.loading,{...n,...n==null?void 0:n.loading});return e.then(o=>(se.success(Mr(t.success,o),{id:r,...n,...n==null?void 0:n.success}),o)).catch(o=>{se.error(Mr(t.error,o),{id:r,...n,...n==null?void 0:n.error})}),e};var ft=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ar(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Lt={exports:{}},ya=Lt.exports,Zr;function wa(){return Zr||(Zr=1,function(e,t){(function(n,r){e.exports=r()})(ya,function(){Array.isArray||(Array.isArray=function(i){return Object.prototype.toString.call(i)==="[object Array]"});function n(i){for(var s=[],u=0,c=i.length;u<c;u++)s.indexOf(i[u])===-1&&s.push(i[u]);return s}var r={},o={"==":function(i,s){return i==s},"===":function(i,s){return i===s},"!=":function(i,s){return i!=s},"!==":function(i,s){return i!==s},">":function(i,s){return i>s},">=":function(i,s){return i>=s},"<":function(i,s,u){return u===void 0?i<s:i<s&&s<u},"<=":function(i,s,u){return u===void 0?i<=s:i<=s&&s<=u},"!!":function(i){return r.truthy(i)},"!":function(i){return!r.truthy(i)},"%":function(i,s){return i%s},log:function(i){return console.log(i),i},in:function(i,s){return!s||typeof s.indexOf>"u"?!1:s.indexOf(i)!==-1},cat:function(){return Array.prototype.join.call(arguments,"")},substr:function(i,s,u){if(u<0){var c=String(i).substr(s);return c.substr(0,c.length+u)}return String(i).substr(s,u)},"+":function(){return Array.prototype.reduce.call(arguments,function(i,s){return parseFloat(i,10)+parseFloat(s,10)},0)},"*":function(){return Array.prototype.reduce.call(arguments,function(i,s){return parseFloat(i,10)*parseFloat(s,10)})},"-":function(i,s){return s===void 0?-i:i-s},"/":function(i,s){return i/s},min:function(){return Math.min.apply(this,arguments)},max:function(){return Math.max.apply(this,arguments)},merge:function(){return Array.prototype.reduce.call(arguments,function(i,s){return i.concat(s)},[])},var:function(i,s){var u=s===void 0?null:s,c=this;if(typeof i>"u"||i===""||i===null)return c;for(var a=String(i).split("."),f=0;f<a.length;f++)if(c==null||(c=c[a[f]],c===void 0))return u;return c},missing:function(){for(var i=[],s=Array.isArray(arguments[0])?arguments[0]:arguments,u=0;u<s.length;u++){var c=s[u],a=r.apply({var:c},this);(a===null||a==="")&&i.push(c)}return i},missing_some:function(i,s){var u=r.apply({missing:s},this);return s.length-u.length>=i?[]:u}};return r.is_logic=function(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&Object.keys(i).length===1},r.truthy=function(i){return Array.isArray(i)&&i.length===0?!1:!!i},r.get_operator=function(i){return Object.keys(i)[0]},r.get_values=function(i){return i[r.get_operator(i)]},r.apply=function(i,s){if(Array.isArray(i))return i.map(function(y){return r.apply(y,s)});if(!r.is_logic(i))return i;var u=r.get_operator(i),c=i[u],a,f,d,l,b;if(Array.isArray(c)||(c=[c]),u==="if"||u=="?:"){for(a=0;a<c.length-1;a+=2)if(r.truthy(r.apply(c[a],s)))return r.apply(c[a+1],s);return c.length===a+1?r.apply(c[a],s):null}else if(u==="and"){for(a=0;a<c.length;a+=1)if(f=r.apply(c[a],s),!r.truthy(f))return f;return f}else if(u==="or"){for(a=0;a<c.length;a+=1)if(f=r.apply(c[a],s),r.truthy(f))return f;return f}else{if(u==="filter")return l=r.apply(c[0],s),d=c[1],Array.isArray(l)?l.filter(function(y){return r.truthy(r.apply(d,y))}):[];if(u==="map")return l=r.apply(c[0],s),d=c[1],Array.isArray(l)?l.map(function(y){return r.apply(d,y)}):[];if(u==="reduce")return l=r.apply(c[0],s),d=c[1],b=typeof c[2]<"u"?r.apply(c[2],s):null,Array.isArray(l)?l.reduce(function(y,w){return r.apply(d,{current:w,accumulator:y})},b):b;if(u==="all"){if(l=r.apply(c[0],s),d=c[1],!Array.isArray(l)||!l.length)return!1;for(a=0;a<l.length;a+=1)if(!r.truthy(r.apply(d,l[a])))return!1;return!0}else if(u==="none"){if(l=r.apply(c[0],s),d=c[1],!Array.isArray(l)||!l.length)return!0;for(a=0;a<l.length;a+=1)if(r.truthy(r.apply(d,l[a])))return!1;return!0}else if(u==="some"){if(l=r.apply(c[0],s),d=c[1],!Array.isArray(l)||!l.length)return!1;for(a=0;a<l.length;a+=1)if(r.truthy(r.apply(d,l[a])))return!0;return!1}}if(c=c.map(function(y){return r.apply(y,s)}),o.hasOwnProperty(u)&&typeof o[u]=="function")return o[u].apply(s,c);if(u.indexOf(".")>0){var g=String(u).split("."),S=o;for(a=0;a<g.length;a++){if(!S.hasOwnProperty(g[a]))throw new Error("Unrecognized operation "+u+" (failed at "+g.slice(0,a+1).join(".")+")");S=S[g[a]]}return S.apply(s,c)}throw new Error("Unrecognized operation "+u)},r.uses_data=function(i){var s=[];if(r.is_logic(i)){var u=r.get_operator(i),c=i[u];Array.isArray(c)||(c=[c]),u==="var"?s.push(c[0]):c.forEach(function(a){s.push.apply(s,r.uses_data(a))})}return n(s)},r.add_operation=function(i,s){o[i]=s},r.rm_operation=function(i){delete o[i]},r.rule_like=function(i,s){if(s===i||s==="@")return!0;if(s==="number")return typeof i=="number";if(s==="string")return typeof i=="string";if(s==="array")return Array.isArray(i)&&!r.is_logic(i);if(r.is_logic(s)){if(r.is_logic(i)){var u=r.get_operator(s),c=r.get_operator(i);if(u==="@"||u===c)return r.rule_like(r.get_values(i,!1),r.get_values(s,!1))}return!1}if(Array.isArray(s))if(Array.isArray(i)){if(s.length!==i.length)return!1;for(var a=0;a<s.length;a+=1)if(!r.rule_like(i[a],s[a]))return!1;return!0}else return!1;return!1},r})}(Lt)),Lt.exports}var ba=wa();const _a=ar(ba);function Sa(e,t,n){const r=Object.entries(e).filter(([o,i])=>t(o,i,n));return At(Object.fromEntries(r))}const Ev={includeNodes:e=>({in:[{var:"nodeId"},e]}),excludeNodes:e=>({"!":{in:[{var:"nodeId"},e]}}),aboveThreshold:e=>({">=":[{var:"share"},e]}),inSubtrees:e=>({some:[e,{"!!":{var:["subtreeContributors",{var:""},{var:"nodeId"}]}}]}),inSubtree:e=>({in:[{var:"nodeId"},{var:["subtreeContributors",e]}]}),and:(...e)=>({and:e}),or:(...e)=>({or:e}),not:e=>({"!":e})};function ka(e){return(t,n,r={subtreeContributors:{}})=>{const o={nodeId:t,share:n,subtreeContributors:r.subtreeContributors};return!!_a.apply(e,o)}}function Ea(e,t,n){if(!e.filter_rule){const o=At({...t});return Fr(e,o)}const r=Sa(t,ka(e.filter_rule),n);return Fr(e,r)}function Fr(e,t){const n=e.max_percentage_div||1,r=e.max_natural_div||1,o=e.quantity||0;if(n>=1&&r<=1||o===0)return t;const i={},s=r/o,c=Math.min(s,n);for(const[a,f]of Object.entries(t)){const d=Math.round(f/c)*c;d>0&&(i[a]=Math.min(d,1))}return At(i)}function At(e){const t=Object.values(e).reduce((n,r)=>n+r,0);return t===0?e:Object.fromEntries(Object.entries(e).map(([n,r])=>[n,r/t]))}function Ie(e,t){if(e.id===t)return e;for(const n of e.children){const r=Ie(n,t);if(r)return r}return null}function gt(e){const t=[];function n(r){for(const o of r.children)t.push(o),n(o)}return n(e),t}function ur(e,t){for(const n of e.children){if(n.id===t)return e;const r=ur(n,t);if(r)return r}return null}function Ta(e){return e.children.filter(t=>t.type==="NonRootNode").reduce((t,n)=>t+(n.points||0),0)}function cr(e,t){if(e.type==="RootNode"||e.id===t.id)return 1;const n=ur(t,e.id);if(!n||e.type!=="NonRootNode")return 1;const r=Ta(n),o=r===0?0:e.points/r,i=cr(n,t);return o*i}function lt(e){var t;return e.type==="NonRootNode"&&((t=e.contributor_ids)==null?void 0:t.length)>0}function ni(e,t){const n=e.manual_fulfillment!==void 0,r=e.children.length===0,o=lt(e),i=e.children.some(l=>lt(l)),s=e.children.some(l=>!lt(l)),u=e.manual_fulfillment??0;if(r&&o)return 1;if(r)return 0;if(n&&i&&!s)return u;const c=e.children.map(l=>cr(l,t)),a=e.children.map(l=>ni(l,t)),f=c.reduce((l,b,g)=>l+b*a[g],0),d=c.reduce((l,b)=>l+b,0);return d===0?0:f/d}function Aa(e,t,n){return[e,...gt(e)].filter(s=>s.type==="RootNode"?!1:s.contributor_ids.includes(t)&&lt(s)).map(s=>{const u=cr(s,e),c=ni(s,e),a=s.type==="RootNode"?1:s.contributor_ids.length;return u*c/a}).reduce((s,u)=>s+u,0)}function xa(e){const t=new Set,n=[e,...gt(e)];for(const r of n)if(r.type==="NonRootNode")for(const o of r.contributor_ids)t.add(o);return[...t]}function Oa(e,t,n){const r={},o=n||Object.keys(t).filter(i=>i!==e.id);for(const i of o){const s=Aa(e,i);r[i]=s}return At(r)}function $a(e,t){const n=Math.round((e.quantity||0)*t),r=e.max_natural_div||1,o=e.max_percentage_div||1,i=t>o?Math.round((e.quantity||0)*o):n;return Math.floor(i/r)*r}function Tv(e,t){e[t.id]=t}function ri(e){return e===void 0?null:Math.max(0,Math.min(1,e))}function Ca(e,t,n){return{id:e,name:t,type:"RootNode",children:[],manual_fulfillment:ri(n),created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}function Na(e,t,n,r,o=[],i){return{id:e,name:t,type:"NonRootNode",points:r,parent_id:n,children:[],contributor_ids:o,manual_fulfillment:ri(i)}}function z(e,t,n,r,o=[],i){if(e.type==="NonRootNode"&&e.contributor_ids.length>0)throw new Error("Cannot add children to nodes with contributors");const s=Na(t,n,e.id,r,o,i);e.children.push(s)}function Av(e,t){e.type==="NonRootNode"?(e.contributor_ids=[...t],e.children=[]):e.children=[]}function Ra(e,t,n){if(e.id===t)return n(e),!0;for(const r of e.children)if(Ra(r,t,n))return!0;return!1}function xv(e,t){e.points=t}function Ov(e,t){e.name=t}function oi(e){const t={};function n(o){const i=new Set;return[o,...gt(o)].forEach(u=>{u.type==="NonRootNode"&&u.contributor_ids.forEach(c=>i.add(c))}),[...i]}return t[e.id]=Object.fromEntries(n(e).map(o=>[o,!0])),gt(e).forEach(o=>{t[o.id]=Object.fromEntries(n(o).map(i=>[i,!0]))}),t}function ja(e,t){if(e.id===t)return null;const n=ur(e,t);if(!n)return null;const r=n.children.findIndex(i=>i.id===t);return r===-1?null:n.children.splice(r,1)[0]}function Da(e,t,n){const r=Ie(e,t);return r?(n.type==="NonRootNode"&&(n.parent_id=t),r.children.push(n),!0):!1}function ii(e,t,n){if(t===n)return!0;const r=Ie(e,t);return r?gt(r).some(i=>i.id===n):!1}function Ia(e,t,n){if(ii(e,t,n)||e.id===t)return!1;const r=ja(e,t);return!(!r||!Da(e,n,r))}function I(e,t,n){function r(u,c){var a;Object.defineProperty(u,"_zod",{value:u._zod??{},enumerable:!1}),(a=u._zod).traits??(a.traits=new Set),u._zod.traits.add(e),t(u,c);for(const f in s.prototype)f in u||Object.defineProperty(u,f,{value:s.prototype[f].bind(u)});u._zod.constr=s,u._zod.def=c}const o=(n==null?void 0:n.Parent)??Object;class i extends o{}Object.defineProperty(i,"name",{value:e});function s(u){var c;const a=n!=null&&n.Parent?new i:this;r(a,u),(c=a._zod).deferred??(c.deferred=[]);for(const f of a._zod.deferred)f();return a}return Object.defineProperty(s,"init",{value:r}),Object.defineProperty(s,Symbol.hasInstance,{value:u=>{var c,a;return n!=null&&n.Parent&&u instanceof n.Parent?!0:(a=(c=u==null?void 0:u._zod)==null?void 0:c.traits)==null?void 0:a.has(e)}}),Object.defineProperty(s,"name",{value:e}),s}class vt extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const si={};function xe(e){return si}function Pa(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,o])=>t.indexOf(+r)===-1).map(([r,o])=>o)}function Ua(e,t){return typeof t=="bigint"?t.toString():t}function ai(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function fr(e){return e==null}function lr(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function za(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=n>r?n:r,i=Number.parseInt(e.toFixed(o).replace(".","")),s=Number.parseInt(t.toFixed(o).replace(".",""));return i%s/10**o}function X(e,t,n){Object.defineProperty(e,t,{get(){{const r=n();return e[t]=r,r}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function hr(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function ui(e=10){const t="abcdefghijklmnopqrstuvwxyz";let n="";for(let r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n}function rt(e){return JSON.stringify(e)}const ci=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function Fn(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Ma=ai(()=>{var e;if(typeof navigator<"u"&&((e=navigator==null?void 0:navigator.userAgent)!=null&&e.includes("Cloudflare")))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function Ln(e){if(Fn(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(Fn(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}const Za=new Set(["string","number","symbol"]);function xt(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Fe(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n!=null&&n.parent)&&(r._zod.parent=e),r}function Z(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if((t==null?void 0:t.message)!==void 0){if((t==null?void 0:t.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Fa(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const La={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Wa(e,t){const n={},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(n[o]=r.shape[o])}return Fe(e,{...e._zod.def,shape:n,checks:[]})}function Ba(e,t){const n={...e._zod.def.shape},r=e._zod.def;for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&delete n[o]}return Fe(e,{...e._zod.def,shape:n,checks:[]})}function Ka(e,t){const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return hr(this,"shape",r),r},checks:[]};return Fe(e,n)}function Ja(e,t){return Fe(e,{...e._zod.def,get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return hr(this,"shape",n),n},catchall:t._zod.def.catchall,checks:[]})}function Ga(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const i in n){if(!(i in r))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(o[i]=e?new e({type:"optional",innerType:r[i]}):r[i])}else for(const i in r)o[i]=e?new e({type:"optional",innerType:r[i]}):r[i];return Fe(t,{...t._zod.def,shape:o,checks:[]})}function Ha(e,t,n){const r=t._zod.def.shape,o={...r};if(n)for(const i in n){if(!(i in o))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(o[i]=new e({type:"nonoptional",innerType:r[i]}))}else for(const i in r)o[i]=new e({type:"nonoptional",innerType:r[i]});return Fe(t,{...t._zod.def,shape:o,checks:[]})}function ht(e,t=0){for(let n=t;n<e.issues.length;n++)if(e.issues[n].continue!==!0)return!0;return!1}function je(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function jt(e){return typeof e=="string"?e:e==null?void 0:e.message}function Oe(e,t,n){var o,i,s,u,c,a;const r={...e,path:e.path??[]};if(!e.message){const f=jt((s=(i=(o=e.inst)==null?void 0:o._zod.def)==null?void 0:i.error)==null?void 0:s.call(i,e))??jt((u=t==null?void 0:t.error)==null?void 0:u.call(t,e))??jt((c=n.customError)==null?void 0:c.call(n,e))??jt((a=n.localeError)==null?void 0:a.call(n,e))??"Invalid input";r.message=f}return delete r.inst,delete r.continue,t!=null&&t.reportInput||delete r.input,r}function dr(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function mt(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const fi=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get(){return JSON.stringify(t,Ua,2)},enumerable:!0})},li=I("$ZodError",fi),hi=I("$ZodError",fi,{Parent:Error});function qa(e,t=n=>n.message){const n={},r=[];for(const o of e.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:n}}function Va(e,t){const n=t||function(i){return i.message},r={_errors:[]},o=i=>{for(const s of i.issues)if(s.code==="invalid_union"&&s.errors.length)s.errors.map(u=>o({issues:u}));else if(s.code==="invalid_key")o({issues:s.issues});else if(s.code==="invalid_element")o({issues:s.issues});else if(s.path.length===0)r._errors.push(n(s));else{let u=r,c=0;for(;c<s.path.length;){const a=s.path[c];c===s.path.length-1?(u[a]=u[a]||{_errors:[]},u[a]._errors.push(n(s))):u[a]=u[a]||{_errors:[]},u=u[a],c++}}};return o(e),r}const Xa=e=>(t,n,r,o)=>{const i=r?Object.assign(r,{async:!1}):{async:!1},s=t._zod.run({value:n,issues:[]},i);if(s instanceof Promise)throw new vt;if(s.issues.length){const u=new((o==null?void 0:o.Err)??e)(s.issues.map(c=>Oe(c,i,xe())));throw ci(u,o==null?void 0:o.callee),u}return s.value},Ya=e=>async(t,n,r,o)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},i);if(s instanceof Promise&&(s=await s),s.issues.length){const u=new((o==null?void 0:o.Err)??e)(s.issues.map(c=>Oe(c,i,xe())));throw ci(u,o==null?void 0:o.callee),u}return s.value},di=e=>(t,n,r)=>{const o=r?{...r,async:!1}:{async:!1},i=t._zod.run({value:n,issues:[]},o);if(i instanceof Promise)throw new vt;return i.issues.length?{success:!1,error:new(e??li)(i.issues.map(s=>Oe(s,o,xe())))}:{success:!0,data:i.value}},Qa=di(hi),pi=e=>async(t,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},o);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(s=>Oe(s,o,xe())))}:{success:!0,data:i.value}},eu=pi(hi),tu=/^[cC][^\s-]{8,}$/,nu=/^[0-9a-z]+$/,ru=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,ou=/^[0-9a-vA-V]{20}$/,iu=/^[A-Za-z0-9]{27}$/,su=/^[a-zA-Z0-9_-]{21}$/,au=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,uu=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Lr=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,cu=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,fu="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function lu(){return new RegExp(fu,"u")}const hu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,du=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,pu=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,gu=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,vu=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,gi=/^[A-Za-z0-9_-]*$/,mu=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,yu=/^\+(?:[0-9]){6,14}[0-9]$/,vi="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",wu=new RegExp(`^${vi}$`);function mi(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function bu(e){return new RegExp(`^${mi(e)}$`)}function _u(e){const t=mi({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-]\\d{2}:\\d{2})");const r=`${t}(?:${n.join("|")})`;return new RegExp(`^${vi}T(?:${r})$`)}const Su=e=>{const t=e?`[\\s\\S]{${(e==null?void 0:e.minimum)??0},${(e==null?void 0:e.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},ku=/^\d+$/,Eu=/^-?\d+(?:\.\d+)?/i,Tu=/true|false/i,Au=/^[^A-Z]*$/,xu=/^[^a-z]*$/,ue=I("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),yi={number:"number",bigint:"bigint",object:"date"},wi=I("$ZodCheckLessThan",(e,t)=>{ue.init(e,t);const n=yi[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,i=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<i&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),bi=I("$ZodCheckGreaterThan",(e,t)=>{ue.init(e,t);const n=yi[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,i=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>i&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Ou=I("$ZodCheckMultipleOf",(e,t)=>{ue.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):za(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),$u=I("$ZodCheckNumberFormat",(e,t)=>{var s;ue.init(e,t),t.format=t.format||"float64";const n=(s=t.format)==null?void 0:s.includes("int"),r=n?"int":"number",[o,i]=La[t.format];e._zod.onattach.push(u=>{const c=u._zod.bag;c.format=t.format,c.minimum=o,c.maximum=i,n&&(c.pattern=ku)}),e._zod.check=u=>{const c=u.value;if(n){if(!Number.isInteger(c)){u.issues.push({expected:r,format:t.format,code:"invalid_type",input:c,inst:e});return}if(!Number.isSafeInteger(c)){c>0?u.issues.push({input:c,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}):u.issues.push({input:c,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}c<o&&u.issues.push({origin:"number",input:c,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),c>i&&u.issues.push({origin:"number",input:c,code:"too_big",maximum:i,inst:e})}}),Cu=I("$ZodCheckMaxLength",(e,t)=>{ue.init(e,t),e._zod.when=n=>{const r=n.value;return!fr(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<r&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const r=n.value;if(r.length<=t.maximum)return;const i=dr(r);n.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Nu=I("$ZodCheckMinLength",(e,t)=>{ue.init(e,t),e._zod.when=n=>{const r=n.value;return!fr(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>r&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const r=n.value;if(r.length>=t.minimum)return;const i=dr(r);n.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:r,inst:e,continue:!t.abort})}}),Ru=I("$ZodCheckLengthEquals",(e,t)=>{ue.init(e,t),e._zod.when=n=>{const r=n.value;return!fr(r)&&r.length!==void 0},e._zod.onattach.push(n=>{const r=n._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=n=>{const r=n.value,o=r.length;if(o===t.length)return;const i=dr(r),s=o>t.length;n.issues.push({origin:i,...s?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},input:n.value,inst:e,continue:!t.abort})}}),ln=I("$ZodCheckStringFormat",(e,t)=>{var n;ue.init(e,t),e._zod.onattach.push(r=>{const o=r._zod.bag;o.format=t.format,t.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(t.pattern))}),(n=e._zod).check??(n.check=r=>{if(!t.pattern)throw new Error("Not implemented.");t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})})}),ju=I("$ZodCheckRegex",(e,t)=>{ln.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Du=I("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=Au),ln.init(e,t)}),Iu=I("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=xu),ln.init(e,t)}),Pu=I("$ZodCheckIncludes",(e,t)=>{ue.init(e,t);const n=xt(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(o=>{const i=o._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(r)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),Uu=I("$ZodCheckStartsWith",(e,t)=>{ue.init(e,t);const n=new RegExp(`^${xt(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),zu=I("$ZodCheckEndsWith",(e,t)=>{ue.init(e,t);const n=new RegExp(`.*${xt(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),Mu=I("$ZodCheckOverwrite",(e,t)=>{ue.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class Zu{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(s=>s),o=Math.min(...r.map(s=>s.length-s.trimStart().length)),i=r.map(s=>s.slice(o)).map(s=>" ".repeat(this.indent*2)+s);for(const s of i)this.content.push(s)}compile(){const t=Function,n=this==null?void 0:this.args,o=[...((this==null?void 0:this.content)??[""]).map(i=>`  ${i}`)];return new t(...n,o.join(`
`))}}const Fu={major:4,minor:0,patch:0},G=I("$ZodType",(e,t)=>{var o;var n;e??(e={}),X(e._zod,"id",()=>t.type+"_"+ui(10)),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Fu;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const i of r)for(const s of i._zod.onattach)s(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),(o=e._zod.deferred)==null||o.push(()=>{e._zod.run=e._zod.parse});else{const i=(s,u,c)=>{let a=ht(s),f;for(const d of u){if(d._zod.when){if(!d._zod.when(s))continue}else if(a)continue;const l=s.issues.length,b=d._zod.check(s);if(b instanceof Promise&&(c==null?void 0:c.async)===!1)throw new vt;if(f||b instanceof Promise)f=(f??Promise.resolve()).then(async()=>{await b,s.issues.length!==l&&(a||(a=ht(s,l)))});else{if(s.issues.length===l)continue;a||(a=ht(s,l))}}return f?f.then(()=>s):s};e._zod.run=(s,u)=>{const c=e._zod.parse(s,u);if(c instanceof Promise){if(u.async===!1)throw new vt;return c.then(a=>i(a,r,u))}return i(c,r,u)}}e["~standard"]={validate:i=>{var s;try{const u=Qa(e,i);return u.success?{value:u.data}:{issues:(s=u.error)==null?void 0:s.issues}}catch{return eu(e,i).then(c=>{var a;return c.success?{value:c.data}:{issues:(a=c.error)==null?void 0:a.issues}})}},vendor:"zod",version:1}}),pr=I("$ZodString",(e,t)=>{var n;G.init(e,t),e._zod.pattern=[...((n=e==null?void 0:e._zod.bag)==null?void 0:n.patterns)??[]].pop()??Su(e._zod.bag),e._zod.parse=(r,o)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),V=I("$ZodStringFormat",(e,t)=>{ln.init(e,t),pr.init(e,t)}),Lu=I("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=uu),V.init(e,t)}),Wu=I("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Lr(r))}else t.pattern??(t.pattern=Lr());V.init(e,t)}),Bu=I("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=cu),V.init(e,t)}),Ku=I("$ZodURL",(e,t)=>{V.init(e,t),e._zod.check=n=>{try{const r=new URL(n.value);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(r.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:mu.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(r.protocol.endsWith(":")?r.protocol.slice(0,-1):r.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort}));return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),Ju=I("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=lu()),V.init(e,t)}),Gu=I("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=su),V.init(e,t)}),Hu=I("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=tu),V.init(e,t)}),qu=I("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=nu),V.init(e,t)}),Vu=I("$ZodULID",(e,t)=>{t.pattern??(t.pattern=ru),V.init(e,t)}),Xu=I("$ZodXID",(e,t)=>{t.pattern??(t.pattern=ou),V.init(e,t)}),Yu=I("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=iu),V.init(e,t)}),Qu=I("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=_u(t)),V.init(e,t),e._zod.check}),ec=I("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=wu),V.init(e,t)}),tc=I("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=bu(t)),V.init(e,t),e._zod.check}),nc=I("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=au),V.init(e,t)}),rc=I("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=hu),V.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv4"})}),oc=I("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=du),V.init(e,t),e._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv6"}),e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),ic=I("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=pu),V.init(e,t)}),sc=I("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=gu),V.init(e,t),e._zod.check=n=>{const[r,o]=n.value.split("/");try{if(!o)throw new Error;const i=Number(o);if(`${i}`!==o)throw new Error;if(i<0||i>128)throw new Error;new URL(`http://[${r}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function _i(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const ac=I("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=vu),V.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),e._zod.check=n=>{_i(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function uc(e){if(!gi.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return _i(n)}const cc=I("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=gi),V.init(e,t),e._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),e._zod.check=n=>{uc(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),fc=I("$ZodE164",(e,t)=>{t.pattern??(t.pattern=yu),V.init(e,t)});function lc(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n,o=JSON.parse(atob(r));return!("typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const hc=I("$ZodJWT",(e,t)=>{V.init(e,t),e._zod.check=n=>{lc(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),Si=I("$ZodNumber",(e,t)=>{G.init(e,t),e._zod.pattern=e._zod.bag.pattern??Eu,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const i=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...i?{received:i}:{}}),n}}),dc=I("$ZodNumber",(e,t)=>{$u.init(e,t),Si.init(e,t)}),pc=I("$ZodBoolean",(e,t)=>{G.init(e,t),e._zod.pattern=Tu,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=!!n.value}catch{}const o=n.value;return typeof o=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:o,inst:e}),n}}),gc=I("$ZodAny",(e,t)=>{G.init(e,t),e._zod.parse=n=>n}),vc=I("$ZodUnknown",(e,t)=>{G.init(e,t),e._zod.parse=n=>n}),mc=I("$ZodNever",(e,t)=>{G.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function Wr(e,t,n){e.issues.length&&t.issues.push(...je(n,e.issues)),t.value[n]=e.value}const yc=I("$ZodArray",(e,t)=>{G.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),n;n.value=Array(o.length);const i=[];for(let s=0;s<o.length;s++){const u=o[s],c=t.element._zod.run({value:u,issues:[]},r);c instanceof Promise?i.push(c.then(a=>Wr(a,n,s))):Wr(c,n,s)}return i.length?Promise.all(i).then(()=>n):n}});function Dt(e,t,n){e.issues.length&&t.issues.push(...je(n,e.issues)),t.value[n]=e.value}function Br(e,t,n,r){e.issues.length?r[n]===void 0?n in r?t.value[n]=void 0:t.value[n]=e.value:t.issues.push(...je(n,e.issues)):e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}const wc=I("$ZodObject",(e,t)=>{G.init(e,t);const n=ai(()=>{const d=Object.keys(t.shape);for(const b of d)if(!(t.shape[b]instanceof G))throw new Error(`Invalid element at key "${b}": expected a Zod schema`);const l=Fa(t.shape);return{shape:t.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(l)}});X(e._zod,"propValues",()=>{const d=t.shape,l={};for(const b in d){const g=d[b]._zod;if(g.values){l[b]??(l[b]=new Set);for(const S of g.values)l[b].add(S)}}return l});const r=d=>{const l=new Zu(["shape","payload","ctx"]),{keys:b,optionalKeys:g}=n.value,S=p=>{const h=rt(p);return`shape[${h}]._zod.run({ value: input[${h}], issues: [] }, ctx)`};l.write("const input = payload.value;");const y=Object.create(null);for(const p of b)y[p]=ui(15);l.write("const newResult = {}");for(const p of b)if(g.has(p)){const h=y[p];l.write(`const ${h} = ${S(p)};`);const v=rt(p);l.write(`
        if (${h}.issues.length) {
          if (input[${v}] === undefined) {
            if (${v} in input) {
              newResult[${v}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${h}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${v}, ...iss.path] : [${v}],
              }))
            );
          }
        } else if (${h}.value === undefined) {
          if (${v} in input) newResult[${v}] = undefined;
        } else {
          newResult[${v}] = ${h}.value;
        }
        `)}else{const h=y[p];l.write(`const ${h} = ${S(p)};`),l.write(`
          if (${h}.issues.length) payload.issues = payload.issues.concat(${h}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${rt(p)}, ...iss.path] : [${rt(p)}]
          })));`),l.write(`newResult[${rt(p)}] = ${h}.value`)}l.write("payload.value = newResult;"),l.write("return payload;");const w=l.compile();return(p,h)=>w(d,p,h)};let o;const i=Fn,s=!si.jitless,c=s&&Ma.value,{catchall:a}=t;let f;e._zod.parse=(d,l)=>{f??(f=n.value);const b=d.value;if(!i(b))return d.issues.push({expected:"object",code:"invalid_type",input:b,inst:e}),d;const g=[];if(s&&c&&(l==null?void 0:l.async)===!1&&l.jitless!==!0)o||(o=r(t.shape)),d=o(d,l);else{d.value={};const h=f.shape;for(const v of f.keys){const m=h[v],T=m._zod.run({value:b[v],issues:[]},l),E=m._zod.optin==="optional"&&m._zod.optout==="optional";T instanceof Promise?g.push(T.then(k=>E?Br(k,d,v,b):Dt(k,d,v))):E?Br(T,d,v,b):Dt(T,d,v)}}if(!a)return g.length?Promise.all(g).then(()=>d):d;const S=[],y=f.keySet,w=a._zod,p=w.def.type;for(const h of Object.keys(b)){if(y.has(h))continue;if(p==="never"){S.push(h);continue}const v=w.run({value:b[h],issues:[]},l);v instanceof Promise?g.push(v.then(m=>Dt(m,d,h))):Dt(v,d,h)}return S.length&&d.issues.push({code:"unrecognized_keys",keys:S,input:b,inst:e}),g.length?Promise.all(g).then(()=>d):d}});function Kr(e,t,n,r){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(o=>o.issues.map(i=>Oe(i,r,xe())))}),t}const bc=I("$ZodUnion",(e,t)=>{G.init(e,t),X(e._zod,"values",()=>{if(t.options.every(n=>n._zod.values))return new Set(t.options.flatMap(n=>Array.from(n._zod.values)))}),X(e._zod,"pattern",()=>{if(t.options.every(n=>n._zod.pattern)){const n=t.options.map(r=>r._zod.pattern);return new RegExp(`^(${n.map(r=>lr(r.source)).join("|")})$`)}}),e._zod.parse=(n,r)=>{let o=!1;const i=[];for(const s of t.options){const u=s._zod.run({value:n.value,issues:[]},r);if(u instanceof Promise)i.push(u),o=!0;else{if(u.issues.length===0)return u;i.push(u)}}return o?Promise.all(i).then(s=>Kr(s,n,e,r)):Kr(i,n,e,r)}}),_c=I("$ZodIntersection",(e,t)=>{G.init(e,t),e._zod.parse=(n,r)=>{const{value:o}=n,i=t.left._zod.run({value:o,issues:[]},r),s=t.right._zod.run({value:o,issues:[]},r);return i instanceof Promise||s instanceof Promise?Promise.all([i,s]).then(([c,a])=>Jr(n,c,a)):Jr(n,i,s)}});function Wn(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(Ln(e)&&Ln(t)){const n=Object.keys(t),r=Object.keys(e).filter(i=>n.indexOf(i)!==-1),o={...e,...t};for(const i of r){const s=Wn(e[i],t[i]);if(!s.valid)return{valid:!1,mergeErrorPath:[i,...s.mergeErrorPath]};o[i]=s.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const o=e[r],i=t[r],s=Wn(o,i);if(!s.valid)return{valid:!1,mergeErrorPath:[r,...s.mergeErrorPath]};n.push(s.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Jr(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),ht(e))return e;const r=Wn(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const Sc=I("$ZodRecord",(e,t)=>{G.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Ln(o))return n.issues.push({expected:"record",code:"invalid_type",input:o,inst:e}),n;const i=[];if(t.keyType._zod.values){const s=t.keyType._zod.values;n.value={};for(const c of s)if(typeof c=="string"||typeof c=="number"||typeof c=="symbol"){const a=t.valueType._zod.run({value:o[c],issues:[]},r);a instanceof Promise?i.push(a.then(f=>{f.issues.length&&n.issues.push(...je(c,f.issues)),n.value[c]=f.value})):(a.issues.length&&n.issues.push(...je(c,a.issues)),n.value[c]=a.value)}let u;for(const c in o)s.has(c)||(u=u??[],u.push(c));u&&u.length>0&&n.issues.push({code:"unrecognized_keys",input:o,inst:e,keys:u})}else{n.value={};for(const s of Reflect.ownKeys(o)){if(s==="__proto__")continue;const u=t.keyType._zod.run({value:s,issues:[]},r);if(u instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(u.issues.length){n.issues.push({origin:"record",code:"invalid_key",issues:u.issues.map(a=>Oe(a,r,xe())),input:s,path:[s],inst:e}),n.value[u.value]=u.value;continue}const c=t.valueType._zod.run({value:o[s],issues:[]},r);c instanceof Promise?i.push(c.then(a=>{a.issues.length&&n.issues.push(...je(s,a.issues)),n.value[u.value]=a.value})):(c.issues.length&&n.issues.push(...je(s,c.issues)),n.value[u.value]=c.value)}}return i.length?Promise.all(i).then(()=>n):n}}),kc=I("$ZodEnum",(e,t)=>{G.init(e,t);const n=Pa(t.entries);e._zod.values=new Set(n),e._zod.pattern=new RegExp(`^(${n.filter(r=>Za.has(typeof r)).map(r=>typeof r=="string"?xt(r):r.toString()).join("|")})$`),e._zod.parse=(r,o)=>{const i=r.value;return e._zod.values.has(i)||r.issues.push({code:"invalid_value",values:n,input:i,inst:e}),r}}),Ec=I("$ZodLiteral",(e,t)=>{G.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?xt(n):n?n.toString():String(n)).join("|")})$`),e._zod.parse=(n,r)=>{const o=n.value;return e._zod.values.has(o)||n.issues.push({code:"invalid_value",values:t.values,input:o,inst:e}),n}}),Tc=I("$ZodTransform",(e,t)=>{G.init(e,t),e._zod.parse=(n,r)=>{const o=t.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(s=>(n.value=s,n));if(o instanceof Promise)throw new vt;return n.value=o,n}}),Ac=I("$ZodOptional",(e,t)=>{G.init(e,t),e._zod.optin="optional",e._zod.optout="optional",X(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),X(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${lr(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>n.value===void 0?n:t.innerType._zod.run(n,r)}),xc=I("$ZodNullable",(e,t)=>{G.init(e,t),X(e._zod,"optin",()=>t.innerType._zod.optin),X(e._zod,"optout",()=>t.innerType._zod.optout),X(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${lr(n.source)}|null)$`):void 0}),X(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),Oc=I("$ZodDefault",(e,t)=>{G.init(e,t),e._zod.optin="optional",X(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(n.value===void 0)return n.value=t.defaultValue,n;const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>Gr(i,t)):Gr(o,t)}});function Gr(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const $c=I("$ZodPrefault",(e,t)=>{G.init(e,t),e._zod.optin="optional",X(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),Cc=I("$ZodNonOptional",(e,t)=>{G.init(e,t),X(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>Hr(i,e)):Hr(o,e)}});function Hr(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Nc=I("$ZodCatch",(e,t)=>{G.init(e,t),X(e._zod,"optin",()=>t.innerType._zod.optin),X(e._zod,"optout",()=>t.innerType._zod.optout),X(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(i=>(n.value=i.value,i.issues.length&&(n.value=t.catchValue({...n,error:{issues:i.issues.map(s=>Oe(s,r,xe()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(i=>Oe(i,r,xe()))},input:n.value}),n.issues=[]),n)}}),Rc=I("$ZodPipe",(e,t)=>{G.init(e,t),X(e._zod,"values",()=>t.in._zod.values),X(e._zod,"optin",()=>t.in._zod.optin),X(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(n,r)=>{const o=t.in._zod.run(n,r);return o instanceof Promise?o.then(i=>qr(i,t,r)):qr(o,t,r)}});function qr(e,t,n){return ht(e)?e:t.out._zod.run({value:e.value,issues:e.issues},n)}const jc=I("$ZodReadonly",(e,t)=>{G.init(e,t),X(e._zod,"propValues",()=>t.innerType._zod.propValues),X(e._zod,"optin",()=>t.innerType._zod.optin),X(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(Vr):Vr(o)}});function Vr(e){return e.value=Object.freeze(e.value),e}const Dc=I("$ZodCustom",(e,t)=>{ue.init(e,t),G.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,o=t.fn(r);if(o instanceof Promise)return o.then(i=>Xr(i,n,r,e));Xr(o,n,r,e)}});function Xr(e,t,n,r){if(!e){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),t.issues.push(mt(o))}}class Ic{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}remove(t){return this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};return delete r.id,{...r,...this._map.get(t)}}return this._map.get(t)}has(t){return this._map.has(t)}}function Pc(){return new Ic}const It=Pc();function Uc(e,t){return new e({type:"string",...Z(t)})}function zc(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...Z(t)})}function Yr(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...Z(t)})}function Mc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...Z(t)})}function Zc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Z(t)})}function Fc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Z(t)})}function Lc(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Z(t)})}function Wc(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...Z(t)})}function Bc(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...Z(t)})}function Kc(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...Z(t)})}function Jc(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...Z(t)})}function Gc(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...Z(t)})}function Hc(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...Z(t)})}function qc(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...Z(t)})}function Vc(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...Z(t)})}function Xc(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...Z(t)})}function Yc(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...Z(t)})}function Qc(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Z(t)})}function ef(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Z(t)})}function tf(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...Z(t)})}function nf(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...Z(t)})}function rf(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...Z(t)})}function of(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...Z(t)})}function sf(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Z(t)})}function af(e,t){return new e({type:"string",format:"date",check:"string_format",...Z(t)})}function uf(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...Z(t)})}function cf(e,t){return new e({type:"string",format:"duration",check:"string_format",...Z(t)})}function ff(e,t){return new e({type:"number",checks:[],...Z(t)})}function lf(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...Z(t)})}function hf(e,t){return new e({type:"boolean",...Z(t)})}function df(e){return new e({type:"any"})}function pf(e){return new e({type:"unknown"})}function gf(e,t){return new e({type:"never",...Z(t)})}function Qr(e,t){return new wi({check:"less_than",...Z(t),value:e,inclusive:!1})}function xn(e,t){return new wi({check:"less_than",...Z(t),value:e,inclusive:!0})}function eo(e,t){return new bi({check:"greater_than",...Z(t),value:e,inclusive:!1})}function On(e,t){return new bi({check:"greater_than",...Z(t),value:e,inclusive:!0})}function to(e,t){return new Ou({check:"multiple_of",...Z(t),value:e})}function ki(e,t){return new Cu({check:"max_length",...Z(t),maximum:e})}function Vt(e,t){return new Nu({check:"min_length",...Z(t),minimum:e})}function Ei(e,t){return new Ru({check:"length_equals",...Z(t),length:e})}function vf(e,t){return new ju({check:"string_format",format:"regex",...Z(t),pattern:e})}function mf(e){return new Du({check:"string_format",format:"lowercase",...Z(e)})}function yf(e){return new Iu({check:"string_format",format:"uppercase",...Z(e)})}function wf(e,t){return new Pu({check:"string_format",format:"includes",...Z(t),includes:e})}function bf(e,t){return new Uu({check:"string_format",format:"starts_with",...Z(t),prefix:e})}function _f(e,t){return new zu({check:"string_format",format:"ends_with",...Z(t),suffix:e})}function Ot(e){return new Mu({check:"overwrite",tx:e})}function Sf(e){return Ot(t=>t.normalize(e))}function kf(){return Ot(e=>e.trim())}function Ef(){return Ot(e=>e.toLowerCase())}function Tf(){return Ot(e=>e.toUpperCase())}function Af(e,t,n){return new e({type:"array",element:t,...Z(n)})}function xf(e,t,n){return new e({type:"custom",check:"custom",fn:t,...Z(n)})}const Of=I("ZodISODateTime",(e,t)=>{Qu.init(e,t),Q.init(e,t)});function $f(e){return sf(Of,e)}const Cf=I("ZodISODate",(e,t)=>{ec.init(e,t),Q.init(e,t)});function Nf(e){return af(Cf,e)}const Rf=I("ZodISOTime",(e,t)=>{tc.init(e,t),Q.init(e,t)});function jf(e){return uf(Rf,e)}const Df=I("ZodISODuration",(e,t)=>{nc.init(e,t),Q.init(e,t)});function If(e){return cf(Df,e)}const Pf=(e,t)=>{li.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>Va(e,n)},flatten:{value:n=>qa(e,n)},addIssue:{value:n=>e.issues.push(n)},addIssues:{value:n=>e.issues.push(...n)},isEmpty:{get(){return e.issues.length===0}}})},hn=I("ZodError",Pf,{Parent:Error}),Uf=Xa(hn),zf=Ya(hn),Mf=di(hn),Zf=pi(hn),Y=I("ZodType",(e,t)=>(G.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),e.clone=(n,r)=>Fe(e,n,r),e.brand=()=>e,e.register=(n,r)=>(n.add(e,r),e),e.parse=(n,r)=>Uf(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>Mf(e,n,r),e.parseAsync=async(n,r)=>zf(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>Zf(e,n,r),e.spa=e.safeParseAsync,e.refine=(n,r)=>e.check(Dl(n,r)),e.superRefine=n=>e.check(Il(n)),e.overwrite=n=>e.check(Ot(n)),e.optional=()=>q(e),e.nullable=()=>ie(e),e.nullish=()=>q(ie(e)),e.nonoptional=n=>Al(e,n),e.array=()=>Xt(e),e.or=n=>vr([e,n]),e.and=n=>gl(e,n),e.transform=n=>so(e,bl(n)),e.default=n=>kl(e,n),e.prefault=n=>Tl(e,n),e.catch=n=>Ol(e,n),e.pipe=n=>so(e,n),e.readonly=()=>Nl(e),e.describe=n=>{const r=e.clone();return It.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){var n;return(n=It.get(e))==null?void 0:n.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return It.get(e);const r=e.clone();return It.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),Ti=I("_ZodString",(e,t)=>{pr.init(e,t),Y.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(vf(...r)),e.includes=(...r)=>e.check(wf(...r)),e.startsWith=(...r)=>e.check(bf(...r)),e.endsWith=(...r)=>e.check(_f(...r)),e.min=(...r)=>e.check(Vt(...r)),e.max=(...r)=>e.check(ki(...r)),e.length=(...r)=>e.check(Ei(...r)),e.nonempty=(...r)=>e.check(Vt(1,...r)),e.lowercase=r=>e.check(mf(r)),e.uppercase=r=>e.check(yf(r)),e.trim=()=>e.check(kf()),e.normalize=(...r)=>e.check(Sf(...r)),e.toLowerCase=()=>e.check(Ef()),e.toUpperCase=()=>e.check(Tf())}),Ff=I("ZodString",(e,t)=>{pr.init(e,t),Ti.init(e,t),e.email=n=>e.check(zc(Lf,n)),e.url=n=>e.check(Wc(Wf,n)),e.jwt=n=>e.check(of(ol,n)),e.emoji=n=>e.check(Bc(Bf,n)),e.guid=n=>e.check(Yr(no,n)),e.uuid=n=>e.check(Mc(Pt,n)),e.uuidv4=n=>e.check(Zc(Pt,n)),e.uuidv6=n=>e.check(Fc(Pt,n)),e.uuidv7=n=>e.check(Lc(Pt,n)),e.nanoid=n=>e.check(Kc(Kf,n)),e.guid=n=>e.check(Yr(no,n)),e.cuid=n=>e.check(Jc(Jf,n)),e.cuid2=n=>e.check(Gc(Gf,n)),e.ulid=n=>e.check(Hc(Hf,n)),e.base64=n=>e.check(tf(tl,n)),e.base64url=n=>e.check(nf(nl,n)),e.xid=n=>e.check(qc(qf,n)),e.ksuid=n=>e.check(Vc(Vf,n)),e.ipv4=n=>e.check(Xc(Xf,n)),e.ipv6=n=>e.check(Yc(Yf,n)),e.cidrv4=n=>e.check(Qc(Qf,n)),e.cidrv6=n=>e.check(ef(el,n)),e.e164=n=>e.check(rf(rl,n)),e.datetime=n=>e.check($f(n)),e.date=n=>e.check(Nf(n)),e.time=n=>e.check(jf(n)),e.duration=n=>e.check(If(n))});function ne(e){return Uc(Ff,e)}const Q=I("ZodStringFormat",(e,t)=>{V.init(e,t),Ti.init(e,t)}),Lf=I("ZodEmail",(e,t)=>{Bu.init(e,t),Q.init(e,t)}),no=I("ZodGUID",(e,t)=>{Lu.init(e,t),Q.init(e,t)}),Pt=I("ZodUUID",(e,t)=>{Wu.init(e,t),Q.init(e,t)}),Wf=I("ZodURL",(e,t)=>{Ku.init(e,t),Q.init(e,t)}),Bf=I("ZodEmoji",(e,t)=>{Ju.init(e,t),Q.init(e,t)}),Kf=I("ZodNanoID",(e,t)=>{Gu.init(e,t),Q.init(e,t)}),Jf=I("ZodCUID",(e,t)=>{Hu.init(e,t),Q.init(e,t)}),Gf=I("ZodCUID2",(e,t)=>{qu.init(e,t),Q.init(e,t)}),Hf=I("ZodULID",(e,t)=>{Vu.init(e,t),Q.init(e,t)}),qf=I("ZodXID",(e,t)=>{Xu.init(e,t),Q.init(e,t)}),Vf=I("ZodKSUID",(e,t)=>{Yu.init(e,t),Q.init(e,t)}),Xf=I("ZodIPv4",(e,t)=>{rc.init(e,t),Q.init(e,t)}),Yf=I("ZodIPv6",(e,t)=>{oc.init(e,t),Q.init(e,t)}),Qf=I("ZodCIDRv4",(e,t)=>{ic.init(e,t),Q.init(e,t)}),el=I("ZodCIDRv6",(e,t)=>{sc.init(e,t),Q.init(e,t)}),tl=I("ZodBase64",(e,t)=>{ac.init(e,t),Q.init(e,t)}),nl=I("ZodBase64URL",(e,t)=>{cc.init(e,t),Q.init(e,t)}),rl=I("ZodE164",(e,t)=>{fc.init(e,t),Q.init(e,t)}),ol=I("ZodJWT",(e,t)=>{hc.init(e,t),Q.init(e,t)}),Ai=I("ZodNumber",(e,t)=>{Si.init(e,t),Y.init(e,t),e.gt=(r,o)=>e.check(eo(r,o)),e.gte=(r,o)=>e.check(On(r,o)),e.min=(r,o)=>e.check(On(r,o)),e.lt=(r,o)=>e.check(Qr(r,o)),e.lte=(r,o)=>e.check(xn(r,o)),e.max=(r,o)=>e.check(xn(r,o)),e.int=r=>e.check(ro(r)),e.safe=r=>e.check(ro(r)),e.positive=r=>e.check(eo(0,r)),e.nonnegative=r=>e.check(On(0,r)),e.negative=r=>e.check(Qr(0,r)),e.nonpositive=r=>e.check(xn(0,r)),e.multipleOf=(r,o)=>e.check(to(r,o)),e.step=(r,o)=>e.check(to(r,o)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function le(e){return ff(Ai,e)}const il=I("ZodNumberFormat",(e,t)=>{dc.init(e,t),Ai.init(e,t)});function ro(e){return lf(il,e)}const sl=I("ZodBoolean",(e,t)=>{pc.init(e,t),Y.init(e,t)});function oo(e){return hf(sl,e)}const al=I("ZodAny",(e,t)=>{gc.init(e,t),Y.init(e,t)});function gr(){return df(al)}const ul=I("ZodUnknown",(e,t)=>{vc.init(e,t),Y.init(e,t)});function io(){return pf(ul)}const cl=I("ZodNever",(e,t)=>{mc.init(e,t),Y.init(e,t)});function fl(e){return gf(cl,e)}const ll=I("ZodArray",(e,t)=>{yc.init(e,t),Y.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(Vt(n,r)),e.nonempty=n=>e.check(Vt(1,n)),e.max=(n,r)=>e.check(ki(n,r)),e.length=(n,r)=>e.check(Ei(n,r)),e.unwrap=()=>e.element});function Xt(e,t){return Af(ll,e,t)}const hl=I("ZodObject",(e,t)=>{wc.init(e,t),Y.init(e,t),X(e,"shape",()=>t.shape),e.keyof=()=>ml(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:io()}),e.loose=()=>e.clone({...e._zod.def,catchall:io()}),e.strict=()=>e.clone({...e._zod.def,catchall:fl()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>Ka(e,n),e.merge=n=>Ja(e,n),e.pick=n=>Wa(e,n),e.omit=n=>Ba(e,n),e.partial=(...n)=>Ga(Oi,e,n[0]),e.required=(...n)=>Ha($i,e,n[0])});function Qe(e,t){const n={type:"object",get shape(){return hr(this,"shape",{...e}),this.shape},...Z(t)};return new hl(n)}const dl=I("ZodUnion",(e,t)=>{bc.init(e,t),Y.init(e,t),e.options=t.options});function vr(e,t){return new dl({type:"union",options:e,...Z(t)})}const pl=I("ZodIntersection",(e,t)=>{_c.init(e,t),Y.init(e,t)});function gl(e,t){return new pl({type:"intersection",left:e,right:t})}const vl=I("ZodRecord",(e,t)=>{Sc.init(e,t),Y.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function dn(e,t,n){return new vl({type:"record",keyType:e,valueType:t,...Z(n)})}const Bn=I("ZodEnum",(e,t)=>{kc.init(e,t),Y.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,o)=>{const i={};for(const s of r)if(n.has(s))i[s]=t.entries[s];else throw new Error(`Key ${s} not found in enum`);return new Bn({...t,checks:[],...Z(o),entries:i})},e.exclude=(r,o)=>{const i={...t.entries};for(const s of r)if(n.has(s))delete i[s];else throw new Error(`Key ${s} not found in enum`);return new Bn({...t,checks:[],...Z(o),entries:i})}});function ml(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new Bn({type:"enum",entries:n,...Z(t)})}const yl=I("ZodLiteral",(e,t)=>{Ec.init(e,t),Y.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function xi(e,t){return new yl({type:"literal",values:Array.isArray(e)?e:[e],...Z(t)})}const wl=I("ZodTransform",(e,t)=>{Tc.init(e,t),Y.init(e,t),e._zod.parse=(n,r)=>{n.addIssue=i=>{if(typeof i=="string")n.issues.push(mt(i,n.value,t));else{const s=i;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=e),s.continue??(s.continue=!0),n.issues.push(mt(s))}};const o=t.transform(n.value,n);return o instanceof Promise?o.then(i=>(n.value=i,n)):(n.value=o,n)}});function bl(e){return new wl({type:"transform",transform:e})}const Oi=I("ZodOptional",(e,t)=>{Ac.init(e,t),Y.init(e,t),e.unwrap=()=>e._zod.def.innerType});function q(e){return new Oi({type:"optional",innerType:e})}const _l=I("ZodNullable",(e,t)=>{xc.init(e,t),Y.init(e,t),e.unwrap=()=>e._zod.def.innerType});function ie(e){return new _l({type:"nullable",innerType:e})}const Sl=I("ZodDefault",(e,t)=>{Oc.init(e,t),Y.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function kl(e,t){return new Sl({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const El=I("ZodPrefault",(e,t)=>{$c.init(e,t),Y.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Tl(e,t){return new El({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():t}})}const $i=I("ZodNonOptional",(e,t)=>{Cc.init(e,t),Y.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Al(e,t){return new $i({type:"nonoptional",innerType:e,...Z(t)})}const xl=I("ZodCatch",(e,t)=>{Nc.init(e,t),Y.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function Ol(e,t){return new xl({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const $l=I("ZodPipe",(e,t)=>{Rc.init(e,t),Y.init(e,t),e.in=t.in,e.out=t.out});function so(e,t){return new $l({type:"pipe",in:e,out:t})}const Cl=I("ZodReadonly",(e,t)=>{jc.init(e,t),Y.init(e,t)});function Nl(e){return new Cl({type:"readonly",innerType:e})}const Rl=I("ZodCustom",(e,t)=>{Dc.init(e,t),Y.init(e,t)});function jl(e,t){const n=new ue({check:"custom",...Z(t)});return n._zod.check=e,n}function Dl(e,t={}){return xf(Rl,e,t)}function Il(e,t){const n=jl(r=>(r.addIssue=o=>{if(typeof o=="string")r.issues.push(mt(o,r.value,n._zod.def));else{const i=o;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=n),i.continue??(i.continue=!n._zod.def.abort),r.issues.push(mt(i))}},e(r.value,r)),t);return n}const pe=ne().min(1),Ci=ne().min(1),Pl=le().gte(0),He=le().gte(0).lte(1);dn(pe,He);const Ul=Qe({id:pe,name:Ci,type:xi("NonRootNode"),manual_fulfillment:ie(le()),children:Xt(gr()),points:Pl,parent_id:pe,contributor_ids:Xt(pe)}),Ni=Qe({id:pe,name:Ci,type:xi("RootNode"),manual_fulfillment:ie(le()),children:Xt(gr()),created_at:ne(),updated_at:ne()});vr([Ni,Ul]);const Ri=Qe({id:pe,name:ne(),emoji:q(ne()),quantity:q(le().gte(0)),unit:q(ne()),max_natural_div:q(le().gte(1)),max_percentage_div:q(He),hidden_until_request_accepted:q(oo()),owner_id:q(pe),filter_rule:q(ie(gr())),location_type:q(ne()),longitude:q(le().min(-180).max(180)),latitude:q(le().min(-90).max(90)),all_day:q(oo()),recurrence:q(ie(ne())),custom_recurrence_repeat_every:q(ie(le())),custom_recurrence_repeat_unit:q(ie(ne())),custom_recurrence_end_type:q(ie(ne())),custom_recurrence_end_value:q(ie(ne())),start_date:q(ie(ne())),start_time:q(ie(ne())),end_date:q(ie(ne())),end_time:q(ie(ne())),time_zone:q(ne())}),zl=Qe({...Ri.shape,recipient_shares:dn(pe,He)}),Ml=Qe({...Ri.shape,share_percentage:He,computed_quantity:le().gte(0),provider_id:pe}),Zl=vr([zl,Ml]),Fl=dn(pe,Zl),Ll=Qe({ourShare:He,theirShare:He,timestamp:le()});dn(pe,Ll);const ee=H(null),yt=H(null),Ue=H(null),ze=H({}),Be=H({}),ji=oe([Be,ze],([e,t])=>{if(!e||!t)return console.log("[NETWORK-CAPACITIES] No network data available, returning empty"),{};console.log("networkCapacityShares",e),console.log("networkCapacities",t);const n={};return Object.entries(e).forEach(([r,o])=>{const i=t[r];i&&Object.entries(o).forEach(([s,u])=>{const c=i[s];c&&(n[s]={...c,share_percentage:u,computed_quantity:$a(c,u),provider_id:r})})}),console.log(`[NETWORK-CAPACITIES] Found ${Object.keys(n).length} capacities where we have shares`),n}),Di=H({}),wt=H([]),$n=H([]),Ae=H({}),mr=oe(Ae,e=>{console.log(`[MUTUAL-RECOGNITION] ${new Date().toISOString()} Recalculating from cache:`,e);const t={};for(const[n,r]of Object.entries(e)){const o=Math.min(r.ourShare,r.theirShare);t[n]=o,console.log(`[MUTUAL-RECOGNITION] ${n}: our=${r.ourShare.toFixed(4)}, their=${r.theirShare.toFixed(4)}, mutual=${o.toFixed(4)}`)}return console.log("[MUTUAL-RECOGNITION] Final mutual values:",t),t}),Ii=oe(mr,e=>Object.entries(e).filter(([n,r])=>r>0).map(([n,r])=>n)),Pi=oe(mr,e=>{if(console.log(`[PROVIDER-SHARES] ${new Date().toISOString()} Recalculating from mutual recognition:`,e),Object.keys(e).length===0)return console.log("[PROVIDER-SHARES] No mutual recognition data, returning empty"),{};const t=At(e);return console.log("[PROVIDER-SHARES] Normalized shares:",t),t}),Wl=oe([ee],([e])=>{if(!e)return console.log("[SUBTREE-MAP] No tree available, returning empty map"),{};console.log("[SUBTREE-MAP] Calculating subtree contributor map...");const t=oi(e);return console.log("[SUBTREE-MAP] Generated filter map for",Object.keys(t).length,"subtrees"),t}),Ui=oe([Ue,Pi,Wl],([e,t,n])=>{if(console.log(`[CAPACITY-SHARES] ${new Date().toISOString()} Recalculating from capacities and provider shares`),!e||Object.keys(t).length===0)return console.log("[CAPACITY-SHARES] No capacities or provider shares, returning empty"),{};const r={};return Object.entries(e).forEach(([o,i])=>{try{const u=Ea(i,t,{subtreeContributors:n});r[o]=u}catch(s){console.error("[CAPACITY-SHARES] Error calculating shares for capacity:",o,s),r[o]={}}}),console.log("[CAPACITY-SHARES] Generated shares for",Object.keys(r).length,"capacities"),r}),yr=oe(Ui,e=>{console.log(`[CAPACITY-SHARES] ${new Date().toISOString()} Recalculating from capacity shares`);const t={};return Object.entries(e).forEach(([n,r])=>{Object.entries(r).forEach(([o,i])=>{t[o]||(t[o]={}),t[o][n]=i})}),console.log("[CAPACITY-SHARES] Generated contributor shares map:",t),t}),$v=oe([Ue,Ui],([e,t])=>{if(console.log(`[CAPACITIES-WITH-SHARES] ${new Date().toISOString()} Combining capacities with shares`),!e)return console.log("[CAPACITIES-WITH-SHARES] No capacities available, returning null"),null;const n={};return Object.entries(e).forEach(([r,o])=>{const i=t[r]||{};n[r]={...o,recipient_shares:i}}),console.log("[CAPACITIES-WITH-SHARES] Generated",Object.keys(n).length,"capacities with shares"),n});oe([ee],([e])=>{if(!e)return[];const t=oi(e);return Object.entries(t).map(([n,r])=>{const o=Object.keys(r),i=Ie(e,n),s=(i==null?void 0:i.name)||n;return{id:n,name:s,contributorCount:o.length,contributors:o}}).filter(n=>n.contributorCount>0)});const Ne=H(!1),Re=H(!1),Bl=H(!1),Kn=H(!1);function wr(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Wt={exports:{}};Wt.exports;var ao;function Le(){return ao||(ao=1,function(e){(function(){function t(r,o){return o?wr(r):r.slice?t[i(r)]:function(s,u){r(s={exports:{}}),t[i(u)]=s.exports};function i(s){return s.split("/").slice(-1).toString().replace(".js","")}}var n=e;t(function(r){String.random=function(i,s){var u="";for(i=i||24,s=s||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";i-- >0;)u+=s.charAt(Math.floor(Math.random()*s.length));return u},String.match=function(i,s){var u,c;return typeof i!="string"?!1:(typeof s=="string"&&(s={"=":s}),s=s||{},u=s["="]||s["*"]||s[">"]||s["<"],i===u?!0:c!==s["="]?!1:(u=s["*"]||s[">"],i.slice(0,(u||"").length)===u?!0:c!==s["*"]?!1:c!==s[">"]&&c!==s["<"]?i>=s[">"]&&i<=s["<"]:c!==s[">"]&&i>=s[">"]||c!==s["<"]&&i<=s["<"]))},String.hash=function(i,s){if(typeof i=="string"){if(s=s||0,!i.length)return s;for(var u=0,c=i.length,a;u<c;++u)a=i.charCodeAt(u),s=(s<<5)-s+a,s|=0;return s}};var o=Object.prototype.hasOwnProperty;Object.plain=function(i){return i?i instanceof Object&&i.constructor===Object||Object.prototype.toString.call(i).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(i,s){for(var u in i)if(o.call(i,u)&&(!s||s.indexOf(u)==-1))return!1;return!0},Object.keys=Object.keys||function(i){var s=[];for(var u in i)o.call(i,u)&&s.push(u);return s},function(){var i,s=setTimeout,u=0,c=0,a=typeof setImmediate!=""+i&&setImmediate||function(d,l){return typeof MessageChannel==""+i?s:((d=new MessageChannel).port1.onmessage=function(b){b.data==""&&l()},function(b){l=b,d.port2.postMessage("")})}(),f=s.check=s.check||typeof performance!=""+i&&performance||{now:function(){return+new Date}};s.hold=s.hold||9,s.poll=s.poll||function(d){if(s.hold>=f.now()-u&&c++<3333){d();return}a(function(){u=f.now(),d()},c=0)}}(),function(){var i=setTimeout,s=i.turn=i.turn||function(l){u.push(l)==1&&c(d)},u=s.s=[],c=i.poll,a=0,f,d=function(){(f=u[a++])&&f(),(a==u.length||a==99)&&(u=s.s=u.slice(a),a=0),u.length&&c(d)}}(),function(){var i,s=setTimeout,u=s.turn;(s.each=s.each||function(c,a,f,d){d=d||9,function l(b,g,S){if(g=(b=(c||[]).splice(0,d)).length){for(var y=0;y<g&&i===(S=a(b[y]));y++);if(i===S){u(l);return}}f&&f(S)}()})()}()})(t,"./shim"),t(function(r){r.exports=function o(f,s,u){if(!f)return{to:o};var c,a=typeof s=="function",f=(this.tag||(this.tag={}))[f]||a&&(this.tag[f]={tag:f,to:o._={next:function(l){var b;(b=this.to)&&b.next(l)}}});if(a){var d={off:o.off||(o.off=function(){if(this.next===o._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=o._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:o._,next:s,the:f,on:this,as:u};return(d.back=f.last||f).to=d,f.last=d}return(f=f.to)&&c!==s&&f.next(s),f}})(t,"./onto"),t(function(r){r.exports=function(o){return o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"&&o!=1/0&&o!=-1/0&&o===o||!!o&&typeof o["#"]=="string"&&Object.keys(o).length===1&&o["#"]}})(t,"./valid"),t(function(r){t("./shim");function o(){var f=+new Date;return c<f?(s=0,c=f+o.drift):c=f+(s+=1)/u+o.drift}o.drift=0;var i=-1/0,s=0,u=999,c=i,a;o.is=function(f,d,l){var b=d&&f&&f._&&f._[">"]||l;if(b)return typeof(b=b[d])=="number"?b:i},o.ify=function(f,d,l,b,g){(f=f||{})._=f._||{},g&&(f._["#"]=g);var S=f._[">"]||(f._[">"]={});return a!==d&&d!=="_"&&(typeof l=="number"&&(S[d]=l),a!==b&&(f[d]=b)),f},r.exports=o})(t,"./state"),t(function(r){t("./shim");function o(i){var s={s:{}},u=s.s;i=i||{max:999,age:1e3*9},s.check=function(a){return u[a]?c(a):!1};var c=s.track=function(a){var f=u[a]||(u[a]={});return f.was=s.now=+new Date,s.to||(s.to=setTimeout(s.drop,i.age+9)),c.ed&&c.ed(a),f};return s.drop=function(a){s.to=null,s.now=+new Date;var f=Object.keys(u);console.STAT&&console.STAT(s.now,+new Date-s.now,"dup drop keys"),setTimeout.each(f,function(d){var l=u[d];l&&(a||i.age)>s.now-l.was||delete u[d]},0,99)},s}r.exports=o})(t,"./dup"),t(function(r){t("./onto"),r.exports=function(s,u){if(this.on){var c=(this.opt||{}).lack||9e3;if(typeof s!="function"){if(!s)return;var f=s["#"]||s,a=(this.tag||"")[f];return a?(u&&(a=this.on(f,u),clearTimeout(a.err),a.err=setTimeout(function(){a.off()},c)),!0):void 0}var f=u&&u["#"]||o(9);if(!s)return f;var d=this.on(f,s,u);return d.err=d.err||setTimeout(function(){d.off(),d.next({err:"Error: No ACK yet.",lack:!0})},c),f}};var o=String.random||function(){return Math.random().toString(36).slice(2)}})(t,"./ask"),t(function(r){function o(g){return g instanceof o?(this._={$:this}).$:this instanceof o?o.create(this._={$:this,opt:g}):new o(g)}o.is=function(g){return g instanceof o||g&&g._&&g===g._.$||!1},o.version=.202,o.chain=o.prototype,o.chain.toJSON=function(){},t("./shim"),o.valid=t("./valid"),o.state=t("./state"),o.on=t("./onto"),o.dup=t("./dup"),o.ask=t("./ask"),function(){o.create=function(_){_.root=_.root||_,_.graph=_.graph||{},_.on=_.on||o.on,_.ask=_.ask||o.ask,_.dup=_.dup||o.dup();var x=_.$.opt(_.opt);return _.once||(_.on("in",g,_),_.on("out",g,_),_.on("put",w,_),o.on("create",_),_.on("create",_)),_.once=1,x};function g(_){if(_){if(_.out===g){this.to.next(_);return}var x=this,$=x.as,D=$.at||$,N=D.$,R=D.dup,P,U=_.DBG;if((P=_["#"])||(P=_["#"]=s(9)),!R.check(P)){if(R.track(P),P=_._,_._=typeof P=="function"?P:function(){},_.$&&_.$===(_.$._||"").$||(_.$=N),_["@"]&&!_.put&&h(_),!D.ask(_["@"],_))if(U&&(U.u=+new Date),_.put){S(_);return}else _.get&&o.on.get(_,N);U&&(U.uc=+new Date),x.to.next(_),U&&(U.ua=+new Date),!(_.nts||_.NTS)&&(_.out=g,D.on("out",_),U&&(U.ue=+new Date))}}}function S(_){if(_){var x=_._||"",$=x.root=((x.$=_.$||"")._||"").root;if(_["@"]&&x.faith&&!x.miss){_.out=g,$.on("out",_);return}x.latch=$.hatch,x.match=$.hatch=[];var D=_.put,N=x.DBG=_.DBG,R=+new Date;if(C=C||R,!(D["#"]&&D["."])){N&&(N.p=R),x["#"]=_["#"],x.msg=_,x.all=0,x.stun=1;var P=Object.keys(D);console.STAT&&console.STAT(R,((N||x).pk=+new Date)-R,"put sort");var U=0,F,B,K,J,re,fe,et;(function $e(Nt){if(F!=U){if(F=U,!(K=P[U])){console.STAT&&console.STAT(R,((N||x).pd=+new Date)-R,"put"),p(x);return}(J=D[K])?(et=J._)?K!==et["#"]?fe=m+T(K)+"soul not same.":(re=et[">"])||(fe=m+T(K)+"no state."):fe=m+T(K)+"no meta.":fe=m+T(K)+"no node.",B=Object.keys(J||{})}if(fe){_.err=x.err=fe,p(x);return}var xr=0,Ce;for(Nt=Nt||0;Nt++<9&&(Ce=B[xr++]);)if(Ce!=="_"){var Rt=J[Ce],Or=re[Ce];if(d===Or){fe=m+T(Ce)+"on"+T(K)+"no state.";break}if(!c(Rt)){fe=m+T(Ce)+"on"+T(K)+"bad "+typeof Rt+T(Rt);break}y(Rt,Ce,K,Or,_),++j}if((B=B.slice(xr)).length){u($e);return}++U,B=null,$e(Nt)})()}}}o.on.put=S;function y(_,x,$,D,N){var R=N._||"",P=R.root,U=P.graph,F,B=U[$]||l,K=a(B,x,1),J=B[x],re=R.DBG;(F=console.STAT)&&(!U[$]||!J)&&(F.has=(F.has||0)+1);var fe=O();if(D>fe){setTimeout(function(){y(_,x,$,D,N)},(F=D-fe)>k?k:F),console.STAT&&console.STAT((re||R).Hf=+new Date,F,"future");return}if(!(D<K)&&!(!R.faith&&D===K&&(_===J||E(_)<=E(J))&&!R.miss)){R.stun++;var et=N["#"]+R.all++,$e={toString:function(){return et},_:R};$e.toJSON=$e.toString,P.dup.track($e)["#"]=N["#"],re&&(re.ph=re.ph||+new Date),P.on("put",{"#":$e,"@":N["@"],put:{"#":$,".":x,":":_,">":D},ok:N.ok,_:R})}}function w(_){var x;(x=(_._||"").DBG)&&(x.pa=+new Date,x.pm=x.pm||+new Date);var $=this,D=$.as,N=D.graph,R=_._,P=_.put,U=P["#"],F=P["."],B=P[":"],K=P[">"];_["#"];var J;(J=R.msg)&&(J=J.put)&&(J=J[U])&&f(J,F,K,B,U),N[U]=f(N[U],F,K,B,U),(J=(D.next||"")[U])&&J.on("in",_),p(R),$.to.next(_)}function p(_,x){var $;if(!_.stop&&!(!_.err&&0<--_.stun)&&(_.stop=1,!!($=_.root))){var D=_.match;D.end=1,D===$.hatch&&(!(D=_.latch)||D.end?delete $.hatch:$.hatch=D),_.hatch&&_.hatch(),setTimeout.each(_.match,function(N){N&&N()}),!(!(x=_.msg)||_.err||x.err)&&(x.out=g,_.root.on("out",x),A())}}function h(_){var x=_["@"]||"",$;if(!($=x._)){var D=(D=_.$)&&(D=D._)&&(D=D.root)&&(D=D.dup);if(!(D=D.check(x)))return;_["@"]=D["#"]||_["@"];return}$.acks=($.acks||0)+1,($.err=_.err)&&(_["@"]=$["#"],p($)),$.ok=_.ok||$.ok,!$.stop&&!$.crack&&($.crack=$.match&&$.match.push(function(){v($)})),v($)}function v(_){!_||!_.root||_.stun||_.acks!==_.all||_.root.on("in",{"@":_["#"],err:_.err,ok:_.err?d:_.ok||{"":1}})}var m="Error: Invalid graph!",T=function(_){return" '"+(""+_).slice(0,9)+"...' "},E=JSON.stringify,k=2147483647,O=o.state,j=0,C,A=function(){j>999&&j/-(C-(C=+new Date))>1&&(o.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),A=function(){j=0})}}(),function(){o.on.get=function(S,y){var w=y._,p=S.get,h=p["#"],v=w.graph[h],m=p["."],T=w.next||(w.next={}),E=T[h],k=S._||{},O=k.DBG=S.DBG;if(O&&(O.g=+new Date),!v)return w.on("get",S);if(m){if((typeof m!="string"||d===v[m])&&!((E||"").next||"")[m]){w.on("get",S);return}v=f({},m,a(v,m),v[m],h)}v&&g(S,v),w.on("get",S)};function g(S,y){var w=+new Date,p=S._||{},h=p.DBG=S.DBG,v=S["#"],m=s(9),T=Object.keys(y||"").sort(),E=((y||"")._||"")["#"];T.length;var k=S.$._.root,O=y===k.graph[E];console.STAT&&console.STAT(w,((h||p).gk=+new Date)-w,"got keys"),y&&function j(){w=+new Date;for(var C=0,A,_={},x;C<9&&(A=T[C++]);)f(_,A,a(y,A),y[A],E);T=T.slice(C),(x={})[E]=_,_=x;var $;O&&($=function(){},$.ram=$.faith=!0),x=T.length,console.STAT&&console.STAT(w,-(w-(w=+new Date)),"got copied some"),h&&(h.ga=+new Date),k.on("in",{"@":v,"#":m,put:_,"%":x?m=s(9):d,$:k.$,_:$,DBG:h,FOO:1}),console.STAT&&console.STAT(w,+new Date-w,"got in"),x&&setTimeout.turn(j)}(),y||k.on("in",{"@":S["#"]})}o.on.get.ack=g}(),function(){o.chain.opt=function(g){g=g||{};var S=this,y=S._,w=g.peers||g;return Object.plain(g)||(g={}),Object.plain(y.opt)||(y.opt=g),typeof w=="string"&&(w=[w]),Object.plain(y.opt.peers)||(y.opt.peers={}),w instanceof Array&&(g.peers={},w.forEach(function(p){var h={};h.id=h.url=p,g.peers[p]=y.opt.peers[p]=y.opt.peers[p]||h})),i(g,function p(h){var v=this[h];if(this&&this.hasOwnProperty(h)||typeof v=="string"||Object.empty(v)){this[h]=v;return}v&&v.constructor!==Object&&!(v instanceof Array)||i(v,p)}),y.opt.from=g,o.on("opt",y),y.opt.uuid=y.opt.uuid||function(h){return o.state().toString(36).replace(".","")+String.random(h||12)},S}}();var i=function(g,S){Object.keys(g).forEach(S,g)},s=String.random,u=setTimeout.turn,c=o.valid,a=o.state.is,f=o.state.ify,d,l={},b;o.log=function(){return!o.log.off&&b.log.apply(b,arguments),[].slice.call(arguments).join(" ")},o.log.once=function(g,S,y){return(y=o.log.once)[g]=y[g]||0,y[g]++||o.log(S)},typeof window<"u"&&((window.GUN=window.Gun=o).window=window);try{typeof n<"u"&&(n.exports=o)}catch{}r.exports=o,(o.window||{}).console=(o.window||{}).console||{log:function(){}},(b=console).only=function(g,S){return b.only.i&&g===b.only.i&&b.only.i++&&(b.log.apply(b,arguments)||S)},o.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(t,"./root"),t(function(r){var o=t("./root");o.chain.back=function(u,c){var a;if(u=u||1,u===-1||u===1/0)return this._.root.$;if(u===1)return(this._.back||this._).$;var f=this,d=f._;if(typeof u=="string"&&(u=u.split(".")),u instanceof Array){var l=0,b=u.length,a=d;for(l;l<b;l++)a=(a||i)[u[l]];return s!==a?c?f:a:(a=d.back)?a.$.back(u,c):void 0}if(typeof u=="function"){for(var g,a={back:d};(a=a.back)&&s===(g=u(a,c)););return g}return typeof u=="number"?(d.back||d).$.back(u-1):this};var i={},s})(t,"./back"),t(function(r){var o=t("./root");o.chain.chain=function(p){var h=this,v=h._,m=new(p||h).constructor(h),T=m._,E;return T.root=E=v.root,T.id=++E.once,T.back=h._,T.on=o.on,T.on("in",o.on.in,T),T.on("out",o.on.out,T),m};function i(p){var h,v=this.as,m=v.back,T=v.root,E;if(p.$||(p.$=v.$),this.to.next(p),v.err){v.on("in",{put:v.put=d,$:v.$});return}if(h=p.get){if(T.pass&&(T.pass[v.id]=v),v.lex&&Object.keys(v.lex).forEach(function(k){E[k]=v.lex[k]},E=p.get=p.get||{}),h["#"]||v.soul){if(h["#"]=h["#"]||v.soul,p["#"]||(p["#"]=l(9)),m=T.$.get(h["#"])._,h=h["."]){if(g(m.put,h)&&(E=m.ask&&m.ask[h],(m.ask||(m.ask={}))[h]=m.$.get(h)._,m.on("in",{get:h,put:{"#":m.soul,".":h,":":m.put[h],">":y(T.graph[m.soul],h)}}),E))return}else{if(E=m.ask&&m.ask[""],(m.ask||(m.ask={}))[""]=m,d!==m.put&&(m.on("in",m),E))return;p.$=m.$}return T.ask(a,p),T.on("in",p)}if(h["."])return v.get?(p={get:{".":v.get},$:v.$},(m.ask||(m.ask={}))[v.get]=p.$._,m.on("out",p)):(p={get:v.lex?p.get:{},$:v.$},m.on("out",p));if((v.ask||(v.ask={}))[""]=v,v.get)return h["."]=v.get,(m.ask||(m.ask={}))[v.get]=p.$._,m.on("out",p)}return m.on("out",p)}o.on.out=i;function s(p,h){h=h||this.as;var v=h.root,m=p.$||(p.$=h.$),T=(m||"")._||f,E=p.put||"",k=E["#"],O=E["."],j=d!==E["="]?E["="]:E[":"],C=E[">"]||-1/0,A;if(d!==p.put&&(d===E["#"]||d===E["."]||d===E[":"]&&d===E["="]||d===E[">"])){if(!b(E)){if(!(k=((E||"")._||"")["#"])){console.log("chain not yet supported for",E,"...",p,h);return}return m=h.root.$.get(k),setTimeout.each(Object.keys(E).sort(),function(_){_=="_"||d===(C=y(E,_))||h.on("in",{$:m,put:{"#":k,".":_,"=":E[_],">":C},VIA:p})})}h.on("in",{$:T.back.$,put:{"#":k=T.back.soul,".":O=T.has||T.get,"=":E,">":y(T.back.put,O)},via:p});return}(p.seen||"")[h.id]||((p.seen||(p.seen=function(){}))[h.id]=h,h!==T&&(Object.keys(p).forEach(function(_){E[_]=p[_]},E={}),E.get=h.get||E.get,!h.soul&&!h.has?E.$$$=E.$$$||h.$:T.soul&&(E.$=h.$,E.$$=E.$$||T.$),p=E),c(p,h),(h.soul||p.$$)&&C>=y(v.graph[k],O)&&((E=v.$.get(k)._).put=w(E.put,O,C,j,k)),!T.soul&&C>=y(v.graph[k],O)&&(A=(v.$.get(k)._.next||"")[O])&&(A.put=j,typeof(E=b(j))=="string"&&(A.put=v.$.get(E)._.put||j)),this.to&&this.to.next(p),h.any&&setTimeout.each(Object.keys(h.any),function(_){(_=h.any[_])&&_(p)},0,99),h.echo&&setTimeout.each(Object.keys(h.echo),function(_){(_=h.echo[_])&&_.on("in",p)},0,99),((p.$$||"")._||T).soul&&(A=h.next)&&(A=A[O])&&(E={},Object.keys(p).forEach(function(_){E[_]=p[_]}),E.$=(p.$$||p.$).get(E.get=O),delete E.$$,delete E.$$$,A.on("in",E)),u(p,h))}o.on.in=s;function u(p,h){if(h=h||this.as||p.$._,!(p.$$&&this!==o.on)&&!(!p.put||h.soul)){var v=p.put||"",m=v["="]||v[":"],O,T=h.root,E=T.$.get(v["#"]).get(v["."])._;if(typeof(m=b(m))!="string"){this===o.on&&((E.echo||(E.echo={}))[h.id]=h);return}if(!((E.echo||(E.echo={}))[h.id]&&!(T.pass||"")[h.id])){if(O=T.pass){if(O[m+h.id])return;O[m+h.id]=1}(E.echo||(E.echo={}))[h.id]=h,h.has&&(h.link=m);var k=T.$.get(E.link=m)._;(k.echo||(k.echo={}))[E.id]=E;var O=h.ask||"";(O[""]||h.lex)&&k.on("out",{get:{"#":m}}),setTimeout.each(Object.keys(O),function(j,C){!j||!(C=O[j])||C.on("out",{get:{"#":m,".":j}})},0,99)}}}o.on.link=u;function c(p,h){var v=p.put||"",m=d!==v["="]?v["="]:v[":"],T=h.root,E,k;if(d===m){if(h.soul&&d!==h.put||(k=(p.$$||p.$||"")._||"",p["@"]&&(d!==k.put||d!==h.put)))return;(E=h.link||p.linked)&&delete(T.$.get(E)._.echo||"")[h.id],h.has&&(h.link=null),h.put=d,setTimeout.each(Object.keys(h.next||""),function(O,j){(j=h.next[O])&&(E&&delete(T.$.get(E).get(O)._.echo||"")[j.id],j.on("in",{get:O,put:d,$:j.$}))},0,99);return}h.soul||p.$$||(E=b(m),k=p.$._||"",!((E===k.link||h.has&&!k.link)&&!((T.pass||"")[h.id]&&typeof E!="string"))&&(delete(k.echo||"")[h.id],c({get:h.get,put:d,$:p.$,linked:p.linked=p.linked||k.link},h)))}o.on.unlink=c;function a(p,h){var v=this.as,m=v.$._;m.root;var T=v.get||"",E=(p.put||"")[T["#"]]||"";if(!p.put||typeof T["."]=="string"&&d===E[T["."]]){if(d!==m.put||!m.soul&&!m.has)return;m.ack=(m.ack||0)+1,m.on("in",{get:m.get,put:m.put=d,$:m.$,"@":p["@"]});return}(p._||{}).miss=1,o.on.put(p)}var f={},d,l=String.random,b=o.valid,g=function(p,h){return p&&Object.prototype.hasOwnProperty.call(p,h)},S=o.state,y=S.is,w=S.ify})(t,"./chain"),t(function(r){var o=t("./root");o.chain.get=function(d,l,b){var g,S;if(typeof d=="string"){if(d.length==0)return(g=this.chain())._.err={err:o.log("0 length key!",d)},l&&l.call(g,g._.err),g;var y=this,w=y._,p=w.next||c;(g=p[d])||(g=d&&i(d,y)),g=g&&g.$}else if(typeof d=="function"){let k=function(O,j,C){if(!k.stun&&!((N=v.pass)&&!N[m])){var A=O.$._,_=(O.$$||"")._,x=(_||A).put,$=!A.has&&!A.soul,D={},N;if(($||f===x)&&(x=f===((N=O.put)||"")["="]?f===(N||"")[":"]?N:N[":"]:N["="]),typeof(N=o.valid(x))=="string"&&(x=f===(N=v.$.get(N)._.put)?h.not?f:x:N),!(h.not&&f===x)){if(f===h.stun){if((N=v.stun)&&N.on&&(w.$.back(function(R){if(N.on(""+R.id,D={}),(D.run||0)<k.id)return D}),!D.run&&N.on(""+A.id,D={}),!D.run&&_&&N.on(""+_.id,D={}),k.id>D.run&&((!D.stun||D.stun.end)&&(D.stun=N.on("stun"),D.stun=D.stun&&D.stun.last),D.stun&&!D.stun.end))){(D.stun.add||(D.stun.add={}))[m]=function(){k(O,j,1)};return}if(f===x&&(C=0),(N=v.hatch)&&!N.end&&f===h.hatch&&!C){if(T[A.$._.id])return;T[A.$._.id]=1,N.push(function(){k(O,j,1)});return}T={}}if(v.pass){if(v.pass[m+A.id])return;v.pass[m+A.id]=1}if(h.on){h.ok.call(A.$,x,A.get,O,j||k);return}if(h.v2020){h.ok(O,j||k);return}Object.keys(O).forEach(function(R){N[R]=O[R]},N={}),O=N,O.put=x,h.ok.call(h.as,O,j||k)}}};if(l===!0)return s(this,d,l,b),this;g=this;var w=g._,h=l||{},v=w.root,m;h.at=w,h.ok=d;var T={};return k.at=w,(w.any||(w.any={}))[m=String.random(7)]=k,k.off=function(){k.stun=1,w.any&&delete w.any[m]},k.rid=u,k.id=h.run||++v.once,S=v.pass,(v.pass={})[m]=1,h.out=h.out||{get:{}},w.on("out",h.out),v.pass=S,g}else{if(typeof d=="number")return this.get(""+d,l,b);if(typeof(S=a(d))=="string")return this.get(S,l,b);(S=this.get.next)&&(g=S(this,d))}return g?(l&&typeof l=="function"&&g.get(l,b),g):((g=this.chain())._.err={err:o.log("Invalid get request!",d)},l&&l.call(g,g._.err),g)};function i(d,l){var b=l._,g=b.next,S=l.chain(),y=S._;return g||(g=b.next={}),g[y.get=d]=y,l===b.root.$?y.soul=d:(b.soul||b.has)&&(y.has=d),y}function s(d,l,b,g){var S=d._,y=0,w;return(w=S.soul||S.link)?l(w,g,S):S.jam?S.jam.push([l,g]):(S.jam=[[l,g]],d.get(function(h,v){if(!(f===h.put&&!S.root.opt.super&&(w=Object.keys(S.root.opt.peers).length)&&++y<=w)){v.rid(h);var m=(m=h.$)&&m._||{},T=0,E;for(w=S.jam,delete S.jam;E=w[T++];){var k=E[0];E=E[1],k&&k(m.link||m.soul||o.valid(h.put)||((h.put||{})._||{})["#"],E,h,v)}}},{out:{get:{".":!0}}}),d)}function u(d){var l=this.at||this.on;if(!d||l.soul||l.has)return this.off();if(d=(d=(d=d.$||d)._||d).id){l.map;var b;if((b=this.seen||(this.seen={}))[d])return!0;b[d]=!0}}var c={},a=o.valid,f})(t,"./get"),t(function(r){var o=t("./root");o.chain.put=function(g,S,y){var w=this,p=w._,h=p.root;y=y||{},y.root=p.root,y.run||(y.run=h.once),i(y,p.id),y.ack=y.ack||S,y.via=y.via||w,y.data=y.data||g,y.soul||(y.soul=p.soul||typeof S=="string"&&S);var v=y.state=y.state||o.state();return typeof g=="function"?(g(function(m){y.data=m,w.put(a,a,y)}),w):y.soul?(y.$=h.$.get(y.soul),y.todo=[{it:y.data,ref:y.$}],y.turn=y.turn||d,y.ran=y.ran||s,function m(){var T=y.todo,E=T.pop(),k=E.it;E.ref&&E.ref._.id;var O,j,C,A,_;if(i(y,E.ref),(A=E.todo)&&(j=A.pop(),k=k[j],A.length&&T.push(E)),j&&(T.path||(T.path=[])).push(j),!(O=l(k))&&!(_=o.is(k))){if(!Object.plain(k)){s.err(y,"Invalid data: "+c(k)+" at "+(y.via.back(function(N){N.get&&A.push(N.get)},A=[])||A.join("."))+"."+(T.path||[]).join("."));return}for(var x=y.seen||(y.seen=[]),$=x.length;$--;)if(k===(A=x[$]).it){O=k=A.link;break}}if(j&&O)E.node=b(E.node,j,v,k);else{let N=function(R,P){var U=C.link["#"];P&&(P.off(),P.rid(R));var F=U||R.soul||(A=(R.$$||R.$)._||"").soul||A.link||((A=A.put||"")._||"")["#"]||A["#"]||((A=R.put||"")&&R.$$?A["#"]:(A["="]||A[":"]||"")["#"]);if(!U&&i(y,R.$),!F&&!E.link["#"]){(E.wait||(E.wait=[])).push(function(){N(R,P)});return}F||(F=[],(R.$$||R.$).back(function(B){if(A=B.soul||B.link)return F.push(A);F.push(B.get)}),F=F.reverse().join("/")),C.link["#"]=F,!_&&(((y.graph||(y.graph={}))[F]=C.node||(C.node={_:{}}))._["#"]=F),delete y.wait[D],C.wait&&setTimeout.each(C.wait,function(B){B&&B()}),y.ran(y)};if(!y.seen){s.err(y,"Data at root of graph must be a node (an object).");return}y.seen.push(C={it:k,link:{},todo:_?[]:Object.keys(k).sort().reverse(),path:(T.path||[]).slice(),up:E}),E.node=b(E.node,j,v,C.link),!_&&C.todo.length&&T.push(C);var D=y.seen.length;(y.wait||(y.wait={}))[D]="",A=(C.ref=_?k:j?E.ref.get(j):E.ref)._,(A=k&&(k._||"")["#"]||A.soul||A.link)?N({soul:A}):C.ref.get(N,{run:y.run,v2020:1,out:{get:{".":" "}}})}if(!T.length)return y.ran(y);y.turn(m)}(),w):(u(y),w)};function i(g,S){if(S){S=(S._||"").id||S;var y=g.root.stun||(g.root.stun={on:o.on}),w={},p;g.stun||(g.stun=y.on("stun",function(){})),(p=y.on(""+S))&&p.the.last.next(w),!(w.run>=g.run)&&y.on(""+S,function(h){if(g.stun.end){this.off(),this.to.next(h);return}h.run=h.run||g.run,h.stun=h.stun||g.stun})}}function s(g){if(g.err){s.end(g.stun,g.root);return}if(!(g.todo.length||g.end||!Object.empty(g.wait))){g.end=1;var S=g.$.back(-1)._,y=S.root,w=S.ask(function(m){y.on("ack",m),m.err&&!m.lack&&o.log(m),++p>(g.acks||0)&&this.off(),g.ack&&g.ack(m,this)},g.opt),p=0,h=g.stun,v;(v=function(){h&&(s.end(h,y),setTimeout.each(Object.keys(h=h.add||""),function(m){(m=h[m])&&m()}))}).hatch=v,g.ack&&!g.ok&&(g.ok=g.acks||9),g.via._.on("out",{put:g.out=g.graph,ok:g.ok&&{"@":g.ok+1},opt:g.opt,"#":w,_:v})}}s.end=function(g,S){g.end=f,g.the.to===g&&g===g.the.last&&delete S.stun,g.off()},s.err=function(g,S){(g.ack||f).call(g,g.out={err:g.err=o.log(S)}),g.ran(g)};function u(g){var S=g.via._,y;g.via=g.via.back(function(w){if(w.soul||!w.get)return w.$;y=g.data,(g.data={})[w.get]=y}),(!g.via||!g.via._.soul)&&(g.via=S.root.$.get(((g.data||"")._||"")["#"]||S.$.back("opt.uuid")())),g.via.put(g.data,g.ack,g)}function c(g,S){return g&&(S=g.constructor)&&S.name||typeof g}var a,f=function(){},d=setTimeout.turn,l=o.valid,b=o.state.ify})(t,"./put"),t(function(r){var o=t("./root");t("./chain"),t("./back"),t("./put"),t("./get"),r.exports=o})(t,"./index"),t(function(r){var o=t("./index");o.chain.on=function(u,c,a,f){var d=this,l=d._;l.root;var b;if(typeof u=="string")return c?(b=l.on(u,c,a||l,f),a&&a.$&&(a.subs||(a.subs=[])).push(b),d):l.on(u);var g=c;return(g=g===!0?{change:!0}:g||{}).not=1,g.on=1,d.get(u,g),d},o.chain.once=function(u,c){if(c=c||{},!u)return i(this);var a=this,f=a._,d=f.root;f.put;var l=String.random(7),b;return a.get(function(g,S,y,w){var p=this,h=p._,v=h.one||(h.one={});if(w.stun||v[l]==="")return;if((b=o.valid(g))===!0){m();return}if(typeof b=="string")return;clearTimeout((f.one||"")[l]),clearTimeout(v[l]),v[l]=setTimeout(m,c.wait||99);function m(T){if(!h.has&&!h.soul&&(h={put:g,get:S}),s===(b=h.put)&&(b=((y.$$||"")._||"").put),typeof o.valid(b)=="string"&&(b=d.$.get(b)._.put,b===s&&!T)){v[l]=setTimeout(function(){m(1)},c.wait||99);return}w.stun||v[l]!==""&&(v[l]="",(f.soul||f.has)&&w.off(),u.call(p,b,h.get),clearTimeout(v[l]))}},{on:1}),a};function i(u,c,a){return o.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(a=u.chain())._.nix=u.once(function(f,d){a._.on("in",this._)}),a._.lex=u._.lex,a}o.chain.off=function(){var u=this,c=u._,a,f=c.back;if(f)return c.ack=0,(a=f.next)&&a[c.get]&&delete a[c.get],(a=f.any)&&(delete f.any,f.any={}),(a=f.ask)&&delete a[c.get],(a=f.put)&&delete a[c.get],(a=c.soul)&&delete f.root.graph[a],(a=c.map)&&Object.keys(a).forEach(function(d,l){l=a[d],l.link&&f.root.$.get(l.link).off()}),(a=c.next)&&Object.keys(a).forEach(function(d,l){l=a[d],l.$.off()}),c.on("off",{}),u};var s})(t,"./on"),t(function(r){var o=t("./index"),i=o.chain.get.next;o.chain.get.next=function(a,f){var d;return Object.plain(f)?(d=((d=f["#"])||"")["="]||d)?a.get(d):((d=a.chain()._).lex=f,a.on("in",function(l){String.match(l.get||(l.put||"")["."],f["."]||f["#"]||f)&&d.on("in",l),this.to.next(l)}),d.$):(i||u)(a,f)},o.chain.map=function(a,f,d){var l=this,b=l._,g,S;return Object.plain(a)&&(g=a["."]?a:{".":a},a=c),a?(o.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),S=l.chain(),l.map().on(function(y,w,p,h){var v=(a||u).call(this,y,w,p,h);if(c!==v){if(y===v)return S._.on("in",p);if(o.is(v))return S._.on("in",v._);var m={};Object.keys(p.put).forEach(function(T){m[T]=p.put[T]},m),m["="]=v,S._.on("in",{get:w,put:m})}}),S):((S=b.each)||((b.each=S=l.chain())._.lex=g||S._.lex||b.lex,S._.nix=l.back("nix"),l.on("in",s,S._)),S)};function s(a){this.to.next(a);var f=this.as,d=a.$,l=d._,b=a.put,g;!l.soul&&!a.$$||(g=f.lex)&&!String.match(a.get||(b||"")["."],g["."]||g["#"]||g)||o.on.link(a,f)}var u=function(){},c})(t,"./map"),t(function(r){var o=t("./index");o.chain.set=function(i,s,u){var c=this,a=c.back(-1),f,d;return s=s||function(){},u=u||{},u.item=u.item||i,(f=((i||"")._||"")["#"])&&((i={})["#"]=f),typeof(d=o.valid(i))=="string"?c.get(f=d).put(i,s,u):o.is(i)?(c.put(function(l){i.get(function(b,g,S){if(!b)return s.call(c,{err:o.log('Only a node can be linked! Not "'+S.put+'"!')});(d={})[b]={"#":b},l(d)},!0)}),i):(Object.plain(i)&&(i=a.get(f=c.back("opt.uuid")()).put(i)),c.get(f||a.back("opt.uuid")(7)).put(i,s,u))}})(t,"./set"),t(function(r){t("./shim");var o=function(){},i=JSON.parseAsync||function(a,f,d){var l,b=+new Date;try{f(l,JSON.parse(a,d),s.sucks(+new Date-b))}catch(g){f(g)}},s=JSON.stringifyAsync||function(a,f,d,l){var b,g=+new Date;try{f(b,JSON.stringify(a,d,l),s.sucks(+new Date-g))}catch(S){f(S)}};s.sucks=function(a){a>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),s.sucks=o)};function u(a){var f=function(){},d=a.opt||{};d.log=d.log||console.log,d.gap=d.gap||d.wait||0,d.max=d.max||(d.memory?d.memory*999*999:3e8)*.3,d.pack=d.pack||d.max*.01*.01,d.puff=d.puff||9;var l=setTimeout.turn||setTimeout,b=a.dup,g=b.check,S=b.track,y=f.hear=function(h,v){if(h){if(d.max<=h.length)return f.say({dam:"!",err:"Message too big!"},v);f===this&&(y.d+=h.length||0,++y.c);var m=v.SH=+new Date,T=h[0],E;if(T==="["){i(h,function(k,O){if(k||!O)return f.say({dam:"!",err:"DAM JSON parse error."},v);console.STAT&&console.STAT(+new Date,O.length,"# on hear batch");var j=d.puff;(function C(){for(var A=+new Date,_=0,x;_<j&&(x=O[_++]);)f.hear(x,v);O=O.slice(_),console.STAT&&console.STAT(A,+new Date-A,"hear loop"),w(v),O.length&&l(C,0)})()}),h="";return}if(T==="{"||(h["#"]||Object.plain(h))&&(E=h)){if(E)return y.one(E,v,m);i(h,function(k,O){if(k||!O)return f.say({dam:"!",err:"DAM JSON parse error."},v);y.one(O,v,m)});return}}};y.one=function(h,v,C){var T,E,k,O,j;if(h.DBG&&(h.DBG=j={DBG:h.DBG}),j&&(j.h=C),j&&(j.hp=+new Date),(T=h["#"])||(T=h["#"]=String.random(9)),!(k=g(T))&&(E=h["##"],!(E&&(k=h["@"]||h.get&&T)&&b.check(O=k+E)))){if((h._=function(){}).via=f.leap=v,(k=h["><"])&&typeof k=="string"&&k.slice(0,99).split(",").forEach(function(A){this[A]=1},h._.yo={}),k=h.dam){(k=f.hear[k])&&k(h,v,a),S(T);return}(k=h.ok)&&(h._.near=k["/"]);var C=+new Date;j&&(j.is=C),v.SI=T,S.ed=function(A){T===A&&(S.ed=0,(A=b.s[T])&&(A.via=v,h.get&&(A.it=h)))},a.on("in",f.last=h),j&&(j.hd=+new Date),console.STAT&&console.STAT(C,+new Date-C,h.get?"msg get":h.put?"msg put":"msg"),S(T),O&&S(O),f.leap=f.last=null}},y.c=y.d=0,function(){var h=0,v;f.hash=function(E,k){var O,j,C,A=+new Date;s(E.put,function _(x,$){var D=(j||(j=C=$||"")).slice(0,32768);if(O=String.hash(D,O),j=j.slice(32768),j){l(_,0);return}console.STAT&&console.STAT(A,+new Date-A,"say json+hash"),E._.$put=C,E["##"]=O,f.say(E,k),delete E._.$put},m)};function m(E,k){var O;return k instanceof Object?(Object.keys(k).sort().forEach(T,{to:O={},on:k}),O):k}function T(E){this.to[E]=this.on[E]}f.say=function(E,k){var O;if((O=this)&&(O=O.to)&&O.next&&O.next(E),!E)return!1;var j,C,A,_=E["@"],x=E._||(E._=function(){}),$=E.DBG,D=+new Date;if(x.y=x.y||D,k||$&&($.y=D),(j=E["#"])||(j=E["#"]=String.random(9)),!v&&S(j),!(C=E["##"])&&c!==E.put&&!x.via&&_){f.hash(E,k);return}if(!k&&_&&(k=(O=b.s[_])&&(O.via||(O=O.it)&&(O=O._)&&O.via)||(O=f.last)&&_===O["#"]&&f.leap),!k&&_)return b.s[_]?void 0:(console.STAT&&console.STAT(+new Date,++h,"total no peer to ack to"),!1);if(_&&!E.put&&!C&&((b.s[_]||"").it||"")["##"])return!1;if(!k&&f.way)return f.way(E);if($&&($.yh=+new Date),!(A=x.raw)){f.raw(E,k);return}if($&&($.yr=+new Date),!k||!k.id){if(!Object.plain(k||d.peers))return!1;var D=+new Date;d.puff;var N=d.peers,R=Object.keys(k||d.peers||{});console.STAT&&console.STAT(D,+new Date-D,"peer keys"),function F(){var B=+new Date;v=1;var K=x.raw;x.raw=A;for(var J=0,re;J<9&&(re=(R||"")[J++]);)(re=N[re]||(k||"")[re])&&f.say(E,re);x.raw=K,v=0,R=R.slice(J),console.STAT&&console.STAT(B,+new Date-B,"say loop"),R.length&&(l(F,0),_&&S(_))}();return}if(!k.wire&&f.wire&&f.wire(k),j!==k.last){if(k.last=j,k===x.via||(O=x.yo)&&(O[k.url]||O[k.pid]||O[k.id]))return!1;if(console.STAT&&console.STAT(D,(($||x).yp=+new Date)-(x.y||D),"say prep"),!v&&_&&S(_),k.batch){if(k.tail=(O=k.tail||0)+A.length,k.tail<=d.pack){k.batch+=(O?",":"")+A;return}w(k)}k.batch="[";var P=+new Date;setTimeout(function(){console.STAT&&console.STAT(P,+new Date-P,"0ms TO"),w(k)},d.gap),p(A,k),console.STAT&&_===k.SI&&console.STAT(D,+new Date-k.SH,"say ack")}},f.say.c=f.say.d=0,f.raw=function(E,k){if(!E)return"";var O=E._||{},j,C;if(C=O.raw)return C;if(typeof E=="string")return E;var A=E["##"],_=E["@"];if(A&&_){if(!O.via&&g(_+A))return!1;if(C=(b.s[_]||"").it){if(A===C["##"])return!1;C["##"]||(C["##"]=A)}}if(!E.dam&&!E["@"]){var x=0,$=[];C=d.peers;for(var D in C){var N=C[D];if($.push(N.url||N.pid||N.id),++x>6)break}x>1&&(E["><"]=$.join())}if(E.put&&(C=E.ok)&&(E.ok={"@":(C["@"]||1)-1,"/":C["/"]==E._.near?f.near:C["/"]}),j=O.$put){C={},Object.keys(E).forEach(function(P){C[P]=E[P]}),C.put=":])([:",s(C,function(P,U){if(!P){var F=+new Date;C=U.indexOf('"put":":])([:"'),R(c,U=U.slice(0,C+6)+j+U.slice(C+14)),console.STAT&&console.STAT(F,+new Date-F,"say slice")}});return}s(E,R);function R(P,U){P||(O.raw=U,f.say(E,k))}}}();function w(h){var v=h.batch,m=typeof v=="string";if(m&&(v+="]"),h.batch=h.tail=null,!!v&&!(m?3>v.length:!v.length)){if(!m)try{v=v.length===1?v[0]:JSON.stringify(v)}catch(T){return d.log("DAM JSON stringify error",T)}v&&p(v,h)}}function p(h,v){try{var m=v.wire;v.say?v.say(h):m.send&&m.send(h),f.say.d+=h.length||0,++f.say.c}catch{(v.queue=v.queue||[]).push(h)}}return f.near=0,f.hi=function(h){var v=h.wire,m;if(!v){f.wire(h.length&&{url:h,id:h}||h);return}h.id?d.peers[h.url||h.id]=h:(m=h.id=h.id||h.url||String.random(9),f.say({dam:"?",pid:a.opt.pid},d.peers[m]=h),delete b.s[h.last]),h.met||(f.near++,h.met=+new Date,a.on("hi",h)),m=h.queue,h.queue=[],setTimeout.each(m||[],function(T){p(T,h)},0,9)},f.bye=function(h){h.met&&--f.near,delete h.met,a.on("bye",h);var v=+new Date;v=v-(h.met||v),f.bye.time=((f.bye.time||v)+v)/2},f.hear["!"]=function(h,v){d.log("Error:",h.err)},f.hear["?"]=function(h,v){h.pid&&(v.pid||(v.pid=h.pid),h["@"])||(f.say({dam:"?",pid:d.pid,"@":h["#"]},v),delete b.s[v.last])},f.hear.mob=function(h,v){if(h.peers){var m=Object.keys(h.peers),T=m[Math.random()*m.length>>0];T&&(f.bye(v),f.hi(T))}},a.on("create",function(h){h.opt.pid=h.opt.pid||String.random(9),this.to.next(h),h.on("out",f.say)}),a.on("bye",function(h,v){h=d.peers[h.id||h]||h,this.to.next(h),h.bye?h.bye():(v=h.wire)&&v.close&&v.close(),delete d.peers[h.id],h.wire=null}),a.on("bye",function(h,v){this.to.next(h),(v=console.STAT)&&(v.peers=f.near),(v=h.url)&&setTimeout(function(){},d.lack||9e3)}),a.on("hi",function(h,v){if(this.to.next(h),(v=console.STAT)&&(v.peers=f.near),!d.super){var m=Object.keys(a.next||"");m.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(m,function(T){var E=a.next[T];if(d.super||(E.ask||"")[""]){f.say({get:{"#":T}},h);return}setTimeout.each(Object.keys(E.ask||""),function(k){k&&f.say({"##":String.hash((a.graph[T]||"")[k]),get:{"#":T,".":k}},h)})})}}),f}var c;try{r.exports=u}catch{}})(t,"./mesh"),t(function(r){var o=t("./index");o.Mesh=t("./mesh"),o.on("opt",function(s){if(this.to.next(s),s.once)return;var u=s.opt;if(u.WebSocket===!1)return;var c=o.window||{},a=u.WebSocket||c.WebSocket||c.webkitWebSocket||c.mozWebSocket;if(!a)return;u.WebSocket=a;var f=u.mesh=u.mesh||o.Mesh(s);f.wire||u.wire,f.wire=u.wire=d;function d(S){try{if(!S||!S.url)return w&&w(S);var y=S.url.replace(/^http/,"ws"),w=S.wire=new u.WebSocket(y);return w.onclose=function(){b(S),u.mesh.bye(S)},w.onerror=function(p){b(S)},w.onopen=function(){u.mesh.hi(S)},w.onmessage=function(p){p&&u.mesh.hear(p.data||p,S)},w}catch{u.mesh.bye(S)}}setTimeout(function(){!u.super&&s.on("out",{dam:"hi"})},1);var l=2*999;function b(S){clearTimeout(S.defer),u.peers[S.url]&&(g&&S.retry<=0||(S.retry=(S.retry||u.retry+1||60)-(-S.tried+(S.tried=+new Date)<l*4?1:0),S.defer=setTimeout(function y(){if(g&&g.hidden)return setTimeout(y,l);d(S)},l)))}var g=""+i!=typeof document&&document});var i})(t,"./websocket"),t(function(r){if(!(typeof Gun>"u")){var o=function(){},i;try{i=(Gun.window||o).localStorage}catch{}i||(Gun.log("Warning: No localStorage exists to persist data to!"),i={setItem:function(u,c){this[u]=c},removeItem:function(u){delete this[u]},getItem:function(u){return this[u]}});var s=JSON.stringifyAsync||function(u,c,a,f){var d;try{c(d,JSON.stringify(u,a,f))}catch(l){c(l)}};Gun.on("create",function u(c){this.to.next(c);var a=c.opt;c.graph;var f=[],d,l,b,g;if(a.localStorage===!1)return;a.prefix=a.file||"gun/";try{d=u[a.prefix]=u[a.prefix]||JSON.parse(b=i.getItem(a.prefix))||{}}catch{d=u[a.prefix]={}}b=(b||"").length,c.on("get",function(y){this.to.next(y);var w=y.get,p,h,v,m;!w||!(p=w["#"])||(h=d[p]||m,h&&(v=w["."])&&!Object.plain(v)&&(h=Gun.state.ify({},v,Gun.state.is(h,v),h[v],p)),Gun.on.get.ack(y,h))}),c.on("put",function(y){this.to.next(y);var w=y.put,p=w["#"],h=w["."],v=y["#"],m=y.ok||"";if(d[p]=Gun.state.ify(d[p],h,w[">"],w[":"],p),g&&b>4999880){c.on("in",{"@":v,err:"localStorage max!"});return}!y["@"]&&(!y._.via||Math.random()<m["@"]/m["/"])&&f.push(v),!l&&(l=setTimeout(S,9+b/333))});function S(){if(!f.length&&((setTimeout.turn||"").s||"").length){setTimeout(S,99);return}var y=f;clearTimeout(l),l=!1,f=[],s(d,function(w,p){try{!w&&i.setItem(a.prefix,p)}catch(h){w=g=h||"localStorage failure"}w&&(Gun.log(w+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),c.on("localStorage:error",{err:w,get:a.prefix,put:d})),b=p.length,setTimeout.each(y,function(h){c.on("in",{"@":h,err:w,ok:0})},0,99)})}})}})(t,"./localStorage")})(),function(){var C;if(""+C!=typeof Gun){var t=function(A){console.warn("Warning! Deprecated internal utility will break in next version:",A)},n=Gun;n.fn=n.fn||{is:function(A){return t("fn"),!!A&&typeof A=="function"}},n.bi=n.bi||{is:function(A){return t("bi"),A instanceof Boolean||typeof A=="boolean"}},n.num=n.num||{is:function(A){return t("num"),!r(A)&&(A-parseFloat(A)+1>=0||A===1/0||A===-1/0)}},n.text=n.text||{is:function(A){return t("text"),typeof A=="string"}},n.text.ify=n.text.ify||function(A){return t("text.ify"),n.text.is(A)?A:typeof JSON<"u"?JSON.stringify(A):A&&A.toString?A.toString():A},n.text.random=n.text.random||function(A,_){t("text.random");var x="";for(A=A||24,_=_||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";A>0;)x+=_.charAt(Math.floor(Math.random()*_.length)),A--;return x},n.text.match=n.text.match||function(A,_){var x,$;return t("text.match"),typeof A!="string"?!1:(typeof _=="string"&&(_={"=":_}),_=_||{},x=_["="]||_["*"]||_[">"]||_["<"],A===x?!0:$!==_["="]?!1:(x=_["*"]||_[">"]||_["<"],A.slice(0,(x||"").length)===x?!0:$!==_["*"]?!1:$!==_[">"]&&$!==_["<"]?A>=_[">"]&&A<=_["<"]:$!==_[">"]&&A>=_[">"]||$!==_["<"]&&A<=_["<"]))},n.text.hash=n.text.hash||function(A,_){if(t("text.hash"),typeof A=="string"){if(_=_||0,!A.length)return _;for(var x=0,$=A.length,D;x<$;++x)D=A.charCodeAt(x),_=(_<<5)-_+D,_|=0;return _}},n.list=n.list||{is:function(A){return t("list"),A instanceof Array}},n.list.slit=n.list.slit||Array.prototype.slice,n.list.sort=n.list.sort||function(A){return t("list.sort"),function(_,x){return!_||!x?0:(_=_[A],x=x[A],_<x?-1:_>x?1:0)}},n.list.map=n.list.map||function(A,_,x){return t("list.map"),O(A,_,x)},n.list.index=1,n.obj=n.boj||{is:function(A){return t("obj"),A?A instanceof Object&&A.constructor===Object||Object.prototype.toString.call(A).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},n.obj.put=n.obj.put||function(A,_,x){return t("obj.put"),(A||{})[_]=x,A},n.obj.has=n.obj.has||function(A,_){return t("obj.has"),A&&Object.prototype.hasOwnProperty.call(A,_)},n.obj.del=n.obj.del||function(A,_){if(t("obj.del"),!!A)return A[_]=null,delete A[_],A},n.obj.as=n.obj.as||function(A,_,x,$){return t("obj.as"),A[_]=A[_]||($===x?{}:x)},n.obj.ify=n.obj.ify||function(A){if(t("obj.ify"),v(A))return A;try{A=JSON.parse(A)}catch{A={}}return A},function(){var A;function _(x,$){T(this,$)&&A!==this[$]||(this[$]=x)}n.obj.to=n.obj.to||function(x,$){return t("obj.to"),$=$||{},O(x,_,$),$}}(),n.obj.copy=n.obj.copy||function(A){return t("obj.copy"),A&&JSON.parse(JSON.stringify(A))},function(){function A(_,x){var $=this.n,D;if(!($&&(x===$||v($)&&T($,x)))&&D!==x)return!0}n.obj.empty=n.obj.empty||function(_,x){return t("obj.empty"),_?!O(_,A,{n:x}):!0}}(),function(){function A($,D){if(arguments.length===2){A.r=A.r||{},A.r[$]=D;return}A.r=A.r||[],A.r.push($)}var _=Object.keys,x;Object.keys=Object.keys||function($){return x($,function(D,N,R){R(N)})},n.obj.map=x=n.obj.map||function($,D,N){t("obj.map");var R,P=0,U,F,B,K,J=typeof D=="function";if(A.r=R,_&&v($)&&(B=_($),K=!0),N=N||{},r($)||B)for(U=(B||$).length;P<U;P++){var re=P+n.list.index;if(J){if(F=K?D.call(N,$[B[P]],B[P],A):D.call(N,$[P],re,A),F!==R)return F}else if(D===$[K?B[P]:P])return B?B[P]:re}else for(P in $)if(J){if(T($,P)&&(F=N?D.call(N,$[P],P,A):D($[P],P,A),F!==R))return F}else if(D===$[P])return P;return J?A.r:n.list.index?0:-1}}(),n.time=n.time||{},n.time.is=n.time.is||function(A){return t("time"),A?A instanceof Date:+new Date().getTime()};var p=n.fn.is,r=n.list.is,h=n.obj,v=h.is,T=h.has,O=h.map,o={};o.is=function(A){return t("val.is"),A===C?!1:A===null?!0:A===1/0?!1:u(A)||s(A)||g(A)?!0:o.link.is(A)||!1},o.link=o.rel={_:"#"},function(){o.link.is=function(_){if(t("val.link.is"),_&&_[i]&&!_._&&v(_)){var x={};if(O(_,A,x),x.id)return x.id}return!1};function A(_,x){var $=this;if($.id)return $.id=!1;if(x==i&&u(_))$.id=_;else return $.id=!1}}(),o.link.ify=function(A){return t("val.link.ify"),k({},i,A)},n.obj.has._=".";var i=o.link._,C,s=n.bi.is,g=n.num.is,u=n.text.is,h=n.obj,v=h.is,k=h.put,O=h.map;n.val=n.val||o;var c={_:"_"};c.soul=function(A,_){return t("node.soul"),A&&A._&&A._[_||d]},c.soul.ify=function(A,_){return t("node.soul.ify"),_=typeof _=="string"?{soul:_}:_||{},A=A||{},A._=A._||{},A._[d]=_.soul||A._[d]||f(),A},c.soul._=o.link._,function(){c.is=function(_,x,$){t("node.is");var D;return v(_)&&(D=c.soul(_))?!O(_,A,{as:$,cb:x,s:D,n:_}):!1};function A(_,x){if(x!==c._){if(!o.is(_))return!0;this.cb&&this.cb.call(this.as,_,x,this.n,this.s)}}}(),function(){c.ify=function(_,x,$){return t("node.ify"),x?typeof x=="string"?x={soul:x}:typeof x=="function"&&(x={map:x}):x={},x.map&&(x.node=x.map.call($,_,C,x.node||{})),(x.node=c.soul.ify(x.node||{},x))&&O(_,A,{o:x,as:$}),x.node};function A(_,x){var $=this.o,D,N;if($.map){D=$.map.call(this.as,_,""+x,$.node),N===D?m($.node,x):$.node&&($.node[x]=D);return}o.is(_)&&($.node[x]=_)}}();var h=n.obj,v=h.is,m=h.del,O=h.map,a=n.text,f=a.random,d=c.soul._,C;n.node=n.node||c;var l=n.state;l.lex=function(){return t("state.lex"),l().toString(36).replace(".","")},l.to=function(A,_,x){t("state.to");var $=(A||{})[_];return v($)&&($=j($)),l.ify(x,_,l.is(A,_),$,c.soul(A))},function(){l.map=function(_,x,$){t("state.map");var D,N=v(N=_||x)?N:null;return _=p(_=_||x)?_:null,N&&!_?(x=g(x)?x:l(),N[y]=N[y]||{},O(N,A,{o:N,s:x}),N):($=$||v(x)?x:D,x=g(x)?x:l(),function(R,P,U,F){if(!_)return A.call({o:U,s:x},R,P),R;_.call($||this||{},R,P,U,F),!(T(U,P)&&D===U[P])&&A.call({o:U,s:x},R,P)})};function A(_,x){y!==x&&l.ify(this.o,x,this.s)}}();var h=n.obj;h.as;var T=h.has,v=h.is,O=h.map,j=h.copy,b=n.num,g=b.is,S=n.fn,p=S.is,y=c._,C,w={};(function(){w.is=function(x,$,D,N){return t("graph.is"),!x||!v(x)||E(x)?!1:!O(x,A,{cb:$,fn:D,as:N})};function A(x,$){if(!x||$!==c.soul(x)||!c.is(x,this.fn,this.as))return!0;this.cb&&(_.n=x,_.as=this.as,this.cb.call(_.as,x,$,_))}function _(x){x&&c.is(_.n,x,_.as)}})(),function(){w.ify=function(N,R,P){t("graph.ify");var U={path:[],obj:N};return R?typeof R=="string"?R={soul:R}:typeof R=="function"&&(R.map=R):R={},typeof P=="string"&&(R.soul=R.soul||P,P=C),R.soul&&(U.link=o.link.ify(R.soul)),R.shell=(P||{}).shell,R.graph=R.graph||{},R.seen=R.seen||[],R.as=R.as||P,A(R,U),R.root=U.node,R.graph};function A(N,R){var P;return(P=D(N,R))?P:(R.env=N,R.soul=x,c.ify(R.obj,_,R)&&(R.link=R.link||o.link.ify(c.soul(R.node)),R.obj!==N.shell&&(N.graph[o.link.is(R.link)]=R.node)),R)}function _(N,R,P){var U=this,F=U.env,B,K;if(c._===R&&T(N,o.link._))return P._;if(B=$(N,R,P,U,F)){if(R||(U.node=U.node||P||{},T(N,c._)&&c.soul(N)&&(U.node._=j(N._)),U.node=c.soul.ify(U.node,o.link.is(U.link)),U.link=U.link||o.link.ify(c.soul(U.node))),(K=F.map)&&(K.call(F.as||{},N,R,P,U),T(P,R))){if(N=P[R],C===N){m(P,R);return}if(!(B=$(N,R,P,U,F)))return}if(!R)return U.node;if(B===!0)return N;if(K=A(F,{obj:N,path:U.path.concat(R)}),!!K.node)return K.link}}function x(N){var R=this,P=o.link.is(R.link),U=R.env.graph;R.link=R.link||o.link.ify(N),R.link[o.link._]=N,R.node&&R.node[c._]&&(R.node[c._][o.link._]=N),T(U,P)&&(U[N]=U[P],m(U,P))}function $(N,R,P,U,F){var B;if(o.is(N))return!0;if(v(N))return 1;if(B=F.invalid)return N=B.call(F.as||{},N,R,P),$(N,R,P,U,F);F.err="Invalid value at '"+U.path.concat(R).join(".")+"'!",n.list.is(N)&&(F.err+=" Use `.set(item)` instead of an Array.")}function D(N,R){for(var P=N.seen,U=P.length,F;U--;)if(F=P[U],R.obj===F.obj)return F;P.push(R)}}(),w.node=function(A){t("graph.node");var _=c.soul(A);if(_)return k({},_,A)},function(){w.to=function(_,x,$){if(t("graph.to"),!!_){var D={};return $=$||{seen:{}},O(_[x],A,{obj:D,graph:_,opt:$}),D}};function A(_,x){var $,D;if(c._===x){if(E(_,o.link._))return;this.obj[x]=j(_);return}if(!($=o.link.is(_))){this.obj[x]=_;return}if(D=this.opt.seen[$]){this.obj[x]=D;return}this.obj[x]=this.opt.seen[$]=w.to(this.graph,$,this.opt)}}();var p=n.fn.is,h=n.obj,v=h.is,m=h.del,T=h.has,E=h.empty,k=h.put,O=h.map,j=h.copy,C;n.graph=n.graph||w}}()}(Wt)),Wt.exports}var Cn,uo;function Kl(){return uo||(uo=1,Cn=Le()),Cn}var Jl=Kl();const Yt=ar(Jl);var Bt={exports:{}};Bt.exports;var co;function Gl(){return co||(co=1,function(e){(function(){function t(r,o){return o?wr(r):r.slice?t[i(r)]:function(s,u){r(s={exports:{}}),t[i(u)]=s.exports};function i(s){return s.split("/").slice(-1).toString().replace(".js","")}}var n=e;t(function(r){typeof self<"u"&&(r.window=self),typeof window<"u"&&(r.window=window);var o=r.window||r,i,s=o.SEA||{};(s.window=r.window)&&(s.window.SEA=s);try{i+""!=typeof n&&(n.exports=s)}catch{}r.exports=s})(t,"./root"),t(function(r){var o=t("./root");try{o.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(t,"./https"),t(function(r){var o;if(o+""==typeof btoa){if(o+""==typeof Buffer)try{ft.Buffer=t("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}ft.btoa=function(i){return Buffer.from(i,"binary").toString("base64")},ft.atob=function(i){return Buffer.from(i,"base64").toString("binary")}}})(t,"./base64"),t(function(r){t("./base64");function o(){}Object.assign(o,{from:Array.from}),o.prototype=Object.create(Array.prototype),o.prototype.toString=function(i,s,u){i=i||"utf8",s=s||0;const c=this.length;if(i==="hex"){const a=new Uint8Array(this);return[...Array((u&&u+1||c)-s).keys()].map(f=>a[f+s].toString(16).padStart(2,"0")).join("")}if(i==="utf8")return Array.from({length:(u||c)-s},(a,f)=>String.fromCharCode(this[f+s])).join("");if(i==="base64")return btoa(this)},r.exports=o})(t,"./array"),t(function(r){t("./base64");var o=t("./array");function i(...s){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),i.from(...s)}i.prototype=Object.create(Array.prototype),Object.assign(i,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const s=arguments[0];let u;if(typeof s=="string"){const a=arguments[1]||"utf8";if(a==="hex"){const f=s.match(/([\da-fA-F]{2})/g).map(d=>parseInt(d,16));if(!f||!f.length)throw new TypeError("Invalid first argument for type 'hex'.");u=o.from(f)}else if(a==="utf8"||a==="binary"){const f=s.length,d=new Uint16Array(f);Array.from({length:f},(l,b)=>d[b]=s.charCodeAt(b)),u=o.from(d)}else if(a==="base64"){const f=atob(s),d=f.length,l=new Uint8Array(d);Array.from({length:d},(b,g)=>l[g]=f.charCodeAt(g)),u=o.from(l)}else a==="binary"?u=o.from(s):console.info("SafeBuffer.from unknown encoding: "+a);return u}if(s.byteLength,s.byteLength?s.byteLength:s.length){let a;return s instanceof ArrayBuffer&&(a=new Uint8Array(s)),o.from(a||s)}},alloc(s,u=0){return o.from(new Uint8Array(Array.from({length:s},()=>u)))},allocUnsafe(s){return o.from(new Uint8Array(Array.from({length:s})))},concat(s){if(!Array.isArray(s))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return o.from(s.reduce((u,c)=>u.concat(Array.from(c)),[]))}}),i.prototype.from=i.from,i.prototype.toString=o.prototype.toString,r.exports=i})(t,"./buffer"),t(function(r){const o=t("./root"),i={Buffer:t("./buffer")};var s={},u;if(JSON.parseAsync=JSON.parseAsync||function(a,f,d){var l;try{f(l,JSON.parse(a,d))}catch(b){f(b)}},JSON.stringifyAsync=JSON.stringifyAsync||function(a,f,d,l){var b;try{f(b,JSON.stringify(a,d,l))}catch(g){f(g)}},i.parse=function(a,f){return new Promise(function(d,l){JSON.parseAsync(a,function(b,g){b?l(b):d(g)},f)})},i.stringify=function(a,f,d){return new Promise(function(l,b){JSON.stringifyAsync(a,function(g,S){g?b(g):l(S)},f,d)})},o.window&&(i.crypto=o.window.crypto||o.window.msCrypto,i.subtle=(i.crypto||s).subtle||(i.crypto||s).webkitSubtle,i.TextEncoder=o.window.TextEncoder,i.TextDecoder=o.window.TextDecoder,i.random=a=>i.Buffer.from(i.crypto.getRandomValues(new Uint8Array(i.Buffer.alloc(a))))),!i.TextDecoder){const{TextEncoder:a,TextDecoder:f}=t((u+""==typeof n?".":"")+"./lib/text-encoding",1);i.TextDecoder=f,i.TextEncoder=a}if(!i.crypto)try{var c=t("crypto",1);Object.assign(i,{crypto:c,random:f=>i.Buffer.from(c.randomBytes(f))});const{Crypto:a}=t("@peculiar/webcrypto",1);i.ossl=i.subtle=new a({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}r.exports=i})(t,"./shim"),t(function(r){var o=t("./root"),i=t("./shim"),s={};s.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},s.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},s.ecdh={name:"ECDH",namedCurve:"P-256"},s.jwk=function(u,c){u=u.split(".");var a=u[0],f=u[1],d={kty:"EC",crv:"P-256",x:a,y:f,ext:!0};return d.key_ops=c?["sign"]:["verify"],c&&(d.d=c),d},s.keyToJwk=function(u){return{kty:"oct",k:u.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},s.recall={validity:12*60*60,hook:function(u){return u}},s.check=function(u){return typeof u=="string"&&u.slice(0,4)==="SEA{"},s.parse=async function(c){try{var a=typeof c=="string";return a&&c.slice(0,4)==="SEA{"&&(c=c.slice(3)),a?await i.parse(c):c}catch{}return c},o.opt=s,r.exports=s})(t,"./settings"),t(function(r){var o=t("./shim");r.exports=async function(i,s){var u=typeof i=="string"?i:await o.stringify(i),c=await o.subtle.digest({name:s||"SHA-256"},new o.TextEncoder().encode(u));return o.Buffer.from(c)}})(t,"./sha256"),t(function(r){const o=t("./shim"),i=o.subtle,s=o.ossl?o.ossl:i,u=c=>s.digest({name:"SHA-1"},new ArrayBuffer(c));r.exports=u})(t,"./sha1"),t(function(r){var o=t("./root"),i=t("./shim"),s=t("./settings"),u=t("./sha256"),c;o.work=o.work||(async(a,f,d,l)=>{try{var b=(f||{}).epub||f;if(l=l||{},b instanceof Function&&(d=b,b=c),a=typeof a=="string"?a:await i.stringify(a),(l.name||"").toLowerCase().slice(0,3)==="sha"){var g=i.Buffer.from(await u(a,l.name),"binary").toString(l.encode||"base64");if(d)try{d(g)}catch(p){console.log(p)}return g}b=b||i.random(9);var S=await(i.ossl||i.subtle).importKey("raw",new i.TextEncoder().encode(a),{name:l.name||"PBKDF2"},!1,["deriveBits"]),y=await(i.ossl||i.subtle).deriveBits({name:l.name||"PBKDF2",iterations:l.iterations||s.pbkdf2.iter,salt:new i.TextEncoder().encode(l.salt||b),hash:l.hash||s.pbkdf2.hash},S,l.length||s.pbkdf2.ks*8);a=i.random(a.length);var w=i.Buffer.from(y,"binary").toString(l.encode||"base64");if(d)try{d(w)}catch(p){console.log(p)}return w}catch(p){if(console.log(p),o.err=p,o.throw)throw p;d&&d();return}}),r.exports=o.work})(t,"./work"),t(function(r){var o=t("./root"),i=t("./shim");t("./settings"),o.name=o.name||(async(s,u)=>{try{if(s)try{s()}catch(c){console.log(c)}return}catch(c){if(console.log(c),o.err=c,o.throw)throw c;s&&s();return}}),o.pair=o.pair||(async(s,u)=>{try{var c=i.ossl||i.subtle,a=await i.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async l=>{var b={};b.priv=(await i.subtle.exportKey("jwk",l.privateKey)).d;var g=await i.subtle.exportKey("jwk",l.publicKey);return b.pub=g.x+"."+g.y,b});try{var f=await c.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async l=>{var b={};b.epriv=(await c.exportKey("jwk",l.privateKey)).d;var g=await c.exportKey("jwk",l.publicKey);return b.epub=g.x+"."+g.y,b})}catch(l){if(o.window)throw l;if(l=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw l}f=f||{};var d={pub:a.pub,priv:a.priv,epub:f.epub,epriv:f.epriv};if(s)try{s(d)}catch(l){console.log(l)}return d}catch(l){if(console.log(l),o.err=l,o.throw)throw l;s&&s();return}}),r.exports=o.pair})(t,"./pair"),t(function(r){var o=t("./root"),i=t("./shim"),s=t("./settings"),u=t("./sha256"),c;o.sign=o.sign||(async(a,f,d,l)=>{try{if(l=l||{},!(f||l).priv){if(!o.I)throw"No signing key.";f=await o.I(null,{what:a,how:"sign",why:l.why})}if(c===a)throw"`undefined` not allowed.";var b=await s.parse(a),g=l.check=l.check||b;if(o.verify&&(o.opt.check(g)||g&&g.s&&g.m)&&c!==await o.verify(g,f)){var v=await s.parse(g);if(l.raw||(v="SEA"+await i.stringify(v)),d)try{d(v)}catch(T){console.log(T)}return v}var S=f.pub,y=f.priv,w=s.jwk(S,y),p=await u(b),h=await(i.ossl||i.subtle).importKey("jwk",w,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(m=>(i.ossl||i.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},m,new Uint8Array(p))),v={m:b,s:i.Buffer.from(h,"binary").toString(l.encode||"base64")};if(l.raw||(v="SEA"+await i.stringify(v)),d)try{d(v)}catch(m){console.log(m)}return v}catch(m){if(console.log(m),o.err=m,o.throw)throw m;d&&d();return}}),r.exports=o.sign})(t,"./sign"),t(function(r){var o=t("./root"),i=t("./shim"),s=t("./settings"),u=t("./sha256"),c;o.verify=o.verify||(async(d,l,b,g)=>{try{var S=await s.parse(d);if(l===!1){var y=await s.parse(S.m);if(b)try{b(y)}catch(O){console.log(O)}return y}g=g||{};var w=l.pub||l,p=o.opt.slow_leak?await o.opt.slow_leak(w):await(i.ossl||i.subtle).importKey("jwk",s.jwk(w),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),h=await u(S.m),v,m,T,E;try{if(v=i.Buffer.from(S.s,g.encode||"base64"),m=new Uint8Array(v),T=await(i.ossl||i.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},p,m,new Uint8Array(h)),!T)throw"Signature did not match."}catch{if(o.opt.fallback)return await o.opt.fall_verify(d,l,b,g)}var k=T?await s.parse(S.m):c;if(b)try{b(k)}catch(O){console.log(O)}return k}catch(O){if(console.log(O),o.err=O,o.throw)throw O;b&&b();return}}),r.exports=o.verify;var a={};o.opt.slow_leak=d=>{if(a[d])return a[d];var l=s.jwk(d);return a[d]=(i.ossl||i.subtle).importKey("jwk",l,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),a[d]};var f=o.opt;o.opt.fall_verify=async function(d,l,b,g,S){if(S===o.opt.fallback)throw"Signature did not match";S=S||1;var y=d||"";d=o.opt.unpack(d)||d;var w=await s.parse(d),p=l.pub||l,h=await o.opt.slow_leak(p),v=S<=o.opt.fallback?i.Buffer.from(await i.subtle.digest({name:"SHA-256"},new i.TextEncoder().encode(await s.parse(w.m)))):await u(w.m),m,T,E;try{if(m=i.Buffer.from(w.s,g.encode||"base64"),T=new Uint8Array(m),E=await(i.ossl||i.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},h,T,new Uint8Array(v)),!E)throw"Signature did not match."}catch{try{m=i.Buffer.from(w.s,"utf8"),T=new Uint8Array(m),E=await(i.ossl||i.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},h,T,new Uint8Array(v))}catch{if(!E)throw"Signature did not match."}}var k=E?await s.parse(w.m):c;if(f.fall_soul=y["#"],f.fall_key=y["."],f.fall_val=d,f.fall_state=y[">"],b)try{b(k)}catch(O){console.log(O)}return k},o.opt.fallback=2})(t,"./verify"),t(function(r){var o=t("./shim"),i=t("./settings"),s=t("./sha256");const u=async(c,a,f)=>{const d=c+(a||o.random(8)).toString("utf8"),l=o.Buffer.from(await s(d),"binary"),b=i.keyToJwk(l);return await o.subtle.importKey("jwk",b,{name:"AES-GCM"},!1,["encrypt","decrypt"])};r.exports=u})(t,"./aeskey"),t(function(r){var o=t("./root"),i=t("./shim");t("./settings");var s=t("./aeskey"),u;o.encrypt=o.encrypt||(async(c,a,f,d)=>{try{d=d||{};var l=(a||d).epriv||a;if(u===c)throw"`undefined` not allowed.";if(!l){if(!o.I)throw"No encryption key.";a=await o.I(null,{what:c,how:"encrypt",why:d.why}),l=a.epriv||a}var b=typeof c=="string"?c:await i.stringify(c),g={s:i.random(9),iv:i.random(15)},S=await s(l,g.s,d).then(w=>i.subtle.encrypt({name:d.name||"AES-GCM",iv:new Uint8Array(g.iv)},w,new i.TextEncoder().encode(b))),y={ct:i.Buffer.from(S,"binary").toString(d.encode||"base64"),iv:g.iv.toString(d.encode||"base64"),s:g.s.toString(d.encode||"base64")};if(d.raw||(y="SEA"+await i.stringify(y)),f)try{f(y)}catch(w){console.log(w)}return y}catch(w){if(console.log(w),o.err=w,o.throw)throw w;f&&f();return}}),r.exports=o.encrypt})(t,"./encrypt"),t(function(r){var o=t("./root"),i=t("./shim"),s=t("./settings"),u=t("./aeskey");o.decrypt=o.decrypt||(async(c,a,f,d)=>{try{d=d||{};var l=(a||d).epriv||a;if(!l){if(!o.I)throw"No decryption key.";a=await o.I(null,{what:c,how:"decrypt",why:d.why}),l=a.epriv||a}var b=await s.parse(c),g,S,y;try{g=i.Buffer.from(b.s,d.encode||"base64"),S=i.Buffer.from(b.iv,d.encode||"base64"),y=i.Buffer.from(b.ct,d.encode||"base64");var w=await u(l,g,d).then(h=>i.subtle.decrypt({name:d.name||"AES-GCM",iv:new Uint8Array(S),tagLength:128},h,new Uint8Array(y)))}catch{if(d.encode==="utf8")throw"Could not decrypt";if(o.opt.fallback)return d.encode="utf8",await o.decrypt(c,a,f,d)}var p=await s.parse(new i.TextDecoder("utf8").decode(w));if(f)try{f(p)}catch(h){console.log(h)}return p}catch(h){if(console.log(h),o.err=h,o.throw)throw h;f&&f();return}}),r.exports=o.decrypt})(t,"./decrypt"),t(function(r){var o=t("./root"),i=t("./shim");t("./settings"),o.secret=o.secret||(async(u,c,a,f)=>{try{if(f=f||{},!c||!c.epriv||!c.epub){if(!o.I)throw"No secret mix.";c=await o.I(null,{what:u,how:"secret",why:f.why})}var d=u.epub||u,l=c.epub,b=c.epriv,g=i.ossl||i.subtle,S=s(d),y=Object.assign({public:await g.importKey(...S,!0,[])},{name:"ECDH",namedCurve:"P-256"}),w=s(l,b),p=await g.importKey(...w,!1,["deriveBits"]).then(async v=>{var m=await g.deriveBits(y,v,256),T=new Uint8Array(m),E=await g.importKey("raw",T,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return g.exportKey("jwk",E).then(({k})=>k)}),h=p;if(a)try{a(h)}catch(v){console.log(v)}return h}catch(v){if(console.log(v),o.err=v,o.throw)throw v;a&&a();return}});var s=(u,c)=>{var[a,f]=u.split("."),d=c?{d:c}:{};return["jwk",Object.assign(d,{x:a,y:f,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};r.exports=o.secret})(t,"./secret"),t(function(r){var o=t("./root");o.certify=o.certify||(async(i,s={},u,c,a={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),i=(()=>{var h=[];if(i){if((typeof i=="string"||Array.isArray(i))&&i.indexOf("*")>-1)return"*";if(typeof i=="string")return i;if(Array.isArray(i)){if(i.length===1&&i[0])return typeof i[0]=="object"&&i[0].pub?i[0].pub:typeof i[0]=="string"?i[0]:null;i.map(v=>{typeof v=="string"?h.push(v):typeof v=="object"&&v.pub&&h.push(v.pub)})}return typeof i=="object"&&i.pub?i.pub:h.length>0?h:null}})(),!i)return console.log("No certificant found.");const d=a.expiry&&(typeof a.expiry=="number"||typeof a.expiry=="string")?parseFloat(a.expiry):null,l=(s||{}).read?s.read:null,b=(s||{}).write?s.write:typeof s=="string"||Array.isArray(s)||s["+"]||s["#"]||s["."]||s["="]||s["*"]||s[">"]||s["<"]?s:null,g=(a||{}).block||(a||{}).blacklist||(a||{}).ban||{},S=g.read&&(typeof g.read=="string"||(g.read||{})["#"])?g.read:null,y=typeof g=="string"?g:g.write&&(typeof g.write=="string"||g.write["#"])?g.write:null;if(!l&&!b)return console.log("No policy found.");const w=JSON.stringify({c:i,...d?{e:d}:{},...l?{r:l}:{},...b?{w:b}:{},...S?{rb:S}:{},...y?{wb:y}:{}});var f=await o.sign(w,u,null,{raw:1});if(a.raw||(f="SEA"+JSON.stringify(f)),c)try{c(f)}catch(h){console.log(h)}return f}catch(d){if(o.err=d,o.throw)throw d;c&&c();return}}),r.exports=o.certify})(t,"./certify"),t(function(r){var o=t("./shim"),i=t("./root");i.work=t("./work"),i.sign=t("./sign"),i.verify=t("./verify"),i.encrypt=t("./encrypt"),i.decrypt=t("./decrypt"),i.certify=t("./certify"),i.random=i.random||o.random,i.Buffer=i.Buffer||t("./buffer"),i.keyid=i.keyid||(async s=>{try{const u=o.Buffer.concat(s.replace(/-/g,"+").replace(/_/g,"/").split(".").map(d=>o.Buffer.from(d,"base64"))),c=o.Buffer.concat([o.Buffer.from([153,u.length/256,u.length%256]),u]),a=await sha1hash(c),f=o.Buffer.from(a,"binary");return f.toString("hex",f.length-8)}catch(u){throw console.log(u),u}}),((i.window||{}).GUN||{}).SEA=i,r.exports=i})(t,"./sea"),t(function(r){var o=t("./sea"),i,s;o.window?i=o.window.GUN||{chain:{}}:i=t((s+""==typeof n?".":"")+"./gun",1),o.GUN=i;function u(a){this._={$:this}}u.prototype=function(){function a(){}return a.prototype=i.chain,new a}(),u.prototype.constructor=u,i.chain.user=function(a){var f=this,l=f.back(-1),d;if(a)return a=o.opt.pub((a._||"")["#"])||a,l.get("~"+a);if(d=l.back("user"))return d;var l=l._,b=l,g=b.opt.uuid||c;return(b=(d=b.user=f.chain(new u))._).opt={},b.opt.uuid=function(S){var y=g(),w=l.user;return!w||!(w=w.is)||!(w=w.pub)||(y="~"+w+"/"+y,S&&S.call&&S(null,y)),y},d};function c(){return i.state().toString(36).replace(".","")}i.User=u,u.GUN=i,u.SEA=i.SEA=o,r.exports=u})(t,"./user"),t(function(r){var o,i=""+o!=typeof GUN?GUN||{chain:{}}:t((""+o==typeof n?".":"")+"./gun",1);i.chain.then=function(s,u){var c=this,a=new Promise(function(f,d){c.once(f,u)});return s?a.then(s):a}})(t,"./then"),t(function(r){var o=t("./user"),i=o.SEA,s=o.GUN,u=function(){};o.prototype.create=function(...c){var a=typeof c[0]=="object"&&(c[0].pub||c[0].epub)?c[0]:typeof c[1]=="object"&&(c[1].pub||c[1].epub)?c[1]:null,f=a&&(a.pub||a.epub)?a.pub:typeof c[0]=="string"?c[0]:null,d=a&&(a.pub||a.epub)?a:f&&typeof c[1]=="string"?c[1]:null,l=c.filter(h=>typeof h=="function")[0]||null,b=c&&c.length>1&&typeof c[c.length-1]=="object"?c[c.length-1]:{},g=this,S=g._,y=g.back(-1);if(l=l||u,b=b||{},b.check!==!1){var w;if(f||(w="No user."),(d||"").length<8&&(w="Password too short!"),w)return l({err:s.log(w)}),g}if(S.ing)return(l||u)({err:s.log("User is already being created or authenticated!"),wait:!0}),g;S.ing=!0;var p={};return p.a=function(h){if(p.pubs=h,h&&!b.already){var v={err:s.log("User already created!")};S.ing=!1,(l||u)(v),g.leave();return}p.salt=String.random(64),i.work(d,p.salt,p.b)},p.b=function(h){p.proof=h,a?p.c(a):i.pair(p.c)},p.c=function(h){var v;p.pair=h||{},(v=S.root.user)&&(v._.sea=h,v.is={pub:h.pub,epub:h.epub,alias:f}),p.data={pub:h.pub},p.d()},p.d=function(){p.data.alias=f,p.e()},p.e=function(){p.data.epub=p.pair.epub,i.encrypt({priv:p.pair.priv,epriv:p.pair.epriv},p.proof,p.f,{raw:1})},p.f=function(h){p.data.auth=JSON.stringify({ek:h,s:p.salt}),p.g(p.data.auth)},p.g=function(h){var v;p.data.auth=p.data.auth||h,y.get(v="~"+p.pair.pub).put(p.data).on(p.h);var m={};m[v]={"#":v},y.get("~@"+f).put(m).get(v).on(p.i)},p.h=function(h,v,m,T){T.off(),p.h.ok=1,p.i()},p.i=function(h,v,m,T){T&&(p.i.ok=1,T.off()),!(!p.h.ok||!p.i.ok)&&(S.ing=!1,l({ok:0,pub:p.pair.pub}),u===l&&(a?g.auth(a):g.auth(f,d)))},y.get("~@"+f).once(p.a),g},o.prototype.leave=function(c,a){var f=this,d=f.back(-1)._.user;if(d&&(delete d.is,delete d._.is,delete d._.sea),i.window)try{var l={};l=i.window.sessionStorage,delete l.recall,delete l.pair}catch{}return f}})(t,"./create"),t(function(r){var o=t("./user"),i=o.SEA,s=o.GUN,u=function(){};o.prototype.auth=function(...a){var f=typeof a[0]=="object"&&(a[0].pub||a[0].epub)?a[0]:typeof a[1]=="object"&&(a[1].pub||a[1].epub)?a[1]:null,d=!f&&typeof a[0]=="string"?a[0]:null,l=(d||f&&!(f.priv&&f.epriv))&&typeof a[1]=="string"?a[1]:null,b=a.filter(m=>typeof m=="function")[0]||null,g=a&&a.length>1&&typeof a[a.length-1]=="object"?a[a.length-1]:{},S=this,y=S._,w=S.back(-1);if(y.ing)return(b||u)({err:s.log("User is already being created or authenticated!"),wait:!0}),S;y.ing=!0;var p={},h,v=9;return p.a=function(m){if(!m)return p.b();if(!m.pub){var T=[];return Object.keys(m).forEach(function(E){E!="_"&&T.push(m[E])}),p.b(T)}if(p.name)return p.f(m);p.c((p.data=m).auth)},p.b=function(m){var T=(p.list=(p.list||[]).concat(m||[])).shift();if(h===T){if(p.name)return p.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(d&&v--){w.get("~@"+d).once(p.a);return}return p.err("Wrong user or password.")}w.get(T).once(p.a)},p.c=function(m){if(h===m)return p.b();if(typeof m=="string")return p.c(c(m));i.work(l,(p.auth=m).s,p.d,p.enc)},p.d=function(m){i.decrypt(p.auth.ek,m,p.e,p.enc)},p.e=function(m){if(h===m)return p.enc?(p.enc=null,p.b()):(p.enc={encode:"utf8"},p.c(p.auth));p.half=m,p.f(p.data)},p.f=function(m){var T=p.half||{},E=p.data||{};p.g(p.lol={pub:m.pub||E.pub,epub:m.epub||E.epub,priv:m.priv||T.priv,epriv:m.epriv||T.epriv})},p.g=function(m){if(!m||!m.pub||!m.epub)return p.b();p.pair=m;var T=w._.user,E=T._;E.tag;var k=E.opt;E=T._=w.get("~"+m.pub)._,E.opt=k,T.is={pub:m.pub,epub:m.epub,alias:d||m.pub},E.sea=p.pair,y.ing=!1;try{l&&h==(c(y.root.graph["~"+m.pub].auth)||"")[":"]&&(g.shuffle=g.change=l)}catch{}if(g.change?p.z():(b||u)(E),i.window&&(S.back("user")._.opt||g).remember)try{var O={};O=i.window.sessionStorage,O.recall=!0,O.pair=JSON.stringify(m)}catch{}try{w._.tag.auth?w._.on("auth",E):setTimeout(function(){w._.on("auth",E)},1)}catch(j){s.log("Your 'auth' callback crashed with:",j)}},p.h=function(m){if(!m)return p.b();if(d=m.alias,d||(d=m.alias="~"+f.pub),!m.auth)return p.g(f);f=null,p.c((p.data=m).auth)},p.z=function(){p.salt=String.random(64),i.work(g.change,p.salt,p.y)},p.y=function(m){i.encrypt({priv:p.pair.priv,epriv:p.pair.epriv},m,p.x,{raw:1})},p.x=function(m){p.w(JSON.stringify({ek:m,s:p.salt}))},p.w=function(m){if(g.shuffle){console.log("migrate core account from UTF8 & shuffle");var T={};Object.keys(p.data).forEach(function(E){T[E]=p.data[E]}),delete T._,T.auth=m,w.get("~"+p.pair.pub).put(T)}w.get("~"+p.pair.pub).get("auth").put(m,b||u)},p.err=function(m){var T={err:s.log(m||"User cannot be found!")};y.ing=!1,(b||u)(T)},p.plugin=function(m){if(!(p.name=m))return p.err();var T=[m];m[0]!=="~"&&(T[1]="~"+m,T[2]="~@"+m),p.b(T)},f?f.priv&&f.epriv?p.g(f):w.get("~"+f.pub).once(p.h):d?w.get("~@"+d).once(p.a):!d&&!l&&i.name(p.plugin),S};function c(a){if(typeof a!="string")return a;try{a=JSON.parse(a)}catch{a={}}return a}})(t,"./auth"),t(function(r){var o=t("./user"),i=o.SEA;o.GUN,o.prototype.recall=function(s,u){var c=this,a=c.back(-1);if(s=s||{},s&&s.sessionStorage){if(i.window)try{var f={};f=i.window.sessionStorage,f&&(a._.opt.remember=!0,(c.back("user")._.opt||s).remember=!0,(f.recall||f.pair)&&a.user().auth(JSON.parse(f.pair),u))}catch{}return c}return c}})(t,"./recall"),t(function(r){var o=t("./user"),i=o.SEA,s=o.GUN,u=function(){};o.prototype.pair=function(){var c=this,a;try{a=new Proxy({DANGER:"â "},{get:function(f,d,l){if(!(!c.is||!(c._||"").sea))return c._.sea[d]}})}catch{}return a},o.prototype.delete=async function(c,a,f){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var d=this;d.back(-1);var l=d.back("user");try{l.auth(c,a,function(b){var g=(l.is||{}).pub;l.map().once(function(){this.put(null)}),l.leave(),(f||u)({ok:0})})}catch(b){s.log("User.delete failed! Error:",b)}return d},o.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const c=this.back(-1);try{return await authRecall(c),c._.user._}catch{const f="No session!";throw s.log(f),{err:f}}},o.prototype.trust=async function(c){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),s.is(c)&&c.get("pub").get((a,f)=>{console.log(a,f)}),c.get("trust").get(path).put(theirPubkey)},o.prototype.grant=function(c,a){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var f=this,d=f.back(-1).user(),l=d._.sea,b="";return f.back(function(g){g.is||(b+=g.get||"")}),async function(){var g,S=await d.get("grant").get(l.pub).get(b).then();S=await i.decrypt(S,l),S||(S=i.random(16).toString(),g=await i.encrypt(S,l),d.get("grant").get(l.pub).get(b).put(g));var y=c.get("pub").then(),w=c.get("epub").then();y=await y,w=await w;var p=await i.secret(w,l);g=await i.encrypt(S,p),d.get("grant").get(y).get(b).put(g,a)}(),f},o.prototype.secret=function(c,a){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var f=this,d=f.back(-1).user(),l=d.pair(),b="";return f.back(function(g){g.is||(b+=g.get||"")}),async function(){var g,S=await d.get("trust").get(l.pub).get(b).then();S=await i.decrypt(S,l),S||(S=i.random(16).toString(),g=await i.encrypt(S,l),d.get("trust").get(l.pub).get(b).put(g)),g=await i.encrypt(c,S),f.put(g,a)}(),f},r.exports=o})(t,"./share"),t(function(r){var o=t("./sea"),i=t("./settings"),s,u=(o.window||"").GUN||t((""+s==typeof n?".":"")+"./gun",1);u.on("opt",function(g){g.sea||(g.sea={own:{}},g.on("put",c,g)),this.to.next(g)});function c(g){var S=this,y=S.as,w=g.put,p=w["#"],h=w["."],v=w[":"],m=w[">"],T=g["#"],E;if(!(!p||!h)){if((g._||"").faith&&(y.opt||"").faith&&typeof g._=="function"){o.opt.pack(w,function(O){o.verify(O,!1,function(j){w["="]=o.opt.unpack(j),S.to.next(g)})});return}var k=function(O){y.on("in",{"@":T,err:g.err=O})};if((g._||"").DBG&&((g._||"").DBG.c=+new Date),0<=p.indexOf("<?")&&(E=parseFloat(p.split("<?")[1]||""),E&&m<u.state()-E*1e3)){(E=g._)&&E.stun&&E.stun--;return}if(p==="~@"){c.alias(S,g,v,h,p,y,k);return}if(p.slice(0,2)==="~@"){c.pubs(S,g,v,h,p,y,k);return}if(E=o.opt.pub(p)){c.pub(S,g,v,h,p,y,k,y.user||"",E);return}if(0<=p.indexOf("#")){c.hash(S,g,v,h,p,y,k);return}c.any(S,g,v,h,p,y,k,y.user||"")}}c.hash=function(g,S,y,w,p,h,v){o.work(y,null,function(m){function T(E){let k="";for(let O=0;O<E.length;O++)k+=O-1&1?"":String.fromCharCode(parseInt(E.substring(O-1,O+1),16));return btoa(k)}if(m&&m===w.split("#").slice(-1)[0])return g.to.next(S);if(m&&m===T(w.split("#").slice(-1)[0]))return g.to.next(S);v("Data hash not same as hash!")},{name:"SHA-256"})},c.alias=function(g,S,y,w,p,h,v){if(!y)return v("Data must exist!");if("~@"+w===f(y))return g.to.next(S);v("Alias not same!")},c.pubs=function(g,S,y,w,p,h,v){if(!y)return v("Alias must exist!");if(w===f(y))return g.to.next(S);v("Alias not same!")},c.pub=async function(g,S,y,w,p,h,v,m,T){var E;const k=await i.parse(y)||{},O=(j,C,A)=>{if(j.m&&j.s&&C&&T)return o.verify(j,T,_=>{if(s!==_&&s!==_.e&&S.put[">"]&&S.put[">"]>parseFloat(_.e))return v("Certificate expired.");if(s!==_&&_.c&&_.w&&(_.c===C||_.c.indexOf("*")>-1)){let $=p.indexOf("/")>-1?p.replace(p.substring(0,p.indexOf("/")+1),""):"";String.match=String.match||u.text.match;const D=Array.isArray(_.w)?_.w:typeof _.w=="object"||typeof _.w=="string"?[_.w]:[];for(const N of D)if(String.match($,N["#"])&&String.match(w,N["."])||!N["."]&&String.match($,N["#"])||!N["#"]&&String.match(w,N["."])||String.match($?$+"/"+w:w,N["#"]||N)){if(N["+"]&&N["+"].indexOf("*")>-1&&$&&$.indexOf(C)==-1&&w.indexOf(C)==-1)return v(`Path "${$}" or key "${w}" must contain string "${C}".`);if(_.wb&&(typeof _.wb=="string"||(_.wb||{})["#"])){var x=g.as.root.$.back(-1);return typeof _.wb=="string"&&_.wb.slice(0,1)!=="~"&&(x=x.get("~"+T)),x.get(_.wb).get(C).once(R=>R&&(R===1||R===!0)?v(`Certificant ${C} blocked.`):A(_))}return A(_)}return v("Certificate verification fail.")}})};if(w==="pub"&&"~"+T===p)return y===T?g.to.next(S):v("Account not same!");if((E=m.is)&&E.pub&&!k["*"]&&!k["+"]&&(T===E.pub||T!==E.pub&&((S._.msg||{}).opt||{}).cert)){o.opt.pack(S.put,j=>{o.sign(j,m._.sea,async function(C){if(s===C)return v(o.err||"Signature fail.");if(S.put[":"]={":":E=o.opt.unpack(C.m),"~":C.s},S.put["="]=E,T===m.is.pub){(E=f(y))&&((h.sea.own[E]=h.sea.own[E]||{})[T]=1),JSON.stringifyAsync(S.put[":"],function(A,_){return A?v(A||"Stringify error."):(S.put[":"]=_,g.to.next(S))});return}if(T!==m.is.pub&&((S._.msg||{}).opt||{}).cert){const A=await i.parse(S._.msg.opt.cert);A&&A.m&&A.s&&O(A,m.is.pub,_=>{S.put[":"]["+"]=A,S.put[":"]["*"]=m.is.pub,JSON.stringifyAsync(S.put[":"],function(x,$){return x?v(x||"Stringify error."):(S.put[":"]=$,g.to.next(S))})})}},{raw:1})});return}o.opt.pack(S.put,j=>{o.verify(j,k["*"]||T,function(C){var A;if(C=o.opt.unpack(C),s===C)return v("Unverified data.");if((A=f(C))&&T===o.opt.pub(A)&&((h.sea.own[A]=h.sea.own[A]||{})[T]=1),k["+"]&&k["+"].m&&k["+"].s&&k["*"])O(k["+"],k["*"],_=>(S.put["="]=C,g.to.next(S)));else return S.put["="]=C,g.to.next(S)})})},c.any=function(g,S,y,w,p,h,v,m){if(h.opt.secure)return v("Soul missing public key at '"+w+"'.");h.on("secure",function(T){if(this.off(),!h.opt.secure)return g.to.next(T);v("Data cannot be changed.")}).on.on("secure",S)};var a=u.valid,f=function(g,S){return typeof(S=a(g))=="string"&&S};(u.state||"").ify;var d=/[^\w_-]/;o.opt.pub=function(g){if(g&&(g=g.split("~"),!(!g||!(g=g[1]))&&(g=g.split(d).slice(0,2),!(!g||g.length!=2)&&(g[0]||"")[0]!=="@")))return g=g.slice(0,2).join("."),g},o.opt.stringy=function(g){},o.opt.pack=function(g,S,y,w,p){var h,v;if(o.opt.check(g))return S(g);g&&g["#"]&&g["."]&&g[">"]&&(h=g[":"],v=1),JSON.parseAsync(v?h:g,function(m,T){var E=s!==(T||"")[":"]&&(T||"")["~"];if(!E){S(g);return}S({m:{"#":p||g["#"],".":y||g["."],":":(T||"")[":"],">":g[">"]||u.state.is(w,y)},s:E})})};var l=o.opt;o.opt.unpack=function(g,S,y){var w;if(s!==g){if(g&&s!==(w=g[":"]))return w;if(S=S||l.fall_key,!y&&l.fall_val&&(y={},y[S]=l.fall_val),!(!S||!y)){if(g===y[S]||!o.opt.check(y[S]))return g;var p=y&&y._&&y._["#"]||l.fall_soul,h=u.state.is(y,S)||l.fall_state;if(g&&g.length===4&&p===g[0]&&S===g[1]&&b(h)===b(g[3]))return g[2];if(h<o.opt.shuffle_attack)return g}}},o.opt.shuffle_attack=15463296e5;var b=Math.floor})(t,"./index")})()}(Bt)),Bt.exports}var Hl=Gl();const ql=ar(Hl);var Nn={exports:{}},fo={},lo;function Vl(){if(lo)return fo;lo=1;var e={},t=typeof window<"u"?window.Gun:Le(),n;t.on("opt",function(o){r(o),this.to.next(o)});function r(o){if(o.axe)return;var i=o.opt;if(i.peers,i.axe===!1||typeof process<"u"&&""+(e||"").AXE=="false")return;t.log.once("AXE","AXE relay enabled!");var s=o.axe={},u=i.mesh=i.mesh||t.Mesh(o),c=o.dup;u.way=function(y){if(y){if(y.get)return a(y);y.put||f(y)}};function a(y){if(y){var w=(y._||"").via,p;if(!w||!w.id||!(p=d(y)._))return f(y);p.asked=+new Date,a.turn(y,p.route,0)}}a.turn=function(y,w,p){var h=y["#"],v=c.s[h],m;if(!(!h||!v)&&(clearTimeout(v.lack),!(v.ack&&(h=v["##"])&&y["##"]===h))){if(m=Object.maps(w||i.peers).slice(p=p||0),!m.length){if(!w)return;a.turn(y,n,0);return}setTimeout.each(m,function(T){var E=i.peers[T];if(p++,!E||!E.wire){w&&w.delete(T);return}if(u.say(y,E)!==!1&&p%3==0)return 1},function(){v["##"]=y["##"],v.lack=setTimeout(function(){a.turn(y,w,p)},25)},3)}};function f(y){u.say(y,i.peers)}function d(y){var w="",p,h,v;if(!y||!y.get)return w;typeof(p=y.get["#"])=="string"&&(w=o.$.get(p)),typeof(v=y.get["."])=="string"?h=v:h="";var m=(y._||"").via,T=m.sub||(m.sub=new Object.Map);return(T.get(p)||T.set(p,v=new Object.Map)&&v).set(h,1),m.id&&w._&&(w._.route||(w._.route=new Object.Map)).set(m.id,m),w}function l(y){return(y=y||"")["="]||y["*"]||y[">"]||y}o.on("in",function(y){var w=this.to,p;if((p=y["@"])&&(p=c.s[p])){if(p.ack=(p.ack||0)+1,p.it&&p.it.get&&y.put){var h=p.it.get||"",v=d(p.it)._,m=(p.it._||"").via||"",T;if(m&&v&&(m.id&&(v.route||(v.route=new Object.Map)).set(m.id,m),T=m.sub||(m.sub=new Object.Map),v&&(T.get(l(h["#"]))||T.set(l(h["#"]),T=new Object.Map)&&T).set(l(h["."]),1),m=(y._||"").via||"",m&&(m.id&&(v.route||(v.route=new Object.Map)).set(m.id,m),T=m.sub||(m.sub=new Object.Map),v))){var E=l(h["#"]),k=T.get(E),O=l(h["."]);O?(k||T.set(E,k=new Object.Map)&&k).set(O,1):k||(T.set(E,k=new Object.Map),k.set("",1))}}if(p=p.back){setTimeout.each(Object.keys(p),function(j){w.next({"#":y["#"],"@":j,ok:y.ok})});return}}w.next(y)}),o.on("create",function(y){this.to.next(y),y.on("put",function(w){var p=this;p.as;var h=w.put,v=h["#"],m=h["."],T=h[":"],E=h[">"];if(p.to.next(w),!w["@"]&&!(!v||!m)){var k=y.$.get(v)._,O=(k||"").route;if(O){if(k.skip&&k.skip.has==m){k.skip.now=w["#"];return}(k.skip={now:w["#"],has:m}).to=setTimeout(function(){setTimeout.each(Object.maps(O),function(j){var C,D,A=k.skip||"";if(k.skip=null,!!(C=O.get(j))){if(!C.wire){O.delete(j);return}var _=(C.sub||(C.sub=new Object.Map)).get(v);if(_&&!(!_.get(m)&&!_.get(""))){var x=C.put||(C.put={}),$=y.graph[v],D;$&&n!==(D=$[m])&&(E=S($,m),T=D),x[v]=g(x[v],m,E,T,v),D=c.track(C.next=C.next||String.random(9)),(D.back||(D.back={}))[""+(A.now||w["#"])]=1,!C.to&&(C.to=setTimeout(function(){b(C)},i.gap))}}})},9)}}})});function b(y){var w={"#":y.next,put:y.put,ok:{"@":3,"/":u.near}};y.next=y.put=y.to=null,u.say(w,y)}var g=t.state.ify,S=t.state.is;(function(){s.up={};var y=u.hear["?"];u.hear["?"]=function(w,p){var h;if(y(w,p),!!p.pid){if(p.pid===i.pid){u.bye(p);return}if(h=s.up[p.pid]){if(h===p)return;i.pid>p.pid&&(h=p,p=s.up[h.pid]),h.url=h.url||p.url,u.bye(p),s.up[h.pid]=h;return}p.url&&(s.up[p.pid]=p,s.stay&&s.stay())}},u.hear.opt=function(w,p){if(!w.ok){var h=w.opt;h&&(h=h.peers,!(!h||typeof h!="string")&&(99<=Object.keys(s.up).length||(u.hi({id:h,url:h,retry:9}),p&&u.say({dam:"opt",ok:1,"@":w["#"]},p))))}},s.stay=function(){clearTimeout(s.stay.to),s.stay.to=setTimeout(function(w,p){(w=o.stats&&o.stats.stay)&&(p={},Object.keys(s.up||"").forEach(function(h){h=(s.up||"")[h],h.url&&(p[h.url]={})}),(w.axe=w.axe||{}).up=p)},1e3*9)},setTimeout(function(w){(w=o.stats&&o.stats.stay&&o.stats.stay.axe)&&(w=w.up)&&(w instanceof Array||(w=Object.keys(w)),setTimeout.each(w||[],function(p){u.hear.opt({opt:{peers:p}})}))},1e3)})(),function(){i.mob=i.mob||9900,o.on("hi",function(y){if(this.to.next(y),!y.url){var w=u.near;if(!(i.mob>=w)){var p={};Object.keys(s.up).forEach(function(h){h=s.up[h],h.url&&(p[h.url]={})}),u.say({dam:"mob",mob:w,peers:p},y),setTimeout(function(){u.bye(y)},9)}}}),o.on("bye",function(y){this.to.next(y)})}()}return function(){var o=Array.from;if(Object.maps=function(i){return o&&i instanceof Map?o(i.keys()):(i instanceof Object.Map&&(i=i.s),Object.keys(i))},o)return Object.Map=Map;(Object.Map=function(){this.s={}}).prototype={set:function(i,s){return this.s[i]=s,this},get:function(i){return this.s[i]},delete:function(i){delete this.s[i]}}}(),fo}var ho;function Xl(){return ho||(ho=1,function(e){(function(){var t=setTimeout||{},n;typeof window!=""+n&&(t.window=window);var r=(t.window||"").AXE||function(){};(r.window=t.window)&&(r.window.AXE=r);var o=(r.window||"").GUN||Le();(o.AXE=r).GUN=r.Gun=o,o.window||Vl(),o.on("opt",function(s){i(s),this.to.next(s)});function i(s){if(s.axe)return;var u=s.opt,c=u.peers;if(u.axe===!1||!o.window)return;var a=o.window,f=a.localStorage||u.localStorage||{},d=a.location||u.location||{},l=a.navigator||u.navigator||{},b=s.axe={},g,S,y=u.mesh=u.mesh||o.Mesh(s);g=c[S=d.origin+"/gun"]=c[S]||{},g.id=g.url=S,g.retry=g.retry||0,g=c[S="http://localhost:8765/gun"]=c[S]||{},g.id=g.url=S,g.retry=g.retry||0,o.log.once("AXE","AXE enabled: Trying to find network via (1) local peer (2) last used peers (3) a URL parameter, and last (4) hard coded peers."),o.log.once("AXEWarn","Warning: AXE is in alpha, use only for testing!");var w=f.peers||"";w&&(w+=" "),w+=((d.search||"").split("peers=")[1]||"").split("&")[0],s.on("bye",function(h){this.to.next(h),h.url&&(l.onLine||(h.retry=1),!h.retry&&(b.fall&&delete b.fall[h.url||h.id],function v(){if(!b.fall){setTimeout(v,9);return}var m=Object.keys(b.fall||""),T=m[Math.random()*m.length>>0];if(m.length||(f.peers="",T="https://gunjs.herokuapp.com/gun"),c[T]){v();return}y.hi(T)}()))}),s.on("hi",function(h){this.to.next(h),h.url});function p(h){b.fall={},((h||"").match(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/ig)||[]).forEach(function(v){b.fall[v]={url:v,id:v,retry:0}})}if(w){p(w);return}try{fetch(((d.search||"").split("axe=")[1]||"").split("&")[0]||d.axe||"https://raw.githubusercontent.com/wiki/amark/gun/volunteer.dht.md").then(function(h){return h.text()}).then(function(h){p(f.peers=h)}).catch(function(){p()})}catch{p()}}try{""+n!="object"&&(e.exports=r)}catch{}})()}(Nn)),Nn.exports}Xl();var Rn={exports:{}},po;function zi(){return po||(po=1,function(e){(function(){var t={},n,r=setTimeout.turn||typeof setImmediate!=""+n&&setImmediate||setTimeout;t.parseAsync=function(i,s,u,c){if(typeof i!="string"){try{s(n,JSON.parse(i))}catch(d){s(d)}return}var a={i:0,text:i,done:s,l:i.length,up:[]};c=c||1024*32,f();function f(){for(var d=a.text,l=a.i,b=a.l,g=0,S=a.w,y,w;g++<c;){var p=d[l++];if(l>b){a.end=!0;break}if(S){for(l=d.indexOf('"',l-1),p=d[l],w=0;d[l-++w]=="\\";);w=!(w%2),y=y||w,p=='"'&&!w&&(S=n,w=a.s,a.a?(w=d.slice(a.sl,l),(y||1+w.indexOf("\\"))&&(w=JSON.parse('"'+w+'"')),a.at instanceof Array?a.at.push(a.s=w):(a.at||(a.end=g=c,w=n),(a.at||{})[a.s]=a.s=w),a.s=n):(a.s=d.slice(a.sl,l),(y||1+a.s.indexOf("\\"))&&(a.s=JSON.parse('"'+a.s+'"'))),a.a=y=n),++l}else switch(p){case'"':a.sl=l,S=!0;break;case":":a.ai=l,a.a=!0;break;case",":(a.a||a.at instanceof Array)&&(w=d.slice(a.ai,l-1))&&n!==(w=o(w))&&(a.at instanceof Array?a.at.push(w):a.at[a.s]=w),a.a=n,a.at instanceof Array&&(a.a=!0,a.ai=l);break;case"{":a.up.push(a.at||(a.at={})),a.at instanceof Array?a.at.push(a.at={}):n!==(w=a.s)&&(a.at[w]=a.at={}),a.a=n;break;case"}":a.a&&(w=d.slice(a.ai,l-1))&&n!==(w=o(w))&&(a.at instanceof Array?a.at.push(w):(a.at||(a.end=g=c,w=n),(a.at||{})[a.s]=w)),a.a=n,a.at=a.up.pop();break;case"[":n!==(w=a.s)?(a.up.push(a.at),a.at[w]=a.at=[]):a.at||a.up.push(a.at=[]),a.a=!0,a.ai=l;break;case"]":a.a&&(w=d.slice(a.ai,l-1))&&n!==(w=o(w))&&(a.at instanceof Array?a.at.push(w):a.at[a.s]=w),a.a=n,a.at=a.up.pop();break}}if(a.s=n,a.i=l,a.w=S,a.end){if(w=a.at,n===w)try{w=JSON.parse(i)}catch(h){return a.done(h)}a.done(n,w)}else r(f)}};function o(i){var s=parseFloat(i);if(!isNaN(s))return s;if(i=i.trim(),i=="true")return!0;if(i=="false")return!1;if(i=="null")return null}t.stringifyAsync=function(i,s,u,c,a){a=a||{},a.text=a.text||"",a.up=[a.at={d:i}],a.done=s,a.i=0;var f=0;d();function d(){var l=a.at,b=l.d,g="",S;switch(l.i&&l.i-l.j>0&&(g+=","),n!==(S=l.k)&&(g+=JSON.stringify(S)+":"),typeof b){case"boolean":g+=""+b;break;case"string":g+=JSON.stringify(b);break;case"number":g+=isNaN(b)?"null":b;break;case"object":if(!b){g+="null";break}if(b instanceof Array){g+="[",l={i:-1,as:b,up:l,j:0},l.l=b.length,a.up.push(a.at=l);break}if(typeof(b||"").toJSON!="function"){g+="{",l={i:-1,ok:Object.keys(b).sort(),as:b,up:l,j:0},l.l=l.ok.length,a.up.push(a.at=l);break}if(S=b.toJSON()){g+=S;break}case"function":if(l.as instanceof Array){g+="null";break}default:g="",l.j++}for(a.text+=g;1+l.i>=l.l;)a.text+=l.ok?"}":"]",l=a.at=l.up;if(++l.i<l.l){if((S=l.ok)?l.d=l.as[l.k=S[l.i]]:l.d=l.as[l.i],++f<9)return d();f=0,r(d);return}a.done(n,a.text)}},typeof window!=""+n&&(window.YSON=t);try{""+n!="object"&&(e.exports=t)}catch{}typeof JSON!=""+n&&(JSON.parseAsync=t.parseAsync,JSON.stringifyAsync=t.stringifyAsync)})()}(Rn)),Rn.exports}zi();var jn={exports:{}},go;function br(){return go||(go=1,function(){function e(){var i=function(s,u,c){if(i.unit=0,!c&&r!==u&&(i.last=""+s<i.last?i.last:""+s,delete(i.$||{})[o]),c=c||i.$||(i.$={}),!s&&Object.keys(c).length)return c;s=""+s;for(var a=0,f=s.length-1,d=s[a],l,b;!(l=c[d])&&a<f;)d+=s[++a];if(l)if(a==f){if(r===u)return r===(b=l[""])?l:(i.unit=1)&&b;l[""]=u}else return r!==u&&delete l[o],i(s.slice(++a),u,l||(l={}));else{if(!t(c,function(g,S){var y=0,w="";if((S||"").length)for(;S[y]==s[y];)w+=S[y++];if(w){if(r===u)return y<=f?void 0:((b||(b={}))[S.slice(y)]=g,g);var p={};if(p[S.slice(y)]=g,y=s.slice(y),y===""?p[""]=u:(p[y]={})[""]=u,c[w]=p,e.debug&&""+w=="undefined"){console.log(0,w);debugger}return delete c[S],!0}})){if(r===u)return;if((c[d]||(c[d]={}))[""]=u,e.debug&&""+d=="undefined"){console.log(1,d);debugger}}if(r===u)return b}};return i}if(e.map=function i(s,u,c,a){try{a=a||[];var f=typeof s=="function"?s.$||{}:s;//!opt && console.log("WHAT IS T?", JSON.stringify(t).length);
if(!f)return;if(typeof f=="string"){if(e.debug)throw["BUG:",s,u,c,a];return}var d=(f[o]||n).sort||(f[o]=function k(){return k.sort=Object.keys(f).sort(),k}()).sort,l;c=c===!0?{branch:!0}:c||{},(l=c.reverse)&&(d=d.slice(0).reverse());for(var b=c.start,g=c.end,S="ï¿¿",y=0,w=d.length;y<w;y++){var p=d[y],h=f[p],v,m,T;if(!(!h||p===""||o===p||p==="undefined")&&(m=a.slice(0),m.push(p),T=m.join(""),!(r!==b&&T<(b||"").slice(0,T.length))&&!(r!==g&&(g||S)<T))){if(l&&(v=i(h,u,c,m),r!==v))return v;if(r!==(v=h[""])){var E=1;if(r!==b&&T<(b||"")&&(E=0),r!==g&&T>(g||S)&&(E=0),E&&(v=u(v,T,p,a),r!==v))return v}else if(c.branch&&(v=u(r,T,p,a),r!==v))return v;if(a=m,!l&&(v=i(h,u,c,a),r!==v))return v;a.pop()}}}catch(k){console.error(k)}},typeof window<"u")window.Radix=e;else try{jn.exports=e}catch{}var t=e.object=function(i,s,u){for(var c in i)if(i.hasOwnProperty(c)&&(u=s(i[c],c))!==r)return u},n={},r,o=""}()),jn.exports}br();var Dn={exports:{}},In,vo;function Yl(){return vo||(vo=1,In=function(e){var t=br();e.find("a",function(){var n=[];t.map(e.list,function(i,s){s.indexOf("%1B")+1&&i&&n.push([s,i])}),n.length&&console.log(`
! ! ! WARNING ! ! !
RAD v0.2020.x has detected OLD v0.2019.x data & automatically migrating. Automatic migration will be turned OFF in future versions! If you are just developing/testing, we recommend you reset your data. Please contact us if you have any concerns.
This message should only log once.`);var r,o;n.forEach(function(i){r=i[0],o=i[1],e.list(decodeURIComponent(r),o),e.list(r,0)}),r&&e.find.bad(r)})}),In}var mo;function Mi(){return mo||(mo=1,function(){function e(r){r=r||{},r.log=r.log||console.log,r.file=String(r.file||"radata");var o=(e.has||(e.has={}))[r.file];if(o)return o;r.max=r.max||(r.memory?r.memory*999*999:3e8)*.3,r.until=r.until||r.wait||250,r.batch=r.batch||10*1e3,r.chunk=r.chunk||1024*1024*1,r.code=r.code||{},r.code.from=r.code.from||"!",r.jsonify=!0;function i(y){return encodeURIComponent(y).replace(/\*/g,"%2A")}function s(y){return S!==y&&(!y||typeof y!="object")}var u=""+S==typeof setImmediate?setTimeout:setImmediate,c=setTimeout.turn||u,S,a=n.object,f=0;if(!r.store)return r.log("ERROR: Radisk needs `opt.store` interface with `{get: fn, put: fn (, list: fn)}`!");if(!r.store.put)return r.log("ERROR: Radisk needs `store.put` interface with `(file, data, cb)`!");if(!r.store.get)return r.log("ERROR: Radisk needs `store.get` interface with `(file, cb)`!");r.store.list,""+S!=typeof wr&&zi();var d=JSON.parseAsync||function(y,w,p){var h;try{w(h,JSON.parse(y,p))}catch(v){w(v)}},l=function(y,w,p,h,v){if(typeof w=="function"){var m=p||{};p=w,l.read(y,p,m,v||h);return}l.save(y,w,p,h,v)};l.save=function(y,w,p,h,v){var m={key:y},T,E;m.find=function(k){var O;if(m.file=k||(k=r.code.from),v&&(v=v[k]=v[k]||{}),v&&(v.sf=v.sf||+new Date),O=l.disk[k]){m.mix(S,O);return}l.parse(k,m.mix,S,v)},m.mix=function(k,O){if(v&&(v.sml=+new Date),v&&(v.sm=v.sm||+new Date),m.err=k||m.err){p(k);return}var j=m.file=(O||"").file||m.file,C;if(!O&&j!==r.code.from){l.find.bad(j),l.save(y,w,p,h);return}if((O=l.disk[j]||(l.disk[j]=O||n())).file||(O.file=j),r.compare&&(w=r.compare(O(y),w,y,j),S===w)){p(k,-1);return}if((m.disk=O)(y,w),h&&((C=(C=O.tags||(O.tags={}))[h]||(C[h]=l.tags[h]||(l.tags[h]={})))[j]||(C[j]=l.one[h]||(l.one[h]=p)),p=null),v&&(v.st=v.st||+new Date),O.Q){p&&O.Q.push(p);return}O.Q=p?[p]:[],O.to=setTimeout(m.write,r.until)},m.write=function(){v&&(v.sto=v.sto||+new Date);var k=T=m.file,O=m.disk;E=m.q=O.Q,m.tags=O.tags,delete O.Q,delete l.disk[k],delete O.tags,l.write(k,O,m.ack,S,v)},m.ack=function(k,O){v&&(v.sa=v.sa||+new Date),v&&(v.sal=E.length);var j,C;for(var A in l.tags)if(l.tags.hasOwnProperty(A)){var _=l.tags[A];if(!((C=l.disk[T])&&(C=C.tags)&&C[_])){j=_[T],delete _[T];var x;for(var $ in _)if(_.hasOwnProperty($)){x=!0;break}x||(delete l.tags[_],j&&j(k,O))}}!E&&(E="");for(var D=E.length,N=0,R=+new Date;N<D;N++)(j=E[N])&&j(k,O);console.STAT&&console.STAT(R,+new Date-R,"rad acks",i(m.file)),console.STAT&&console.STAT(R,E.length,"rad acks #",i(m.file))},p||(p=function(k,O){}),l.find(y,m.find)},l.disk={},l.one={},l.tags={};var b=0;l.write=function(y,w,p,h,v){if(!w){p("No radix!");return}h=typeof h=="object"?h:{force:h};var m=function(){},T,E;if(m.text="",m.file=y=w.file||(w.file=y),!y){p("What file?");return}if(m.write=function(){var k=w.raw=m.text;l.disk[y=w.file||m.file||y]=w;var O=+new Date;v&&(v.wd=O),l.find.add(y,function(C){if(v&&(v.wa=+new Date),C){p(C);return}r.store.put(i(y),k,function(_,x){v&&(v.wp=+new Date),console.STAT&&console.STAT(O,f=+new Date-O,"wrote disk",JSON.stringify(y),++b,"total all writes."),p(_,x||1),w.Q||delete l.disk[y]})})},m.split=function(){var k=+new Date;v&&(v.wf=k),m.text="",m.count||(m.count=0,n.map(w,function(){m.count++})),v&&(v.wfc=m.count),m.limit=Math.ceil(m.count/2);var O=m.count;return m.count=0,v&&(v.wf1=+new Date),m.sub=n(),n.map(w,m.slice,{reverse:1}),v&&(v.wf2=+new Date),l.write(m.end,m.sub,m.both,h),v&&(v.wf3=+new Date),m.hub=n(),n.map(w,m.stop),v&&(v.wf4=+new Date),l.write(w.file,m.hub,m.both,h),v&&(v.wf5=+new Date),console.STAT&&console.STAT(k,+new Date-k,"rad split",i(w.file),O),!0},m.slice=function(k,O){if(m.sub(m.end=O,k),m.limit<=++m.count)return!0},m.stop=function(k,O){if(O>=m.end)return!0;m.hub(O,k)},m.both=function(k,O){if(v&&(v.wfd=+new Date),E){p(k||E);return}if(T){p(k,O);return}T=!0,E=k},m.each=function(k,O,j,C){if(S!==k&&m.count++,r.max<=(k||"").length)return p("Data too big!"),!0;var A=e.encode(C.length)+"#"+e.encode(j)+(S===k?"":":"+e.encode(k))+`
`;if(r.chunk<m.text.length+A.length&&1<m.count&&!h.force)return m.split();m.text+=A},r.jsonify){l.write.jsonify(m,w,p,h,v);return}n.map(w,m.each,!0)||m.write()},l.write.jsonify=function(y,w,p,h,v){var m,T=+new Date;v&&(v.w=T);try{m=JSON.stringify(w.$)}catch{p("Cannot radisk!");return}if(v&&(v.ws=+new Date),console.STAT&&console.STAT(T,+new Date-T,"rad stringified JSON"),r.chunk<m.length&&!h.force){var E=0;if(n.map(w,function(){if(E++)return!0}),E>1)return y.split()}y.text=m,y.write()},l.range=function(y,w){if(!(!y||!w)){if(S===w.start&&S===w.end||s(y))return y;var p=n();return n.map(y,function(h,v){p(v,h)},w),p("")}},function(){l.read=function(y,w,p,h){p=p||{};var v={key:y};v.find=function(m){var T;if(v.file=m||(m=r.code.from),h&&(h=h[m]=h[m]||{}),h&&(h.rf=h.rf||+new Date),T=l.disk[v.file=m]){v.check(S,T);return}l.parse(m,v.check,S,h)},v.get=function(m,T,E){if(h&&(h.rgl=+new Date),h&&(h.rg=h.rg||+new Date),v.err=m||v.err){w(m);return}var k=v.file=(T||"").file||v.file;if(!T&&k!==r.code.from){l.find.bad(k),l.read(y,w,p);return}if(T=l.disk[k]||(l.disk[k]=T),!T){w(k===r.code.from?S:"No file!");return}T.file||(T.file=k);var O=l.range(T(y),p);if(h&&(h.rr=+new Date),p.unit=T.unit,p.chunks=(p.chunks||0)+1,p.parsed=(p.parsed||0)+((E||"").parsed||p.chunks*r.chunk),p.more=1,p.next=S,n.map(l.list,function(_,x){if(!(!_||k===x))return p.next=x,1},p.reverse?{reverse:1,end:k}:{start:k}),h&&(h.rl=+new Date),p.next||(p.more=0),p.next&&(!p.reverse&&(y<p.next&&p.next.indexOf(y)!=0||S!==p.end&&(p.end||"ï¿¿")<p.next)&&(p.more=0),p.reverse&&(y>p.next&&y.indexOf(p.next)!=0||S!==p.start&&(p.start||"")>p.next&&k<=p.start)&&(p.more=0)),!p.more){w(v.err,O,p);return}if(O&&w(v.err,O,p),!(p.parsed>=p.limit)){var j=+new Date;h&&(h.rm=j);var C=p.next;u(function(){console.STAT&&console.STAT(j,+new Date-j,"rad more"),l.parse(C,v.check)},0)}},v.check=function(m,T,E){if(v.get(m,T,E),!(!T||T.check)){T.check=1;var k=+new Date;(E||(E={})).file||(E.file=v.file),n.map(T,function(O,j){l.find(j,function(C){if((C||(C=r.code.from))!==E.file){var A=(""+Math.random()).slice(-3);c(function(){l.save(j,O,function _(x,$){if(x){l.save(j,O,_);return}console.STAT&&console.STAT("MISLOCATED DATA CORRECTED",A,i(j),i(E.file),i(C))})},0)}})}),console.STAT&&console.STAT(k,+new Date-k,"rad check")}},l.find(y||(p.reverse?p.end||"":p.start||""),v.find)}}(),function(){var y=0,w={},p="";l.parse=function(h,v,m,T){var E;if(!h)return v();if(E=w[h]){E.push(v);return}E=w[h]=[v];var k=function(){},O={file:h};(k.disk=n()).file=h,k.read=function(C,A){if(T&&(T.rpg=+new Date),console.STAT&&console.STAT(j,+new Date-j,"read disk",JSON.stringify(h),++y,"total all parses."),(k.err=C)||(k.not=!A)){delete w[h],k.map(E,k.ack);return}if(typeof A!="string"){try{r.max<=A.length?k.err="Chunk too big!":A=A.toString()}catch(_){k.err=_}if(k.err){delete w[h],k.map(E,k.ack);return}}if(O.parsed=A.length,T&&(T.rpl=O.parsed),T&&(T.rpa=E.length),j=+new Date,!(r.jsonify||A[0]==="{")){k.radec(C,A);return}d(A,function(_,x){if(!_){delete w[h],k.disk.$=x,console.STAT&&(f=+new Date-j)>9&&console.STAT(j,f,"rad parsed JSON"),T&&(T.rpd=+new Date),k.map(E,k.ack);return}if(A[0]==="{"){delete w[h],k.err="JSON error!",k.map(E,k.ack);return}k.radec(_,A)})},k.map=function(){if(!(!E||!E.length)){for(var C=+new Date,A=k.err,_=k.not?S:k.disk,x=0,$;x<9&&($=E[x++]);)$(A,_,O);console.STAT&&console.STAT(C,+new Date-C,"rad packs",i(h)),console.STAT&&console.STAT(C,x,"rad packs #",i(h)),(E=E.slice(x)).length&&c(k.map,0)}},k.ack=function(C){if(C){if(k.err||k.not){C(k.err,S,O);return}C(S,k.disk,O)}},k.radec=function(C,A){delete w[h],j=+new Date;var _=k.split(A),x=[],$,D,N;if(!_||_[1]!==0){k.err="File '"+h+"' does not have root radix! ",k.map(E,k.ack);return}for(;_;)D=N=S,$=_[1],_=k.split(_[2])||"",_[0]=="#"&&(D=_[1],x=x.slice(0,$),$<=x.length&&x.push(D)),_=k.split(_[2])||"",_[0]!=`
`&&((_[0]=="="||_[0]==":")&&(N=_[1]),S!==D&&S!==N&&k.disk(x.join(""),N),_=k.split(_[2]));console.STAT&&console.STAT(j,+new Date-j,"parsed RAD"),k.map(E,k.ack)},k.split=function(C){if(C){var A=[],_={},x=-1,$="";if(x=C.indexOf(p),!!C[x])return $=C.slice(0,x),A[0]=$,A[1]=e.decode(C.slice(x),_),A[2]=C.slice(x+_.i),A}},l.disk&&(m||(m=(l.disk[h]||"").raw));var j=+new Date;if(T&&(T.rp=j),m)return c(function(){k.read(S,m)},0);r.store.get(i(h),k.read)}}(),function(){var y,w="",p;l.find=function(m,T){if(!y){if(p){p.push([m,T]);return}p=[[m,T]],l.parse(w,h);return}n.map(l.list=y,function(E,k){if(E)return T(k)||!0},{reverse:1,end:m})||T(r.code.from)},l.find.add=function(m,T){var E=y(m);if(E||m===w){T(S,1);return}y(m,1),T.found=(T.found||0)+1,l.write(w,y,function(k,O){if(k){T(k);return}T.found=(T.found||0)-1,T.found===0&&T(S,1)},!0)},l.find.bad=function(m,T){y(m,0),l.write(w,y,T||g)};function h(m,T){if(m){r.log("list",m),setTimeout(function(){l.parse(w,h)},1e3);return}if(T){v(T);return}if(y=y||T||n(),!r.store.list){v(y);return}r.store.list(function(E){if(!E){v(y);return}l.find.add(E,g)})}function v(m,T){y=y||m,y.file=w,T=p,p=null,a(T,function(E){l.find(E[0],E[1])})}}();try{!t.window&&Yl()(l)}catch{}var g=function(){},S;return e.has[r.file]=l,l}if(function(){var r="";e.encode=function(o,i,s){s=s||r;var u=s,c;if(typeof o=="string"){for(var a=o.indexOf(s);a!=-1;)u+=s,a=o.indexOf(s,a+1);return u+'"'+o+s}else{if(o&&o["#"]&&Object.keys(o).length==1)return u+"#"+c+u;if(typeof o=="number")return u+"+"+(o||0)+u;if(o===null)return u+" "+u;if(o===!0)return u+"+"+u;if(o===!1)return u+"-"+u}},e.decode=function(o,i,s){s=s||r;var u="",c=-1,a=0,f,d;if(s===o[0]){for(;s===o[++c];)++a;for(d=o[f=a]||!0;--a>=0;)c=o.indexOf(s,c+1);if(c==-1&&(c=o.length),u=o.slice(f+1,c),i&&(i.i=c+1),d==='"')return u;if(d==="#")return{"#":u};if(d==="+")return u.length===0?!0:parseFloat(u);if(d===" ")return null;if(d==="-")return!1}}}(),typeof window<"u"){var t=window.Gun,n=window.Radix;window.Radisk=e}else{var t=Le(),n=br();try{Dn.exports=e}catch{}}e.Radix=n}()),Dn.exports}Mi();var yo={},wo;function Ql(){if(wo)return yo;wo=1;var e={},t=typeof window<"u"?window.Gun:Le();return t.on("create",function(n){t.TESTING&&(n.opt.file="radatatest"),this.to.next(n);var r=n.opt,o;if(!(r.rad===!1||r.radisk===!1)&&!(o+""!=typeof process&&""+(e||"").RAD=="false")){var i=t.window&&t.window.Radisk||Mi(),s=i.Radix,u=i(r),c="\x1B",a=0;n.on("put",function(d){if(this.to.next(d),!(d._||"").rad){var l=d["#"],b=d.put,g=b["#"],S=b["."],y=b[":"],w=b[">"],p=(d._||"").DBG;p&&(p.sp=p.sp||+new Date);var h=(d._||"").RPS||((d._||"").RPS=+new Date);u(g+c+S,{":":y,">":w},function(v,m){if(p&&(p.spd=p.spd||+new Date),console.STAT&&console.STAT(h,+new Date-h,"put"),v){n.on("in",{"@":l,err:v,DBG:p});return}n.on("in",{"@":l,ok:m,DBG:p})},!1,p&&(p.r=p.r||{})),p&&(p.sps=p.sps||+new Date)}}),n.on("get",function(d){this.to.next(d);var l=d._||"",b=l.DBG=d.DBG;b&&(b.sg=+new Date);var g=d["#"],S=d.get,y=d.get["#"],w=d.get["."]||"",p={},h,v,m,T;if(typeof y=="string"?v=y:y&&(o!==(m=y["*"])&&(p.limit=T=1),o!==y[">"]&&(p.start=y[">"]),o!==y["<"]&&(p.end=y["<"]),v=T?""+m:m||y["="],T=null),v&&!p.limit&&(typeof w=="string"?v=v+c+(p.atom=w):w&&(o!==w[">"]&&(p.start=w[">"],p.limit=1),o!==w["<"]&&(p.end=w["<"],p.limit=1),o!==(m=w["*"])&&(p.limit=T=1),v&&(v=v+c+(T?""+(m||""):m||(p.atom=w["="]||""))))),((m=S["%"])||p.limit)&&(p.limit=m<=(p.pack||1e3*100)?m:1),(w["-"]||(y||{})["-"]||S["-"])&&(p.reverse=!0),(m=(n.next||"")[y])&&m.put){if(p.atom){if(m=(m.next||"")[p.atom],m&&m.root&&m.root.graph&&m.root.graph[y]&&m.root.graph[y][p.atom])return}else if(m&&m.rad)return}var E=t.state(),k=+new Date,O=0;b&&(b.sgm=k),u(v||"",function(C,A,_){b&&(b.sgr=+new Date),b&&(b.sgi=_);try{r.store.stats.get.time[f%50]=+new Date-k,++f,r.store.stats.get.count++,C&&(r.store.stats.get.err=C)}catch{}console.STAT&&console.STAT(k,+new Date-k,"got",JSON.stringify(v)),k=+new Date,_=_||"";var x,$;if(_.unit&&A&&o!==(x=A[":"])&&o!==($=A[">"])){var D=v.split(c),N=D[0],R=D[1];(h=h||{})[N]=t.state.ify(h[N],R,$,x,N),n.$.get(N).get(R)._.rad=E}else A&&(typeof A!="string"&&(p.atom?A=o:s.map(A,j,p)),!h&&A&&j(A,""),!p.atom&&!w&typeof y=="string"&&!p.limit&&!p.more&&(n.$.get(y)._.rad=E));b&&(b.sgp=+new Date),console.STAT&&(a=+new Date-k)>9&&(console.STAT(k,a,"got prep time"),console.STAT(k,O,"got prep #")),O=0,k=+new Date;var P=function(){};P.faith=!0,P.rad=S,n.on("in",{"@":g,put:h,"%":_.more?1:o,err:C||o,_:P,DBG:b}),console.STAT&&(a=+new Date-k)>9&&console.STAT(k,a,"got emit",Object.keys(h||{}).length),h=o},p,b&&(b.r=b.r||{})),b&&(b.sgd=+new Date),console.STAT&&(a=+new Date-k)>9&&console.STAT(k,a,"get call");function j(C,A,_,x){if(O++,!!C){A=(v+A).split(c);var $=A.slice(0,1)[0];if(A=A.slice(-1)[0],p.limit&&p.limit<=p.count)return!0;var D,N,R=$,P=A;if(typeof C!="string"){D=C[":"],N=C[">"],(h=h||{})[R]=t.state.ify(h[R],P,N,D,R),p.count=(p.count||0)+((D||"").length||9);return}p.count=(p.count||0)+C.length;var U=C.lastIndexOf(">"),F=i.decode(C.slice(U+1),null,c);C=i.decode(C.slice(0,U),null,c),(h=h||{})[$]=t.state.ify(h[$],A,F,C,$)}}}),t.valid,(r.store||{}).stats={get:{time:{},count:0},put:{time:{},count:0}};var f=0}}),yo}Ql();var Pn={exports:{}},bo;function eh(){return bo||(bo=1,function(){function e(n){n=n||{},n.file=String(n.file||"radata");var r=e[n.file],o=null,i;if(r)return console.log("Warning: reusing same IndexedDB store and options as 1st."),e[n.file];r=e[n.file]=function(){};try{n.indexedDB=n.indexedDB||e.indexedDB||indexedDB}catch{}try{if(!n.indexedDB||location.protocol=="file:"){var s=r.d||(r.d={});return r.put=function(u,c,a){s[u]=c,setTimeout(function(){a(null,1)},250)},r.get=function(u,c){setTimeout(function(){c(null,s[u]||i)},5)},console.log("Warning: No indexedDB exists to persist data to!"),r}}catch{}return r.start=function(){var u=indexedDB.open(n.file,1);u.onupgradeneeded=function(c){c.target.result.createObjectStore(n.file)},u.onsuccess=function(){o=u.result},u.onerror=function(c){console.log(c||1)}},r.start(),r.put=function(u,c,a){if(!o){setTimeout(function(){r.put(u,c,a)},1);return}var f=o.transaction([n.file],"readwrite"),d=f.objectStore(n.file),l=d.put(c,""+u);l.onsuccess=d.onsuccess=f.onsuccess=function(){a(null,1)},l.onabort=d.onabort=f.onabort=function(b){a(b||"put.tx.abort")},l.onerror=d.onerror=f.onerror=function(b){a(b||"put.tx.error")}},r.get=function(u,c){if(!o){setTimeout(function(){r.get(u,c)},9);return}var a=o.transaction([n.file],"readonly"),f=a.objectStore(n.file),d=f.get(""+u);d.onsuccess=function(){c(null,d.result)},d.onabort=function(l){c(l||4)},d.onerror=function(l){c(l||5)}},setInterval(function(){o&&o.close(),o=null,r.start()},1e3*15),r}if(typeof window<"u")(e.window=window).RindexedDB=e,e.indexedDB=window.indexedDB;else try{Pn.exports=e}catch{}try{var t=e.window.Gun||Le();t.on("create",function(n){this.to.next(n),n.opt.store=n.opt.store||e(n.opt)})}catch{}}()),Pn.exports}eh();var _o={},So;function th(){return So||(So=1,function(){var e=typeof window<"u"?window.Gun:Le();e.on("opt",function(t){this.to.next(t);var n=t.opt;if(t.once||!e.Mesh||n.RTCPeerConnection===!1)return;var r;typeof window<"u"&&(r=window),typeof ft<"u"&&(r=ft),r=r||{};var o=n.RTCPeerConnection||r.RTCPeerConnection||r.webkitRTCPeerConnection||r.mozRTCPeerConnection,i=n.RTCSessionDescription||r.RTCSessionDescription||r.webkitRTCSessionDescription||r.mozRTCSessionDescription,s=n.RTCIceCandidate||r.RTCIceCandidate||r.webkitRTCIceCandidate||r.mozRTCIceCandidate;if(!o||!i||!s)return;n.RTCPeerConnection=o,n.RTCSessionDescription=i,n.RTCIceCandidate=s,n.rtc=n.rtc||{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.sipgate.net:3478"}]},n.rtc.dataChannel=n.rtc.dataChannel||{ordered:!1,maxRetransmits:2},n.rtc.sdp=n.rtc.sdp||{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},n.rtc.max=n.rtc.max||55,n.rtc.room=n.rtc.room||e.window&&(location.hash.slice(1)||location.pathname.slice(1)),n.announce=function(a){n.rtc.start=+new Date,t.$.get("/RTC/"+n.rtc.room+"<?99").get("+").put(n.pid,function(f){!f.ok||!f.ok.rtc||c(f)},{acks:n.rtc.max}).on(function(f,d,l){f===n.pid||n.rtc.start>l.put[">"]||c({"#":""+l["#"],ok:{rtc:{id:f}}})})};var u=n.mesh=n.mesh||e.Mesh(t);t.on("create",function(a){this.to.next(a),setTimeout(n.announce,1)});function c(a){if(this&&this.off&&this.off(),!!a.ok){var f=a.ok.rtc,d,l;if(!(!f||!f.id||f.id===n.pid)){if(l=f.answer)return!(d=n.peers[f.id]||c[f.id])||d.remoteSet?void 0:(l.sdp=l.sdp.replace(/\\r\\n/g,`\r
`),d.setRemoteDescription(d.remoteSet=new n.RTCSessionDescription(l)));if(l=f.candidate)return d=n.peers[f.id]||c[f.id]||c({ok:{rtc:{id:f.id}}}),d.addIceCandidate(new n.RTCIceCandidate(l));if(!c[f.id]){(d=new n.RTCPeerConnection(n.rtc)).id=f.id;var b=d.wire=d.createDataChannel("dc",n.rtc.dataChannel);if(c[f.id]=d,b.to=setTimeout(function(){delete c[f.id]},1e3*60),b.onclose=function(){u.bye(d)},b.onerror=function(g){},b.onopen=function(g){delete c[f.id],u.hi(d)},b.onmessage=function(g){g&&u.hear(g.data||g,d)},d.onicecandidate=function(g){g.candidate&&t.on("out",{"@":a["#"],ok:{rtc:{candidate:g.candidate,id:n.pid}}})},d.ondatachannel=function(g){var S=g.channel;S.onmessage=b.onmessage,S.onopen=b.onopen,S.onclose=b.onclose},l=f.offer){f.offer.sdp=f.offer.sdp.replace(/\\r\\n/g,`\r
`),d.setRemoteDescription(new n.RTCSessionDescription(l)),d.createAnswer(function(g){d.setLocalDescription(g),t.on("out",{"@":a["#"],ok:{rtc:{answer:g,id:n.pid}}})},function(){},n.rtc.sdp);return}return d.createOffer(function(g){d.setLocalDescription(g),t.on("out",{"@":a["#"],"#":t.ask(c),ok:{rtc:{offer:g,id:n.pid}}})},function(){},n.rtc.sdp),d}}}}})}()),_o}th();const qe=H({}),Ve=H({}),Ke=H({}),Je=H({}),nh=oe([qe,ji],([e,t])=>{console.log("[FEASIBLE-COMPOSE-FROM] Calculating feasible compose-from with absolute units and resource allocation...");const n={};Object.entries(e).forEach(([i,s])=>{const u={};Object.entries(s).forEach(([c,a])=>{const f=t[c];if(!f){console.warn(`[FEASIBLE-COMPOSE-FROM] No network capacity found for: ${c}`);return}const d=f.computed_quantity||0,l=Math.min(a,d);l>0&&(u[c]=l,l<a&&console.log(`[FEASIBLE-COMPOSE-FROM] Share-constrained ${i} â ${c}: desired ${a} â ${l} units (limited by available ${d} units)`))}),Object.keys(u).length>0&&(n[i]=u)});const r={};Object.entries(n).forEach(([i,s])=>{Object.entries(s).forEach(([u,c])=>{if(!r[u]){const a=t[u],f=(a==null?void 0:a.computed_quantity)||0;r[u]={totalDemand:0,available:f,consumers:[]}}r[u].totalDemand+=c,r[u].consumers.push({ourCapacityId:i,desiredUnits:c})})});const o={};return Object.entries(r).forEach(([i,s])=>{const{totalDemand:u,available:c,consumers:a}=s;let f=1;u>c&&(f=c/u,console.log(`[FEASIBLE-COMPOSE-FROM] Resource allocation scaling for ${i}: ${u} demanded > ${c} available, scaling by ${f.toFixed(3)}`)),a.forEach(({ourCapacityId:d,desiredUnits:l})=>{const b=l*f;o[d]||(o[d]={}),o[d][i]=b,f<1&&console.log(`[FEASIBLE-COMPOSE-FROM] Resource-allocated ${d} â ${i}: ${l} â ${b.toFixed(1)} units`)})}),console.log(`[FEASIBLE-COMPOSE-FROM] Generated resource-allocated feasible compositions for ${Object.keys(o).length} capacities`),o}),rh=oe([Ve,yr,ze,Ue],([e,t,n,r])=>{console.log("[FEASIBLE-COMPOSE-INTO] Calculating feasible compose-into with absolute units and resource allocation...");const o={};Object.entries(e).forEach(([u,c])=>{const a={};Object.entries(c).forEach(([f,d])=>{var p;const l=Object.keys(n).find(h=>n[h]&&n[h][f]);if(!l){console.warn(`[FEASIBLE-COMPOSE-INTO] No provider found for capacity: ${f}`);return}const b=r==null?void 0:r[u];if(!b){console.warn(`[FEASIBLE-COMPOSE-INTO] Our capacity not found: ${u}`);return}const g=((p=t[l])==null?void 0:p[u])||0,y=(b.quantity||0)*g,w=Math.min(d,y);w>0&&(a[f]=w,w<d&&console.log(`[FEASIBLE-COMPOSE-INTO] Share-constrained ${u} â ${f}: desired ${d} â ${w} units (limited by ${(g*100).toFixed(1)}% recipient share = ${y} max units)`))}),Object.keys(a).length>0&&(o[u]=a)});const i={};Object.entries(o).forEach(([u,c])=>{Object.entries(c).forEach(([a,f])=>{if(!i[u]){const d=r==null?void 0:r[u],l=(d==null?void 0:d.quantity)||0;i[u]={totalDemand:0,available:l,recipients:[]}}i[u].totalDemand+=f,i[u].recipients.push({theirCapacityId:a,desiredUnits:f})})});const s={};return Object.entries(i).forEach(([u,c])=>{const{totalDemand:a,available:f,recipients:d}=c;let l=1;a>f&&(l=f/a,console.log(`[FEASIBLE-COMPOSE-INTO] Resource allocation scaling for our ${u}: ${a} demanded > ${f} available, scaling by ${l.toFixed(3)}`)),d.forEach(({theirCapacityId:b,desiredUnits:g})=>{const S=g*l;s[u]||(s[u]={}),s[u][b]=S,l<1&&console.log(`[FEASIBLE-COMPOSE-INTO] Resource-allocated ${u} â ${b}: ${g} â ${S.toFixed(1)} units`)})}),console.log(`[FEASIBLE-COMPOSE-INTO] Generated resource-allocated feasible compositions for ${Object.keys(s).length} capacities`),s});function pn(e,t){return e===0||t===0?0:Math.min(e,t)/Math.max(e,t)}const oh=oe([qe,Je,ji],([e,t,n])=>{if(console.log("[MUTUAL-DESIRE-OURS] Calculating mutual desires for our capacities..."),!e||!t)return console.log("[MUTUAL-DESIRE-OURS] No composition data available"),{};const r={};return Object.entries(e).forEach(([o,i])=>{Object.entries(i).forEach(([s,u])=>{var b,g;const c=n[s],a=c==null?void 0:c.provider_id;if(!a){console.warn(`[MUTUAL-DESIRE-OURS] No provider found for capacity: ${s}`);return}const f=(g=(b=t[a])==null?void 0:b[s])==null?void 0:g[o];if(!f)return;const d=pn(u,f),l=`${o}:${s}:${a}`;r[l]={ourCapacityId:o,theirCapacityId:s,ourDesiredAmount:u,theirDesiredAmount:f,providerId:a,desireViability:d},console.log(`[MUTUAL-DESIRE-OURS] Found mutual desire: ${l} (desire viability: ${d.toFixed(2)})`)})}),console.log(`[MUTUAL-DESIRE-OURS] Found ${Object.keys(r).length} mutual desires for our capacities`),r}),ih=oe([Ve,Ke,ze],([e,t,n])=>{if(console.log("[MUTUAL-DESIRE-THEIRS] Calculating mutual desires for their capacities..."),!e||!t)return console.log("[MUTUAL-DESIRE-THEIRS] No composition data available"),{};const r={};return Object.entries(e).forEach(([o,i])=>{Object.entries(i).forEach(([s,u])=>{var l,b;const c=Object.keys(n).find(g=>n[g]&&n[g][s]);if(!c){console.warn(`[MUTUAL-DESIRE-THEIRS] No provider found for capacity: ${s}`);return}const a=(b=(l=t[c])==null?void 0:l[s])==null?void 0:b[o];if(!a)return;const f=pn(u,a),d=`${o}:${s}:${c}`;r[d]={ourCapacityId:o,theirCapacityId:s,ourDesiredAmount:u,theirDesiredAmount:a,providerId:c,desireViability:f},console.log(`[MUTUAL-DESIRE-THEIRS] Found mutual desire: ${d} (desire viability: ${f.toFixed(2)})`)})}),console.log(`[MUTUAL-DESIRE-THEIRS] Found ${Object.keys(r).length} mutual desires for their capacities`),r}),Cv=oe([oh,nh],([e,t])=>{console.log("[MUTUAL-FEASIBLE-OURS] Calculating feasible mutual enhancements of our capacities...");const n={};return Object.entries(e).forEach(([r,o])=>{var c;const{ourCapacityId:i,theirCapacityId:s}=o,u=((c=t[i])==null?void 0:c[s])||0;if(u>0){const a=pn(u,o.theirDesiredAmount),f=u/o.ourDesiredAmount;n[r]={...o,ourFeasibleAmount:u,feasibleViability:a,constraintRatio:f},console.log(`[MUTUAL-FEASIBLE-OURS] ${r}: desired ${o.ourDesiredAmount.toFixed(3)} â feasible ${u.toFixed(3)} (${(f*100).toFixed(1)}% achievable)`)}}),console.log(`[MUTUAL-FEASIBLE-OURS] Found ${Object.keys(n).length} feasible mutual enhancements of our capacities`),n}),Nv=oe([ih,rh],([e,t])=>{console.log("[MUTUAL-FEASIBLE-THEIRS] Calculating feasible mutual enhancements of their capacities...");const n={};return Object.entries(e).forEach(([r,o])=>{var c;const{ourCapacityId:i,theirCapacityId:s}=o,u=((c=t[i])==null?void 0:c[s])||0;if(u>0){const a=pn(u,o.theirDesiredAmount),f=u/o.ourDesiredAmount;n[r]={...o,ourFeasibleAmount:u,feasibleViability:a,constraintRatio:f},console.log(`[MUTUAL-FEASIBLE-THEIRS] ${r}: desired ${o.ourDesiredAmount.toFixed(3)} â feasible ${u.toFixed(3)} (${(f*100).toFixed(1)}% achievable)`)}}),console.log(`[MUTUAL-FEASIBLE-THEIRS] Found ${Object.keys(n).length} feasible mutual enhancements of their capacities`),n});function sh(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const o of n)if(!(o in t)||Math.abs(e[o]-t[o])>1e-10)return!1;return!0}function ko(e,t){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();for(let o=0;o<n.length;o++)if(n[o]!==r[o])return!1;return!0}function Qt(){console.log("[RECALC] Starting tree recalculation...");const e=W(ee);if(!e){console.error("[RECALC] Tree is missing, cannot proceed with recalculation");return}console.log("[RECALC] Processing tree with",e.children.length,"children");try{Kn.set(!0);try{console.log("[RECALC] Collecting contributors from tree...");const t=xa(e),n=W(wt);!ko(n,t)?(console.log("[RECALC] Contributors have changed, updating store"),wt.set(t),console.log("[RECALC] Found",t.length,"contributors")):console.log("[RECALC] Contributors unchanged, skipping update");const o=W($n),i=[...new Set([...o,...t])];!ko(o,i)?(console.log("[RECALC] All known contributors have changed, updating store"),$n.set(i),console.log("[RECALC] Total known contributors:",i.length)):console.log("[RECALC] All known contributors unchanged, skipping update")}catch(t){console.error("[RECALC] Error collecting contributors:",t)}try{console.log("[RECALC] Calculating SOGF...");const t=W($n),n=W(Di),r=Oa(e,n,t),o=W(yt);!o||!sh(o,r)?(console.log("[RECALC] SOGF has changed, updating stores and recognition cache"),yt.set(r),t.forEach(s=>{const u=r[s]||0,c=W(Ae)[s],a=(c==null?void 0:c.theirShare)||0;console.log(`[RECALC] Updating recognition for ${s}: ourShare=${u.toFixed(4)}, theirShare=${a.toFixed(4)}`),Ae.update(f=>{const d=f[s];return f[s]={ourShare:u,theirShare:a,timestamp:Date.now()},console.log(`[MUTUAL] Cache entry for ${s}:`,{old:d,new:f[s]}),f})}),console.log("[RECALC] SOGF calculation complete for",t.length,"known contributors")):console.log("[RECALC] SOGF unchanged, skipping update")}catch(t){console.error("[RECALC] Error calculating SOGF:",t)}console.log("[RECALC] Tree recalculation process complete")}finally{Kn.set(!1)}}function ah(e){if(!e||typeof e!="object"||Array.isArray(e))return e;const t={};for(const[n,r]of Object.entries(e))n.startsWith("_")||(t[n]=r);return t}function uh(e){try{let t;if(typeof e=="string")try{t=JSON.parse(e)}catch(r){return console.error("Error parsing tree data JSON:",r),null}else t=e;const n=Ni.safeParse(t);return n.success?n.data:(console.error("Tree data validation failed:",n.error),null)}catch(t){return console.error("Error parsing tree data:",t),null}}function Zi(e){try{let t;if(typeof e=="string")try{t=JSON.parse(e)}catch(r){return console.error("[VALIDATION] Error parsing capacities data JSON:",r),{}}else t=e;t=ah(t),console.log("[VALIDATION] Pre-validation capacities data:",t);const n=Fl.safeParse(t);if(n.success){let r=function(i,s,u=[]){const c={};return typeof i!=typeof s?(c[u.join(".")]={original:i,validated:s},c):(typeof i=="object"&&i!==null?Object.keys({...i,...s}).forEach(a=>{const f=r(i[a],s[a],[...u,a]);Object.assign(c,f)}):i!==s&&(c[u.join(".")]={original:i,validated:s}),c)};console.log("[VALIDATION] Capacities validation successful");const o=r(t,n.data);return Object.keys(o).length>0?console.log("[VALIDATION] Validation made the following changes:",o):console.log("[VALIDATION] Validation made no changes to data"),console.log("[VALIDATION] Validated Capacities data:",n.data),n.data}else return console.error("[VALIDATION] Capacities validation failed. Data:",t),console.error("[VALIDATION] Validation errors:",n.error.issues),console.error("[VALIDATION] Validation error paths:",n.error.issues.map(r=>r.path)),{}}catch(t){return console.error("[VALIDATION] Error during capacities validation:",t),{}}}function ch(){var t;if(!((t=L.is)==null?void 0:t.pub)){console.log("[NETWORK] Cannot subscribe to own tree - not authenticated");return}console.log("[NETWORK] Setting up subscription to own tree data"),L.get("tree").on(n=>{if(!n){console.log("[NETWORK] No tree data in subscription, skipping");return}console.log("[NETWORK] Received tree update from network"),Re.set(!0);const r=uh(n);if(!r){console.log("[NETWORK] Failed to parse incoming tree data"),Re.set(!1);return}const o=W(ee);if(!o){console.log("[NETWORK] No current tree, updating with network data"),ee.set(r),Re.set(!1),Qt();return}const i=JSON.stringify(o),s=JSON.stringify(r);if(i===s){console.log("[NETWORK] Incoming tree matches current tree, ignoring update"),Re.set(!1);return}console.log("[NETWORK] Tree data changed, updating local store"),console.log("[NETWORK] Current tree children count:",o.children.length),console.log("[NETWORK] Incoming tree children count:",r.children.length),ee.set(r),Re.set(!1),Qt()})}function fh(){var t;if(!((t=L.is)==null?void 0:t.pub)){console.log("[NETWORK] Cannot subscribe to own capacities - not authenticated");return}console.log("[NETWORK] Setting up subscription to own capacities data"),L.get("capacities").on(n=>{if(!n){console.log("[NETWORK] No capacities data found"),Ne.set(!1);return}console.log("[NETWORK] Received capacities update from network"),Ne.set(!0);const r=Zi(n);if(!r){console.error("[NETWORK] Failed to validate own capacities data"),Ne.set(!1);return}const o=W(Ue);if(o&&JSON.stringify(o)===JSON.stringify(r)){console.log("[NETWORK] Incoming capacities match current capacities, ignoring update"),Ne.set(!1);return}console.log("[NETWORK] Capacities data changed, updating local store"),console.log("[NETWORK] Loaded capacities count:",Object.keys(r).length),Ue.set(r),Ne.set(!1)})}function lh(){var t;if(!((t=L.is)==null?void 0:t.pub)){console.log("[NETWORK] Cannot subscribe to own desired compose-from - not authenticated");return}console.log("[NETWORK] Setting up subscription to own desired compose-from data"),L.get("desiredComposeFrom").on(n=>{if(!n){console.log("[NETWORK] No desired compose-from data found");return}console.log("[NETWORK] Received desired compose-from update from network");try{let r;typeof n=="string"?r=JSON.parse(n):r=n;const o={};Object.entries(r).forEach(([s,u])=>{if(typeof u=="object"&&u!==null){const c={};Object.entries(u).forEach(([a,f])=>{typeof f=="number"&&f>=0&&(c[a]=f)}),Object.keys(c).length>0&&(o[s]=c)}});const i=W(qe);if(i&&JSON.stringify(i)===JSON.stringify(o)){console.log("[NETWORK] Incoming compose-from matches current compose-from, ignoring update");return}console.log("[NETWORK] Desired compose-from data changed, updating local store"),qe.set(o)}catch(r){console.error("[NETWORK] Error parsing own desired compose-from:",r)}})}function hh(){var t;if(!((t=L.is)==null?void 0:t.pub)){console.log("[NETWORK] Cannot subscribe to own desired compose-into - not authenticated");return}console.log("[NETWORK] Setting up subscription to own desired compose-into data"),L.get("desiredComposeInto").on(n=>{if(!n){console.log("[NETWORK] No desired compose-into data found");return}console.log("[NETWORK] Received desired compose-into update from network");try{let r;typeof n=="string"?r=JSON.parse(n):r=n;const o={};Object.entries(r).forEach(([s,u])=>{if(typeof u=="object"&&u!==null){const c={};Object.entries(u).forEach(([a,f])=>{typeof f=="number"&&f>=0&&(c[a]=f)}),Object.keys(c).length>0&&(o[s]=c)}});const i=W(Ve);if(i&&JSON.stringify(i)===JSON.stringify(o)){console.log("[NETWORK] Incoming compose-into matches current compose-into, ignoring update");return}console.log("[NETWORK] Desired compose-into data changed, updating local store"),Ve.set(o)}catch(r){console.error("[NETWORK] Error parsing own desired compose-into:",r)}})}function dh(){if(typeof window>"u")return;console.log("[USERS] Setting up centralized usersList subscription");const e=new Map;de.map().on((t,n)=>{if(console.log(`[USERS] User update: ${n}`,t),!n||n==="_")return;if(t==null)console.log(`[USERS] User removed: ${n}`),e.delete(n),dt.update(o=>{const{[n]:i,...s}=o;return s});else{e.set(n,t);const o=t.name;o&&typeof o=="string"?dt.update(i=>({...i,[n]:o})):ce.get(`~${n}`).get("alias").once(i=>{i&&typeof i=="string"&&(console.log(`[USERS] Got alias from protected space for ${n}: ${i}`),dt.update(s=>({...s,[n]:i})))})}const r=Array.from(e.keys());wh.set(r)})}function en(){var e;if(!((e=L.is)!=null&&e.pub)){console.log("[NETWORK] Cannot initialize subscriptions - not authenticated");return}console.log("[NETWORK] Initializing all user data subscriptions"),dh(),ch(),fh(),lh(),hh()}function ph(e,t){console.log(`[NETWORK] Received share from ${e}: ${t.toFixed(4)}`);const r=W(Ae)[e];console.log(`[NETWORK] Existing cache entry for ${e}:`,r),Ae.update(i=>(r?(console.log(`[NETWORK] Updating existing entry for ${e}`),i[e]={...i[e],theirShare:t,timestamp:Date.now()}):(console.log(`[NETWORK] Creating new entry for ${e} with ourShare=0`),i[e]={ourShare:0,theirShare:t,timestamp:Date.now()}),console.log(`[NETWORK] Updated cache entry for ${e}:`,i[e]),i));const o=W(Ae);console.log(`[NETWORK] Cache after network update from ${e}:`,o)}function Fi(e){console.log(`[NETWORK] Setting up subscription to ${e}'s SOGF`),ce.get(`~${e}`).get("sogf").on(n=>{var c;if(!n)return;console.log(`[NETWORK] Received SOGF update from ${e}`);const r=(c=L.is)==null?void 0:c.pub;if(!r)return;const o=n[r]||0,s=W(Ae)[e];if(s&&s.theirShare===o){console.log(`[NETWORK] Ignoring duplicate SOGF update from contributor ${e}: share=${o}`);return}ph(e,o)})}function gh(e){console.log(`[NETWORK] Setting up subscription to ${e}'s capacities`),ce.get(`~${e}`).get("capacities").on(n=>{var u;if(!n||(console.log(`[NETWORK] Received capacities update from ${e}:`,n),!((u=L.is)==null?void 0:u.pub)))return;const o=Zi(n);if(!o||Object.keys(o).length===0){console.error("[NETWORK] Failed to validate capacities from contributor:",e);return}const i=W(ze)[e]||{};if(JSON.stringify(o)===JSON.stringify(i)){console.log(`[NETWORK] Ignoring duplicate capacities update for contributor ${e}`);return}ze.update(c=>{const a={...c};return a[e]=o,console.log(`[NETWORK] Updated networkCapacities for ${e}: added ${Object.keys(o).length} capacities`),a})})}function vh(e){var n;const t=(n=L.is)==null?void 0:n.pub;if(!t){console.log("[NETWORK] Cannot subscribe to capacity shares - not authenticated");return}console.log(`[NETWORK] Setting up capacity shares subscription for contributor: ${e}`),ce.get(`~${e}`).get("capacityShares").get(t).on(r=>{if(!r){console.log(`[NETWORK] No capacity shares from contributor ${e}`),Be.update(o=>{const{[e]:i,...s}=o;return s});return}try{let o;typeof r=="string"?o=JSON.parse(r):o=r;const i={};Object.entries(o).forEach(([c,a])=>{typeof a=="number"&&a>=0&&a<=1?i[c]=a:console.warn(`[NETWORK] Invalid share value for capacity ${c}:`,a)});const s=W(Be)[e]||{};if(JSON.stringify(i)===JSON.stringify(s)){console.log(`[NETWORK] Ignoring duplicate update for contributor ${e}`);return}console.log(`[NETWORK] Received new capacity shares from contributor ${e}:`,i),Be.update(c=>({...c,[e]:i}))}catch(o){console.error(`[NETWORK] Error parsing/validating capacity shares from contributor ${e}:`,o)}})}function mh(e){console.log(`[NETWORK] Setting up subscription to ${e}'s desired compose-from`),ce.get(`~${e}`).get("desiredComposeFrom").on(n=>{if(!n){console.log(`[NETWORK] No desired compositions from contributor ${e}`),Ke.update(r=>{const{[e]:o,...i}=r;return i});return}console.log(`[NETWORK] Received desired compositions update from ${e}:`,n);try{let r;typeof n=="string"?r=JSON.parse(n):r=n;const o={};Object.entries(r).forEach(([u,c])=>{if(typeof c=="object"&&c!==null){const a={};Object.entries(c).forEach(([f,d])=>{typeof d=="number"&&d>=0&&(a[f]=d)}),Object.keys(a).length>0&&(o[u]=a)}});const i=W(Ke)[e]||{};if(JSON.stringify(o)===JSON.stringify(i)){console.log(`[NETWORK] Ignoring duplicate desired compositions update for contributor ${e}`);return}Ke.update(u=>({...u,[e]:o})),console.log(`[NETWORK] Updated desired compositions for ${e}: ${Object.keys(o).length} capacities with composition desires`)}catch(r){console.error(`[NETWORK] Error parsing/validating desired compositions from contributor ${e}:`,r)}})}function yh(e){console.log(`[NETWORK] Setting up subscription to ${e}'s desired compose-into`),ce.get(`~${e}`).get("desiredComposeInto").on(n=>{if(!n){console.log(`[NETWORK] No desired compose-into from contributor ${e}`),Je.update(r=>{const{[e]:o,...i}=r;return i});return}console.log(`[NETWORK] Received desired compose-into update from ${e}:`,n);try{let r;typeof n=="string"?r=JSON.parse(n):r=n;const o={};Object.entries(r).forEach(([u,c])=>{if(typeof c=="object"&&c!==null){const a={};Object.entries(c).forEach(([f,d])=>{typeof d=="number"&&d>=0&&(a[f]=d)}),Object.keys(a).length>0&&(o[u]=a)}});const i=W(Je)[e]||{};if(JSON.stringify(o)===JSON.stringify(i)){console.log(`[NETWORK] Ignoring duplicate desired compose-into update for contributor ${e}`);return}Je.update(u=>({...u,[e]:o})),console.log(`[NETWORK] Updated desired compose-into for ${e}: ${Object.keys(o).length} capacities with compose-into desires`)}catch(r){console.error(`[NETWORK] Error parsing/validating desired compose-into from contributor ${e}:`,r)}})}wt.subscribe(e=>{var t;if(!e.length){console.log("[NETWORK] No contributors to subscribe to");return}if(!((t=L.is)!=null&&t.pub)){console.log("[NETWORK] Cannot subscribe to contributors - not authenticated");return}console.log(`[NETWORK] Contributors changed, now have ${e.length}, setting up subscriptions`),e.forEach(n=>{try{console.log(`[NETWORK] Setting up subscription for contributor: ${n}`),Fi(n)}catch(r){console.error(`[NETWORK] Error subscribing to contributor ${n}:`,r)}})});Ii.subscribe(e=>{var t;if(!e.length){ze.set({}),Be.set({}),Ke.set({}),Je.set({});return}if(!((t=L.is)!=null&&t.pub)){console.log("[NETWORK] Cannot subscribe to mutual contributors - not authenticated");return}console.log(`[NETWORK] Mutual contributors changed, now have ${e.length}, setting up subscriptions`),ze.update(n=>{if(!n)return{};const r={};return Object.entries(n).forEach(([o,i])=>{e.includes(o)&&(r[o]=i)}),console.log(`[NETWORK] Cleaned network capacities: kept ${Object.keys(r).length} contributors from ${Object.keys(n).length} total`),r}),Be.update(n=>{const r={};return Object.entries(n).forEach(([o,i])=>{e.includes(o)&&(r[o]=i)}),console.log(`[NETWORK] Cleaned capacity shares: kept ${Object.keys(r).length} contributors from ${Object.keys(n).length} total`),r}),Ke.update(n=>{const r={};return Object.entries(n).forEach(([o,i])=>{e.includes(o)&&(r[o]=i)}),console.log(`[NETWORK] Cleaned desired compositions: kept ${Object.keys(r).length} contributors from ${Object.keys(n).length} total`),r}),Je.update(n=>{const r={};return Object.entries(n).forEach(([o,i])=>{e.includes(o)&&(r[o]=i)}),console.log(`[NETWORK] Cleaned desired compose-into: kept ${Object.keys(r).length} contributors from ${Object.keys(n).length} total`),r}),e.forEach(n=>{try{console.log(`[NETWORK] Setting up subscriptions for mutual contributor: ${n}`),gh(n),vh(n),mh(n),yh(n)}catch(r){console.error(`[NETWORK] Error subscribing to mutual contributor ${n}:`,r)}})});function Jn(e){z(e,"space","Space & Environment",25);const t=e.children.find(l=>l.id==="space");z(t,"indoorSpace","Indoor/Outdoor Space",15),z(t,"seating","Comfortable Seating",15),z(t,"lighting","Lighting",12),z(t,"temperature","Temperature Control",12),z(t,"bathroom","Bathroom Access",12),z(t,"waterAccess","Water Access",12),z(t,"cleaning","Cleaning Supplies",11),z(t,"waste","Trash/Recycling",11);const n=t.children.find(l=>l.id==="indoorSpace");z(n,"hosts","Space Providers/Hosts",14),z(n,"infrastructure","Infra(de)structure & Bottom-secret Spaces",25);const r=n.children.find(l=>l.id==="infrastructure");z(e,"subverse","Subverse ð",25);const o=e.children.find(l=>l.id==="subverse");z(o,"magicalTech","Magical Technologies & Systems",25),z(o,"substances","Transformative Substances",20),z(o,"realityHacking","Reality Hacking & Manifestation",20),z(o,"loreSystem","Lore & Knowledge Systems",10);const i=o.children.find(l=>l.id==="magicalTech"),s=o.children.find(l=>l.id==="substances"),u=o.children.find(l=>l.id==="realityHacking"),c=o.children.find(l=>l.id==="loreSystem");z(e,"money","ð¸",10),z(e,"freeAssociation","Free Association",10),z(e,"automation","Automation of Useful & Repetitive Tasks",10),z(e,"commons","Socialization of Land & Means of Production",10),z(e,"property","Maintaining Personal Property Relations",10);const a=e.children.find(l=>l.id==="money"),f=e.children.find(l=>l.id==="freeAssociation"),d=e.children.find(l=>l.id==="property");return z(d,"securingLaptop","Securing my Laptop",10),z(d,"securingBackpack","Securing my Backpack",10),z(a,"openCollective","Playnet Open Collective",10),z(a,"personalDonations","Personal Donations",10),z(f,"development","Development",10),z(f,"communications","Communications",10),z(r,"secretStairs","Secret stairways",10),z(r,"wellsTunnels","Wells & tunnels",8),z(r,"basements","Basements",7),z(r,"subLakes","Subterranean lakes",6),z(r,"alleysRoots","Alleys & Roots",9),z(r,"trapDoors","Trap-doors",8),z(r,"warpZones","Warp zones",7),z(r,"driveIns","Liberation Drive-ins",8),z(r,"trainYards","Train-yards",7),z(r,"fleaMarkets","Flea Markets",6),z(r,"roofs","Roofs",5),z(r,"ufoLanding","*ufo* Landing Pads",5),z(i,"cloudBusting","Cloud Busting",9),z(i,"cameraAbatement","Camera Abatement",8),z(i,"systemOfframp","System (off/out)-ramp Drive-thrus",7),z(i,"bioSlimes","Bioluminescent Slimes",8),z(i,"butterflyWings","Butterfly-wing-iridescence Materiality",8),z(i,"eventHorizons","Event Horizons & Vanishing Points",7),z(i,"libraryStacks","Library Stacks",8),z(i,"saunaLore","Pagan Sauna Lore",7),z(i,"ritualSpaces","Ritual Spaces",6),z(i,"candyWisdom","Candy Store Wisdom",6),z(s,"pixieDust","Pixie Dust & Silly Powders",9),z(s,"oozeSlimes","Oozes & slimes",8),z(s,"potionsBalms","Potions & Balms",7),z(s,"veganWaters","Vegan & Non-vegan Waters",8),z(s,"mistsSprays","Mists & Sprays",7),z(s,"lozengesBonbons","Lozenges & Bonbons",6),z(s,"pheromones","Pheromonal Inflection Points",8),z(s,"darkMatter","Dark Matter Manipulation",7),z(s,"globulation","Nebulatory Coagular Globulation",6),z(u,"trueFakes","TrueFakes & FakeUntruths",9),z(u,"memeDrives","MemeDrives & GeneEngines",8),z(u,"cosmicBabble","Cosmic Psychobabble",7),z(u,"dimPortals","Interdimensional portals",8),z(u,"infinityPools","Infinity Pools",7),z(u,"deprivationTanks","Sensory Deprivation Tankage",6),z(u,"girlMath","GirlMath",8),z(u,"moonMath","Moonlight Mathematicians",7),z(u,"angelicNums","Angelic Numbers",6),z(c,"comicBooks","Comic Books & Stories",8),z(c,"poemsAndMaps","Poems & Maps",7),z(c,"priestesses","Interdimensional Priestesses",8),z(c,"crimeLords","Alien Crime Lords",7),z(c,"ballerinas","Sci-fi Ballerinas",6),console.log("Populated root node with example data:",e),e}typeof window<"u"&&(window.populateWithExampleData=Jn,window.populateCurrentTreeWithExampleData=()=>{const e=W(ee);if(!e)return console.error("[DEBUG] No userTree available to populate with example data"),null;console.log("[DEBUG] Populating current userTree with example data");const t=Jn(e);return ee.set(t),t},console.log("[DEBUG] populateWithExampleData and populateCurrentTreeWithExampleData functions exposed to window"));typeof Yt.SEA>"u"&&(Yt.SEA=ql);const Rv=Yt,ce=new Yt({peers:["https://gun-manhattan.herokuapp.com/gun","https://peer.wallie.io/gun","https://gun.defucc.me/gun"],localStorage:!1}),tn=H(!0);let L;typeof window<"u"?L=ce.user().recall({sessionStorage:!0}):L={_:{sea:null},is:null};const Se=H(""),ye=H(""),de=ce.get("freely-associating-players"),dt=H({}),wh=H([]);async function jv(e){const t=W(dt);if(t[e])return t[e];try{const r=ce.get(`~${e}`).get("alias").once(o=>o);if(r&&typeof r=="string")return dt.update(o=>({...o,[e]:r})),r}catch(r){console.log(`[USER-NAME] Could not fetch alias for user ${e}:`,r)}return e.substring(0,8)+"..."}typeof window<"u"&&(async()=>{var t,n,r;try{if(tn.set(!0),await new Promise(o=>setTimeout(o,100)),L._.sea&&((t=L.is)!=null&&t.alias)){console.log("[RECALL] User authenticated via SEA check:",L.is.alias),L.get("alias").once(o=>{L.get("pub").once(i=>{const s=o||L.is.alias,u=i||L.is.pub;console.log("[RECALL] Using alias from storage:",s),console.log("[RECALL] Using pub from storage:",(u==null?void 0:u.slice(0,20))+"..."),Se.set(s),ye.set(u),de.get(u).put({name:s,lastSeen:Date.now()})})}),en();return}(n=L==null?void 0:L.is)!=null&&n.pub&&((r=L.is)!=null&&r.alias)?(console.log("[RECALL] User authenticated via pub check:",L.is.alias),L.get("alias").once(o=>{L.get("pub").once(i=>{const s=o||L.is.alias,u=i||L.is.pub;console.log("[RECALL] Using alias from storage (pub fallback):",s),console.log("[RECALL] Using pub from storage (pub fallback):",(u==null?void 0:u.slice(0,20))+"..."),Se.set(s),ye.set(u),de.get(u).put({name:s,lastSeen:Date.now()})})}),en()):(console.log("[RECALL] No authenticated user found after recall"),Se.set(""),ye.set(""))}catch(o){console.error("[RECALL] Error during authentication check:",o),Se.set(""),ye.set("")}finally{tn.set(!1)}})();ce.on("auth",async()=>{try{if(tn.set(!0),L._.sea){console.log("[AUTH] User authenticated via SEA check:",L.is.alias),L.get("alias").once(e=>{L.get("pub").once(t=>{const n=e||L.is.alias,r=t||L.is.pub;console.log("[AUTH] Using alias from storage:",n),console.log("[AUTH] Using pub from storage:",(r==null?void 0:r.slice(0,20))+"..."),Se.set(n),ye.set(r),de.get(r).put({name:n,lastSeen:Date.now()}),console.log(`signed in as ${n}`),console.log(`userPub: ${r}`),en()})});return}if(L.is.alias){console.log("[AUTH] User authenticated via alias check:",L.is.alias),L.get("alias").once(e=>{L.get("pub").once(t=>{const n=e||L.is.alias,r=t||L.is.pub;console.log("[AUTH] Using alias from storage (fallback):",n),console.log("[AUTH] Using pub from storage (fallback):",(r==null?void 0:r.slice(0,20))+"..."),Se.set(n),ye.set(r),de.get(r).put({name:n,lastSeen:Date.now()}),console.log(`signed in as ${n} (fallback)`),console.log(`userPub: ${r} (fallback)`),en()})});return}else throw new Error("Authentication failed - no alias found")}catch(e){console.error("[AUTH] Error during authentication:",e),Se.set(""),ye.set("")}finally{tn.set(!1)}});function bh(e,t){L.auth(e,t,({err:n})=>n&&alert(n))}function Dv(e,t){ce.get(`~@${e}`).once(n=>{if(n){console.log("[SIGNUP] checking alias user data",n),alert("Username already taken");return}L.create(e,t,({err:r})=>{r?alert(r):bh(e,t)})},{wait:2e3})}async function Iv(){for(L.leave();L._.sea!=null;)await new Promise(requestAnimationFrame);Se.set(""),ye.set("")}function gn(){if(W(Re)){console.log("[PERSIST] Skipping tree persistence because tree is being loaded");return}const e=W(ee);if(e){console.log("[PERSIST] Starting tree persistence..."),console.log("[PERSIST] Tree structure before serialization:",{id:e.id,childCount:e.children.length});const t=JSON.stringify(structuredClone(e));console.log("[PERSIST] Serialized tree length:",t.length),console.log("[PERSIST] Tree JSON preview:",t.substring(0,100)+"..."),L.get("tree").put(t,n=>{n.err?console.error("[PERSIST] Error saving tree to Gun:",n.err):console.log("[PERSIST] Tree successfully saved to Gun")})}}function _h(){if(W(Bl)){console.log("[PERSIST] Skipping SOGF persistence because SOGF is being loaded");return}const e=W(yt);e&&L.get("sogf").put(structuredClone(e))}function Sh(){if(W(Ne)){console.log("[PERSIST] Skipping capacities persistence because capacities are being loaded");return}const e=W(Ue);if(e){console.log("[PERSIST] Starting capacities persistence..."),console.log("[PERSIST] Capacities count:",Object.keys(e).length);try{const t=structuredClone(e);console.log("[PERSIST] Saving capacities:",t);const n=JSON.stringify(t);console.log("[PERSIST] Serialized capacities length:",n.length),L.get("capacities").put(n,r=>{r.err?console.error("[PERSIST] Error saving capacities to Gun:",r.err):console.log("[PERSIST] Capacities successfully saved to Gun")})}catch(t){console.error("[PERSIST] Error serializing capacities:",t)}}}function kh(){var n;if(!((n=L.is)==null?void 0:n.pub)){console.log("[PERSIST] No user ID available, cannot persist contributor capacity shares");return}const t=W(yr);Object.entries(t).forEach(([r,o])=>{L.get("capacityShares").get(r).put(JSON.stringify(o),i=>{i.err&&console.error(`[PERSIST] Error persisting capacity shares for contributor ${r}:`,i.err)})})}function Eh(){const e=W(qe);if(!e||Object.keys(e).length===0){console.log("[PERSIST] No user desired compose-from data to persist");return}console.log("[PERSIST] Starting user desired compose-from persistence..."),console.log("[PERSIST] User desired compose-from:",e);try{const t=structuredClone(e),n=JSON.stringify(t);console.log("[PERSIST] Serialized user desired compose-from length:",n.length),L.get("desiredComposeFrom").put(n,r=>{r.err?console.error("[PERSIST] Error saving user desired compose-from to Gun:",r.err):console.log("[PERSIST] User desired compose-from successfully saved to Gun")})}catch(t){console.error("[PERSIST] Error serializing user desired compose-from:",t)}}function Th(){const e=W(Ve);if(!e||Object.keys(e).length===0){console.log("[PERSIST] No user desired compose-into data to persist");return}console.log("[PERSIST] Starting user desired compose-into persistence..."),console.log("[PERSIST] User desired compose-into:",e);try{const t=structuredClone(e),n=JSON.stringify(t);console.log("[PERSIST] Serialized user desired compose-into length:",n.length),L.get("desiredComposeInto").put(n,r=>{r.err?console.error("[PERSIST] Error saving user desired compose-into to Gun:",r.err):console.log("[PERSIST] User desired compose-into successfully saved to Gun")})}catch(t){console.error("[PERSIST] Error serializing user desired compose-into:",t)}}function Ah(e){const t=/^(\d+)(s|m|h|d|w|mo)$/i,n=e.match(t);if(!n)throw new Error(`Invalid duration format: '${e}'`);const r=parseInt(n[1],10),o=n[2].toLowerCase(),i={s:1e3,m:60*1e3,h:60*60*1e3,d:24*60*60*1e3,w:7*24*60*60*1e3,mo:30*24*60*60*1e3};return r*i[o]}function xh(e="30m"){let t;try{t=Ah(e)}catch(r){console.error(`[PRUNE] ${r}`);return}console.log(`[PRUNE] Starting to prune users inactive for more than ${e}...`);const n=Date.now()-t;de.once(r=>{if(r){const o=Object.keys(r);console.log(`[PRUNE] Found ${o.length} users to check`);let i=0,s=0;o.forEach(u=>{de.get(u).once(c=>{if(s++,c&&c.lastSeen){const a=c.lastSeen;a<n?de.get(u).put(null,f=>{f.err?console.error(`[PRUNE] Error removing inactive user ${u}:`,f.err):(console.log(`[PRUNE] Removed inactive user ${u} (last seen: ${new Date(a).toLocaleString()})`),i++)}):console.log(`[PRUNE] User ${u} is active (last seen: ${new Date(a).toLocaleString()})`)}else console.log(`[PRUNE] User ${u} has no lastSeen data, removing...`),de.get(u).put(null,a=>{a.err?console.error(`[PRUNE] Error removing user without lastSeen ${u}:`,a.err):(console.log(`[PRUNE] Removed user without lastSeen data: ${u}`),i++)});s===o.length&&console.log(`[PRUNE] Pruning complete. Checked ${s} users, removed ${i} inactive users.`)})})}else console.log("[PRUNE] No users found to prune")})}function Oh(e){console.log(`[TREE-NAME] Changing tree name to: ${e}`);const t=W(ee);if(!t){console.error("[TREE-NAME] No tree found to rename");return}const n={...t,name:e};ee.set(n),gn(),console.log(`[TREE-NAME] Tree name changed to: ${e}`)}function $h(){console.log("[USERS-FIX] Starting to fix corrupted names in usersList..."),de.once(e=>{if(!e){console.log("[USERS-FIX] No users data found");return}const t=Object.keys(e).filter(o=>o!=="_");console.log(`[USERS-FIX] Found ${t.length} users to check for corrupted names`);let n=0,r=0;t.forEach(o=>{const i=e[o];if(!i||!i.name){console.log(`[USERS-FIX] User ${o} has no name data, skipping`),n++;return}i.name===o?(console.log(`[USERS-FIX] Found corrupted name for user ${o.substring(0,20)}... (name equals pubkey)`),ce.get(`~${o}`).get("alias").once(u=>{n++,u&&typeof u=="string"&&u!==o?(console.log(`[USERS-FIX] Fixing user ${o.substring(0,20)}... with correct alias: ${u}`),de.get(o).put({...i,name:u,lastSeen:Date.now(),fixed:!0},c=>{c.err?console.error(`[USERS-FIX] Error fixing user ${o}:`,c.err):(console.log(`[USERS-FIX] Successfully fixed user ${o} -> ${u}`),r++),n===t.length&&console.log(`[USERS-FIX] Completed fixing corrupted names. Checked ${n} users, fixed ${r} corrupted names.`)})):(console.log(`[USERS-FIX] Could not get valid alias for user ${o.substring(0,20)}..., keeping current name`),n===t.length&&console.log(`[USERS-FIX] Completed fixing corrupted names. Checked ${n} users, fixed ${r} corrupted names.`))})):(console.log(`[USERS-FIX] User ${o.substring(0,20)}... has valid name: ${i.name}`),n++,n===t.length&&console.log(`[USERS-FIX] Completed fixing corrupted names. Checked ${n} users, fixed ${r} corrupted names.`))}),t.length===0&&console.log("[USERS-FIX] No users to check")})}function Ch(e=!0){console.log("[TREE-CREATE] Creating new tree...");const t=W(ye),n=W(Se);if(!t||!n){console.error("[TREE-CREATE] Cannot create tree - user not authenticated");return}const r=Ca(t,n);return e&&(console.log("[TREE-CREATE] Populating new tree with example data"),Jn(r)),ee.set(r),gn(),console.log(`[TREE-CREATE] New tree created and set with ${r.children.length} child nodes`),Qt(),r}typeof window<"u"&&(window.clearUsersList=xh,window.changeTreeName=Oh,window.fixCorruptedUserListNames=$h,window.createNewTree=Ch,console.log("[DEBUG] clearUsersList, changeTreeName, fixCorruptedUserListNames, and createNewTree functions exposed to window"));ee.subscribe(e=>{if(e){let t=function(r){n[r.id]=r,r.children.forEach(t)};console.log("[TREE-SUB] Tree updated in store, rebuilding nodes map"),console.log("[TREE-SUB] Tree has",e.children.length,"children");const n={};t(e),Di.set(n),console.log("[TREE-SUB] Rebuilt nodes map with",Object.keys(n).length,"nodes"),console.log("[TREE-SUB] Forcing immediate tree persistence"),gn()}});yt.subscribe(e=>{if(e){console.log("[SOGF-SUB] SOGF updated"),console.log("[SOGF-SUB] SOGF contributor count:",Object.keys(e).length);try{_h()}catch(t){console.error("[SOGF-SUB] Error during persistence:",t)}}});let Ut=null;ee.subscribe(e=>{if(e){if(console.log("[TREE-RECALC-SUB] Tree updated, scheduling recalculation"),console.log("[TREE-RECALC-SUB] Tree has",e.children.length,"children"),W(Re)){console.log("[TREE-RECALC-SUB] Skipping recalculation because tree is being loaded");return}if(W(Kn)){console.log("[TREE-RECALC-SUB] Skipping recalculation because update is from recalculation");return}Ut&&(console.log("[TREE-RECALC-SUB] Clearing previous recalc timer"),clearTimeout(Ut)),console.log("[TREE-RECALC-SUB] Setting new recalc timer for 300ms"),Ut=setTimeout(()=>{console.log("[TREE-RECALC-SUB] Timer fired, running recalculation");try{Qt()}catch(t){console.error("[TREE-RECALC-SUB] Error during recalculation:",t),console.log("[TREE-RECALC-SUB] Forcing tree persistence after error"),gn()}Ut=null},300)}});Ue.subscribe(e=>{if(e)if(console.log("[CAPACITIES-SUB] Capacities updated"),console.log("[CAPACITIES-SUB] Capacities count:",Object.keys(e).length),W(Ne))console.log("[CAPACITIES-SUB] Skipping persistence because capacities are being loaded");else{console.log("[CAPACITIES-SUB] Persisting capacities");try{Sh()}catch(t){console.error("[CAPACITIES-SUB] Error during persistence:",t)}}});yr.subscribe(e=>{console.log("[CONTRIBUTOR-CAPACITY-SHARES-SUB] Contributor capacity shares updated"),console.log("[CONTRIBUTOR-CAPACITY-SHARES-SUB] Contributor capacity shares count:",Object.keys(e).length),kh()});qe.subscribe(e=>{console.log("[USER-COMPOSE-FROM-SUB] User desired compose-from updated"),console.log("[USER-COMPOSE-FROM-SUB] User desired compose-from capacities:",Object.keys(e).length);try{Eh()}catch(t){console.error("[USER-COMPOSE-FROM-SUB] Error during persistence:",t)}});Ve.subscribe(e=>{console.log("[USER-COMPOSE-INTO-SUB] User desired compose-into updated"),console.log("[USER-COMPOSE-INTO-SUB] User desired compose-into capacities:",Object.keys(e).length);try{Th()}catch(t){console.error("[USER-COMPOSE-INTO-SUB] Error during persistence:",t)}});function Nh(){console.log("=== RECOGNITION DEBUG STATE ===");const e=W(wt),t=W(Ii),n=W(Ae),r=W(mr),o=W(Pi),i=W(yt);console.log("Contributors:",e),console.log("Mutual Contributors:",t),console.log("User SOGF:",i),console.log("=== DETAILED RECOGNITION CACHE ==="),Object.entries(n).forEach(([s,u])=>{console.log(`${s}:`,{ourShare:u.ourShare,theirShare:u.theirShare,mutual:Math.min(u.ourShare,u.theirShare),timestamp:new Date(u.timestamp).toISOString()})}),console.log("Mutual Recognition:",r),console.log("Provider Shares:",o),console.log("=== END DEBUG ===")}function Rh(){console.log("[DEBUG] Manually triggering subscriptions for all contributors");const e=W(wt);e.forEach(t=>{console.log(`[DEBUG] Setting up subscription for: ${t}`),Fi(t)}),console.log(`[DEBUG] Set up ${e.length} subscriptions`)}typeof window<"u"&&(window.debugRecognition=Nh,window.debugTriggerSubscriptions=Rh);const me=H([]);{let e="";ye.subscribe(t=>{t&&t!==e?(me.set([t]),e=t,console.log("Initialized currentPath with user public key:",t)):!t&&e&&(me.set([]),e="")})}const M=Fs({deleteMode:!1,recomposeMode:!1,nodeToEdit:"",editMode:!1,recomposing:!1,editingNodeId:"",initializationStarted:!1,isDragging:!1,draggedNodeId:"",draggedNodeName:"",draggedNodeColor:"",dragX:0,dragY:0,navigateToPath:async e=>{if(M.editMode){console.log("Navigation blocked: currently in edit mode");return}console.log("Navigating to path",e),!(!e.length||!W(ee))&&me.set(e)},navigateToPathIndex:e=>{if(M.editMode){console.log("Navigation blocked: currently in edit mode");return}const t=W(me);e<0||e>=t.length||e!==t.length-1&&me.set(t.slice(0,e+1))},zoomInto:e=>{if(M.editMode){console.log("Navigation blocked: currently in edit mode");return}const t=W(me),n=W(ee);if(!n)return;const r=Ie(n,e);if(r){if(lt(r)){M.showToast("Cannot zoom into nodes with contributors","warning");return}me.set([...t,e])}},zoomOut:()=>{if(M.editMode){console.log("Navigation blocked: currently in edit mode");return}const e=W(me);e.length<=1||me.set(e.slice(0,-1))},resetState:()=>{ee.set(null),me.set([]),M.editMode=!1,M.editingNodeId="",M.nodeToEdit="",M.deleteMode=!1},toggleDeleteMode:()=>{if(M.editMode){M.showToast("Cannot toggle delete mode while editing","warning");return}if(M.recomposeMode){M.showToast("Cannot toggle delete mode while in recompose mode","warning");return}M.deleteMode=!M.deleteMode,M.showToast(M.deleteMode?"Delete mode activated. Click a node to delete it.":"Delete mode deactivated.",M.deleteMode?"warning":"info")},toggleRecomposeMode:()=>{if(M.editMode){M.showToast("Cannot toggle recompose mode while editing","warning");return}if(M.deleteMode){M.showToast("Cannot toggle recompose mode while in delete mode","warning");return}M.recomposeMode=!M.recomposeMode,M.showToast(M.recomposeMode?"Recompose mode activated. Click a node to recompose it.":"Recompose mode deactivated.",(M.recomposeMode,"info"))},setNodeToEditMode:e=>{M.nodeToEdit=e,setTimeout(()=>{M.nodeToEdit===e&&(M.nodeToEdit="")},1e3)},enterEditMode:e=>M.deleteMode?(M.showToast("Cannot edit nodes in delete mode","warning"),!1):M.recomposeMode?(M.showToast("Cannot edit nodes in recompose mode","warning"),!1):(M.editMode&&M.editingNodeId!==e&&M.exitEditMode(),M.editMode=!0,M.editingNodeId=e,console.log("[GLOBAL STATE] Entered edit mode for node:",e),!0),exitEditMode:()=>{M.editMode=!1,M.editingNodeId="",M.nodeToEdit="",console.log("[GLOBAL STATE] Exited edit mode")},showToast:(e,t="info")=>{switch(t){case"success":se.success(e);break;case"error":se.error(e);break;case"warning":se(e,{icon:"â ï¸",style:"border: 1px solid #f59e0b; background: #fef3c7; color: #92400e;"});break;case"info":default:se(e,{icon:"â¹ï¸"});break}},startDrag:(e,t,n,r,o)=>{M.isDragging=!0,M.draggedNodeId=e,M.draggedNodeName=t,M.draggedNodeColor=n,M.dragX=r,M.dragY=o},updateDragPosition:(e,t)=>{M.dragX=e,M.dragY=t},endDrag:()=>{M.isDragging=!1,M.draggedNodeId="",M.draggedNodeName="",M.draggedNodeColor="",M.dragX=0,M.dragY=0},handleNodeReorder:(e,t)=>{try{const n=W(ee);if(!n)return M.showToast("No tree available for reordering","error"),!1;if(e===t)return M.showToast("Cannot move node to itself","warning"),!1;const r=structuredClone(n);if(ii(r,e,t))return M.showToast("Cannot move node to its own descendant","warning"),!1;const o=Ie(r,e),i=Ie(r,t);return o?i?Ia(r,e,t)?(ee.set(r),M.showToast(`Moved "${o.name}" to "${i.name}"`,"success"),console.log(`[REORDER] Successfully moved ${o.name} to ${i.name}`),!0):(M.showToast("Failed to reorder node","error"),!1):(M.showToast("Target node not found","error"),!1):(M.showToast("Source node not found","error"),!1)}catch(n){return console.error("Error in reorder process:",n),M.showToast("Error reordering node","error"),!1}}});class Eo extends Map{constructor(t,n=Ih){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[r,o]of t)this.set(r,o)}get(t){return super.get(To(this,t))}has(t){return super.has(To(this,t))}set(t,n){return super.set(jh(this,t),n)}delete(t){return super.delete(Dh(this,t))}}function To({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):n}function jh({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):(e.set(r,n),n)}function Dh({_intern:e,_key:t},n){const r=t(n);return e.has(r)&&(n=e.get(r),e.delete(r)),n}function Ih(e){return e!==null&&typeof e=="object"?e.valueOf():e}var Ph={value:()=>{}};function Li(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Kt(n)}function Kt(e){this._=e}function Uh(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",o=n.indexOf(".");if(o>=0&&(r=n.slice(o+1),n=n.slice(0,o)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Kt.prototype=Li.prototype={constructor:Kt,on:function(e,t){var n=this._,r=Uh(e+"",n),o,i=-1,s=r.length;if(arguments.length<2){for(;++i<s;)if((o=(e=r[i]).type)&&(o=zh(n[o],e.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(o=(e=r[i]).type)n[o]=Ao(n[o],e.name,t);else if(t==null)for(o in n)n[o]=Ao(n[o],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Kt(e)},call:function(e,t){if((o=arguments.length-2)>0)for(var n=new Array(o),r=0,o,i;r<o;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,i=r.length;o<i;++o)r[o].value.apply(t,n)}};function zh(e,t){for(var n=0,r=e.length,o;n<r;++n)if((o=e[n]).name===t)return o.value}function Ao(e,t,n){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=Ph,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var Gn="http://www.w3.org/1999/xhtml";const xo={svg:"http://www.w3.org/2000/svg",xhtml:Gn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function vn(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),xo.hasOwnProperty(t)?{space:xo[t],local:e}:e}function Mh(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Gn&&t.documentElement.namespaceURI===Gn?t.createElement(e):t.createElementNS(n,e)}}function Zh(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Wi(e){var t=vn(e);return(t.local?Zh:Mh)(t)}function Fh(){}function _r(e){return e==null?Fh:function(){return this.querySelector(e)}}function Lh(e){typeof e!="function"&&(e=_r(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,u=r[o]=new Array(s),c,a,f=0;f<s;++f)(c=i[f])&&(a=e.call(c,c.__data__,f,i))&&("__data__"in c&&(a.__data__=c.__data__),u[f]=a);return new ge(r,this._parents)}function Wh(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Bh(){return[]}function Bi(e){return e==null?Bh:function(){return this.querySelectorAll(e)}}function Kh(e){return function(){return Wh(e.apply(this,arguments))}}function Jh(e){typeof e=="function"?e=Kh(e):e=Bi(e);for(var t=this._groups,n=t.length,r=[],o=[],i=0;i<n;++i)for(var s=t[i],u=s.length,c,a=0;a<u;++a)(c=s[a])&&(r.push(e.call(c,c.__data__,a,s)),o.push(c));return new ge(r,o)}function Ki(e){return function(){return this.matches(e)}}function Ji(e){return function(t){return t.matches(e)}}var Gh=Array.prototype.find;function Hh(e){return function(){return Gh.call(this.children,e)}}function qh(){return this.firstElementChild}function Vh(e){return this.select(e==null?qh:Hh(typeof e=="function"?e:Ji(e)))}var Xh=Array.prototype.filter;function Yh(){return Array.from(this.children)}function Qh(e){return function(){return Xh.call(this.children,e)}}function ed(e){return this.selectAll(e==null?Yh:Qh(typeof e=="function"?e:Ji(e)))}function td(e){typeof e!="function"&&(e=Ki(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,u=r[o]=[],c,a=0;a<s;++a)(c=i[a])&&e.call(c,c.__data__,a,i)&&u.push(c);return new ge(r,this._parents)}function Gi(e){return new Array(e.length)}function nd(){return new ge(this._enter||this._groups.map(Gi),this._parents)}function nn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}nn.prototype={constructor:nn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function rd(e){return function(){return e}}function od(e,t,n,r,o,i){for(var s=0,u,c=t.length,a=i.length;s<a;++s)(u=t[s])?(u.__data__=i[s],r[s]=u):n[s]=new nn(e,i[s]);for(;s<c;++s)(u=t[s])&&(o[s]=u)}function id(e,t,n,r,o,i,s){var u,c,a=new Map,f=t.length,d=i.length,l=new Array(f),b;for(u=0;u<f;++u)(c=t[u])&&(l[u]=b=s.call(c,c.__data__,u,t)+"",a.has(b)?o[u]=c:a.set(b,c));for(u=0;u<d;++u)b=s.call(e,i[u],u,i)+"",(c=a.get(b))?(r[u]=c,c.__data__=i[u],a.delete(b)):n[u]=new nn(e,i[u]);for(u=0;u<f;++u)(c=t[u])&&a.get(l[u])===c&&(o[u]=c)}function sd(e){return e.__data__}function ad(e,t){if(!arguments.length)return Array.from(this,sd);var n=t?id:od,r=this._parents,o=this._groups;typeof e!="function"&&(e=rd(e));for(var i=o.length,s=new Array(i),u=new Array(i),c=new Array(i),a=0;a<i;++a){var f=r[a],d=o[a],l=d.length,b=ud(e.call(f,f&&f.__data__,a,r)),g=b.length,S=u[a]=new Array(g),y=s[a]=new Array(g),w=c[a]=new Array(l);n(f,d,S,y,w,b,t);for(var p=0,h=0,v,m;p<g;++p)if(v=S[p]){for(p>=h&&(h=p+1);!(m=y[h])&&++h<g;);v._next=m||null}}return s=new ge(s,r),s._enter=u,s._exit=c,s}function ud(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function cd(){return new ge(this._exit||this._groups.map(Gi),this._parents)}function fd(e,t,n){var r=this.enter(),o=this,i=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),n==null?i.remove():n(i),r&&o?r.merge(o).order():o}function ld(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,o=n.length,i=r.length,s=Math.min(o,i),u=new Array(o),c=0;c<s;++c)for(var a=n[c],f=r[c],d=a.length,l=u[c]=new Array(d),b,g=0;g<d;++g)(b=a[g]||f[g])&&(l[g]=b);for(;c<o;++c)u[c]=n[c];return new ge(u,this._parents)}function hd(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],o=r.length-1,i=r[o],s;--o>=0;)(s=r[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function dd(e){e||(e=pd);function t(d,l){return d&&l?e(d.__data__,l.__data__):!d-!l}for(var n=this._groups,r=n.length,o=new Array(r),i=0;i<r;++i){for(var s=n[i],u=s.length,c=o[i]=new Array(u),a,f=0;f<u;++f)(a=s[f])&&(c[f]=a);c.sort(t)}return new ge(o,this._parents).order()}function pd(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function gd(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function vd(){return Array.from(this)}function md(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length;o<i;++o){var s=r[o];if(s)return s}return null}function yd(){let e=0;for(const t of this)++e;return e}function wd(){return!this.node()}function bd(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var o=t[n],i=0,s=o.length,u;i<s;++i)(u=o[i])&&e.call(u,u.__data__,i,o);return this}function _d(e){return function(){this.removeAttribute(e)}}function Sd(e){return function(){this.removeAttributeNS(e.space,e.local)}}function kd(e,t){return function(){this.setAttribute(e,t)}}function Ed(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Td(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function Ad(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function xd(e,t){var n=vn(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?Sd:_d:typeof t=="function"?n.local?Ad:Td:n.local?Ed:kd)(n,t))}function Hi(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Od(e){return function(){this.style.removeProperty(e)}}function $d(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Cd(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function Nd(e,t,n){return arguments.length>1?this.each((t==null?Od:typeof t=="function"?Cd:$d)(e,t,n??"")):Xe(this.node(),e)}function Xe(e,t){return e.style.getPropertyValue(t)||Hi(e).getComputedStyle(e,null).getPropertyValue(t)}function Rd(e){return function(){delete this[e]}}function jd(e,t){return function(){this[e]=t}}function Dd(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Id(e,t){return arguments.length>1?this.each((t==null?Rd:typeof t=="function"?Dd:jd)(e,t)):this.node()[e]}function qi(e){return e.trim().split(/^|\s+/)}function Sr(e){return e.classList||new Vi(e)}function Vi(e){this._node=e,this._names=qi(e.getAttribute("class")||"")}Vi.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Xi(e,t){for(var n=Sr(e),r=-1,o=t.length;++r<o;)n.add(t[r])}function Yi(e,t){for(var n=Sr(e),r=-1,o=t.length;++r<o;)n.remove(t[r])}function Pd(e){return function(){Xi(this,e)}}function Ud(e){return function(){Yi(this,e)}}function zd(e,t){return function(){(t.apply(this,arguments)?Xi:Yi)(this,e)}}function Md(e,t){var n=qi(e+"");if(arguments.length<2){for(var r=Sr(this.node()),o=-1,i=n.length;++o<i;)if(!r.contains(n[o]))return!1;return!0}return this.each((typeof t=="function"?zd:t?Pd:Ud)(n,t))}function Zd(){this.textContent=""}function Fd(e){return function(){this.textContent=e}}function Ld(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Wd(e){return arguments.length?this.each(e==null?Zd:(typeof e=="function"?Ld:Fd)(e)):this.node().textContent}function Bd(){this.innerHTML=""}function Kd(e){return function(){this.innerHTML=e}}function Jd(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Gd(e){return arguments.length?this.each(e==null?Bd:(typeof e=="function"?Jd:Kd)(e)):this.node().innerHTML}function Hd(){this.nextSibling&&this.parentNode.appendChild(this)}function qd(){return this.each(Hd)}function Vd(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Xd(){return this.each(Vd)}function Yd(e){var t=typeof e=="function"?e:Wi(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Qd(){return null}function ep(e,t){var n=typeof e=="function"?e:Wi(e),r=t==null?Qd:typeof t=="function"?t:_r(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function tp(){var e=this.parentNode;e&&e.removeChild(this)}function np(){return this.each(tp)}function rp(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function op(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ip(e){return this.select(e?op:rp)}function sp(e){return arguments.length?this.property("__data__",e):this.node().__data__}function ap(e){return function(t){e.call(this,t,this.__data__)}}function up(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function cp(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,o=t.length,i;n<o;++n)i=t[n],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++r]=i;++r?t.length=r:delete this.__on}}}function fp(e,t,n){return function(){var r=this.__on,o,i=ap(t);if(r){for(var s=0,u=r.length;s<u;++s)if((o=r[s]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=n),o.value=t;return}}this.addEventListener(e.type,i,n),o={type:e.type,name:e.name,value:t,listener:i,options:n},r?r.push(o):this.__on=[o]}}function lp(e,t,n){var r=up(e+""),o,i=r.length,s;if(arguments.length<2){var u=this.node().__on;if(u){for(var c=0,a=u.length,f;c<a;++c)for(o=0,f=u[c];o<i;++o)if((s=r[o]).type===f.type&&s.name===f.name)return f.value}return}for(u=t?fp:cp,o=0;o<i;++o)this.each(u(r[o],t,n));return this}function Qi(e,t,n){var r=Hi(e),o=r.CustomEvent;typeof o=="function"?o=new o(t,n):(o=r.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function hp(e,t){return function(){return Qi(this,e,t)}}function dp(e,t){return function(){return Qi(this,e,t.apply(this,arguments))}}function pp(e,t){return this.each((typeof t=="function"?dp:hp)(e,t))}function*gp(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,i=r.length,s;o<i;++o)(s=r[o])&&(yield s)}var vp=[null];function ge(e,t){this._groups=e,this._parents=t}function $t(){return new ge([[document.documentElement]],vp)}function mp(){return this}ge.prototype=$t.prototype={constructor:ge,select:Lh,selectAll:Jh,selectChild:Vh,selectChildren:ed,filter:td,data:ad,enter:nd,exit:cd,join:fd,merge:ld,selection:mp,order:hd,sort:dd,call:gd,nodes:vd,node:md,size:yd,empty:wd,each:bd,attr:xd,style:Nd,property:Id,classed:Md,text:Wd,html:Gd,raise:qd,lower:Xd,append:Yd,insert:ep,remove:np,clone:ip,datum:sp,on:lp,dispatch:pp,[Symbol.iterator]:gp};function kr(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function es(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Ct(){}var bt=.7,rn=1/bt,Ge="\\s*([+-]?\\d+)\\s*",_t="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",we="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",yp=/^#([0-9a-f]{3,8})$/,wp=new RegExp(`^rgb\\(${Ge},${Ge},${Ge}\\)$`),bp=new RegExp(`^rgb\\(${we},${we},${we}\\)$`),_p=new RegExp(`^rgba\\(${Ge},${Ge},${Ge},${_t}\\)$`),Sp=new RegExp(`^rgba\\(${we},${we},${we},${_t}\\)$`),kp=new RegExp(`^hsl\\(${_t},${we},${we}\\)$`),Ep=new RegExp(`^hsla\\(${_t},${we},${we},${_t}\\)$`),Oo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};kr(Ct,St,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:$o,formatHex:$o,formatHex8:Tp,formatHsl:Ap,formatRgb:Co,toString:Co});function $o(){return this.rgb().formatHex()}function Tp(){return this.rgb().formatHex8()}function Ap(){return ts(this).formatHsl()}function Co(){return this.rgb().formatRgb()}function St(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=yp.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?No(t):n===3?new ae(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?zt(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?zt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=wp.exec(e))?new ae(t[1],t[2],t[3],1):(t=bp.exec(e))?new ae(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=_p.exec(e))?zt(t[1],t[2],t[3],t[4]):(t=Sp.exec(e))?zt(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=kp.exec(e))?Do(t[1],t[2]/100,t[3]/100,1):(t=Ep.exec(e))?Do(t[1],t[2]/100,t[3]/100,t[4]):Oo.hasOwnProperty(e)?No(Oo[e]):e==="transparent"?new ae(NaN,NaN,NaN,0):null}function No(e){return new ae(e>>16&255,e>>8&255,e&255,1)}function zt(e,t,n,r){return r<=0&&(e=t=n=NaN),new ae(e,t,n,r)}function xp(e){return e instanceof Ct||(e=St(e)),e?(e=e.rgb(),new ae(e.r,e.g,e.b,e.opacity)):new ae}function Hn(e,t,n,r){return arguments.length===1?xp(e):new ae(e,t,n,r??1)}function ae(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}kr(ae,Hn,es(Ct,{brighter(e){return e=e==null?rn:Math.pow(rn,e),new ae(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?bt:Math.pow(bt,e),new ae(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ae(Pe(this.r),Pe(this.g),Pe(this.b),on(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ro,formatHex:Ro,formatHex8:Op,formatRgb:jo,toString:jo}));function Ro(){return`#${De(this.r)}${De(this.g)}${De(this.b)}`}function Op(){return`#${De(this.r)}${De(this.g)}${De(this.b)}${De((isNaN(this.opacity)?1:this.opacity)*255)}`}function jo(){const e=on(this.opacity);return`${e===1?"rgb(":"rgba("}${Pe(this.r)}, ${Pe(this.g)}, ${Pe(this.b)}${e===1?")":`, ${e})`}`}function on(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Pe(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function De(e){return e=Pe(e),(e<16?"0":"")+e.toString(16)}function Do(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new he(e,t,n,r)}function ts(e){if(e instanceof he)return new he(e.h,e.s,e.l,e.opacity);if(e instanceof Ct||(e=St(e)),!e)return new he;if(e instanceof he)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,o=Math.min(t,n,r),i=Math.max(t,n,r),s=NaN,u=i-o,c=(i+o)/2;return u?(t===i?s=(n-r)/u+(n<r)*6:n===i?s=(r-t)/u+2:s=(t-n)/u+4,u/=c<.5?i+o:2-i-o,s*=60):u=c>0&&c<1?0:s,new he(s,u,c,e.opacity)}function $p(e,t,n,r){return arguments.length===1?ts(e):new he(e,t,n,r??1)}function he(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}kr(he,$p,es(Ct,{brighter(e){return e=e==null?rn:Math.pow(rn,e),new he(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?bt:Math.pow(bt,e),new he(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,o=2*n-r;return new ae(Un(e>=240?e-240:e+120,o,r),Un(e,o,r),Un(e<120?e+240:e-120,o,r),this.opacity)},clamp(){return new he(Io(this.h),Mt(this.s),Mt(this.l),on(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=on(this.opacity);return`${e===1?"hsl(":"hsla("}${Io(this.h)}, ${Mt(this.s)*100}%, ${Mt(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Io(e){return e=(e||0)%360,e<0?e+360:e}function Mt(e){return Math.max(0,Math.min(1,e||0))}function Un(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const ns=e=>()=>e;function Cp(e,t){return function(n){return e+n*t}}function Np(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function Rp(e){return(e=+e)==1?rs:function(t,n){return n-t?Np(t,n,e):ns(isNaN(t)?n:t)}}function rs(e,t){var n=t-e;return n?Cp(e,n):ns(isNaN(e)?t:e)}const Po=function e(t){var n=Rp(t);function r(o,i){var s=n((o=Hn(o)).r,(i=Hn(i)).r),u=n(o.g,i.g),c=n(o.b,i.b),a=rs(o.opacity,i.opacity);return function(f){return o.r=s(f),o.g=u(f),o.b=c(f),o.opacity=a(f),o+""}}return r.gamma=e,r}(1);function Te(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var qn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zn=new RegExp(qn.source,"g");function jp(e){return function(){return e}}function Dp(e){return function(t){return e(t)+""}}function Ip(e,t){var n=qn.lastIndex=zn.lastIndex=0,r,o,i,s=-1,u=[],c=[];for(e=e+"",t=t+"";(r=qn.exec(e))&&(o=zn.exec(t));)(i=o.index)>n&&(i=t.slice(n,i),u[s]?u[s]+=i:u[++s]=i),(r=r[0])===(o=o[0])?u[s]?u[s]+=o:u[++s]=o:(u[++s]=null,c.push({i:s,x:Te(r,o)})),n=zn.lastIndex;return n<t.length&&(i=t.slice(n),u[s]?u[s]+=i:u[++s]=i),u.length<2?c[0]?Dp(c[0].x):jp(t):(t=c.length,function(a){for(var f=0,d;f<t;++f)u[(d=c[f]).i]=d.x(a);return u.join("")})}var Uo=180/Math.PI,Vn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function os(e,t,n,r,o,i){var s,u,c;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(c=e*n+t*r)&&(n-=e*c,r-=t*c),(u=Math.sqrt(n*n+r*r))&&(n/=u,r/=u,c/=u),e*r<t*n&&(e=-e,t=-t,c=-c,s=-s),{translateX:o,translateY:i,rotate:Math.atan2(t,e)*Uo,skewX:Math.atan(c)*Uo,scaleX:s,scaleY:u}}var Zt;function Pp(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Vn:os(t.a,t.b,t.c,t.d,t.e,t.f)}function Up(e){return e==null||(Zt||(Zt=document.createElementNS("http://www.w3.org/2000/svg","g")),Zt.setAttribute("transform",e),!(e=Zt.transform.baseVal.consolidate()))?Vn:(e=e.matrix,os(e.a,e.b,e.c,e.d,e.e,e.f))}function is(e,t,n,r){function o(a){return a.length?a.pop()+" ":""}function i(a,f,d,l,b,g){if(a!==d||f!==l){var S=b.push("translate(",null,t,null,n);g.push({i:S-4,x:Te(a,d)},{i:S-2,x:Te(f,l)})}else(d||l)&&b.push("translate("+d+t+l+n)}function s(a,f,d,l){a!==f?(a-f>180?f+=360:f-a>180&&(a+=360),l.push({i:d.push(o(d)+"rotate(",null,r)-2,x:Te(a,f)})):f&&d.push(o(d)+"rotate("+f+r)}function u(a,f,d,l){a!==f?l.push({i:d.push(o(d)+"skewX(",null,r)-2,x:Te(a,f)}):f&&d.push(o(d)+"skewX("+f+r)}function c(a,f,d,l,b,g){if(a!==d||f!==l){var S=b.push(o(b)+"scale(",null,",",null,")");g.push({i:S-4,x:Te(a,d)},{i:S-2,x:Te(f,l)})}else(d!==1||l!==1)&&b.push(o(b)+"scale("+d+","+l+")")}return function(a,f){var d=[],l=[];return a=e(a),f=e(f),i(a.translateX,a.translateY,f.translateX,f.translateY,d,l),s(a.rotate,f.rotate,d,l),u(a.skewX,f.skewX,d,l),c(a.scaleX,a.scaleY,f.scaleX,f.scaleY,d,l),a=f=null,function(b){for(var g=-1,S=l.length,y;++g<S;)d[(y=l[g]).i]=y.x(b);return d.join("")}}}var zp=is(Pp,"px, ","px)","deg)"),Mp=is(Up,", ",")",")"),Ye=0,it=0,ot=0,ss=1e3,sn,st,an=0,Me=0,mn=0,kt=typeof performance=="object"&&performance.now?performance:Date,as=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Er(){return Me||(as(Zp),Me=kt.now()+mn)}function Zp(){Me=0}function un(){this._call=this._time=this._next=null}un.prototype=us.prototype={constructor:un,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Er():+n)+(t==null?0:+t),!this._next&&st!==this&&(st?st._next=this:sn=this,st=this),this._call=e,this._time=n,Xn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Xn())}};function us(e,t,n){var r=new un;return r.restart(e,t,n),r}function Fp(){Er(),++Ye;for(var e=sn,t;e;)(t=Me-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Ye}function zo(){Me=(an=kt.now())+mn,Ye=it=0;try{Fp()}finally{Ye=0,Wp(),Me=0}}function Lp(){var e=kt.now(),t=e-an;t>ss&&(mn-=t,an=e)}function Wp(){for(var e,t=sn,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:sn=n);st=e,Xn(r)}function Xn(e){if(!Ye){it&&(it=clearTimeout(it));var t=e-Me;t>24?(e<1/0&&(it=setTimeout(zo,e-kt.now()-mn)),ot&&(ot=clearInterval(ot))):(ot||(an=kt.now(),ot=setInterval(Lp,ss)),Ye=1,as(zo))}}function Mo(e,t,n){var r=new un;return t=t==null?0:+t,r.restart(o=>{r.stop(),e(o+t)},t,n),r}var Bp=Li("start","end","cancel","interrupt"),Kp=[],cs=0,Zo=1,Yn=2,Jt=3,Fo=4,Qn=5,Gt=6;function yn(e,t,n,r,o,i){var s=e.__transition;if(!s)e.__transition={};else if(n in s)return;Jp(e,n,{name:t,index:r,group:o,on:Bp,tween:Kp,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:cs})}function Tr(e,t){var n=ve(e,t);if(n.state>cs)throw new Error("too late; already scheduled");return n}function be(e,t){var n=ve(e,t);if(n.state>Jt)throw new Error("too late; already running");return n}function ve(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Jp(e,t,n){var r=e.__transition,o;r[t]=n,n.timer=us(i,0,n.time);function i(a){n.state=Zo,n.timer.restart(s,n.delay,n.time),n.delay<=a&&s(a-n.delay)}function s(a){var f,d,l,b;if(n.state!==Zo)return c();for(f in r)if(b=r[f],b.name===n.name){if(b.state===Jt)return Mo(s);b.state===Fo?(b.state=Gt,b.timer.stop(),b.on.call("interrupt",e,e.__data__,b.index,b.group),delete r[f]):+f<t&&(b.state=Gt,b.timer.stop(),b.on.call("cancel",e,e.__data__,b.index,b.group),delete r[f])}if(Mo(function(){n.state===Jt&&(n.state=Fo,n.timer.restart(u,n.delay,n.time),u(a))}),n.state=Yn,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Yn){for(n.state=Jt,o=new Array(l=n.tween.length),f=0,d=-1;f<l;++f)(b=n.tween[f].value.call(e,e.__data__,n.index,n.group))&&(o[++d]=b);o.length=d+1}}function u(a){for(var f=a<n.duration?n.ease.call(null,a/n.duration):(n.timer.restart(c),n.state=Qn,1),d=-1,l=o.length;++d<l;)o[d].call(e,f);n.state===Qn&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=Gt,n.timer.stop(),delete r[t];for(var a in r)return;delete e.__transition}}function Gp(e,t){var n=e.__transition,r,o,i=!0,s;if(n){t=t==null?null:t+"";for(s in n){if((r=n[s]).name!==t){i=!1;continue}o=r.state>Yn&&r.state<Qn,r.state=Gt,r.timer.stop(),r.on.call(o?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[s]}i&&delete e.__transition}}function Hp(e){return this.each(function(){Gp(this,e)})}function qp(e,t){var n,r;return function(){var o=be(this,e),i=o.tween;if(i!==n){r=n=i;for(var s=0,u=r.length;s<u;++s)if(r[s].name===t){r=r.slice(),r.splice(s,1);break}}o.tween=r}}function Vp(e,t,n){var r,o;if(typeof n!="function")throw new Error;return function(){var i=be(this,e),s=i.tween;if(s!==r){o=(r=s).slice();for(var u={name:t,value:n},c=0,a=o.length;c<a;++c)if(o[c].name===t){o[c]=u;break}c===a&&o.push(u)}i.tween=o}}function Xp(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r=ve(this.node(),n).tween,o=0,i=r.length,s;o<i;++o)if((s=r[o]).name===e)return s.value;return null}return this.each((t==null?qp:Vp)(n,e,t))}function Ar(e,t,n){var r=e._id;return e.each(function(){var o=be(this,r);(o.value||(o.value={}))[t]=n.apply(this,arguments)}),function(o){return ve(o,r).value[t]}}function fs(e,t){var n;return(typeof t=="number"?Te:t instanceof St?Po:(n=St(t))?(t=n,Po):Ip)(e,t)}function Yp(e){return function(){this.removeAttribute(e)}}function Qp(e){return function(){this.removeAttributeNS(e.space,e.local)}}function eg(e,t,n){var r,o=n+"",i;return function(){var s=this.getAttribute(e);return s===o?null:s===r?i:i=t(r=s,n)}}function tg(e,t,n){var r,o=n+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===r?i:i=t(r=s,n)}}function ng(e,t,n){var r,o,i;return function(){var s,u=n(this),c;return u==null?void this.removeAttribute(e):(s=this.getAttribute(e),c=u+"",s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,u)))}}function rg(e,t,n){var r,o,i;return function(){var s,u=n(this),c;return u==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),c=u+"",s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,u)))}}function og(e,t){var n=vn(e),r=n==="transform"?Mp:fs;return this.attrTween(e,typeof t=="function"?(n.local?rg:ng)(n,r,Ar(this,"attr."+e,t)):t==null?(n.local?Qp:Yp)(n):(n.local?tg:eg)(n,r,t))}function ig(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function sg(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function ag(e,t){var n,r;function o(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&sg(e,i)),n}return o._value=t,o}function ug(e,t){var n,r;function o(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&ig(e,i)),n}return o._value=t,o}function cg(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var r=vn(e);return this.tween(n,(r.local?ag:ug)(r,t))}function fg(e,t){return function(){Tr(this,e).delay=+t.apply(this,arguments)}}function lg(e,t){return t=+t,function(){Tr(this,e).delay=t}}function hg(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?fg:lg)(t,e)):ve(this.node(),t).delay}function dg(e,t){return function(){be(this,e).duration=+t.apply(this,arguments)}}function pg(e,t){return t=+t,function(){be(this,e).duration=t}}function gg(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?dg:pg)(t,e)):ve(this.node(),t).duration}function vg(e,t){if(typeof t!="function")throw new Error;return function(){be(this,e).ease=t}}function mg(e){var t=this._id;return arguments.length?this.each(vg(t,e)):ve(this.node(),t).ease}function yg(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;be(this,e).ease=n}}function wg(e){if(typeof e!="function")throw new Error;return this.each(yg(this._id,e))}function bg(e){typeof e!="function"&&(e=Ki(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var i=t[o],s=i.length,u=r[o]=[],c,a=0;a<s;++a)(c=i[a])&&e.call(c,c.__data__,a,i)&&u.push(c);return new ke(r,this._parents,this._name,this._id)}function _g(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,o=n.length,i=Math.min(r,o),s=new Array(r),u=0;u<i;++u)for(var c=t[u],a=n[u],f=c.length,d=s[u]=new Array(f),l,b=0;b<f;++b)(l=c[b]||a[b])&&(d[b]=l);for(;u<r;++u)s[u]=t[u];return new ke(s,this._parents,this._name,this._id)}function Sg(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function kg(e,t,n){var r,o,i=Sg(t)?Tr:be;return function(){var s=i(this,e),u=s.on;u!==r&&(o=(r=u).copy()).on(t,n),s.on=o}}function Eg(e,t){var n=this._id;return arguments.length<2?ve(this.node(),n).on.on(e):this.each(kg(n,e,t))}function Tg(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Ag(){return this.on("end.remove",Tg(this._id))}function xg(e){var t=this._name,n=this._id;typeof e!="function"&&(e=_r(e));for(var r=this._groups,o=r.length,i=new Array(o),s=0;s<o;++s)for(var u=r[s],c=u.length,a=i[s]=new Array(c),f,d,l=0;l<c;++l)(f=u[l])&&(d=e.call(f,f.__data__,l,u))&&("__data__"in f&&(d.__data__=f.__data__),a[l]=d,yn(a[l],t,n,l,a,ve(f,n)));return new ke(i,this._parents,t,n)}function Og(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Bi(e));for(var r=this._groups,o=r.length,i=[],s=[],u=0;u<o;++u)for(var c=r[u],a=c.length,f,d=0;d<a;++d)if(f=c[d]){for(var l=e.call(f,f.__data__,d,c),b,g=ve(f,n),S=0,y=l.length;S<y;++S)(b=l[S])&&yn(b,t,n,S,l,g);i.push(l),s.push(f)}return new ke(i,s,t,n)}var $g=$t.prototype.constructor;function Cg(){return new $g(this._groups,this._parents)}function Ng(e,t){var n,r,o;return function(){var i=Xe(this,e),s=(this.style.removeProperty(e),Xe(this,e));return i===s?null:i===n&&s===r?o:o=t(n=i,r=s)}}function ls(e){return function(){this.style.removeProperty(e)}}function Rg(e,t,n){var r,o=n+"",i;return function(){var s=Xe(this,e);return s===o?null:s===r?i:i=t(r=s,n)}}function jg(e,t,n){var r,o,i;return function(){var s=Xe(this,e),u=n(this),c=u+"";return u==null&&(c=u=(this.style.removeProperty(e),Xe(this,e))),s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,u))}}function Dg(e,t){var n,r,o,i="style."+t,s="end."+i,u;return function(){var c=be(this,e),a=c.on,f=c.value[i]==null?u||(u=ls(t)):void 0;(a!==n||o!==f)&&(r=(n=a).copy()).on(s,o=f),c.on=r}}function Ig(e,t,n){var r=(e+="")=="transform"?zp:fs;return t==null?this.styleTween(e,Ng(e,r)).on("end.style."+e,ls(e)):typeof t=="function"?this.styleTween(e,jg(e,r,Ar(this,"style."+e,t))).each(Dg(this._id,e)):this.styleTween(e,Rg(e,r,t),n).on("end.style."+e,null)}function Pg(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function Ug(e,t,n){var r,o;function i(){var s=t.apply(this,arguments);return s!==o&&(r=(o=s)&&Pg(e,s,n)),r}return i._value=t,i}function zg(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,Ug(e,t,n??""))}function Mg(e){return function(){this.textContent=e}}function Zg(e){return function(){var t=e(this);this.textContent=t??""}}function Fg(e){return this.tween("text",typeof e=="function"?Zg(Ar(this,"text",e)):Mg(e==null?"":e+""))}function Lg(e){return function(t){this.textContent=e.call(this,t)}}function Wg(e){var t,n;function r(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&Lg(o)),t}return r._value=e,r}function Bg(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Wg(e))}function Kg(){for(var e=this._name,t=this._id,n=hs(),r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],u=s.length,c,a=0;a<u;++a)if(c=s[a]){var f=ve(c,t);yn(c,e,n,a,s,{time:f.time+f.delay+f.duration,delay:0,duration:f.duration,ease:f.ease})}return new ke(r,this._parents,e,n)}function Jg(){var e,t,n=this,r=n._id,o=n.size();return new Promise(function(i,s){var u={value:s},c={value:function(){--o===0&&i()}};n.each(function(){var a=be(this,r),f=a.on;f!==e&&(t=(e=f).copy(),t._.cancel.push(u),t._.interrupt.push(u),t._.end.push(c)),a.on=t}),o===0&&i()})}var Gg=0;function ke(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function hs(){return++Gg}var _e=$t.prototype;ke.prototype={constructor:ke,select:xg,selectAll:Og,selectChild:_e.selectChild,selectChildren:_e.selectChildren,filter:bg,merge:_g,selection:Cg,transition:Kg,call:_e.call,nodes:_e.nodes,node:_e.node,size:_e.size,empty:_e.empty,each:_e.each,on:Eg,attr:og,attrTween:cg,style:Ig,styleTween:zg,text:Fg,textTween:Bg,remove:Ag,tween:Xp,delay:hg,duration:gg,ease:mg,easeVarying:wg,end:Jg,[Symbol.iterator]:_e[Symbol.iterator]};function Hg(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var qg={time:null,delay:0,duration:250,ease:Hg};function Vg(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Xg(e){var t,n;e instanceof ke?(t=e._id,e=e._name):(t=hs(),(n=qg).time=Er(),e=e==null?null:e+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],u=s.length,c,a=0;a<u;++a)(c=s[a])&&yn(c,e,t,a,s,n||Vg(c,t));return new ke(r,this._parents,e,t)}$t.prototype.interrupt=Hp;$t.prototype.transition=Xg;function Yg(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}const Lo=Symbol("implicit");function ds(){var e=new Eo,t=[],n=[],r=Lo;function o(i){let s=e.get(i);if(s===void 0){if(r!==Lo)return r;e.set(i,s=t.push(i)-1)}return n[s%n.length]}return o.domain=function(i){if(!arguments.length)return t.slice();t=[],e=new Eo;for(const s of i)e.has(s)||e.set(s,t.push(s)-1);return o},o.range=function(i){return arguments.length?(n=Array.from(i),o):n.slice()},o.unknown=function(i){return arguments.length?(r=i,o):r},o.copy=function(){return ds(t,n).unknown(r)},Yg.apply(o,arguments),o}function wn(e){for(var t=e.length/6|0,n=new Array(t),r=0;r<t;)n[r]="#"+e.slice(r*6,++r*6);return n}const Qg=wn("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),ev=wn("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),tv=wn("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),nv=wn("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f");function at(e,t,n){this.k=e,this.x=t,this.y=n}at.prototype={constructor:at,scale:function(e){return e===1?this:new at(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new at(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};at.prototype;ds().range([...Qg,...ev,...tv,...nv]);const Wo=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#aec7e8","#ffbb78","#98df8a","#ff9896","#c5b0d5","#c49c94","#f7b6d2","#c7c7c7","#dbdb8d","#9edae5"];function rv(e){let t=0;if(e.length===0)return t;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);t=(t<<5)-t+r,t=t&t}return Math.abs(t)}function ov(e){const t=e.startsWith("#")?e.slice(1):e,n=parseInt(t.substr(0,2),16),r=parseInt(t.substr(2,2),16),o=parseInt(t.substr(4,2),16);return n*.299+r*.587+o*.114}function Pv(e){if(!e)return"#cccccc";const t=rv(e)%Wo.length;return Wo[t]}function Uv(e){return ov(e)>128?"#000000":"#ffffff"}function zv(e){if(!e)return"#64748b";let t=0;for(let i=0;i<e.length;i++)t=e.charCodeAt(i)+((t<<5)-t);const n=Math.abs(t)%360,r=55+Math.abs(t)%15,o=70+Math.abs(t)%10;return`hsl(${n}, ${r}%, ${o}%)`}export{$v as $,pv as A,ea as B,mv as C,ye as D,Iv as E,Dv as F,bh as G,wv as H,zv as I,hv as J,Uv as K,ce as L,Rv as M,L as N,qe as O,Ve as P,nh as Q,rh as R,ql as S,Cv as T,Nv as U,Ev as V,yv as W,dv as X,gv as Y,Tv as Z,Ue as _,dt as a,ar as a0,xv as a1,Ch as a2,Av as a3,Ra as a4,Ov as a5,ni as a6,ur as a7,yt as a8,Pi as a9,Qt as aa,ji as b,ee as c,jv as d,Pv as e,Ie as f,oi as g,oa as h,lv as i,fv as j,ra as k,Sv as l,fa as m,Di as n,_v as o,bv as p,vv as q,kv as r,qt as s,se as t,wh as u,M as v,z as w,me as x,Se as y,tn as z};
