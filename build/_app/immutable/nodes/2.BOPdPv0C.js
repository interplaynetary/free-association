import{t as z,a as U,d as Ze,e as St}from"../chunks/B8YV51FY.js";import{aa as Tt,E as Yt,ay as Xt,az as qt,a2 as Kt,u as Vt,aA as Zt,w as Jt,a4 as Qt,F as He,ag as It,ah as Dt,ai as $t,H as Ue,ad as G,af as B,j as e,z as ze,l as p,K as O,M as F,X as pe,W as ie,J as Fe,V as Le,aw as Qe,I as ct,av as Pt,k as dt,aq as Nt,ar as Mt}from"../chunks/D8QEN0Si.js";import{i as de,b as Je,s as Ut,a as Ke}from"../chunks/BZ-QgN3O.js";import{t as Se,r as Ft,l as Ot,e as st,j as gt,s as lt,q as nt,F as ot,f as Xe,u as Ge,c as en,b as tn,H as nn,g as K,h as _t,I as on,J as rn,K as an,a as sn,L as ln,M as dn,N as kt,O as cn,P as un}from"../chunks/Bj8vwbLL.js";import{a as hn,w as fn,d as wt,e as pt,s as Ve}from"../chunks/BdftctrX.js";import{b as vn,T as gn,g as At,d as mn,B as Ht}from"../chunks/D0jUzauI.js";import{p as me,r as rt}from"../chunks/CZOFykAy.js";import{c as ft}from"../chunks/CIFXNdNh.js";import{d as Lt}from"../chunks/H1Cc9yE9.js";const pn=()=>performance.now(),Re={tick:n=>requestAnimationFrame(n),now:()=>pn(),tasks:new Set};function Wt(){const n=Re.now();Re.tasks.forEach(t=>{t.c(n)||(Re.tasks.delete(t),t.f())}),Re.tasks.size!==0&&Re.tick(Wt)}function bn(n){let t;return Re.tasks.size===0&&Re.tick(Wt),{promise:new Promise(o=>{Re.tasks.add(t={c:n,f:o})}),abort(){Re.tasks.delete(t)}}}function vt(n,t){fn(()=>{n.dispatchEvent(new CustomEvent(t))})}function _n(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const t=n.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(o=>o[0].toUpperCase()+o.slice(1)).join("")}function Bt(n){const t={},o=n.split(";");for(const r of o){const[c,a]=r.split(":");if(!c||a===void 0)break;const d=_n(c.trim());t[d]=a.trim()}return t}const yn=n=>n;function Gt(n,t,o,r){var c=(n&Zt)!==0,a="both",d,f=t.inert,y=t.style.overflow,l,s;function T(){var u=$t,h=Tt;It(null),Dt(null);try{return d??(d=o()(t,(r==null?void 0:r())??{},{direction:a}))}finally{It(u),Dt(h)}}var i={is_global:c,in(){t.inert=f,vt(t,"introstart"),l=yt(t,T(),s,1,()=>{vt(t,"introend"),l==null||l.abort(),l=d=void 0,t.style.overflow=y})},out(u){t.inert=!0,vt(t,"outrostart"),s=yt(t,T(),l,0,()=>{vt(t,"outroend"),u==null||u()})},stop:()=>{l==null||l.abort(),s==null||s.abort()}},_=Tt;if((_.transitions??(_.transitions=[])).push(i),hn){var b=c;if(!b){for(var m=_.parent;m&&(m.f&Yt)!==0;)for(;(m=m.parent)&&(m.f&Xt)===0;);b=!m||(m.f&qt)!==0}b&&Kt(()=>{Vt(()=>i.in())})}}function yt(n,t,o,r,c){var a=r===1;if(Jt(t)){var d,f=!1;return Qt(()=>{if(!f){var u=t({direction:a?"in":"out"});d=yt(n,u,o,r,c)}}),{abort:()=>{f=!0,d==null||d.abort()},deactivate:()=>d.deactivate(),reset:()=>d.reset(),t:()=>d.t()}}if(o==null||o.deactivate(),!(t!=null&&t.duration))return c(),{abort:He,deactivate:He,reset:He,t:()=>r};const{delay:y=0,css:l,tick:s,easing:T=yn}=t;var i=[];if(a&&o===void 0&&(s&&s(0,1),l)){var _=Bt(l(0,1));i.push(_,_)}var b=()=>1-r,m=n.animate(i,{duration:y});return m.onfinish=()=>{var u=(o==null?void 0:o.t())??1-r;o==null||o.abort();var h=r-u,C=t.duration*Math.abs(h),S=[];if(C>0){var D=!1;if(l)for(var k=Math.ceil(C/16.666666666666668),A=0;A<=k;A+=1){var V=u+h*T(A/k),q=Bt(l(V,1-V));S.push(q),D||(D=q.overflow==="hidden")}D&&(n.style.overflow="hidden"),b=()=>{var ne=m.currentTime;return u+h*T(ne/C)},s&&bn(()=>{if(m.playState!=="running")return!1;var ne=b();return s(ne,1-ne),!0})}m=n.animate(S,{duration:C,fill:"forwards"}),m.onfinish=()=>{b=()=>r,s==null||s(r,1-r),c()}},{abort:()=>{m&&(m.cancel(),m.effect=null,m.onfinish=He)},deactivate:()=>{c=He},reset:()=>{r===0&&(s==null||s(1,0))},t:()=>b()}}function wn(n){var t=0,o=n.children,r=o&&o.length;if(!r)t=1;else for(;--r>=0;)t+=o[r].value;n.value=t}function xn(){return this.eachAfter(wn)}function En(n,t){let o=-1;for(const r of this)n.call(t,r,++o,this);return this}function Cn(n,t){for(var o=this,r=[o],c,a,d=-1;o=r.pop();)if(n.call(t,o,++d,this),c=o.children)for(a=c.length-1;a>=0;--a)r.push(c[a]);return this}function Sn(n,t){for(var o=this,r=[o],c=[],a,d,f,y=-1;o=r.pop();)if(c.push(o),a=o.children)for(d=0,f=a.length;d<f;++d)r.push(a[d]);for(;o=c.pop();)n.call(t,o,++y,this);return this}function Tn(n,t){let o=-1;for(const r of this)if(n.call(t,r,++o,this))return r}function In(n){return this.eachAfter(function(t){for(var o=+n(t.data)||0,r=t.children,c=r&&r.length;--c>=0;)o+=r[c].value;t.value=o})}function Dn(n){return this.eachBefore(function(t){t.children&&t.children.sort(n)})}function Pn(n){for(var t=this,o=Nn(t,n),r=[t];t!==o;)t=t.parent,r.push(t);for(var c=r.length;n!==o;)r.splice(c,0,n),n=n.parent;return r}function Nn(n,t){if(n===t)return n;var o=n.ancestors(),r=t.ancestors(),c=null;for(n=o.pop(),t=r.pop();n===t;)c=n,n=o.pop(),t=r.pop();return c}function Mn(){for(var n=this,t=[n];n=n.parent;)t.push(n);return t}function kn(){return Array.from(this)}function Hn(){var n=[];return this.eachBefore(function(t){t.children||n.push(t)}),n}function Ln(){var n=this,t=[];return n.each(function(o){o!==n&&t.push({source:o.parent,target:o})}),t}function*Bn(){var n=this,t,o=[n],r,c,a;do for(t=o.reverse(),o=[];n=t.pop();)if(yield n,r=n.children)for(c=0,a=r.length;c<a;++c)o.push(r[c]);while(o.length)}function xt(n,t){n instanceof Map?(n=[void 0,n],t===void 0&&(t=On)):t===void 0&&(t=Fn);for(var o=new mt(n),r,c=[o],a,d,f,y;r=c.pop();)if((d=t(r.data))&&(y=(d=Array.from(d)).length))for(r.children=d,f=y-1;f>=0;--f)c.push(a=d[f]=new mt(d[f])),a.parent=r,a.depth=r.depth+1;return o.eachBefore(Wn)}function Un(){return xt(this).eachBefore(An)}function Fn(n){return n.children}function On(n){return Array.isArray(n)?n[1]:null}function An(n){n.data.value!==void 0&&(n.value=n.data.value),n.data=n.data.data}function Wn(n){var t=0;do n.height=t;while((n=n.parent)&&n.height<++t)}function mt(n){this.data=n,this.depth=this.height=0,this.parent=null}mt.prototype=xt.prototype={constructor:mt,count:xn,each:En,eachAfter:Sn,eachBefore:Cn,find:Tn,sum:In,sort:Dn,path:Pn,ancestors:Mn,descendants:kn,leaves:Hn,links:Ln,copy:Un,[Symbol.iterator]:Bn};function Gn(n){if(typeof n!="function")throw new Error;return n}function it(){return 0}function at(n){return function(){return n}}function Rn(n){n.x0=Math.round(n.x0),n.y0=Math.round(n.y0),n.x1=Math.round(n.x1),n.y1=Math.round(n.y1)}function zn(n,t,o,r,c){for(var a=n.children,d,f=-1,y=a.length,l=n.value&&(r-t)/n.value;++f<y;)d=a[f],d.y0=o,d.y1=c,d.x0=t,d.x1=t+=d.value*l}function jn(n,t,o,r,c){for(var a=n.children,d,f=-1,y=a.length,l=n.value&&(c-o)/n.value;++f<y;)d=a[f],d.x0=t,d.x1=r,d.y0=o,d.y1=o+=d.value*l}var Yn=(1+Math.sqrt(5))/2;function Xn(n,t,o,r,c,a){for(var d=[],f=t.children,y,l,s=0,T=0,i=f.length,_,b,m=t.value,u,h,C,S,D,k,A;s<i;){_=c-o,b=a-r;do u=f[T++].value;while(!u&&T<i);for(h=C=u,k=Math.max(b/_,_/b)/(m*n),A=u*u*k,D=Math.max(C/A,A/h);T<i;++T){if(u+=l=f[T].value,l<h&&(h=l),l>C&&(C=l),A=u*u*k,S=Math.max(C/A,A/h),S>D){u-=l;break}D=S}d.push(y={value:u,dice:_<b,children:f.slice(s,T)}),y.dice?zn(y,o,r,c,m?r+=b*u/m:a):jn(y,o,r,m?o+=_*u/m:c,a),m-=u,s=T}return d}const qn=function n(t){function o(r,c,a,d,f){Xn(t,r,c,a,d,f)}return o.ratio=function(r){return n((r=+r)>1?r:1)},o}(Yn);function Kn(){var n=qn,t=!1,o=1,r=1,c=[0],a=it,d=it,f=it,y=it,l=it;function s(i){return i.x0=i.y0=0,i.x1=o,i.y1=r,i.eachBefore(T),c=[0],t&&i.eachBefore(Rn),i}function T(i){var _=c[i.depth],b=i.x0+_,m=i.y0+_,u=i.x1-_,h=i.y1-_;u<b&&(b=u=(b+u)/2),h<m&&(m=h=(m+h)/2),i.x0=b,i.y0=m,i.x1=u,i.y1=h,i.children&&(_=c[i.depth+1]=a(i)/2,b+=l(i)-_,m+=d(i)-_,u-=f(i)-_,h-=y(i)-_,u<b&&(b=u=(b+u)/2),h<m&&(m=h=(m+h)/2),n(i,b,m,u,h))}return s.round=function(i){return arguments.length?(t=!!i,s):t},s.size=function(i){return arguments.length?(o=+i[0],r=+i[1],s):[o,r]},s.tile=function(i){return arguments.length?(n=Gn(i),s):n},s.padding=function(i){return arguments.length?s.paddingInner(i).paddingOuter(i):s.paddingInner()},s.paddingInner=function(i){return arguments.length?(a=typeof i=="function"?i:at(+i),s):a},s.paddingOuter=function(i){return arguments.length?s.paddingTop(i).paddingRight(i).paddingBottom(i).paddingLeft(i):s.paddingTop()},s.paddingTop=function(i){return arguments.length?(d=typeof i=="function"?i:at(+i),s):d},s.paddingRight=function(i){return arguments.length?(f=typeof i=="function"?i:at(+i),s):f},s.paddingBottom=function(i){return arguments.length?(y=typeof i=="function"?i:at(+i),s):y},s.paddingLeft=function(i){return arguments.length?(l=typeof i=="function"?i:at(+i),s):l},s}function Vn(n,t,o,r,c){var a=n.children,d,f=a.length,y,l=new Array(f+1);for(l[0]=y=d=0;d<f;++d)l[d+1]=y+=a[d].value;s(0,f,n.value,t,o,r,c);function s(T,i,_,b,m,u,h){if(T>=i-1){var C=a[T];C.x0=b,C.y0=m,C.x1=u,C.y1=h;return}for(var S=l[T],D=_/2+S,k=T+1,A=i-1;k<A;){var V=k+A>>>1;l[V]<D?k=V+1:A=V}D-l[k-1]<l[k]-D&&T+1<k&&--k;var q=l[k]-S,ne=_-q;if(u-b>h-m){var he=_?(b*ne+u*q)/_:u;s(T,k,q,b,m,he,h),s(k,i,ne,he,m,u,h)}else{var fe=_?(m*ne+h*q)/_:h;s(T,k,q,b,m,u,fe),s(k,i,ne,b,fe,u,h)}}}function Zn(n,t,o,r){if(n.stopPropagation(),t())return;const c=o.node.id;c&&r()({nodeId:c,clientX:n.clientX,clientY:n.clientY})}function bt(n,t,o,r,c){var a;if(console.log("[DEBUG CHILD] handleTextEditStart called, event type:",n.type,"target:",n.target),t()){console.log("[DEBUG CHILD] Edit prevented - delete mode active"),n.stopPropagation(),n.stopImmediatePropagation(),n.preventDefault();return}if(n.stopPropagation(),n.stopImmediatePropagation(),(a=document.getSelection())==null||a.removeAllRanges(),n.type!=="touchstart"&&n.preventDefault(),!o.node.id){console.log("[DEBUG CHILD] No node ID, cannot edit");return}console.log("[DEBUG CHILD] Setting isEditing = true"),p(r,!0),p(c,o.node.name||"",!0)}function Jn(n,t,o){n.key==="Enter"?(n.preventDefault(),t()):n.key==="Escape"&&(n.preventDefault(),p(o,!1))}var Qn=z('<input type="text" class="node-edit-input svelte-1nkfxom">'),$n=z('<span class="title-segment svelte-1nkfxom"> </span>'),eo=z('<div class="node-title svelte-1nkfxom"></div>'),to=z('<div class="mini-contributor svelte-1nkfxom"></div>'),no=z('<div class="more-contributors svelte-1nkfxom" title="More contributors"> </div>'),oo=z("<!> <!>",1),ro=z('<div class="contributors-area svelte-1nkfxom"><div class="contributors-layout"><button class="add-contributor-button svelte-1nkfxom" title="Add contributor">+</button> <!></div></div>'),io=z(`<div class="treemap-node svelte-1nkfxom"><div class="unified-node-content svelte-1nkfxom"><div class="node-title-area svelte-1nkfxom" style="
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        max-width: 90%;
        z-index: 2;
      "><!></div> <!></div></div>`);function ao(n,t){Ue(t,!0);let o=me(t,"addContributor",3,I=>{}),r=me(t,"removeContributor",3,I=>{}),c=me(t,"onTextEdit",3,I=>{}),a=me(t,"onEditModeChange",3,I=>{}),d=me(t,"shouldEdit",3,!1),f=me(t,"deleteMode",3,!1),y=G(!1),l=G(""),s=G(null);const T=B(()=>t.dimensions.x1-t.dimensions.x0),i=B(()=>t.dimensions.y1-t.dimensions.y0),_=B(()=>Math.min(e(T),e(i))*100),b=B(()=>t.node.name==="Unnamed"?[t.node.name]:t.node.name.split(/(?=[A-Z][^A-Z])/g)),m=B(()=>e(b).reduce((I,E)=>E.length>I.length?E:I,"")),u=B(()=>()=>{const I=e(T)*.9*400,E=e(i)*.9*400,Z=I*.95/(e(m).length*.55*16),ve=E*.95/(e(b).length*1.15*16),we=Math.min(Z,ve)*.95;return Math.max(.4,Math.min(3.5,we))}),h=B(()=>e(T)>=.999&&e(i)>=.999),C=B(()=>t.node.contributors.length>0),S=33.33,D=B(()=>t.node.contributors.length+1),k=B(()=>e(C)?Math.max(S,100/e(D)):100),A=B(()=>e(C)?100-e(k):0);B(()=>e(C)?Math.min(1.2,e(A)/(t.node.contributors.length*33.33)):1),B(()=>Math.min(e(k)*.3,32));const V=B(()=>Math.min(1,Math.max(0,(e(_)-5)/7))),q=B(()=>e(_)>=25),ne=B(()=>Math.floor(Math.max(3,Math.min(12,e(_)*.15)))),he=B(()=>Math.max(1,Math.min(8,e(_)*.1))),fe=B(()=>Math.max(2,Math.min(8,e(_)*.08))),W=B(()=>Math.max(12,Math.min(40,e(_)*.5))),ae=B(()=>e(b).length*1.5),ye=B(()=>e(ae)*16),oe=B(()=>e(i)*100),se=B(()=>50+e(ye)/e(oe)*50),Oe=B(()=>100-e(se)-e(he)/e(oe)*100),ce=B(()=>(e(W)+e(fe)*2)/e(oe)*100);B(()=>e(Oe)>=e(ce));function ee(I){if(f())return;const E=t.node.id;E&&r()({nodeId:E,contributorId:I})}function P(I,E){E&&(E.stopPropagation(),E.preventDefault()),console.log(`Clicked on contributor: ${I}`)}function L(I){var E;return console.log("[DEBUG CHILD] preventAllInterference called, event type:",I.type),(E=document.getSelection())==null||E.removeAllRanges(),I.preventDefault(),I.stopPropagation(),I.stopImmediatePropagation(),!1}function J(I){const E=t.node.id;E&&c()({nodeId:E,newName:I})}function le(){const I=e(l).trim();I&&I!==t.node.name&&J(I),p(y,!1)}function Te(I){e(y)&&(I.stopPropagation(),I.stopImmediatePropagation(),e(s)&&!e(s).contains(I.target)&&le())}ze(()=>(console.log("[DEBUG CHILD] $effect triggered, isEditing:",e(y),"editInput:",e(s)),e(y)?(document.addEventListener("mousedown",Te),e(s)?(console.log("[DEBUG CHILD] editInput exists, focusing immediately"),setTimeout(()=>{var I,E;console.log("[DEBUG CHILD] Attempting to focus input, editInput:",e(s)),(I=e(s))==null||I.focus(),(E=e(s))==null||E.select(),console.log("[DEBUG CHILD] Focus/select called, document.activeElement:",document.activeElement)},10)):(console.log("[DEBUG CHILD] editInput not ready, setting up retry"),setTimeout(()=>{console.log("[DEBUG CHILD] Retry - editInput:",e(s)),e(s)?(console.log("[DEBUG CHILD] Retry focusing input"),e(s).focus(),e(s).select(),console.log("[DEBUG CHILD] Retry focus/select called, document.activeElement:",document.activeElement)):console.log("[DEBUG CHILD] Input still not ready after retry")},100))):document.removeEventListener("mousedown",Te),()=>{document.removeEventListener("mousedown",Te)})),ze(()=>{d()&&!e(y)&&t.node.id&&!f()&&(p(y,!0),p(l,t.node.name||"",!0))}),ze(()=>{a()(e(y))});var w=io(),Y=O(w),H=O(Y),be=O(H);{var Ie=I=>{var E=Qn();Ft(E),E.__keydown=[Jn,le,y],Je(E,X=>p(s,X),()=>e(s)),ie((X,Z)=>Se(E,`
          font-size: ${X??""}rem;
          width: 100%;
          max-width: ${Z??""}px;
        `),[()=>e(u)(),()=>Math.min(200,e(_)*3)]),pt("blur",E,le),Ot(E,()=>e(l),X=>p(l,X)),U(I,E)},De=I=>{var E=eo();E.__mousedown=[bt,f,t,y,l],E.__touchstart=[bt,f,t,y,l],E.__pointerdown=[bt,f,t,y,l],E.__contextmenu=L,E.__dblclick=L,st(E,21,()=>e(b),gt,(X,Z)=>{var $=$n(),ve=O($,!0);F($),ie(()=>Ve(ve,e(Z))),U(X,$)}),F(E),ie(X=>{Se(E,`font-size: ${X??""}rem;`),lt(E,"title",t.node.name)},[()=>e(u)()]),pt("selectstart",E,L),pt("dragstart",E,L),U(I,E)};de(be,I=>{e(y)?I(Ie):I(De,!1)})}F(H);var te=pe(H,2);{var Q=I=>{var E=ro(),X=O(E),Z=O(X);Z.__click=[Zn,f,t,o];var $=pe(Z,2);{var ve=re=>{var we=Ze(),ge=Le(we);{var xe=Ee=>{var Pe=Ze(),Ae=Le(Pe);st(Ae,17,()=>t.node.contributors,gt,(Ne,_e)=>{const Me=B(()=>!f());gn(Ne,{get userId(){return e(_e)},get truncateLength(){return e(ne)},get removable(){return e(Me)},onClick:(ke,We)=>P(ke,We),onRemove:ee})}),U(Ee,Pe)},ue=Ee=>{var Pe=oo(),Ae=Le(Pe);st(Ae,17,()=>t.node.contributors,gt,(Me,ke)=>{var We=to();ie((v,g,x)=>{lt(We,"title",e(ke)),Se(We,`
                  background: ${v??""};
                  width: ${g??""}px;
                  height: ${x??""}px;
                `)},[()=>At(e(ke)),()=>Math.max(6,e(W)*.4),()=>Math.max(6,e(W)*.4)]),U(Me,We)});var Ne=pe(Ae,2);{var _e=Me=>{var ke=no(),We=O(ke);F(ke),ie((v,g,x)=>{Se(ke,`
                    width: ${v??""}px;
                    height: ${g??""}px;
                    font-size: ${x??""}px;
                  `),Ve(We,`+${t.node.contributors.length-3}`)},[()=>Math.max(8,e(W)*.5),()=>Math.max(8,e(W)*.5),()=>Math.max(6,e(W)*.3)]),U(Me,ke)};de(Ne,Me=>{t.node.contributors.length>3&&Me(_e)})}U(Ee,Pe)};de(ge,Ee=>{e(q)?Ee(xe):Ee(ue,!1)})}U(re,we)};de($,re=>{e(C)&&re(ve)})}F(X),F(E),ie(re=>{Se(E,`
          position: absolute;
          opacity: ${e(V)??""};
          z-index: 1;
          top: 50%; 
          left: 70%; 
          transform: translateY(-50%);
        `),Se(X,`
            display: flex;
            align-items: center;
            justify-content: center;
            gap: ${re??""}px;
            flex-wrap: wrap;
            flex-direction: column;
          `),Se(Z,`
            width: ${e(W)??""}px;
            height: ${e(W)??""}px;
            font-size: ${e(W)*.5}px;
          `)},[()=>Math.max(2,e(fe)*.5)]),U(I,E)};de(te,I=>{e(V)>.1&&I(Q)})}F(Y),F(w),ie(I=>{Se(w,`
    background-color: ${I??""};
    border: ${(e(h)?"none":"1px solid #fff")??""};
    width: 100%;
    height: 100%;
    overflow: hidden;
    box-sizing: border-box;
  `),Se(Y,`
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: ${e(he)??""}px;
      box-sizing: border-box;
      position: relative;
    `)},[()=>vn(t.node.name)]),U(n,w),Fe()}wt(["keydown","mousedown","touchstart","pointerdown","contextmenu","dblclick","click"]);var so=z('<div class="scroll-clip svelte-1vbeh9n"><div><!></div></div>');function lo(n,t){Ue(t,!0);const o=Qe("sheetContext");if(!o)throw new Error("BottomSheet.Content must be inside a BottomSheet component");let r=rt(t,["$$slots","$$events","$$legacy","children"]);ct(()=>{c()});const c=()=>{const l=o.settings.contentAlignment==="start-fit",s=o.settings.position==="left"||o.settings.position==="right";if(o.sheetContent&&l&&s){const T=o.sheetContent,i=getComputedStyle(T),_=parseFloat(i.paddingLeft),b=parseFloat(i.paddingRight),u=T.offsetWidth-_-b;T.style.width=`${u}px`}};var a=so(),d=O(a);let f;var y=O(d);nt(y,()=>t.children??He),F(d),Je(d,l=>o.sheetContent=l,()=>o==null?void 0:o.sheetContent),F(a),ie(()=>{Se(a,`${o.settings.position==="left"&&"direction: rtl;"}`),f=ot(d,f,{...r,class:`bottom-sheet-content ${t.class??""}`,role:"document"},"svelte-1vbeh9n")}),U(n,a),Fe()}function Rt(n){const t=n-1;return t*t*t+1}const qe=(n,t)=>n>1?t-n:t-n*t,zt=n=>{for(;n&&n!==document.documentElement;){const t=window.getComputedStyle(n),o=t.overflowY,r=t.overflowX,c=o!=="visible"&&o!=="hidden"&&n.scrollHeight>n.clientHeight,a=r!=="visible"&&r!=="hidden"&&n.scrollWidth>n.clientWidth;if(n.className.split(" ").includes("bottom-sheet")&&(c||a)||c||a)return n;n=n.parentElement}return null},co=(n,{delay:t=0,duration:o=400,easing:r=Rt,axis:c="y",position:a="bottom",sheetHeight:d=0})=>{const f=getComputedStyle(n);d===0&&(d=n.offsetHeight);const y=a=="top"||a=="left",l=parseFloat(f.opacity),s=c==="y"?"translateY":"translateX",T=d,i=c==="y"?["top","bottom"]:["left","right"],_=i.map(D=>`${D[0].toUpperCase()}${D.slice(1)}`),b=parseFloat(f[`padding${_[0]}`]),m=parseFloat(f[`padding${_[1]}`]),u=parseFloat(f[`margin${_[0]}`]),h=parseFloat(f[`margin${_[1]}`]),C=parseFloat(f[`border${_[0]}Width`]),S=parseFloat(f[`border${_[1]}Width`]);return{delay:t,duration:o,easing:r,css:D=>`
            overflow: hidden;
            opacity: ${Math.min(D*20,1)*l};
            transform: ${s}(${(1-D)*(y?-1:1)*T}px);
            padding-${i[0]}: ${D*b}px;
            padding-${i[1]}: ${D*m}px;
            margin-${i[0]}: ${D*u}px;
            margin-${i[1]}: ${D*h}px;
            border-${i[0]}-width: ${D*C}px;
            border-${i[1]}-width: ${D*S}px;
        `}};var uo=z("<div><!></div>");function ho(n,t){Ue(t,!0);let o=rt(t,["$$slots","$$events","$$legacy","children"]);const r=Qe("sheetContext"),c=Qe("sheetIdentificationContext");let a,d=r.settings.position==="left"||r.settings.position==="right"?"x":"y";if(!r)throw new Error("BottomSheet.Sheet must be inside a BottomSheet component");const f=u=>{r.sheetElement&&!r.sheetElement.contains(u.target)&&!r.settings.disableClosing&&r.closeSheet()},y=()=>r.sheetElement?Array.from(r.sheetElement.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')):[],l=u=>{if(u.key==="Tab"){const h=y();if(!h.length)return;const C=h[0],S=h[h.length-1],D=!u.shiftKey;u.shiftKey&&document.activeElement===C&&(S.focus(),u.preventDefault()),D&&document.activeElement===S&&(C.focus(),u.preventDefault())}},s=()=>{switch(r.settings.position){case"bottom":case"top":return`height: 100%;  max-height: ${r.maxHeightPx-r.sheetHeight}px`;case"left":case"right":return`height: 100%; width: 100%; max-width: ${r.maxHeightPx-r.sheetHeight}px`}},T=()=>{if(!r.isDragging&&d==="x")return"transition: max-width 0.3s ease";if(!r.isDragging&&d==="y")return"transition: max-height 0.3s ease"},i=u=>{const h=u.target,C=zt(h);if(!C||d==="x")return;const S=C.scrollTop,D=C.scrollHeight,k=C.clientHeight;let A=S<=0;const V=S+k>=D-1;let q=u.deltaY<0;if(r.settings.position==="top"?A=S>=0:(A=S<=0,q=!q),A&&q||!q&&V||!A&&!V){u.stopPropagation();return}else{if(A&&!q)return;if(V&&q)return}};ze(()=>{r.isSheetOpen?(a=document.activeElement,setTimeout(()=>{var h;const u=y();u.length?u[0].focus():(h=r.sheetElement)==null||h.focus(),document.addEventListener("click",f)},100)):(document.removeEventListener("click",f),a==null||a.focus())});var _=Ze(),b=Le(_);{var m=u=>{var h=uo();let C;var S=O(h);nt(S,()=>t.children??He),F(h),Je(h,D=>r.sheetElement=D,()=>r==null?void 0:r.sheetElement),ie((D,k)=>C=ot(h,C,{...o,class:`bottom-sheet position-${r.settings.position??""} ${r.isDragging&&"prevent-select"} ${t.class??""}`,style:`${D??""};  ${k??""}; ${t.style??""}`,role:"dialog","aria-modal":"true","aria-labelledby":c.headingId,"aria-describedby":c.descriptionId,id:c.sheetId,tabindex:"-1","aria-live":"polite",onkeypress:l,ontouchstart:r.touchStartEvent,ontouchmove:r.touchMoveEvent,ontouchend:r.moveEnd,onmousedown:r.mouseDownEvent,onmouseup:r.moveEnd,onwheel:i},"svelte-1o7orpt"),[s,T]),Gt(3,h,()=>co,()=>({duration:500,easing:Rt,axis:d,position:r.settings.position,sheetHeight:r.maxHeightPx})),U(u,h)};de(b,u=>{r.isSheetOpen&&u(m)})}U(n,_),Fe()}var fo=z("<div><!></div>");function vo(n,t){var le,Te;Ue(t,!0);let o=me(t,"isSheetOpen",15,!1),r=me(t,"settings",19,()=>({closeThreshold:.9,autoCloseThreshold:0,maxHeight:.7,snapPoints:[1],startingSnapPoint:1,disableDragging:!1,position:"bottom",disableClosing:!1,contentAlignment:"flex"}));const c={closeThreshold:.9,autoCloseThreshold:0,maxHeight:.7,snapPoints:[1],startingSnapPoint:1,disableDragging:!1,position:"bottom",disableClosing:!1,contentAlignment:"flex"};(le=r().snapPoints)!=null&&le.includes(1)||(Te=r().snapPoints)==null||Te.push(1);const a=B(()=>({...c,...r()}));let d=new AbortController;ct(()=>{p(f,window.innerWidth,!0),p(y,window.innerHeight,!0)}),ze(()=>{var w,Y;o()?((w=t.onopen)==null||w.call(t),d=new AbortController,document.addEventListener("wheel",H=>{H.preventDefault()},{passive:!1,signal:d.signal}),document.addEventListener("touchmove",H=>{H.cancelable&&H.preventDefault()},{passive:!1,signal:d.signal}),document.addEventListener("mouseup",ce),document.addEventListener("mousemove",oe),document.addEventListener("touchmove",q,{passive:!1}),document.addEventListener("keydown",ne)):((Y=t.onclose)==null||Y.call(t),V(e(a).startingSnapPoint,!1),document.removeEventListener("mouseup",ce),document.removeEventListener("touchmove",q),document.removeEventListener("keydown",ne),document.removeEventListener("mousemove",oe),d.abort())});let f=G(0),y=G(0),l=G(0),s=G(!1),T=B(()=>{const{maxHeight:w,position:Y}=e(a);return w>1?w:(Y==="left"||Y==="right"?e(f):e(y))*w}),i=G(null),_=G(null),b=G(!1),m=G(!1),u,h,C=0,S=0;const D=`bottom-sheet-${Math.random().toString(36).substr(2,9)}`,k=`${D}-heading`,A=`${D}-description`,V=(w,Y=!0)=>{var H;return e(a).snapPoints.includes(w)?(p(l,qe(w,e(T)),!0),Y&&((H=t.onsnap)==null||H.call(t,w)),!0):!1},q=w=>{window.scrollY===0&&w.touches[0].clientY>50&&w.preventDefault()},ne=w=>{w.key==="Escape"&&!e(a).disableClosing&&ee.closeSheet()},he=()=>{if(e(l)>qe(e(a).autoCloseThreshold,e(T))){p(l,0),ee.closeSheet(),ce();return}},fe=w=>{ae(w.touches[0].clientY,w.touches[0].clientX)},W=w=>{ae(w.clientY,w.clientX)},ae=(w,Y)=>{var H,be;e(a).disableDragging||(u=w,S=Y,h=e(l),p(b,!0),C=((H=e(_))==null?void 0:H.scrollTop)??0,(be=t.onsheetdragstart)==null||be.call(t))},ye=(w,Y)=>{let H=0;return e(a).position==="bottom"?e(s)?H=Math.max(0,w-u+h):H=Math.max(0,w-u-C+h):e(a).position==="top"?e(s)?H=Math.max(0,u-w+h):H=Math.max(0,u-w-C+h):e(a).position==="left"?e(s)?H=Math.max(0,S-Y+h):H=Math.max(0,S-Y-C+h):e(a).position==="right"&&(e(s)?H=Math.max(0,Y-S+h):H=Math.max(0,Y-S-C+h)),H},oe=w=>{var H;if(!e(b))return;p(s,!0);let Y=ye(w.clientY,w.clientX);e(l)!=0&&p(m,!0),p(l,Y,!0),(H=t.onsheetdrag)==null||H.call(t),he()},se=w=>{var Ie;if(!e(b)||!e(_))return;const Y=w.target,H=zt(Y);if(!e(s)&&!e(m)&&H){const{clientY:De,clientX:te}=w.touches[0],{scrollTop:Q,scrollLeft:I,scrollHeight:E,clientHeight:X,scrollWidth:Z,clientWidth:$}=H,ve=e(a).position==="top"||e(a).position==="bottom";let ge=(ve?De:te)>(ve?u:S);const xe=ve?Math.round(Q)+X>=E:Math.round(I)+$>=Z;let ue;switch(e(a).position){case"top":ue=Q>=0;break;case"bottom":ue=Q<=0,ge=!ge;break;case"left":ue=I>=0;break;case"right":ue=I<=0,ge=!ge;break}if(ue&&ge||!ge&&xe||!ue&&!xe){w.stopPropagation();return}else if(ue&&!ge){p(m,!0);return}else if(xe&&ge)return}let be=ye(w.touches[0].clientY,w.touches[0].clientX);e(l)!=0&&p(m,!0),p(l,be,!0),(Ie=t.onsheetdrag)==null||Ie.call(t),he()},Oe=()=>{var De,te;if(e(a).disableDragging)return;if((De=t.onsheetdragend)==null||De.call(t),e(a).snapPoints.length===1){e(l)>qe(e(a).closeThreshold,e(T))?(ee.closeSheet(),p(l,0)):p(l,0),ce();return}let w=e(a).snapPoints.map(Q=>qe(Q,e(T)));const Y=Math.max(...w);if(e(l)>Y){p(l,0),ee.closeSheet(),ce();return}const H=e(l)<h,be=qe(.95,e(T));if(H&&e(l)>h-be||!H&&e(l)<h+be){p(l,h,!0),ce();return}const Ie=e(a).snapPoints.map(Q=>({original:Q,converted:qe(Q,e(T))})).filter(Q=>H?Q.converted<e(l):Q.converted>e(l));if(Ie.length>0){const Q=Ie.reduce((I,E)=>H?E.converted>I.converted?E:I:E.converted<I.converted?E:I);(te=t.onsnap)==null||te.call(t,Q.original),p(l,Q.converted,!0)}ce()},ce=()=>{p(b,!1),p(m,!1),p(s,!1)},ee={get sheetHeight(){return e(l)},set sheetHeight(w){p(l,w,!0)},get isSheetOpen(){return o()},set isSheetOpen(w){o(w)},get isDragging(){return e(b)},set isDragging(w){p(b,w,!0)},get isMovingSheet(){return e(m)},set isMovingSheet(w){p(m,w,!0)},get isDraggingFromHandle(){return e(s)},set isDraggingFromHandle(w){p(s,w,!0)},get sheetContent(){return e(i)},set sheetContent(w){p(i,w,!0)},get sheetElement(){return e(_)},set sheetElement(w){p(_,w,!0)},get maxHeightPx(){return e(T)},get settings(){return e(a)},touchStartEvent:fe,mouseDownEvent:W,mouseMoveEvent:oe,touchMoveEvent:se,moveEnd:Oe,openSheet:()=>{o(!0)},closeSheet:()=>{o(!1)},toggleSheet:()=>{o(!o())}};let P={sheetId:D,headingId:k,descriptionId:A};V(e(a).startingSnapPoint,!1),Pt("sheetContext",ee),Pt("sheetIdentificationContext",P);var L=fo(),J=O(L);return nt(J,()=>t.children??He),F(L),U(n,L),Fe({setSnapPoint:V})}var go=z("<div><!></div>");function mo(n,t){Ue(t,!0);let o=rt(t,["$$slots","$$events","$$legacy","children"]);const r=Qe("sheetContext"),c=Qe("sheetIdentificationContext");if(!r)throw new Error("BottomSheet.Trigger must be inside a BottomSheet component");const a=()=>{r.toggleSheet()};var d=go(),f=s=>{(s.key==="Enter"||s.key===" ")&&a()};let y;var l=O(d);nt(l,()=>t.children??He),F(d),ie(()=>y=ot(d,y,{...o,role:"button",tabindex:"0","aria-haspopup":"dialog","aria-controls":c.sheetId,"aria-expanded":r.isSheetOpen?"true":"false",onclick:a,onkeydown:f})),U(n,d),Fe()}const po=n=>n;function bo(n,{delay:t=0,duration:o=400,easing:r=po}={}){const c=+getComputedStyle(n).opacity;return{delay:t,duration:o,easing:r,css:a=>`opacity: ${a*c}`}}var _o=z("<div></div>"),yo=z("<!> <!>",1);function wo(n,t){Ue(t,!0);const o=Qe("sheetContext");if(!o)throw new Error("BottomSheet.Overlay must be inside a BottomSheet component");let r=rt(t,["$$slots","$$events","$$legacy","children"]);var c=yo(),a=Le(c);{var d=y=>{var l=_o();let s;ie(()=>s=ot(l,s,{...r,role:"presentation","aria-hidden":"true",class:`bottom-sheet-overlay ${t.class??""}`},"svelte-msj0u3")),Gt(3,l,()=>bo,()=>({duration:200})),U(y,l)};de(a,y=>{o.isSheetOpen&&y(d)})}var f=pe(a,2);nt(f,()=>t.children??He),U(n,c),Fe()}var xo=z("<div></div>");function jt(n,t){Ue(t,!0);let o=rt(t,["$$slots","$$events","$$legacy"]);var r=xo();let c;ie(()=>c=ot(r,c,{...o,class:`bottom-sheet-grip ${t.class??""}`,"aria-hidden":"true"},"svelte-hvzhvz")),U(n,r),Fe()}var Eo=z('<div class="handle-grip-wrapper svelte-1keauf3"><!></div>'),Co=z('<div class="handle-grip-wrapper svelte-1keauf3"><!></div>'),So=z("<div><!></div>");function To(n,t){Ue(t,!0);const o=Qe("sheetContext");if(!o)throw new Error("BottomSheet.Overlay must be inside a BottomSheet component");let r=rt(t,["$$slots","$$events","$$legacy","children"]),c=G(dt({})),a=G(dt({}));ct(()=>{(o.settings.position==="left"||o.settings.position==="right")&&(e(c).style.width=`${e(a).getBoundingClientRect().width}px`)});const d=b=>{if(o.settings.disableDragging)return;const m=o.maxHeightPx;let h=o.settings.snapPoints.map(S=>qe(S,m)).sort((S,D)=>D-S);const C=h.findIndex(S=>Math.abs(S-o.sheetHeight)<10);switch(b.key){case"ArrowUp":b.preventDefault(),C<h.length-1&&(o.sheetHeight=h[C+1]);break;case"ArrowDown":b.preventDefault(),C>0?o.sheetHeight=h[C-1]:o.settings.disableClosing||o.closeSheet();break;case"Home":b.preventDefault(),o.sheetHeight=h[h.length-1];break;case"End":b.preventDefault(),o.sheetHeight=h[0];break}};var f=So(),y=()=>o.isDraggingFromHandle=!0,l=()=>o.isDraggingFromHandle=!0;let s;var T=O(f);{var i=b=>{var m=Eo(),u=O(m);nt(u,()=>t.children??He),F(m),Je(m,h=>p(a,h),()=>e(a)),U(b,m)},_=b=>{var m=Co(),u=O(m);jt(u,{}),F(m),Je(m,h=>p(a,h),()=>e(a)),U(b,m)};de(T,b=>{t.children?b(i):b(_,!1)})}F(f),Je(f,b=>p(c,b),()=>e(c)),ie(b=>s=ot(f,s,{...r,class:`handle-container position-${o.settings.position??""} ${t.class??""}`,onmousemove:y,ontouchmove:l,role:"slider",tabindex:"0","aria-label":"Sheet height control","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":b,onkeydown:d},"svelte-1keauf3"),[()=>Math.round((1-o.sheetHeight/window.innerHeight)*100)]),U(n,f),Fe()}const Be=vo;Be.Content=lo;Be.Sheet=ho;Be.Trigger=mo;Be.Overlay=wo;Be.Handle=To;Be.Grip=jt;var Io=z('<div class="message svelte-rctndy">Loading...</div>'),Do=z('<div class="message svelte-rctndy"> </div>'),Po=(n,t,o)=>t(e(o).id,e(o).name,e(o).metadata),No=z('<div class="item-meta svelte-rctndy"> </div>'),Mo=z('<div class="item svelte-rctndy"><div class="color-dot svelte-rctndy"></div> <div class="item-content svelte-rctndy"><div class="item-name svelte-rctndy"> </div> <!></div></div>'),ko=z('<h3 class="title svelte-rctndy"> </h3> <input type="text" class="search-input svelte-rctndy"> <!>',1),Ho=z("<!> <!>",1);function Lo(n,t){Ue(t,!0);function o(S,D=20){return!S||S.length<=D?S:S.slice(0,D-3)+"..."}let r=me(t,"title",3,"Select Item"),c=me(t,"searchPlaceholder",3,"Search..."),a=me(t,"maxHeight",3,.8),d=me(t,"filterText",3,""),f=me(t,"show",3,!1),y=me(t,"select",3,S=>{}),l=me(t,"close",3,()=>{}),s=G(null),T=G(!1),i=G(dt(d())),_=G(dt(f()));ze(()=>{p(_,f())}),ze(()=>{p(i,d())});function b(){p(_,!1),l()()}function m(S,D,k){y()({id:S,name:D,metadata:k}),b()}function u(){e(T)||(setTimeout(()=>{e(s)&&e(s).focus()},100),p(T,!0))}ze(()=>{e(i)!==void 0&&t.dataProvider.search(e(i))});function h(){p(T,!1),b()}const C=B(()=>({maxHeight:a(),disableClosing:!1,position:"bottom"}));Be(n,{get settings(){return e(C)},onopen:u,onclose:h,get isSheetOpen(){return e(_)},set isSheetOpen(S){p(_,S,!0)},children:(S,D)=>{var k=Ze(),A=Le(k);ft(A,()=>Be.Overlay,(V,q)=>{q(V,{children:(ne,he)=>{var fe=Ze(),W=Le(fe);ft(W,()=>Be.Sheet,(ae,ye)=>{ye(ae,{children:(oe,se)=>{var Oe=Ho(),ce=Le(Oe);ft(ce,()=>Be.Handle,(P,L)=>{L(P,{})});var ee=pe(ce,2);ft(ee,()=>Be.Content,(P,L)=>{L(P,{children:(J,le)=>{var Te=ko(),w=Le(Te),Y=O(w,!0);F(w);var H=pe(w,2);Ft(H),Je(H,te=>p(s,te),()=>e(s));var be=pe(H,2);{var Ie=te=>{var Q=Io();U(te,Q)},De=(te,Q)=>{{var I=X=>{var Z=Do(),$=O(Z,!0);F(Z),ie(()=>Ve($,e(i)?"No matching items found":"No items available")),U(X,Z)},E=X=>{var Z=Ze(),$=Le(Z);st($,17,()=>t.dataProvider.items,ve=>ve.id,(ve,re)=>{var we=Mo();we.__click=[Po,m,re];var ge=O(we),xe=pe(ge,2),ue=O(xe),Ee=O(ue,!0);F(ue);var Pe=pe(ue,2);{var Ae=Ne=>{var _e=No(),Me=O(_e);F(_e),ie(()=>Ve(Me,`(${e(re).metadata.contributorCount??""} contributors)`)),U(Ne,_e)};de(Pe,Ne=>{var _e;((_e=e(re).metadata)==null?void 0:_e.contributorCount)!==void 0&&Ne(Ae)})}F(xe),F(we),ie((Ne,_e)=>{lt(we,"data-id",e(re).id),Se(ge,`background-color: ${Ne??""}`),lt(ue,"title",e(re).name||e(re).id),Ve(Ee,_e)},[()=>e(re).color||At(e(re).id),()=>o(e(re).name||e(re).id,20)]),U(ve,we)}),U(X,Z)};de(te,X=>{t.dataProvider.items.length===0?X(I):X(E,!1)},Q)}};de(be,te=>{t.dataProvider.loading&&t.dataProvider.items.length===0?te(Ie):te(De,!1)})}ie(()=>{Ve(Y,r()),lt(H,"placeholder",c())}),Ot(H,()=>e(i),te=>p(i,te)),U(J,Te)},$$slots:{default:!0}})}),U(oe,Oe)},$$slots:{default:!0}})}),U(ne,fe)},$$slots:{default:!0}})}),U(S,k)},$$slots:{default:!0}}),Fe()}wt(["click"]);var Bo=(n,t,o)=>t(n,e(o)),Uo=(n,t)=>t(n),Fo=(n,t,o)=>t(n,e(o)),Oo=(n,t)=>t(n),Ao=n=>n.preventDefault(),Wo=z("<div><!></div>"),Go=z('<div class="empty-state svelte-7hj7rp"><div class="add-node-prompt svelte-7hj7rp"><button class="add-node-button svelte-7hj7rp"><span class="add-icon svelte-7hj7rp">➕</span> <span class="add-text"> </span></button></div></div>'),Ro=z('<div class="node-container svelte-7hj7rp"><div class="app-content svelte-7hj7rp"><div class="treemap-container svelte-7hj7rp"><!></div></div> <!></div>');function zo(n,t){Ue(t,!0);const[o,r]=Ut(),c=()=>Ke(Ge,"$userTree",o),a=()=>Ke(en,"$currentPath",o),d=()=>Ke(tn,"$userpub",o);let f=G(0);const y=["Node","Value","Goal","Dependency","Desire","Contribution"];let l=G(0);function s(){Nt(l),console.log("[UI FLOW] Triggered update",e(l))}let T=G(!1),i=G(dt({x:0,y:0})),_=G(null),b=G(!1),m=mn([]),u=G(0),h=G(!1),C=G(null),S=G(!1),D=G(!1),k=G(null),A=G(null);const V=350,q=16,ne=.03,he=-.03,fe=250,W=B(c),ae=B(a),ye=B(d),oe=B(()=>e(ae).length===0&&e(ye)?e(ye):e(ae).length>0?e(ae)[e(ae).length-1]:null),se=B(()=>!e(W)&&e(oe)&&e(ye)&&e(oe)===e(ye)?(console.log("[UI FLOW] Waiting for tree to be loaded"),null):!e(W)||!e(oe)?null:Xe(e(W),e(oe))),Oe=B(()=>e(se)?e(se).children:[]),ce=B(()=>{if(!e(se))return{id:"",selfPoints:0,children:[]};const v=e(Oe).map(g=>({id:g.id,points:g.type==="NonRootNode"?g.points:0,nodeName:g.name,contributors:g.type==="NonRootNode"?g.contributor_ids:[],children:[]}));return{id:e(se).id,selfPoints:e(se).type==="NonRootNode"?e(se).points:0,children:v}}),ee=B(()=>{var Ce,$e,et,Ye,ut;e(l);const v=e(ce),g={id:v.id,points:0,children:v.children};console.log("[DEBUG] Creating hierarchy with data:",v),console.log("[DEBUG] Current tree state:",e(W)),console.log("[DEBUG] Current node:",e(se)),console.log("[DEBUG] Children points:",v.children.map(R=>({name:R.nodeName,points:R.points}))),console.log("[DEBUG] Original children from tree:",($e=(Ce=e(se))==null?void 0:Ce.children)==null?void 0:$e.map(R=>({name:R.name,points:R.type==="NonRootNode"?R.points:0})));const x=xt(g,R=>R.children);x.sum(R=>R.points),console.log("[DEBUG] After sum - hierarchy values:",(et=x.children)==null?void 0:et.map(R=>({name:R.data.nodeName,points:R.data.points,value:R.value}))),x.sort((R,tt)=>tt.value-R.value),console.log("[DEBUG] After sort - hierarchy values:",(Ye=x.children)==null?void 0:Ye.map(R=>({name:R.data.nodeName,points:R.data.points,value:R.value})));function M(R,tt,ht,Et,Ct){Vn(R,0,0,1,1);for(const je of R.children||[])je.x0=tt+je.x0*(Et-tt),je.x1=tt+je.x1*(Et-tt),je.y0=ht+je.y0*(Ct-ht),je.y1=ht+je.y1*(Ct-ht)}const j=Kn().tile(M).size([1,1]).padding(.005).round(!1)(x);return console.log("[DEBUG] After treemap - final dimensions:",(ut=j.children)==null?void 0:ut.map(R=>({name:R.data.nodeName,points:R.data.points,value:R.value,width:(R.x1-R.x0)*100,height:(R.y1-R.y0)*100}))),j});ct(()=>{document.addEventListener("mouseup",E),document.addEventListener("touchend",E),document.addEventListener("touchcancel",E);const v=setInterval(()=>{p(f,(e(f)+1)%y.length)},4e3),g=Ge.subscribe(x=>{x&&(console.log("[UI FLOW] userTree updated, triggering UI update"),s())});return()=>{e(k)!==null&&clearInterval(e(k)),e(A)!==null&&clearTimeout(e(A)),clearInterval(v),document.removeEventListener("mouseup",E),document.removeEventListener("touchend",E),document.removeEventListener("touchcancel",E),g()}});function P(v){console.log("[UI FLOW] zoomInto called for node:",v),K.zoomInto(v),console.log("[UI FLOW] Navigation handled")}async function L(){if(console.log("[UI FLOW] handleAddNode started"),!e(oe)){console.log("[UI FLOW] No currentNodeId, aborting");return}const g=(()=>{var Ce;if(!((Ce=e(ee))!=null&&Ce.children)||e(ee).children.length===0)return console.log("[UI FLOW] No siblings, setting new node to 100 points"),100;const N=e(ee).children.reduce(($e,et)=>{var Ye;return $e+(((Ye=et.data)==null?void 0:Ye.points)||0)},0),j=Math.max(1,N*.2);return console.log("[UI FLOW] Calculated points based on siblings:",j),j})(),x=`node_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,M="New Node";console.log("[UI FLOW] Creating new node:",{id:x,points:g,name:M}),console.log("[UI FLOW] Current parent:",e(oe)),console.log("[UI FLOW] Current path:",e(ae));try{if(!e(W)){K.showToast("Error creating node: No tree found","error");return}if(!e(se)){K.showToast("Error creating node: Current node not found","error");return}const N=structuredClone(e(W)),j=Xe(N,e(oe));if(!j){K.showToast("Error creating node: Current node not found in updated tree","error");return}sn(j,x,M,g),Ge.set(N),s(),console.log("[UI FLOW] addNode successful"),K.showToast("New node created","success"),console.log("[UI FLOW] Setting node to edit mode:",x),setTimeout(()=>{K.nodeToEdit=x,console.log("[UI FLOW] Node edit mode set"),console.log("userTree Parent.275",c())},50)}catch(N){console.error("[UI FLOW] Error in handleAddNode:",N),K.showToast("Error creating node","error")}}function J(v){const{nodeId:g,newName:x}=v;try{if(!e(W))return;const M=structuredClone(e(W));rn(M,g,N=>{an(N,x)}),Ge.set(M),s(),K.nodeToEdit="",K.showToast(`Node renamed to "${x}"`,"success")}catch(M){console.error(`Error updating name for node ${g}:`,M),K.showToast("Error updating node name","error")}}function le(v){p(b,v,!0)}function Te(v){const{nodeId:g,clientX:x,clientY:M}=v;p(_,g,!0),p(i,{x,y:M},!0),p(T,!0)}function w(v){const{nodeId:g,contributorId:x}=v;try{if(!e(W))return;const M=structuredClone(e(W)),N=Xe(M,g);if(!N||N.type!=="NonRootNode")return;const j=N.contributor_ids.filter(Ce=>Ce!==x);N.contributor_ids=j,Ge.set(M),s(),K.showToast("Contributor removed successfully","success")}catch(M){console.error("Error removing contributor:",M),K.showToast("Error removing contributor","error")}}function Y(v){const{id:g}=v;if(!e(_)){console.error("No node selected for adding contributor");return}be(e(_),g),p(T,!1),p(_,null)}function H(){p(T,!1),p(_,null)}function be(v,g){try{if(!e(W))return;const x=structuredClone(e(W)),M=Xe(x,v);if(!M||M.type!=="NonRootNode")return;if(!M.contributor_ids.includes(g)){const j=[...M.contributor_ids];j.push(g),dn(M,j),Ge.set(x),s(),K.showToast("Contributor added successfully","success")}}catch(x){console.error("Error adding contributor:",x),K.showToast("Error adding contributor","error")}}function Ie(v){if(!e(W))return 0;const g=Xe(e(W),v);return g?on(g,e(W)):0}function De(v,g=!1){K.deleteMode||e(b)||(e(k)!==null&&clearInterval(e(k)),e(A)!==null&&clearTimeout(e(A)),p(S,!1),p(D,!1),p(A,window.setTimeout(()=>{e(h)&&e(C)===v.data.id&&(p(S,!0),p(D,g,!0),p(k,window.setInterval(()=>{if(!e(h)){te();return}let x;const M=v.data.points;g?x=M*he:x=M*ne;const N=Math.max(1,M+x);if(isNaN(N)){console.error("Growth calculation resulted in NaN:",{currentPoints:M,rate:x,isShrinking:g});return}Q(v,N)},q),!0))},V),!0))}function te(){var v;if(p(h,!1),e(S)&&e(C)&&e(ee)){const g=(v=e(ee).children)==null?void 0:v.find(x=>x.data.id===e(C));g&&g.data&&g.data.id&&I(g.data.id,g.data.points)}p(C,null),e(A)!==null&&clearTimeout(e(A)),e(k)!==null&&clearInterval(e(k)),p(k,null),p(S,!1),p(D,!1)}function Q(v,g){v.data.points=g,Nt(l)}function I(v,g){try{if(!e(W))return;const x=structuredClone(e(W)),M=Xe(x,v);if(!M||M.type!=="NonRootNode")return;nn(M,g),Ge.set(x),s()}catch(x){console.error(`Error saving points for node ${v}:`,x),K.showToast("Error saving node points","error")}}function E(){e(h)&&(te(),xe())}let X=G(null),Z=G(!1),$=G(!1);function ve(v,g){p($,v.touches.length===2),console.log("[DEBUG] TouchStart - touches:",v.touches.length,"isMultiTouch:",e($))}function re(v){v.touches.length<2&&p($,!1)}function we(v,g){if(console.log("[DEBUG] PointerDown - isPrimary:",v.isPrimary,"button:",v.button,"isMultiTouch:",e($)),!v.isPrimary)return;const x=v.target;if(x&&(x.closest(".node-text")||x.closest(".node-text-edit-container")||x.closest(".add-contributor-button")||x.closest(".tag-container")||x.closest(".contributor-container")||x.closest(".node-title")||x.closest(".node-title-area")||x.closest(".title-segment")||x.closest(".node-edit-input")||x.closest(".contributors-area"))){console.log("[DEBUG] Ignoring pointer event on text/contributor element:",x.className);return}if(!e(Z))if(p(X,v.pointerId,!0),p(Z,!0),p(h,!0),p(u,Date.now(),!0),p(C,g.data.id,!0),v.pointerType==="touch")setTimeout(()=>{if(!e(Z))return;const M=v.button===2||e($);console.log("[DEBUG] Delayed processing - isShrinking:",M,"button:",v.button,"isMultiTouch:",e($)),De(g,M)},50);else{const M=v.button===2||e($);console.log("[DEBUG] Immediate processing - isShrinking:",M,"button:",v.button,"isMultiTouch:",e($)),De(g,M)}}function ge(v){if(!v.isPrimary||v.pointerId!==e(X))return;const g=v.target;if(g&&(g.closest(".node-text")||g.closest(".node-text-edit-container")||g.closest(".add-contributor-button")||g.closest(".tag-container")||g.closest(".contributor-container")||g.closest(".node-title")||g.closest(".node-title-area")||g.closest(".title-segment")||g.closest(".node-edit-input")||g.closest(".contributors-area"))){xe();return}const M=Date.now()-e(u)>=fe||e(S),N=e(C);te(),!M&&N&&(K.deleteMode?ue(N):P(N)),xe()}function xe(){p(X,null),p(Z,!1),p($,!1)}ze(()=>{e(ae),xe()});function ue(v){if(confirm("Delete this node and all its children?"))try{if(!e(W))return;const g=structuredClone(e(W)),x=ln(g,v);if(!x){console.error("Cannot find parent node");return}if(v===e(ae)[0]){console.error("Cannot delete root node"),K.showToast("Cannot delete root node","error");return}if(e(oe)===v){if(e(ae).length<=1){console.error("Cannot delete current node with no parent");return}K.zoomOut()}if(!Xe(g,v)){K.showToast("Node not found","error");return}const j=x.children.findIndex(Ce=>Ce.id===v);j!==-1&&x.children.splice(j,1),Ge.set(g),s(),K.showToast("Node deleted successfully","success")}catch(g){console.error(`Error in deletion process: ${g}`),K.showToast("Error deleting node","error")}}var Ee=Ro(),Pe=O(Ee),Ae=O(Pe),Ne=O(Ae);{var _e=v=>{var g=Ze(),x=Le(g);st(x,17,()=>e(ee).children,gt,(M,N)=>{var j=Wo();let Ce;j.__pointerdown=[Bo,we,N],j.__pointerup=[Uo,ge],j.__touchstart=[Fo,ve,N],j.__touchend=[Oo,re],j.__contextmenu=[Ao];var $e=O(j);const et=B(()=>({id:e(N).data.id,name:e(N).data.nodeName||"Unnamed",points:e(N).data.points,contributors:e(N).data.contributors||[],fulfillment:Ie(e(N).data.id)})),Ye=B(()=>({x0:e(N).x0,y0:e(N).y0,x1:e(N).x1,y1:e(N).y1})),ut=B(()=>K.nodeToEdit===e(N).data.id);ao($e,{get node(){return e(et)},get dimensions(){return e(Ye)},addContributor:Te,removeContributor:w,onTextEdit:J,onEditModeChange:le,get shouldEdit(){return e(ut)},get deleteMode(){return K.deleteMode}}),F(j),ie(R=>{Ce=_t(j,1,"clickable",null,Ce,R),Se(j,`
							position: absolute;
							left: ${e(N).x0*100}%;
							top: ${e(N).y0*100}%;
							width: ${(e(N).x1-e(N).x0)*100}%;
							height: ${(e(N).y1-e(N).y0)*100}%;
							box-sizing: border-box;
						`)},[()=>({deleting:K.deleteMode,growing:e(S)&&e(C)===e(N).data.id&&!e(D),shrinking:e(S)&&e(C)===e(N).data.id&&e(D)})]),U(M,j)}),U(v,g)},Me=v=>{var g=Go(),x=O(g),M=O(x);M.__click=L;var N=pe(O(M),2),j=O(N,!0);F(N),F(M),F(x),F(g),ie(()=>Ve(j,y[e(f)])),U(v,g)};de(Ne,v=>{e(ee)&&e(ee).children&&e(ee).children.length>0?v(_e):v(Me,!1)})}F(Ae),F(Pe);var ke=pe(Pe,2);{var We=v=>{Lo(v,{get show(){return e(T)},title:"Select Contributor",searchPlaceholder:"Search users...",dataProvider:m,select:Y,close:H})};de(ke,v=>{e(T)&&v(We)})}F(Ee),U(n,Ee),Fe(),r()}wt(["pointerdown","pointerup","touchstart","touchend","contextmenu","click"]);var jo=z("your<br>recognition",1),Yo=z(`<div class="placeholder svelte-1ghmyps"><p>You have not yet recognized any contributors! Adding contributors to a node makes it a
							contribution!</p></div>`),Xo=z("mutual<br>recognition",1),qo=z(`<div class="placeholder svelte-1ghmyps"><p>You don't have any mutual contributors yet!</p></div>`),Ko=z('<div class="layout root-page svelte-1ghmyps"><div class="parent svelte-1ghmyps"><!></div> <div class="bars svelte-1ghmyps"><div><div class="bar-label svelte-1ghmyps"><!></div> <div class="bar-area svelte-1ghmyps"><!></div></div> <div><div class="bar-label svelte-1ghmyps"><!></div> <div class="bar-area svelte-1ghmyps"><!></div></div></div></div>');function rr(n,t){Ue(t,!0);const[o,r]=Ut(),c=()=>Ke(Ge,"$userTree",o),a=()=>Ke(kt,"$userSogf",o),d=()=>Ke(s,"$barSegments",o),f=()=>Ke(T,"$providerSegments",o);let y=G(!1),l;const s=Lt(kt,P=>!P||Object.keys(P).length===0?[]:Object.entries(P).filter(([L,J])=>J>0).map(([L,J])=>({id:L,value:J*100})).sort((L,J)=>J.value-L.value)),T=Lt(cn,P=>{if(console.log("[UI] providerShares changed:",P),!P||Object.keys(P).length===0)return console.log("[UI] No provider shares data for segments"),[];const L=Object.entries(P).filter(([J,le])=>le>0).map(([J,le])=>({id:J,value:le*100})).sort((J,le)=>le.value-J.value);return console.log("[UI] Generated provider segments:",L),L});ct(()=>{const P=c(),L=a();P&&(!L||Object.keys(L).length===0)&&un(),l=window.matchMedia("(max-width: 768px)");function J(le){p(y,le.matches,!0)}return J(l),l.addEventListener("change",J),()=>{l.removeEventListener("change",J)}});var i=Ko(),_=O(i),b=O(_);zo(b,{}),F(_);var m=pe(_,2),u=O(m);let h;var C=O(u),S=O(C);{var D=P=>{var L=jo();Mt(2),U(P,L)},k=P=>{var L=St("YR");U(P,L)};de(S,P=>{e(y)?P(D):P(k,!1)})}F(C);var A=pe(C,2),V=O(A);{var q=P=>{const L=B(()=>!e(y));Ht(P,{get segments(){return d()},width:"100%",height:"100%",get vertical(){return e(L)},showLabels:!1,showValues:!1,rounded:!1})},ne=P=>{var L=Yo();U(P,L)};de(V,P=>{d().length>0?P(q):P(ne,!1)})}F(A),F(u);var he=pe(u,2);let fe;var W=O(he),ae=O(W);{var ye=P=>{var L=Xo();Mt(2),U(P,L)},oe=P=>{var L=St("MR");U(P,L)};de(ae,P=>{e(y)?P(ye):P(oe,!1)})}F(W);var se=pe(W,2),Oe=O(se);{var ce=P=>{const L=B(()=>!e(y));Ht(P,{get segments(){return f()},width:"100%",height:"100%",get vertical(){return e(L)},showLabels:!1,showValues:!1,rounded:!1})},ee=P=>{var L=qo();U(P,L)};de(Oe,P=>{f().length>0?P(ce):P(ee,!1)})}F(se),F(he),F(m),F(i),ie((P,L)=>{h=_t(u,1,"bar-group svelte-1ghmyps",null,h,P),fe=_t(he,1,"bar-group svelte-1ghmyps",null,fe,L)},[()=>({vertical:!e(y)}),()=>({vertical:!e(y)})]),U(n,i),Fe(),r()}export{rr as component};
