import{t as g,a as u,d as At,e as Lt}from"../chunks/B8YV51FY.js";import{H as it,ad as I,af as q,I as Oe,z as Nt,X as i,J as lt,j as e,aq as It,l as o,K as a,M as r,W as O,V as ne,ar as St}from"../chunks/D8QEN0Si.js";import{d as Ut,s as S,e as Vt}from"../chunks/BdftctrX.js";import{i as E,b as at,s as Ht,a as pe}from"../chunks/BZ-QgN3O.js";import{s as m,g as h,f as rt,a as Mt,u as Me,c as ot,b as Ft,d as Ot,i as Rt,e as Wt,h as Re,j as Bt,r as Ce,k as Dt,l as Fe,m as jt,n as qt,o as Gt,p as Jt,q as Kt}from"../chunks/Bj8vwbLL.js";import{s as Xt,b as Q,g as ct}from"../chunks/DH5dSDNG.js";import{G as Qt}from"../chunks/Bo4nBXrY.js";const Yt=!0,Zt=!0,zt=!0,Va=Object.freeze(Object.defineProperty({__proto__:null,csr:zt,prerender:Yt,ssr:Zt},Symbol.toStringTag,{value:"Module"})),ea=()=>{const p=Xt;return{page:{subscribe:p.page.subscribe},navigating:{subscribe:p.navigating.subscribe},updated:p.updated}},ta={subscribe(p){return ea().page.subscribe(p)}};function st(p,c,w){o(c,!e(c)),e(c)||w()}function aa(p,c){p.preventDefault(),o(c,!0)}function ra(p,c){o(c,!e(c))}function nt(p,c,w,ie,z){o(c,!e(c)),o(w,""),o(ie,""),o(z,!1)}async function oa(){try{await jt(),h.resetState(),h.showToast("Signed out successfully","info"),ct(Q+"/")}catch(p){console.error("Logout error:",p),h.showToast("Error during sign out","error")}}async function sa(p,c){if(!e(c)){h.showToast("No tree data available to copy","error");return}try{const w=JSON.stringify(e(c),null,2);await navigator.clipboard.writeText(w),h.showToast("Tree data copied to clipboard","success")}catch(w){console.error("Error copying tree:",w),h.showToast("Failed to copy tree data","error")}}var na=g('<div class="breadcrumb-item loading-path svelte-nwoc83">Loading...</div>'),ia=(p,c)=>c(0,p),la=g('<a class="breadcrumb-item auth-root current svelte-nwoc83" tabindex="0"> </a>'),ca=g('<button class="breadcrumb-item loading-path svelte-nwoc83" tabindex="0" aria-label="Show login panel">Login</button>'),da=g('<div class="breadcrumb-separator svelte-nwoc83">/</div>'),va=g('<!> <a tabindex="0"> </a>',1),ua=g('<div class="loading-state svelte-nwoc83"><div class="spinner svelte-nwoc83"></div> <p class="svelte-nwoc83">Checking authentication...</p></div>'),pa=(p,c,w)=>c(w()),wa=g('<button class="copy-pub-btn svelte-nwoc83" title="Click to copy your public key"><span class="pub-text svelte-nwoc83"> </span> <span class="copy-icon svelte-nwoc83">üìã</span></button>'),ga=g('<div class="welcome-panel svelte-nwoc83"><div class="user-profile svelte-nwoc83"><div class="avatar large svelte-nwoc83"><img class="svelte-nwoc83"></div> <div class="user-details svelte-nwoc83"><h3 class="svelte-nwoc83"> </h3> <p class="user-id svelte-nwoc83"> </p> <!></div></div> <div class="actions svelte-nwoc83"><button class="copy-tree-btn svelte-nwoc83"><span>üå≤üìã</span></button> <button class="logout-btn svelte-nwoc83">Log Out</button> <button class="close-btn svelte-nwoc83">Close</button></div></div>'),ha=g('<div class="error-message svelte-nwoc83"> </div>'),fa=g('<div class="auth-message svelte-nwoc83"> </div>'),ma=g('<div class="form-group password-group svelte-nwoc83"><label for="confirmPassword" class="svelte-nwoc83">Confirm Password</label> <div class="password-input-container svelte-nwoc83"><input id="confirmPassword" placeholder="Confirm password" autocomplete="new-password" class="svelte-nwoc83"></div></div> <div class="form-group checkbox-group svelte-nwoc83"><label class="checkbox-label svelte-nwoc83"><input type="checkbox" id="agreedToTerms" class="svelte-nwoc83"> <span class="checkbox-text svelte-nwoc83">I agree to the <a target="_blank" class="terms-link svelte-nwoc83">Privacy Policy</a> and <a target="_blank" class="terms-link svelte-nwoc83">Terms of Use</a></span></label></div>',1),ba=g('<div class="spinner small svelte-nwoc83"></div> ',1),_a=g('Already have an account? <button type="button" class="text-link svelte-nwoc83">Sign in instead</button>',1),ya=g(`Don't have an account? <button type="button" class="text-link svelte-nwoc83">Create one now</button>`,1),xa=g('<div class="login-form svelte-nwoc83"><h3 class="svelte-nwoc83"> </h3> <p class="form-info svelte-nwoc83"> </p> <!> <!> <form><div class="form-group svelte-nwoc83"><label for="username" class="svelte-nwoc83">Username</label> <input type="text" id="username" placeholder="Enter username" autocomplete="username" class="svelte-nwoc83"></div> <div class="form-group password-group svelte-nwoc83"><label for="password" class="svelte-nwoc83">Password</label> <div class="password-input-container svelte-nwoc83"><input id="password" placeholder="Enter password" class="svelte-nwoc83"> <button type="button" class="toggle-password svelte-nwoc83"><span> </span></button></div></div> <!> <div class="actions svelte-nwoc83"><button type="submit"><!></button> <button type="button" class="cancel-btn svelte-nwoc83">Cancel</button></div> <div class="toggle-auth-mode svelte-nwoc83"><!></div></form></div>'),ka=g('<div class="login-panel svelte-nwoc83"><!></div>'),$a=g('<div class="header svelte-nwoc83"><div class="header-main svelte-nwoc83"><div class="node-name svelte-nwoc83"><div class="breadcrumbs svelte-nwoc83"><!></div></div> <div class="header-controls svelte-nwoc83"><a class="icon-button inventory-button svelte-nwoc83" title="View inventory"><span>üìä</span></a> <button class="icon-button add-button svelte-nwoc83" title="Add new node"><span>‚ûï</span></button> <button class="icon-button delete-button svelte-nwoc83" title="Toggle delete mode"><span>üóëÔ∏è</span></button></div></div> <!></div>');function Ea(p,c){it(c,!0);const[w,ie]=Ht(),z=()=>pe(Me,"$userTree",w),we=()=>pe(ot,"$currentPath",w),ee=()=>pe(Ft,"$userpub",w),y=()=>pe(Ot,"$username",w),Ae=()=>pe(Rt,"$isAuthenticating",w),_e=()=>pe(ta,"$page",w);function te(t,s=14){return t.length<=s?t:t.slice(0,s-3)+"..."}async function Y(t){try{await navigator.clipboard.writeText(t),h.showToast("Public key copied to clipboard","success")}catch(s){console.error("Failed to copy text: ",s),h.showToast("Failed to copy public key","error")}}let b=I(0);function R(){It(b),console.log("[UI FLOW] Header triggered update",e(b))}const f=q(z),V=q(we);q(ee);const Le=q(y),We=q(Ae),ge=q(()=>(e(b),!e(f)||e(V).length===0?[]:e(V).map(t=>{const s=rt(e(f),t);return{id:t,name:s?s.name:"Unknown"}})));Oe(()=>{const t=Me.subscribe(n=>{n&&(console.log("[UI FLOW] Header userTree updated, triggering UI update"),R())}),s=ot.subscribe(n=>{console.log("[UI FLOW] Header path updated:",n),R()});return()=>{t(),s()}});let Ne=q(()=>_e().url.pathname),ye=q(()=>e(Ne).startsWith(Q)?e(Ne).slice(Q.length):e(Ne)),Be=q(()=>e(ye)==="/"||e(ye)===""||!e(ye).startsWith("/inventory")&&!e(ye).startsWith("/contacts")),T=I(!1),W=I(!1),ae=I(""),G=I(""),he=I(""),x=I(!1),k=I(""),le=I(""),ce=I(!1),re=I(!1);Nt(()=>{_e().url.searchParams.get("error")&&(o(k,"Login failed. Please check your credentials."),o(T,!0))});let De=I(null),xe=I(null);Oe(()=>{function t(s){e(T)&&e(xe)&&!e(xe).contains(s.target)&&(s.target.closest(".header-controls")||o(T,!1))}return document.addEventListener("mousedown",t),e(Le)||setTimeout(()=>{o(T,!0)},100),()=>{document.removeEventListener("mousedown",t)}});function ke(){o(ae,""),o(G,""),o(he,""),o(k,""),o(le,""),o(ce,!1),o(x,!1),o(re,!1)}function dt(){if(!e(f)||e(V).length===0)return;const t=e(V)[e(V).length-1],s=structuredClone(e(f)),n=rt(s,t);if(!n){h.showToast("Error creating node: Current node not found","error");return}const P=()=>{if(!n.children||n.children.length===0)return console.log("[UI FLOW] No siblings, setting new node to 100 points"),100;const M=n.children.reduce(($,U)=>$+(U.type==="NonRootNode"?U.points:0),0),A=Math.max(1,M*.2);return console.log("[UI FLOW] Calculated points based on siblings:",A),A},C=`node_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,v="New Node",H=P();try{Mt(n,C,v,H),Me.set(s),R(),h.showToast("New node created","success"),setTimeout(()=>h.setNodeToEditMode(C),50)}catch(M){console.error("Error in handleAddNode:",M),h.showToast("Error creating node","error")}}function je(t,s){if(s.preventDefault(),!e(Le)){o(T,!0);return}if(t===0&&e(ge).length===1&&e(Be)){o(T,!e(T));return}h.navigateToPathIndex(t),e(Be)||ct(Q+"/")}function vt(){if(!e(ae)||!e(G))return o(k,"Please enter both username and password"),!1;if(e(x)){if(!e(re))return o(k,"Please agree to the Privacy Policy and Terms of Use"),!1;if(e(G)!==e(he))return o(k,"Passwords do not match"),!1;if(e(G).length<8)return o(k,"Password must be at least 8 characters"),!1}return!0}async function ut(t){if(t.preventDefault(),!!vt()&&!e(W)){o(k,""),o(le,""),o(W,!0);try{e(x)?await wt():await pt()}catch(s){console.error("Authentication error:",s),o(k,s instanceof Error?s.message:"Authentication error",!0)}finally{o(W,!1)}}}async function pt(){try{Gt(e(ae).trim(),e(G)),o(T,!1),ke(),h.showToast("Signed in successfully","success")}catch(t){console.error("Authentication error:",t),o(k,t instanceof Error?t.message:"Authentication error",!0)}}async function wt(){try{qt(e(ae).trim(),e(G)),o(T,!1),ke(),h.showToast("Account created successfully!","success")}catch(t){console.error("Registration error:",t),o(k,t instanceof Error?t.message:"Registration error",!0)}}function gt(t,s=null,n=32){if(s&&s.length>=87)try{return Qt({pub:s,size:n,round:!0,draw:"circles"})}catch(P){console.warn("Failed to generate gun-avatar:",P)}if(!t)return`data:image/svg+xml,${encodeURIComponent(`
				<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 ${n} ${n}">
					<rect width="100%" height="100%" fill="#6b7280" rx="${n/4}" ry="${n/4}" />
					<text x="50%" y="50%" font-family="Arial" font-size="${n/2}px" fill="white" 
						text-anchor="middle" dominant-baseline="middle">
						?
					</text>
				</svg>
			`)}`;try{const P=Math.abs(t.split("").reduce((M,A)=>M+A.charCodeAt(0),0)%360),C=70,v=60,H=t.charAt(0).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
				<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 ${n} ${n}">
					<rect width="100%" height="100%" fill="hsl(${P}, ${C}%, ${v}%)" rx="${n/4}" ry="${n/4}" />
					<text x="50%" y="50%" font-family="Arial" font-size="${n/2}px" fill="white" 
						text-anchor="middle" dominant-baseline="middle">
						${H}
					</text>
				</svg>
			`)}`}catch(P){return console.error("Error generating avatar:",P),`data:image/svg+xml,${encodeURIComponent(`
				<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 ${n} ${n}">
					<rect width="100%" height="100%" fill="#6b7280" rx="${n/4}" ry="${n/4}" />
					<text x="50%" y="50%" font-family="Arial" font-size="${n/2}px" fill="white" 
						text-anchor="middle" dominant-baseline="middle">
						!
					</text>
				</svg>
			`)}`}}var $e=$a(),Ie=a($e),Se=a(Ie),qe=a(Se),ht=a(qe);{var ft=t=>{var s=na();u(t,s)},mt=(t,s)=>{{var n=C=>{var v=la();m(v,"href",`${Q??""}/`),v.__click=[ia,je];var H=a(v,!0);r(v),O(M=>{m(v,"aria-label",y()),S(H,M)},[()=>te(y())]),u(C,v)},P=(C,v)=>{{var H=A=>{var $=ca();$.__click=[aa,T],u(A,$)},M=A=>{var $=At(),U=ne($);Wt(U,17,()=>e(ge),Bt,(J,K,F)=>{var oe=va(),B=ne(oe);{var fe=L=>{var D=da();u(L,D)};E(B,L=>{F>0&&L(fe)})}var _=i(B,2);m(_,"href",`${Q??""}/`);let de;_.__click=L=>{je(F,L)};var se=a(_,!0);r(_),O((L,D)=>{de=Re(_,1,"breadcrumb-item svelte-nwoc83",null,de,L),m(_,"aria-label",e(K).name),m(_,"title",e(K).name),S(se,D)},[()=>({current:F===e(ge).length-1,"auth-root":F===0}),()=>te(e(K).name)]),u(J,oe)}),u(A,$)};E(C,A=>{e(ge).length===0?A(H):A(M,!1)},v)}};E(t,C=>{e(ge).length===0&&y()?C(n):C(P,!1)},s)}};E(ht,t=>{e(We)?t(ft):t(mt,!1)})}r(qe),r(Se);var Ge=i(Se,2),Je=a(Ge);m(Je,"href",`${Q??""}/inventory`);var Ke=i(Je,2);Ke.__click=dt;var bt=i(Ke,2);bt.__click=function(...t){var s;(s=h.toggleDeleteMode)==null||s.apply(this,t)},r(Ge),r(Ie);var _t=i(Ie,2);{var yt=t=>{var s=ka(),n=a(s);{var P=v=>{var H=ua();u(v,H)},C=(v,H)=>{{var M=$=>{var U=ga(),J=a(U),K=a(J),F=a(K);r(K);var oe=i(K,2),B=a(oe),fe=a(B);r(B);var _=i(B,2),de=a(_);r(_);var se=i(_,2);{var L=j=>{var X=wa();X.__click=[pa,Y,ee];var ue=a(X),Ee=a(ue);r(ue),St(2),r(X),O(Ue=>S(Ee,`üîë ${Ue??""}`),[()=>te(ee(),20)]),u(j,X)};E(se,j=>{ee()&&j(L)})}r(oe),r(J);var D=i(J,2),ve=a(D);ve.__click=[sa,f];var me=i(ve,2);me.__click=[oa];var Z=i(me,2);Z.__click=[st,T,ke],r(D),r(U),O((j,X,ue)=>{m(F,"src",j),m(F,"alt",y()),m(B,"title",y()),S(fe,`Welcome, ${X??""}`),m(_,"title","@"+(y()||"anonymous")),S(de,`@${ue??""}`)},[()=>gt(y(),ee(),60),()=>te(y(),15),()=>te(y()||"anonymous",15)]),u($,U)},A=$=>{var U=xa(),J=a(U),K=a(J,!0);r(J);var F=i(J,2),oe=a(F,!0);r(F);var B=i(F,2);{var fe=l=>{var d=ha(),N=a(d,!0);r(d),O(()=>S(N,e(k))),u(l,d)};E(B,l=>{e(k)&&l(fe)})}var _=i(B,2);{var de=l=>{var d=fa(),N=a(d,!0);r(d),O(()=>S(N,e(le))),u(l,d)};E(_,l=>{e(le)&&l(de)})}var se=i(_,2),L=a(se),D=i(a(L),2);Ce(D),r(L);var ve=i(L,2),me=i(a(ve),2),Z=a(me);Ce(Z);var j=i(Z,2);j.__click=[ra,ce];var X=a(j),ue=a(X,!0);r(X),r(j),r(me),r(ve);var Ee=i(ve,2);{var Ue=l=>{var d=ma(),N=ne(d),Ye=i(a(N),2),Te=a(Ye);Ce(Te),r(Ye),r(N);var Ze=i(N,2),ze=a(Ze),Pe=a(ze);Ce(Pe);var et=i(Pe,2),tt=i(a(et));m(tt,"href",`${Q??""}/privacy`);var Ct=i(tt,2);m(Ct,"href",`${Q??""}/terms`),r(et),r(ze),r(Ze),O(()=>{m(Te,"type",e(ce)?"text":"password"),Te.disabled=e(W),Pe.disabled=e(W)}),Fe(Te,()=>e(he),He=>o(he,He)),Jt(Pe,()=>e(re),He=>o(re,He)),u(l,d)};E(Ee,l=>{e(x)&&l(Ue)})}var Ve=i(Ee,2),be=a(Ve),xt=a(be);{var kt=l=>{var d=ba(),N=i(ne(d));O(()=>S(N,` ${(e(x)?"Creating account...":"Signing in...")??""}`)),u(l,d)},$t=l=>{var d=Lt();O(()=>S(d,e(x)?"Create Account":"Sign In")),u(l,d)};E(xt,l=>{e(W)?l(kt):l($t,!1)})}r(be);var Xe=i(be,2);Xe.__click=[st,T,ke],r(Ve);var Qe=i(Ve,2),Et=a(Qe);{var Tt=l=>{var d=_a(),N=i(ne(d));N.__click=[nt,x,k,le,re],u(l,d)},Pt=l=>{var d=ya(),N=i(ne(d));N.__click=[nt,x,k,le,re],u(l,d)};E(Et,l=>{e(x)?l(Tt):l(Pt,!1)})}r(Qe),r(se),r(U),O(()=>{S(K,e(x)?"Create Account":"Sign In"),S(oe,e(x)?"Enter your details to create a new account":"Enter your details to sign in"),D.disabled=e(W),m(Z,"type",e(ce)?"text":"password"),Z.disabled=e(W),m(Z,"autocomplete",e(x)?"new-password":"current-password"),m(j,"title",e(ce)?"Hide password":"Show password"),S(ue,e(ce)?"üôà":"üêµ"),Re(be,1,Dt(e(x)?"signup-btn":"login-btn"),"svelte-nwoc83"),be.disabled=e(W)||!e(ae)||!e(G)||e(x)&&(!e(he)||!e(re)),Xe.disabled=e(W)}),Vt("submit",se,ut),Fe(D,()=>e(ae),l=>o(ae,l)),Fe(Z,()=>e(G),l=>o(G,l)),u($,U)};E(v,$=>{y()?$(M):$(A,!1)},H)}};E(n,v=>{e(We)?v(P):v(C,!1)})}r(s),at(s,v=>o(xe,v),()=>e(xe)),u(t,s)};E(_t,t=>{e(T)&&t(yt)})}r($e),at($e,t=>o(De,t),()=>e(De)),u(p,$e),lt(),ie()}Ut(["click"]);var Ta=g('<div class="toast-container svelte-1d02rpz"><div> </div></div>'),Pa=g('<main class="svelte-1d02rpz"><div class="app-header svelte-1d02rpz"><!></div> <div class="app-content svelte-1d02rpz"><!></div></main> <!>',1);function Ha(p,c){it(c,!0);let w=q(()=>h.toast);Oe(()=>{function Y(f){if(f.key==="Escape"){const V=document.activeElement;V&&(V.tagName==="INPUT"||V.tagName==="TEXTAREA"||V.isContentEditable||V.closest(".node-edit-input"))||(f.preventDefault(),h.zoomOut())}}function b(){if(!window.visualViewport&&!window.innerHeight)return;let f=0;window.visualViewport?f=window.innerHeight-window.visualViewport.height:window.screen&&window.screen.height&&(f=Math.max(0,window.screen.height-window.innerHeight-100)),f>0?(document.documentElement.style.setProperty("--keyboard-height",`${f}px`),document.documentElement.style.setProperty("-webkit-keyboard-height",`${f}px`),document.documentElement.style.setProperty("-moz-keyboard-height",`${f}px`)):(document.documentElement.style.setProperty("--keyboard-height","0px"),document.documentElement.style.setProperty("-webkit-keyboard-height","0px"),document.documentElement.style.setProperty("-moz-keyboard-height","0px"))}const R="visualViewport"in window;return R&&window.visualViewport?(window.visualViewport.addEventListener("resize",b),window.visualViewport.addEventListener("scroll",b)):(window.addEventListener("resize",b),window.addEventListener("orientationchange",()=>{setTimeout(b,100)})),b(),document.addEventListener("keydown",Y),()=>{document.removeEventListener("keydown",Y),R&&window.visualViewport&&(window.visualViewport.removeEventListener("resize",b),window.visualViewport.removeEventListener("scroll",b))}});var ie=Pa(),z=ne(ie),we=a(z),ee=a(we);Ea(ee,{}),r(we);var y=i(we,2),Ae=a(y);Kt(Ae,()=>c.children),r(y),r(z);var _e=i(z,2);{var te=Y=>{var b=Ta(),R=a(b),f=a(R,!0);r(R),r(b),O(()=>{Re(R,1,`toast toast-${e(w).type??""}`,"svelte-1d02rpz"),S(f,e(w).message)}),u(Y,b)};E(_e,Y=>{e(w).visible&&Y(te)})}u(p,ie),lt()}export{Ha as component,Va as universal};
