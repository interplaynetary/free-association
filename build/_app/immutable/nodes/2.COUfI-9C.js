import{f as R,a as H,d as qe,t as Tt}from"../chunks/BDgML0BG.js";import{A as St,E as Zt,aB as Jt,aC as Qt,Q as $t,g as en,aD as tn,a8 as nn,S as on,n as Me,ah as Dt,ai as It,aj as rn,o as Le,f as Ge,j as e,ae as G,v as _,x as A,y as B,J as _e,ag as X,z as be,t as He,I as Pe,aA as Ve,q as st,az as Nt,a1 as at,av as Mt,aw as Pt}from"../chunks/ZjNQrdaN.js";import{p as Se,i as se,b as Ke,r as Qe,s as Bt,a as Ye}from"../chunks/CTLQGSEP.js";import{v as p,I as an,h as Ne,A as Ot,C as At,i as it,j as ht,s as Je,e as Ft,q as $e,J as et,c as Ae,f as ze,a1 as sn,x as ln,D as dn,a2 as cn,y as un,a3 as hn,k as _t,a4 as fn,a5 as gn,a6 as vn,w as mn,a7 as pn,a8 as kt,a9 as bn,aa as wn}from"../chunks/6qSDsJxn.js";import{b as _n,w as yn,d as xt,e as bt,s as je}from"../chunks/eaQsrxS5.js";import{T as xn,b as En,B as Lt}from"../chunks/BB5yi0xz.js";import{c as ct}from"../chunks/DNHPwvaD.js";import{d as Ht}from"../chunks/CUh_UXd4.js";const Cn=()=>performance.now(),Fe={tick:n=>requestAnimationFrame(n),now:()=>Cn(),tasks:new Set};function Gt(){const n=Fe.now();Fe.tasks.forEach(t=>{t.c(n)||(Fe.tasks.delete(t),t.f())}),Fe.tasks.size!==0&&Fe.tick(Gt)}function Tn(n){let t;return Fe.tasks.size===0&&Fe.tick(Gt),{promise:new Promise(o=>{Fe.tasks.add(t={c:n,f:o})}),abort(){Fe.tasks.delete(t)}}}function ut(n,t){yn(()=>{n.dispatchEvent(new CustomEvent(t))})}function Sn(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const t=n.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(o=>o[0].toUpperCase()+o.slice(1)).join("")}function Ut(n){const t={},o=n.split(";");for(const r of o){const[h,a]=r.split(":");if(!h||a===void 0)break;const s=Sn(h.trim());t[s]=a.trim()}return t}const Dn=n=>n;function Rt(n,t,o,r){var h=(n&tn)!==0,a="both",s,b=t.inert,w=t.style.overflow,c,u;function T(){var l=rn,v=St;Dt(null),It(null);try{return s??(s=o()(t,(r==null?void 0:r())??{},{direction:a}))}finally{Dt(l),It(v)}}var i={is_global:h,in(){t.inert=b,ut(t,"introstart"),c=yt(t,T(),u,1,()=>{ut(t,"introend"),c==null||c.abort(),c=s=void 0,t.style.overflow=w})},out(l){t.inert=!0,ut(t,"outrostart"),u=yt(t,T(),c,0,()=>{ut(t,"outroend"),l==null||l()})},stop:()=>{c==null||c.abort(),u==null||u.abort()}},m=St;if((m.transitions??(m.transitions=[])).push(i),_n){var x=h;if(!x){for(var y=m.parent;y&&(y.f&Zt)!==0;)for(;(y=y.parent)&&(y.f&Jt)===0;);x=!y||(y.f&Qt)!==0}x&&$t(()=>{en(()=>i.in())})}}function yt(n,t,o,r,h){var a=r===1;if(nn(t)){var s,b=!1;return on(()=>{if(!b){var l=t({direction:a?"in":"out"});s=yt(n,l,o,r,h)}}),{abort:()=>{b=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(o==null||o.deactivate(),!(t!=null&&t.duration))return h(),{abort:Me,deactivate:Me,reset:Me,t:()=>r};const{delay:w=0,css:c,tick:u,easing:T=Dn}=t;var i=[];if(a&&o===void 0&&(u&&u(0,1),c)){var m=Ut(c(0,1));i.push(m,m)}var x=()=>1-r,y=n.animate(i,{duration:w,fill:"forwards"});return y.onfinish=()=>{y.cancel();var l=(o==null?void 0:o.t())??1-r;o==null||o.abort();var v=r-l,D=t.duration*Math.abs(v),I=[];if(D>0){var M=!1;if(c)for(var U=Math.ceil(D/16.666666666666668),k=0;k<=U;k+=1){var ee=l+v*T(k/U),K=Ut(c(ee,1-ee));I.push(K),M||(M=K.overflow==="hidden")}M&&(n.style.overflow="hidden"),x=()=>{var Q=y.currentTime;return l+v*T(Q/D)},u&&Tn(()=>{if(y.playState!=="running")return!1;var Q=x();return u(Q,1-Q),!0})}y=n.animate(I,{duration:D,fill:"forwards"}),y.onfinish=()=>{x=()=>r,u==null||u(r,1-r),h()}},{abort:()=>{y&&(y.cancel(),y.effect=null,y.onfinish=Me)},deactivate:()=>{h=Me},reset:()=>{r===0&&(u==null||u(1,0))},t:()=>x()}}function In(n){var t=0,o=n.children,r=o&&o.length;if(!r)t=1;else for(;--r>=0;)t+=o[r].value;n.value=t}function Nn(){return this.eachAfter(In)}function Mn(n,t){let o=-1;for(const r of this)n.call(t,r,++o,this);return this}function Pn(n,t){for(var o=this,r=[o],h,a,s=-1;o=r.pop();)if(n.call(t,o,++s,this),h=o.children)for(a=h.length-1;a>=0;--a)r.push(h[a]);return this}function kn(n,t){for(var o=this,r=[o],h=[],a,s,b,w=-1;o=r.pop();)if(h.push(o),a=o.children)for(s=0,b=a.length;s<b;++s)r.push(a[s]);for(;o=h.pop();)n.call(t,o,++w,this);return this}function Ln(n,t){let o=-1;for(const r of this)if(n.call(t,r,++o,this))return r}function Hn(n){return this.eachAfter(function(t){for(var o=+n(t.data)||0,r=t.children,h=r&&r.length;--h>=0;)o+=r[h].value;t.value=o})}function Un(n){return this.eachBefore(function(t){t.children&&t.children.sort(n)})}function Bn(n){for(var t=this,o=On(t,n),r=[t];t!==o;)t=t.parent,r.push(t);for(var h=r.length;n!==o;)r.splice(h,0,n),n=n.parent;return r}function On(n,t){if(n===t)return n;var o=n.ancestors(),r=t.ancestors(),h=null;for(n=o.pop(),t=r.pop();n===t;)h=n,n=o.pop(),t=r.pop();return h}function An(){for(var n=this,t=[n];n=n.parent;)t.push(n);return t}function Fn(){return Array.from(this)}function Gn(){var n=[];return this.eachBefore(function(t){t.children||n.push(t)}),n}function Rn(){var n=this,t=[];return n.each(function(o){o!==n&&t.push({source:o.parent,target:o})}),t}function*Wn(){var n=this,t,o=[n],r,h,a;do for(t=o.reverse(),o=[];n=t.pop();)if(yield n,r=n.children)for(h=0,a=r.length;h<a;++h)o.push(r[h]);while(o.length)}function Et(n,t){n instanceof Map?(n=[void 0,n],t===void 0&&(t=Xn)):t===void 0&&(t=Yn);for(var o=new ft(n),r,h=[o],a,s,b,w;r=h.pop();)if((s=t(r.data))&&(w=(s=Array.from(s)).length))for(r.children=s,b=w-1;b>=0;--b)h.push(a=s[b]=new ft(s[b])),a.parent=r,a.depth=r.depth+1;return o.eachBefore(qn)}function zn(){return Et(this).eachBefore(jn)}function Yn(n){return n.children}function Xn(n){return Array.isArray(n)?n[1]:null}function jn(n){n.data.value!==void 0&&(n.value=n.data.value),n.data=n.data.data}function qn(n){var t=0;do n.height=t;while((n=n.parent)&&n.height<++t)}function ft(n){this.data=n,this.depth=this.height=0,this.parent=null}ft.prototype=Et.prototype={constructor:ft,count:Nn,each:Mn,eachAfter:kn,eachBefore:Pn,find:Ln,sum:Hn,sort:Un,path:Bn,ancestors:An,descendants:Fn,leaves:Gn,links:Rn,copy:zn,[Symbol.iterator]:Wn};function Kn(n){if(typeof n!="function")throw new Error;return n}function ot(){return 0}function rt(n){return function(){return n}}function Vn(n){n.x0=Math.round(n.x0),n.y0=Math.round(n.y0),n.x1=Math.round(n.x1),n.y1=Math.round(n.y1)}function Zn(n,t,o,r,h){for(var a=n.children,s,b=-1,w=a.length,c=n.value&&(r-t)/n.value;++b<w;)s=a[b],s.y0=o,s.y1=h,s.x0=t,s.x1=t+=s.value*c}function Jn(n,t,o,r,h){for(var a=n.children,s,b=-1,w=a.length,c=n.value&&(h-o)/n.value;++b<w;)s=a[b],s.x0=t,s.x1=r,s.y0=o,s.y1=o+=s.value*c}var Qn=(1+Math.sqrt(5))/2;function $n(n,t,o,r,h,a){for(var s=[],b=t.children,w,c,u=0,T=0,i=b.length,m,x,y=t.value,l,v,D,I,M,U,k;u<i;){m=h-o,x=a-r;do l=b[T++].value;while(!l&&T<i);for(v=D=l,U=Math.max(x/m,m/x)/(y*n),k=l*l*U,M=Math.max(D/k,k/v);T<i;++T){if(l+=c=b[T].value,c<v&&(v=c),c>D&&(D=c),k=l*l*U,I=Math.max(D/k,k/v),I>M){l-=c;break}M=I}s.push(w={value:l,dice:m<x,children:b.slice(u,T)}),w.dice?Zn(w,o,r,h,y?r+=x*l/y:a):Jn(w,o,r,y?o+=m*l/y:h,a),y-=l,u=T}return s}const eo=function n(t){function o(r,h,a,s,b){$n(t,r,h,a,s,b)}return o.ratio=function(r){return n((r=+r)>1?r:1)},o}(Qn);function to(){var n=eo,t=!1,o=1,r=1,h=[0],a=ot,s=ot,b=ot,w=ot,c=ot;function u(i){return i.x0=i.y0=0,i.x1=o,i.y1=r,i.eachBefore(T),h=[0],t&&i.eachBefore(Vn),i}function T(i){var m=h[i.depth],x=i.x0+m,y=i.y0+m,l=i.x1-m,v=i.y1-m;l<x&&(x=l=(x+l)/2),v<y&&(y=v=(y+v)/2),i.x0=x,i.y0=y,i.x1=l,i.y1=v,i.children&&(m=h[i.depth+1]=a(i)/2,x+=c(i)-m,y+=s(i)-m,l-=b(i)-m,v-=w(i)-m,l<x&&(x=l=(x+l)/2),v<y&&(y=v=(y+v)/2),n(i,x,y,l,v))}return u.round=function(i){return arguments.length?(t=!!i,u):t},u.size=function(i){return arguments.length?(o=+i[0],r=+i[1],u):[o,r]},u.tile=function(i){return arguments.length?(n=Kn(i),u):n},u.padding=function(i){return arguments.length?u.paddingInner(i).paddingOuter(i):u.paddingInner()},u.paddingInner=function(i){return arguments.length?(a=typeof i=="function"?i:rt(+i),u):a},u.paddingOuter=function(i){return arguments.length?u.paddingTop(i).paddingRight(i).paddingBottom(i).paddingLeft(i):u.paddingTop()},u.paddingTop=function(i){return arguments.length?(s=typeof i=="function"?i:rt(+i),u):s},u.paddingRight=function(i){return arguments.length?(b=typeof i=="function"?i:rt(+i),u):b},u.paddingBottom=function(i){return arguments.length?(w=typeof i=="function"?i:rt(+i),u):w},u.paddingLeft=function(i){return arguments.length?(c=typeof i=="function"?i:rt(+i),u):c},u}function no(n,t,o,r,h){var a=n.children,s,b=a.length,w,c=new Array(b+1);for(c[0]=w=s=0;s<b;++s)c[s+1]=w+=a[s].value;u(0,b,n.value,t,o,r,h);function u(T,i,m,x,y,l,v){if(T>=i-1){var D=a[T];D.x0=x,D.y0=y,D.x1=l,D.y1=v;return}for(var I=c[T],M=m/2+I,U=T+1,k=i-1;U<k;){var ee=U+k>>>1;c[ee]<M?U=ee+1:k=ee}M-c[U-1]<c[U]-M&&T+1<U&&--U;var K=c[U]-I,Q=m-K;if(l-x>v-y){var ye=m?(x*Q+l*K)/m:l;u(T,U,K,x,y,ye,v),u(U,i,Q,ye,y,l,v)}else{var ce=m?(y*Q+v*K)/m:v;u(T,U,K,x,y,l,ce),u(U,i,Q,x,ce,l,v)}}}function oo(n,t,o){if(p.deleteMode){p.showToast("Cannot add contributors in delete mode","warning");return}if(p.editMode){p.showToast("Cannot add contributors while editing","warning");return}if(p.recomposeMode){p.showToast("Cannot add contributors in recompose mode","warning");return}n.stopPropagation();const r=t.node.id;r&&o()({nodeId:r,clientX:n.clientX,clientY:n.clientY})}function wt(n,t){var r;if(console.log("[DEBUG CHILD] handleTextEditStart called, event type:",n.type,"target:",n.target),n.stopPropagation(),n.stopImmediatePropagation(),(r=document.getSelection())==null||r.removeAllRanges(),n.type!=="touchstart"&&n.preventDefault(),!t.node.id){console.log("[DEBUG CHILD] No node ID, cannot edit");return}p.enterEditMode(t.node.id)&&console.log("[DEBUG CHILD] Edit mode entered successfully")}function ro(n,t){(n.key==="Enter"||n.key==="Escape")&&(n.preventDefault(),t())}var io=R('<input type="text" class="node-edit-input svelte-1nkfxom"/>'),ao=R('<span class="title-segment svelte-1nkfxom"> </span>'),so=R('<div class="node-title svelte-1nkfxom"></div>'),lo=R('<button class="add-contributor-button svelte-1nkfxom" title="Add contributor">+</button>'),co=R('<div class="mini-contributor svelte-1nkfxom"></div>'),uo=R('<div class="more-contributors svelte-1nkfxom" title="More contributors"> </div>'),ho=R("<!> <!>",1),fo=R('<div class="contributors-area svelte-1nkfxom"><div class="contributors-layout"><!> <!></div></div>'),go=R(`<div class="treemap-node svelte-1nkfxom"><div class="unified-node-content svelte-1nkfxom"><div class="node-title-area svelte-1nkfxom" style="
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        max-width: 90%;
        z-index: 2;
      "><!></div> <!></div></div>`);function vo(n,t){Le(t,!0);let o=Se(t,"addContributor",3,f=>{}),r=Se(t,"removeContributor",3,f=>{}),h=Se(t,"onTextEdit",3,f=>{}),a=Se(t,"shouldEdit",3,!1),s=G(!1),b=G(""),w=G(null);Ge(()=>{const f=p.editMode&&p.editingNodeId===t.node.id;f!==e(s)&&(_(s,f,!0),e(s)&&_(b,t.node.name||"",!0))});const c=X(()=>t.dimensions.x1-t.dimensions.x0),u=X(()=>t.dimensions.y1-t.dimensions.y0),T=X(()=>Math.min(e(c),e(u))*100),i=X(()=>t.node.name==="Unnamed"?[t.node.name]:t.node.name.split(/(?=[A-Z][^A-Z])/g)),m=X(()=>e(i).reduce((f,E)=>E.length>f.length?E:f,"")),x=X(()=>()=>{const f=e(c)*.9*400,E=e(u)*.9*400,ge=f*.95/(e(m).length*.55*16),Y=E*.95/(e(i).length*1.15*16),Z=Math.min(ge,Y)*.95;return Math.max(.4,Math.min(3.5,Z))}),y=X(()=>e(c)>=.999&&e(u)>=.999),l=X(()=>t.node.contributors.length>0),v=X(()=>Math.min(1,Math.max(0,(e(T)-5)/7))),D=X(()=>e(T)>=25),I=X(()=>Math.floor(Math.max(3,Math.min(12,e(T)*.15)))),M=X(()=>Math.max(1,Math.min(8,e(T)*.1))),U=X(()=>Math.max(2,Math.min(8,e(T)*.08))),k=X(()=>Math.max(12,Math.min(40,e(T)*.5)));function ee(f){if(p.deleteMode){p.showToast("Cannot remove contributors in delete mode","warning");return}if(p.editMode){p.showToast("Cannot remove contributors while editing","warning");return}if(p.recomposeMode){p.showToast("Cannot remove contributors in recompose mode","warning");return}const E=t.node.id;E&&r()({nodeId:E,contributorId:f})}function K(f,E){E&&(E.stopPropagation(),E.preventDefault()),console.log(`Clicked on contributor: ${f}`)}function Q(f){var E;return console.log("[DEBUG CHILD] preventAllInterference called, event type:",f.type),(E=document.getSelection())==null||E.removeAllRanges(),f.preventDefault(),f.stopPropagation(),f.stopImmediatePropagation(),!1}function ye(f){const E=t.node.id;E&&h()({nodeId:E,newName:f})}function ce(){const f=e(b).trim();f&&f!==t.node.name&&ye(f),p.exitEditMode()}function we(f){e(s)&&p.editingNodeId===t.node.id&&e(w)&&!e(w).contains(f.target)&&ce()}Ge(()=>(console.log("[DEBUG CHILD] $effect triggered, isEditing:",e(s),"editInput:",e(w)),e(s)?(document.addEventListener("mousedown",we),e(w)?(console.log("[DEBUG CHILD] editInput exists, focusing immediately"),setTimeout(()=>{var f,E;console.log("[DEBUG CHILD] Attempting to focus input, editInput:",e(w)),(f=e(w))==null||f.focus(),(E=e(w))==null||E.select(),console.log("[DEBUG CHILD] Focus/select called, document.activeElement:",document.activeElement)},10)):(console.log("[DEBUG CHILD] editInput not ready, setting up retry"),setTimeout(()=>{console.log("[DEBUG CHILD] Retry - editInput:",e(w)),e(w)?(console.log("[DEBUG CHILD] Retry focusing input"),e(w).focus(),e(w).select(),console.log("[DEBUG CHILD] Retry focus/select called, document.activeElement:",document.activeElement)):console.log("[DEBUG CHILD] Input still not ready after retry")},100))):document.removeEventListener("mousedown",we),()=>{document.removeEventListener("mousedown",we)})),Ge(()=>{a()&&!e(s)&&t.node.id&&p.enterEditMode(t.node.id)&&console.log("[DEBUG CHILD] Auto-entering edit mode for new node")});var F=go(),re=A(F),ue=A(re),he=A(ue);{var le=f=>{var E=io();Ot(E),E.__keydown=[ro,ce],Ke(E,j=>_(w,j),()=>e(w)),be((j,ge)=>Ne(E,`
          font-size: ${j??""}rem;
          width: 100%;
          max-width: ${ge??""}px;
        `),[()=>e(x)(),()=>Math.min(200,e(T)*3)]),bt("blur",E,ce),At(E,()=>e(b),j=>_(b,j)),H(f,E)},fe=f=>{var E=so();E.__mousedown=[wt,t],E.__touchstart=[wt,t],E.__pointerdown=[wt,t],E.__contextmenu=Q,E.__dblclick=Q,it(E,21,()=>e(i),ht,(j,ge)=>{var C=ao(),Y=A(C,!0);B(C),be(()=>je(Y,e(ge))),H(j,C)}),B(E),be(j=>{Ne(E,`font-size: ${j??""}rem;`),Je(E,"title",t.node.name)},[()=>e(x)()]),bt("selectstart",E,Q),bt("dragstart",E,Q),H(f,E)};se(he,f=>{e(s)?f(le):f(fe,!1)})}B(ue);var Te=_e(ue,2);{var S=f=>{var E=fo(),j=A(E),ge=A(j);{var C=Z=>{var ve=lo();ve.__click=[oo,t,o],be(()=>Ne(ve,`
            width: ${e(k)??""}px;
            height: ${e(k)??""}px;
            font-size: ${e(k)*.5}px;
          `)),H(Z,ve)};se(ge,Z=>{t.node.hasChildren||Z(C)})}var Y=_e(ge,2);{var L=Z=>{var ve=qe(),Ue=Pe(ve);{var ne=ie=>{var me=qe(),oe=Pe(me);it(oe,17,()=>t.node.contributors,ht,(pe,xe)=>{xn(pe,{get userId(){return e(xe)},get truncateLength(){return e(I)},onClick:(V,$)=>K(V,$),onRemove:ee})}),H(ie,me)},J=ie=>{var me=ho(),oe=Pe(me);it(oe,17,()=>t.node.contributors,ht,(V,$)=>{var Ee=co();be((de,De,te)=>{Je(Ee,"title",e($)),Ne(Ee,`
                  background: ${de??""};
                  width: ${De??""}px;
                  height: ${te??""}px;
                `)},[()=>Ft(e($)),()=>Math.max(6,e(k)*.4),()=>Math.max(6,e(k)*.4)]),H(V,Ee)});var pe=_e(oe,2);{var xe=V=>{var $=uo(),Ee=A($);B($),be((de,De,te)=>{Ne($,`
                    width: ${de??""}px;
                    height: ${De??""}px;
                    font-size: ${te??""}px;
                  `),je(Ee,`+${t.node.contributors.length-3}`)},[()=>Math.max(8,e(k)*.5),()=>Math.max(8,e(k)*.5),()=>Math.max(6,e(k)*.3)]),H(V,$)};se(pe,V=>{t.node.contributors.length>3&&V(xe)})}H(ie,me)};se(Ue,ie=>{e(D)?ie(ne):ie(J,!1)})}H(Z,ve)};se(Y,Z=>{e(l)&&Z(L)})}B(j),B(E),be(Z=>{Ne(E,`
          position: absolute;
          opacity: ${e(v)??""};
          z-index: 1;
          top: 50%; 
          left: 70%; 
          transform: translateY(-50%);
        `),Ne(j,`
            display: flex;
            align-items: center;
            justify-content: center;
            gap: ${Z??""}px;
            flex-wrap: wrap;
            flex-direction: column;
          `)},[()=>Math.max(2,e(U)*.5)]),H(f,E)};se(Te,f=>{e(v)>.1&&f(S)})}B(re),B(F),be(f=>{Ne(F,`
    background-color: ${f??""};
    border: ${e(y)?"none":"1px solid #fff"};
    width: 100%;
    height: 100%;
    overflow: hidden;
    box-sizing: border-box;
  `),Ne(re,`
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: ${e(M)??""}px;
      box-sizing: border-box;
      position: relative;
    `)},[()=>an(t.node.name)]),H(n,F),He()}xt(["keydown","mousedown","touchstart","pointerdown","contextmenu","dblclick","click"]);var mo=R('<div class="scroll-clip svelte-1vbeh9n"><div><!></div></div>');function po(n,t){Le(t,!0);const o=Ve("sheetContext");if(!o)throw new Error("BottomSheet.Content must be inside a BottomSheet component");let r=Qe(t,["$$slots","$$events","$$legacy","children"]);st(()=>{h()});const h=()=>{const w=o.settings.contentAlignment==="start-fit",c=o.settings.position==="left"||o.settings.position==="right";if(o.sheetContent&&w&&c){const u=o.sheetContent,T=getComputedStyle(u),i=parseFloat(T.paddingLeft),m=parseFloat(T.paddingRight),y=u.offsetWidth-i-m;u.style.width=`${y}px`}};var a=mo(),s=A(a);$e(s,()=>({...r,class:`bottom-sheet-content ${t.class??""}`,role:"document"}),void 0,"svelte-1vbeh9n");var b=A(s);et(b,()=>t.children??Me),B(s),Ke(s,w=>o.sheetContent=w,()=>o==null?void 0:o.sheetContent),B(a),be(()=>Ne(a,`${o.settings.position==="left"&&"direction: rtl;"}`)),H(n,a),He()}function Wt(n){const t=n-1;return t*t*t+1}const Xe=(n,t)=>n>1?t-n:t-n*t,zt=n=>{for(;n&&n!==document.documentElement;){const t=window.getComputedStyle(n),o=t.overflowY,r=t.overflowX,h=o!=="visible"&&o!=="hidden"&&n.scrollHeight>n.clientHeight,a=r!=="visible"&&r!=="hidden"&&n.scrollWidth>n.clientWidth;if(n.className.split(" ").includes("bottom-sheet")&&(h||a)||h||a)return n;n=n.parentElement}return null},bo=(n,{delay:t=0,duration:o=400,easing:r=Wt,axis:h="y",position:a="bottom",sheetHeight:s=0})=>{const b=getComputedStyle(n);s===0&&(s=n.offsetHeight);const w=a=="top"||a=="left",c=parseFloat(b.opacity),u=h==="y"?"translateY":"translateX",T=s,i=h==="y"?["top","bottom"]:["left","right"],m=i.map(M=>`${M[0].toUpperCase()}${M.slice(1)}`),x=parseFloat(b[`padding${m[0]}`]),y=parseFloat(b[`padding${m[1]}`]),l=parseFloat(b[`margin${m[0]}`]),v=parseFloat(b[`margin${m[1]}`]),D=parseFloat(b[`border${m[0]}Width`]),I=parseFloat(b[`border${m[1]}Width`]);return{delay:t,duration:o,easing:r,css:M=>`
            overflow: hidden;
            opacity: ${Math.min(M*20,1)*c};
            transform: ${u}(${(1-M)*(w?-1:1)*T}px);
            padding-${i[0]}: ${M*x}px;
            padding-${i[1]}: ${M*y}px;
            margin-${i[0]}: ${M*l}px;
            margin-${i[1]}: ${M*v}px;
            border-${i[0]}-width: ${M*D}px;
            border-${i[1]}-width: ${M*I}px;
        `}};var wo=R("<div><!></div>");function _o(n,t){Le(t,!0);let o=Qe(t,["$$slots","$$events","$$legacy","children"]);const r=Ve("sheetContext"),h=Ve("sheetIdentificationContext");let a,s=r.settings.position==="left"||r.settings.position==="right"?"x":"y";if(!r)throw new Error("BottomSheet.Sheet must be inside a BottomSheet component");const b=l=>{r.sheetElement&&!r.sheetElement.contains(l.target)&&!r.settings.disableClosing&&r.closeSheet()},w=()=>r.sheetElement?Array.from(r.sheetElement.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')):[],c=l=>{if(l.key==="Tab"){const v=w();if(!v.length)return;const D=v[0],I=v[v.length-1],M=!l.shiftKey;l.shiftKey&&document.activeElement===D&&(I.focus(),l.preventDefault()),M&&document.activeElement===I&&(D.focus(),l.preventDefault())}},u=()=>{switch(r.settings.position){case"bottom":case"top":return`height: 100%;  max-height: ${r.maxHeightPx-r.sheetHeight}px`;case"left":case"right":return`height: 100%; width: 100%; max-width: ${r.maxHeightPx-r.sheetHeight}px`}},T=()=>{if(!r.isDragging&&s==="x")return"transition: max-width 0.3s ease";if(!r.isDragging&&s==="y")return"transition: max-height 0.3s ease"},i=l=>{const v=l.target,D=zt(v);if(!D||s==="x")return;const I=D.scrollTop,M=D.scrollHeight,U=D.clientHeight;let k=I<=0;const ee=I+U>=M-1;let K=l.deltaY<0;if(r.settings.position==="top"?k=I>=0:(k=I<=0,K=!K),k&&K||!K&&ee||!k&&!ee){l.stopPropagation();return}else{if(k&&!K)return;if(ee&&K)return}};Ge(()=>{r.isSheetOpen?(a=document.activeElement,setTimeout(()=>{var v;const l=w();l.length?l[0].focus():(v=r.sheetElement)==null||v.focus(),document.addEventListener("click",b)},100)):(document.removeEventListener("click",b),a==null||a.focus())});var m=qe(),x=Pe(m);{var y=l=>{var v=wo();$e(v,(I,M)=>({...o,class:`bottom-sheet position-${r.settings.position??""} ${(r.isDragging&&"prevent-select")??""} ${t.class??""}`,style:`${I??""};  ${M??""}; ${t.style??""}`,role:"dialog","aria-modal":"true","aria-labelledby":h.headingId,"aria-describedby":h.descriptionId,id:h.sheetId,tabindex:"-1","aria-live":"polite",onkeypress:c,ontouchstart:r.touchStartEvent,ontouchmove:r.touchMoveEvent,ontouchend:r.moveEnd,onmousedown:r.mouseDownEvent,onmouseup:r.moveEnd,onwheel:i}),[u,T],"svelte-1o7orpt");var D=A(v);et(D,()=>t.children??Me),B(v),Ke(v,I=>r.sheetElement=I,()=>r==null?void 0:r.sheetElement),Rt(3,v,()=>bo,()=>({duration:500,easing:Wt,axis:s,position:r.settings.position,sheetHeight:r.maxHeightPx})),H(l,v)};se(x,l=>{r.isSheetOpen&&l(y)})}H(n,m),He()}var yo=R("<div><!></div>");function xo(n,t){var j,ge;Le(t,!0);let o=Se(t,"isSheetOpen",15,!1),r=Se(t,"settings",19,()=>({closeThreshold:.9,autoCloseThreshold:0,maxHeight:.7,snapPoints:[1],startingSnapPoint:1,disableDragging:!1,position:"bottom",disableClosing:!1,contentAlignment:"flex"}));const h={closeThreshold:.9,autoCloseThreshold:0,maxHeight:.7,snapPoints:[1],startingSnapPoint:1,disableDragging:!1,position:"bottom",disableClosing:!1,contentAlignment:"flex"};(j=r().snapPoints)!=null&&j.includes(1)||(ge=r().snapPoints)==null||ge.push(1);const a=X(()=>({...h,...r()}));let s=new AbortController;st(()=>{_(b,window.innerWidth,!0),_(w,window.innerHeight,!0)}),Ge(()=>{var C,Y;o()?((C=t.onopen)==null||C.call(t),s=new AbortController,document.addEventListener("wheel",L=>{L.preventDefault()},{passive:!1,signal:s.signal}),document.addEventListener("touchmove",L=>{L.cancelable&&L.preventDefault()},{passive:!1,signal:s.signal}),document.addEventListener("mouseup",fe),document.addEventListener("mousemove",ue),document.addEventListener("touchmove",K,{passive:!1}),document.addEventListener("keydown",Q)):((Y=t.onclose)==null||Y.call(t),ee(e(a).startingSnapPoint,!1),document.removeEventListener("mouseup",fe),document.removeEventListener("touchmove",K),document.removeEventListener("keydown",Q),document.removeEventListener("mousemove",ue),s.abort())});let b=G(0),w=G(0),c=G(0),u=G(!1),T=X(()=>{const{maxHeight:C,position:Y}=e(a);return C>1?C:(Y==="left"||Y==="right"?e(b):e(w))*C}),i=G(null),m=G(null),x=G(!1),y=G(!1),l,v,D=0,I=0;const M=`bottom-sheet-${Math.random().toString(36).substr(2,9)}`,U=`${M}-heading`,k=`${M}-description`,ee=(C,Y=!0)=>{var L;return e(a).snapPoints.includes(C)?(_(c,Xe(C,e(T)),!0),Y&&((L=t.onsnap)==null||L.call(t,C)),!0):!1},K=C=>{window.scrollY===0&&C.touches[0].clientY>50&&C.preventDefault()},Q=C=>{C.key==="Escape"&&!e(a).disableClosing&&Te.closeSheet()},ye=()=>{if(e(c)>Xe(e(a).autoCloseThreshold,e(T))){_(c,0),Te.closeSheet(),fe();return}},ce=C=>{F(C.touches[0].clientY,C.touches[0].clientX)},we=C=>{F(C.clientY,C.clientX)},F=(C,Y)=>{var L,Z;e(a).disableDragging||(l=C,I=Y,v=e(c),_(x,!0),D=((L=e(m))==null?void 0:L.scrollTop)??0,(Z=t.onsheetdragstart)==null||Z.call(t))},re=(C,Y)=>{let L=0;return e(a).position==="bottom"?e(u)?L=Math.max(0,C-l+v):L=Math.max(0,C-l-D+v):e(a).position==="top"?e(u)?L=Math.max(0,l-C+v):L=Math.max(0,l-C-D+v):e(a).position==="left"?e(u)?L=Math.max(0,I-Y+v):L=Math.max(0,I-Y-D+v):e(a).position==="right"&&(e(u)?L=Math.max(0,Y-I+v):L=Math.max(0,Y-I-D+v)),L},ue=C=>{var L;if(!e(x))return;_(u,!0);let Y=re(C.clientY,C.clientX);e(c)!=0&&_(y,!0),_(c,Y,!0),(L=t.onsheetdrag)==null||L.call(t),ye()},he=C=>{var ve;if(!e(x)||!e(m))return;const Y=C.target,L=zt(Y);if(!e(u)&&!e(y)&&L){const{clientY:Ue,clientX:ne}=C.touches[0],{scrollTop:J,scrollLeft:ie,scrollHeight:me,clientHeight:oe,scrollWidth:pe,clientWidth:xe}=L,V=e(a).position==="top"||e(a).position==="bottom";let de=(V?Ue:ne)>(V?l:I);const De=V?Math.round(J)+oe>=me:Math.round(ie)+xe>=pe;let te;switch(e(a).position){case"top":te=J>=0;break;case"bottom":te=J<=0,de=!de;break;case"left":te=ie>=0;break;case"right":te=ie<=0,de=!de;break}if(te&&de||!de&&De||!te&&!De){C.stopPropagation();return}else if(te&&!de){_(y,!0);return}else if(De&&de)return}let Z=re(C.touches[0].clientY,C.touches[0].clientX);e(c)!=0&&_(y,!0),_(c,Z,!0),(ve=t.onsheetdrag)==null||ve.call(t),ye()},le=()=>{var Ue,ne;if(e(a).disableDragging)return;if((Ue=t.onsheetdragend)==null||Ue.call(t),e(a).snapPoints.length===1){e(c)>Xe(e(a).closeThreshold,e(T))?(Te.closeSheet(),_(c,0)):_(c,0),fe();return}let C=e(a).snapPoints.map(J=>Xe(J,e(T)));const Y=Math.max(...C);if(e(c)>Y){_(c,0),Te.closeSheet(),fe();return}const L=e(c)<v,Z=Xe(.95,e(T));if(L&&e(c)>v-Z||!L&&e(c)<v+Z){_(c,v,!0),fe();return}const ve=e(a).snapPoints.map(J=>({original:J,converted:Xe(J,e(T))})).filter(J=>L?J.converted<e(c):J.converted>e(c));if(ve.length>0){const J=ve.reduce((ie,me)=>L?me.converted>ie.converted?me:ie:me.converted<ie.converted?me:ie);(ne=t.onsnap)==null||ne.call(t,J.original),_(c,J.converted,!0)}fe()},fe=()=>{_(x,!1),_(y,!1),_(u,!1)},Te={get sheetHeight(){return e(c)},set sheetHeight(C){_(c,C,!0)},get isSheetOpen(){return o()},set isSheetOpen(C){o(C)},get isDragging(){return e(x)},set isDragging(C){_(x,C,!0)},get isMovingSheet(){return e(y)},set isMovingSheet(C){_(y,C,!0)},get isDraggingFromHandle(){return e(u)},set isDraggingFromHandle(C){_(u,C,!0)},get sheetContent(){return e(i)},set sheetContent(C){_(i,C,!0)},get sheetElement(){return e(m)},set sheetElement(C){_(m,C,!0)},get maxHeightPx(){return e(T)},get settings(){return e(a)},touchStartEvent:ce,mouseDownEvent:we,mouseMoveEvent:ue,touchMoveEvent:he,moveEnd:le,openSheet:()=>{o(!0)},closeSheet:()=>{o(!1)},toggleSheet:()=>{o(!o())}};let S={sheetId:M,headingId:U,descriptionId:k};ee(e(a).startingSnapPoint,!1),Nt("sheetContext",Te),Nt("sheetIdentificationContext",S);var f=yo(),E=A(f);return et(E,()=>t.children??Me),B(f),H(n,f),He({setSnapPoint:ee})}var Eo=R("<div><!></div>");function Co(n,t){Le(t,!0);let o=Qe(t,["$$slots","$$events","$$legacy","children"]);const r=Ve("sheetContext"),h=Ve("sheetIdentificationContext");if(!r)throw new Error("BottomSheet.Trigger must be inside a BottomSheet component");const a=()=>{r.toggleSheet()};var s=Eo(),b=c=>{(c.key==="Enter"||c.key===" ")&&a()};$e(s,()=>({...o,role:"button",tabindex:"0","aria-haspopup":"dialog","aria-controls":h.sheetId,"aria-expanded":r.isSheetOpen?"true":"false",onclick:a,onkeydown:b}));var w=A(s);et(w,()=>t.children??Me),B(s),H(n,s),He()}const To=n=>n;function So(n,{delay:t=0,duration:o=400,easing:r=To}={}){const h=+getComputedStyle(n).opacity;return{delay:t,duration:o,easing:r,css:a=>`opacity: ${a*h}`}}var Do=R("<div></div>"),Io=R("<!> <!>",1);function No(n,t){Le(t,!0);const o=Ve("sheetContext");if(!o)throw new Error("BottomSheet.Overlay must be inside a BottomSheet component");let r=Qe(t,["$$slots","$$events","$$legacy","children"]);var h=Io(),a=Pe(h);{var s=w=>{var c=Do();$e(c,()=>({...r,role:"presentation","aria-hidden":"true",class:`bottom-sheet-overlay ${t.class??""}`}),void 0,"svelte-msj0u3"),Rt(3,c,()=>So,()=>({duration:200})),H(w,c)};se(a,w=>{o.isSheetOpen&&w(s)})}var b=_e(a,2);et(b,()=>t.children??Me),H(n,h),He()}var Mo=R("<div></div>");function Yt(n,t){Le(t,!0);let o=Qe(t,["$$slots","$$events","$$legacy"]);var r=Mo();$e(r,()=>({...o,class:`bottom-sheet-grip ${t.class??""}`,"aria-hidden":"true"}),void 0,"svelte-hvzhvz"),H(n,r),He()}var Po=R('<div class="handle-grip-wrapper svelte-1keauf3"><!></div>'),ko=R('<div class="handle-grip-wrapper svelte-1keauf3"><!></div>'),Lo=R("<div><!></div>");function Ho(n,t){Le(t,!0);const o=Ve("sheetContext");if(!o)throw new Error("BottomSheet.Overlay must be inside a BottomSheet component");let r=Qe(t,["$$slots","$$events","$$legacy","children"]),h=G(at({})),a=G(at({}));st(()=>{(o.settings.position==="left"||o.settings.position==="right")&&(e(h).style.width=`${e(a).getBoundingClientRect().width}px`)});const s=m=>{if(o.settings.disableDragging)return;const x=o.maxHeightPx;let l=o.settings.snapPoints.map(D=>Xe(D,x)).sort((D,I)=>I-D);const v=l.findIndex(D=>Math.abs(D-o.sheetHeight)<10);switch(m.key){case"ArrowUp":m.preventDefault(),v<l.length-1&&(o.sheetHeight=l[v+1]);break;case"ArrowDown":m.preventDefault(),v>0?o.sheetHeight=l[v-1]:o.settings.disableClosing||o.closeSheet();break;case"Home":m.preventDefault(),o.sheetHeight=l[l.length-1];break;case"End":m.preventDefault(),o.sheetHeight=l[0];break}};var b=Lo(),w=()=>o.isDraggingFromHandle=!0,c=()=>o.isDraggingFromHandle=!0;$e(b,m=>({...r,class:`handle-container position-${o.settings.position??""} ${t.class??""}`,onmousemove:w,ontouchmove:c,role:"slider",tabindex:"0","aria-label":"Sheet height control","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":m,onkeydown:s}),[()=>Math.round((1-o.sheetHeight/window.innerHeight)*100)],"svelte-1keauf3");var u=A(b);{var T=m=>{var x=Po(),y=A(x);et(y,()=>t.children??Me),B(x),Ke(x,l=>_(a,l),()=>e(a)),H(m,x)},i=m=>{var x=ko(),y=A(x);Yt(y,{}),B(x),Ke(x,l=>_(a,l),()=>e(a)),H(m,x)};se(u,m=>{t.children?m(T):m(i,!1)})}B(b),Ke(b,m=>_(h,m),()=>e(h)),H(n,b),He()}const ke=xo;ke.Content=po;ke.Sheet=_o;ke.Trigger=Co;ke.Overlay=No;ke.Handle=Ho;ke.Grip=Yt;var Uo=R('<div class="message svelte-rctndy">Loading...</div>'),Bo=R('<div class="message svelte-rctndy"> </div>'),Oo=(n,t,o)=>t(e(o).id,e(o).name,e(o).metadata),Ao=R('<div class="item-meta svelte-rctndy"> </div>'),Fo=R('<div class="item svelte-rctndy"><div class="color-dot svelte-rctndy"></div> <div class="item-content svelte-rctndy"><div class="item-name svelte-rctndy"> </div> <!></div></div>'),Go=R('<h3 class="title svelte-rctndy"> </h3> <input type="text" class="search-input svelte-rctndy"/> <!>',1),Ro=R("<!> <!>",1);function Wo(n,t){Le(t,!0);function o(I,M=20){return!I||I.length<=M?I:I.slice(0,M-3)+"..."}let r=Se(t,"title",3,"Select Item"),h=Se(t,"searchPlaceholder",3,"Search..."),a=Se(t,"maxHeight",3,.8),s=Se(t,"filterText",3,""),b=Se(t,"show",3,!1),w=Se(t,"select",3,I=>{}),c=Se(t,"close",3,()=>{}),u=G(null),T=G(!1),i=G(at(s())),m=G(at(b()));Ge(()=>{_(m,b())}),Ge(()=>{_(i,s())});function x(){_(m,!1),c()()}function y(I,M,U){w()({id:I,name:M,metadata:U}),x()}function l(){e(T)||(setTimeout(()=>{e(u)&&e(u).focus()},100),_(T,!0))}Ge(()=>{e(i)!==void 0&&t.dataProvider.search(e(i))});function v(){_(T,!1),x()}const D=X(()=>({maxHeight:a(),disableClosing:!1,position:"bottom"}));ke(n,{get settings(){return e(D)},onopen:l,onclose:v,get isSheetOpen(){return e(m)},set isSheetOpen(I){_(m,I,!0)},children:(I,M)=>{var U=qe(),k=Pe(U);ct(k,()=>ke.Overlay,(ee,K)=>{K(ee,{children:(Q,ye)=>{var ce=qe(),we=Pe(ce);ct(we,()=>ke.Sheet,(F,re)=>{re(F,{children:(ue,he)=>{var le=Ro(),fe=Pe(le);ct(fe,()=>ke.Handle,(S,f)=>{f(S,{})});var Te=_e(fe,2);ct(Te,()=>ke.Content,(S,f)=>{f(S,{children:(E,j)=>{var ge=Go(),C=Pe(ge),Y=A(C,!0);B(C);var L=_e(C,2);Ot(L),Ke(L,ne=>_(u,ne),()=>e(u));var Z=_e(L,2);{var ve=ne=>{var J=Uo();H(ne,J)},Ue=(ne,J)=>{{var ie=oe=>{var pe=Bo(),xe=A(pe,!0);B(pe),be(()=>je(xe,e(i)?"No matching items found":"No items available")),H(oe,pe)},me=oe=>{var pe=qe(),xe=Pe(pe);it(xe,17,()=>t.dataProvider.items,V=>V.id,(V,$)=>{var Ee=Fo();Ee.__click=[Oo,y,$];var de=A(Ee),De=_e(de,2),te=A(De),gt=A(te,!0);B(te);var vt=_e(te,2);{var mt=Oe=>{var Ie=Ao(),tt=A(Ie);B(Ie),be(()=>je(tt,`(${e($).metadata.contributorCount??""} contributors)`)),H(Oe,Ie)};se(vt,Oe=>{var Ie;((Ie=e($).metadata)==null?void 0:Ie.contributorCount)!==void 0&&Oe(mt)})}B(De),B(Ee),be((Oe,Ie)=>{Je(Ee,"data-id",e($).id),Ne(de,`background-color: ${Oe??""}`),Je(te,"title",e($).name||e($).id),je(gt,Ie)},[()=>e($).color||Ft(e($).id),()=>o(e($).name||e($).id,20)]),H(V,Ee)}),H(oe,pe)};se(ne,oe=>{t.dataProvider.items.length===0?oe(ie):oe(me,!1)},J)}};se(Z,ne=>{t.dataProvider.loading&&t.dataProvider.items.length===0?ne(ve):ne(Ue,!1)})}be(()=>{je(Y,r()),Je(L,"placeholder",h())}),At(L,()=>e(i),ne=>_(i,ne)),H(E,ge)},$$slots:{default:!0}})}),H(ue,le)},$$slots:{default:!0}})}),H(Q,ce)},$$slots:{default:!0}})}),H(I,U)},$$slots:{default:!0}}),He()}xt(["click"]);var zo=R('<div class="empty-state svelte-1gagiud"><div class="add-node-prompt svelte-1gagiud"><button class="play-button svelte-1gagiud"><span class="play-text svelte-1gagiud">Play! ✨</span></button></div></div>'),Yo=(n,t,o)=>t(n,e(o)),Xo=(n,t)=>t(n),jo=(n,t,o)=>t(n,e(o)),qo=(n,t)=>t(n),Ko=n=>n.preventDefault(),Vo=R("<div><!></div>"),Zo=R('<div class="empty-state svelte-1gagiud"><div class="add-node-prompt svelte-1gagiud"><button class="add-node-button svelte-1gagiud"><span class="add-icon svelte-1gagiud">➕</span> <span class="add-text"> </span></button></div></div>'),Jo=R('<div class="node-container svelte-1gagiud"><div class="app-content svelte-1gagiud"><div class="treemap-container svelte-1gagiud"><!></div></div> <!></div>');function Qo(n,t){Le(t,!0);const[o,r]=Bt(),h=()=>Ye(Ae,"$userTree",o),a=()=>Ye(ln,"$currentPath",o),s=()=>Ye(dn,"$userpub",o),b=()=>Ye(un,"$username",o);let w=G(0);const c=["Node","Value","Goal","Dependency","Desire","Contribution"];let u=G(0);function T(){Mt(u),console.log("[UI FLOW] Triggered update",e(u))}let i=G(!1),m=G(at({x:0,y:0})),x=G(null),y=En([]),l=G(0),v=G(!1),D=G(null),I=G(!1),M=G(!1),U=G(null),k=G(null);const ee=350,K=16,Q=.03,ye=-.03,ce=250;let we=G(0);const F=X(h),re=X(a),ue=X(s),he=X(()=>e(re).length===0&&e(ue)?e(ue):e(re).length>0?e(re)[e(re).length-1]:null),le=X(()=>!e(F)&&e(he)&&e(ue)&&e(he)===e(ue)?(console.log("[UI FLOW] Waiting for tree to be loaded"),null):!e(F)||!e(he)?null:ze(e(F),e(he))),fe=X(()=>e(le)?e(le).children:[]),Te=X(()=>{if(!e(le))return{id:"",selfPoints:0,children:[]};const d=e(fe).map(g=>({id:g.id,points:g.type==="NonRootNode"?g.points:0,nodeName:g.name,contributors:g.type==="NonRootNode"?g.contributor_ids:[],children:[],hasChildren:g.children.length>0}));return{id:e(le).id,selfPoints:e(le).type==="NonRootNode"?e(le).points:0,children:d}}),S=X(()=>{var Ce,Be,z,ae,nt;e(u);const d=e(Te),g={id:d.id,points:0,children:d.children};console.log("[DEBUG] Creating hierarchy with data:",d),console.log("[DEBUG] Current tree state:",e(F)),console.log("[DEBUG] Current node:",e(le)),console.log("[DEBUG] Children points:",d.children.map(W=>({name:W.nodeName,points:W.points}))),console.log("[DEBUG] Original children from tree:",(Be=(Ce=e(le))==null?void 0:Ce.children)==null?void 0:Be.map(W=>({name:W.name,points:W.type==="NonRootNode"?W.points:0})));const P=Et(g,W=>W.children);P.sum(W=>W.points),console.log("[DEBUG] After sum - hierarchy values:",(z=P.children)==null?void 0:z.map(W=>({name:W.data.nodeName,points:W.data.points,value:W.value}))),P.sort((W,Re)=>Re.value-W.value),console.log("[DEBUG] After sort - hierarchy values:",(ae=P.children)==null?void 0:ae.map(W=>({name:W.data.nodeName,points:W.data.points,value:W.value})));function N(W,Re,Ze,lt,dt){no(W,0,0,1,1);for(const We of W.children||[])We.x0=Re+We.x0*(lt-Re),We.x1=Re+We.x1*(lt-Re),We.y0=Ze+We.y0*(dt-Ze),We.y1=Ze+We.y1*(dt-Ze)}const q=to().tile(N).size([1,1]).padding(.005).round(!1)(P);return console.log("[DEBUG] After treemap - final dimensions:",(nt=q.children)==null?void 0:nt.map(W=>({name:W.data.nodeName,points:W.data.points,value:W.value,width:(W.x1-W.x0)*100,height:(W.y1-W.y0)*100}))),q});st(()=>{document.addEventListener("mouseup",oe),document.addEventListener("touchend",oe),document.addEventListener("touchcancel",oe);const d=setInterval(()=>{_(w,(e(w)+1)%c.length)},4e3),g=Ae.subscribe(P=>{P&&(console.log("[UI FLOW] userTree updated, triggering UI update"),T())});return()=>{e(U)!==null&&clearInterval(e(U)),e(k)!==null&&clearTimeout(e(k)),clearInterval(d),document.removeEventListener("mouseup",oe),document.removeEventListener("touchend",oe),document.removeEventListener("touchcancel",oe),document.removeEventListener("pointermove",Oe),document.removeEventListener("pointerup",Ie),g()}});function f(d){console.log("[UI FLOW] zoomInto called for node:",d),p.zoomInto(d),console.log("[UI FLOW] Navigation handled")}function E(){if(console.log("[UI FLOW] handleCreateNewTree started"),!b()||!s()){console.log("[UI FLOW] User not authenticated, prompting to log in"),p.showToast("Please log in to start playing!","info");return}try{cn(!0)&&p.showToast("Greetings player, welcome to playnet!","success")}catch(d){console.error("[UI FLOW] Error creating new tree:",d),p.showToast("Error creating new tree","error")}}async function j(){if(console.log("[UI FLOW] handleAddNode started"),p.editMode){p.showToast("Cannot add nodes while editing","warning");return}if(p.deleteMode){p.showToast("Cannot add nodes in delete mode","warning");return}if(!e(he)){console.log("[UI FLOW] No currentNodeId, aborting");return}const g=(()=>{var Ce;if(!((Ce=e(S))!=null&&Ce.children)||e(S).children.length===0)return console.log("[UI FLOW] No siblings, setting new node to 100 points"),100;const O=e(S).children.reduce((Be,z)=>{var ae;return Be+(((ae=z.data)==null?void 0:ae.points)||0)},0),q=Math.max(1,O*.2);return console.log("[UI FLOW] Calculated points based on siblings:",q),q})(),P=`node_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,N="New Node";console.log("[UI FLOW] Creating new node:",{id:P,points:g,name:N}),console.log("[UI FLOW] Current parent:",e(he)),console.log("[UI FLOW] Current path:",e(re));try{if(!e(F)){p.showToast("Error creating node: No tree found","error");return}if(!e(le)){p.showToast("Error creating node: Current node not found","error");return}const O=structuredClone(e(F)),q=ze(O,e(he));if(!q){p.showToast("Error creating node: Current node not found in updated tree","error");return}mn(q,P,N,g),Ae.set(O),T(),console.log("[UI FLOW] addNode successful"),p.showToast("New node created","success"),console.log("[UI FLOW] Setting node to edit mode:",P),setTimeout(()=>{p.nodeToEdit=P,console.log("[UI FLOW] Node edit mode set"),console.log("userTree Parent.275",h())},50)}catch(O){console.error("[UI FLOW] Error in handleAddNode:",O),p.showToast("Error creating node","error")}}function ge(d){const{nodeId:g,newName:P}=d;try{if(!e(F))return;const N=structuredClone(e(F));fn(N,g,O=>{gn(O,P)}),Ae.set(N),T(),p.exitEditMode(),p.showToast(`Node renamed to "${P}"`,"success")}catch(N){console.error(`Error updating name for node ${g}:`,N),p.showToast("Error updating node name","error")}}function C(d){const{nodeId:g,clientX:P,clientY:N}=d;_(x,g,!0),_(m,{x:P,y:N},!0),_(i,!0)}function Y(d){const{nodeId:g,contributorId:P}=d;try{if(!e(F))return;const N=structuredClone(e(F)),O=ze(N,g);if(!O||O.type!=="NonRootNode")return;const q=O.contributor_ids.filter(Ce=>Ce!==P);O.contributor_ids=q,Ae.set(N),T(),p.showToast("Contributor removed successfully","success")}catch(N){console.error("Error removing contributor:",N),p.showToast("Error removing contributor","error")}}function L(d){const{id:g}=d;if(!e(x)){console.error("No node selected for adding contributor");return}ve(e(x),g),_(i,!1),_(x,null)}function Z(){_(i,!1),_(x,null)}function ve(d,g){try{if(!e(F))return;const P=structuredClone(e(F)),N=ze(P,d);if(!N||N.type!=="NonRootNode")return;if(!N.contributor_ids.includes(g)){const q=[...N.contributor_ids];q.push(g),hn(N,q),Ae.set(P),T(),p.showToast("Contributor added successfully","success")}}catch(P){console.error("Error adding contributor:",P),p.showToast("Error adding contributor","error")}}function Ue(d){if(!e(F))return 0;const g=ze(e(F),d);return g?vn(g,e(F)):0}function ne(d,g=!1){p.deleteMode||p.recomposeMode||p.isDragging||(e(U)!==null&&clearInterval(e(U)),e(k)!==null&&clearTimeout(e(k)),_(I,!1),_(M,!1),_(k,window.setTimeout(()=>{e(v)&&e(D)===d.data.id&&(_(I,!0),_(M,g,!0),_(U,window.setInterval(()=>{if(!e(v)){J();return}let P;const N=d.data.points;g?P=N*ye:P=N*Q;const O=Math.max(1,N+P);if(isNaN(O)){console.error("Growth calculation resulted in NaN:",{currentPoints:N,rate:P,isShrinking:g});return}ie(d,O)},K),!0))},ee),!0))}function J(){var d;if(_(v,!1),e(I)&&e(D)&&e(S)){const g=(d=e(S).children)==null?void 0:d.find(P=>P.data.id===e(D));g&&g.data&&g.data.id&&me(g.data.id,g.data.points)}_(D,null),e(k)!==null&&clearTimeout(e(k)),e(U)!==null&&clearInterval(e(U)),_(U,null),_(I,!1),_(M,!1)}function ie(d,g){d.data.points=g,Mt(u)}function me(d,g){try{if(!e(F))return;const P=structuredClone(e(F)),N=ze(P,d);if(!N||N.type!=="NonRootNode")return;sn(N,g),Ae.set(P),T()}catch(P){console.error(`Error saving points for node ${d}:`,P),p.showToast("Error saving node points","error")}}function oe(){e(v)&&(J(),te())}let pe=G(null),xe=G(!1),V=G(!1);function $(d,g){_(V,d.touches.length===2),console.log("[DEBUG] TouchStart - touches:",d.touches.length,"isMultiTouch:",e(V))}function Ee(d){d.touches.length<2&&_(V,!1)}function de(d,g){if(console.log("[DEBUG] PointerDown - isPrimary:",d.isPrimary,"button:",d.button,"isMultiTouch:",e(V)),!d.isPrimary)return;if(p.editMode){console.log("[DEBUG PARENT] Ignoring growth start - in edit mode");return}if(!p.deleteMode&&(p.recomposeMode||d.button===1||d.ctrlKey||d.metaKey)){mt(d,g);return}const N=d.target;if(N&&(N.closest(".node-text")||N.closest(".node-text-edit-container")||N.closest(".add-contributor-button")||N.closest(".tag-container")||N.closest(".contributor-container")||N.closest(".node-title")||N.closest(".node-title-area")||N.closest(".title-segment")||N.closest(".node-edit-input")||N.closest(".contributors-area"))){console.log("[DEBUG] Ignoring pointer event on text/contributor element:",N.className);return}if(!e(xe))if(_(pe,d.pointerId,!0),_(xe,!0),_(v,!0),_(l,Date.now(),!0),_(D,g.data.id,!0),d.pointerType==="touch")setTimeout(()=>{if(!e(xe))return;const O=d.button===2||e(V);console.log("[DEBUG] Delayed processing - isShrinking:",O,"button:",d.button,"isMultiTouch:",e(V)),ne(g,O)},50);else{const O=d.button===2||e(V);console.log("[DEBUG] Immediate processing - isShrinking:",O,"button:",d.button,"isMultiTouch:",e(V)),ne(g,O)}}function De(d){if(!d.isPrimary||d.pointerId!==e(pe))return;if(p.editMode){console.log("[DEBUG PARENT] Ignoring interaction - in edit mode"),te();return}const g=d.target;if(g&&(g.closest(".node-text")||g.closest(".node-text-edit-container")||g.closest(".add-contributor-button")||g.closest(".tag-container")||g.closest(".contributor-container")||g.closest(".node-title")||g.closest(".node-title-area")||g.closest(".title-segment")||g.closest(".node-edit-input")||g.closest(".contributors-area"))){te();return}const N=Date.now()-e(l)>=ce||e(I),O=e(D);J(),!N&&O&&(p.deleteMode?gt(O):p.recomposeMode?vt(O):f(O)),te()}function te(){_(pe,null),_(xe,!1),_(V,!1)}Ge(()=>{e(re),te()});function gt(d){if(confirm("Delete this node and all its children?"))try{if(!e(F))return;const g=structuredClone(e(F)),P=pn(g,d);if(!P){console.error("Cannot find parent node");return}if(d===e(re)[0]){console.error("Cannot delete root node"),p.showToast("Cannot delete root node","error");return}if(e(he)===d){if(e(re).length<=1){console.error("Cannot delete current node with no parent");return}p.zoomOut()}if(!ze(g,d)){p.showToast("Node not found","error");return}const q=P.children.findIndex(Ce=>Ce.id===d);q!==-1&&P.children.splice(q,1),Ae.set(g),T(),p.showToast("Node deleted successfully","success")}catch(g){console.error(`Error in deletion process: ${g}`),p.showToast("Error deleting node","error")}}function vt(d){try{if(!e(F)){p.showToast("No tree available for recompose","error");return}const g=ze(e(F),d);if(!g){p.showToast("Node not found","error");return}p.showToast(`Recomposing node: ${g.name}`,"info"),console.log("[RECOMPOSE] Recomposing node:",g)}catch(g){console.error(`Error in recompose process: ${g}`),p.showToast("Error recomposing node","error")}}function mt(d,g){d.preventDefault(),d.stopPropagation(),p.startDrag(g.data.id,g.data.nodeName||"Unnamed","",d.clientX,d.clientY),_(we,Date.now(),!0),console.log("[DRAG] Started dragging node:",p.draggedNodeName),document.addEventListener("pointermove",Oe),document.addEventListener("pointerup",Ie)}function Oe(d){p.isDragging&&p.updateDragPosition(d.clientX,d.clientY)}function Ie(d){if(!p.isDragging)return;if(console.log("[DRAG] Ending drag"),Date.now()-e(we)>=200&&p.draggedNodeId){const N=document.elementFromPoint(d.clientX,d.clientY),O=N==null?void 0:N.closest(".clickable[data-node-id], .breadcrumb-item[data-node-id]");if(O){const q=O.getAttribute("data-node-id");q&&q!==p.draggedNodeId&&p.handleNodeReorder(p.draggedNodeId,q)}}p.endDrag(),_(we,0),document.removeEventListener("pointermove",Oe),document.removeEventListener("pointerup",Ie)}var tt=Jo(),pt=A(tt),Ct=A(pt),Xt=A(Ct);{var jt=d=>{var g=zo(),P=A(g),N=A(P);N.__click=E,B(P),B(g),H(d,g)},qt=(d,g)=>{{var P=O=>{var q=qe(),Ce=Pe(q);it(Ce,17,()=>e(S).children,ht,(Be,z)=>{var ae=Vo();let nt;ae.__pointerdown=[Yo,de,z],ae.__pointerup=[Xo,De],ae.__touchstart=[jo,$,z],ae.__touchend=[qo,Ee],ae.__contextmenu=[Ko];var W=A(ae);const Re=X(()=>({id:e(z).data.id,name:e(z).data.nodeName||"Unnamed",points:e(z).data.points,contributors:e(z).data.contributors||[],fulfillment:Ue(e(z).data.id),hasChildren:e(z).data.hasChildren||!1})),Ze=X(()=>({x0:e(z).x0,y0:e(z).y0,x1:e(z).x1,y1:e(z).y1})),lt=X(()=>p.nodeToEdit===e(z).data.id);vo(W,{get node(){return e(Re)},get dimensions(){return e(Ze)},addContributor:C,removeContributor:Y,onTextEdit:ge,get shouldEdit(){return e(lt)}}),B(ae),be(dt=>{nt=_t(ae,1,"clickable",null,nt,dt),Je(ae,"data-node-id",e(z).data.id),Ne(ae,`
							position: absolute;
							left: ${e(z).x0*100}%;
							top: ${e(z).y0*100}%;
							width: ${(e(z).x1-e(z).x0)*100}%;
							height: ${(e(z).y1-e(z).y0)*100}%;
							box-sizing: border-box;
						`)},[()=>({deleting:p.deleteMode,recomposing:p.recomposeMode,"dragging-over":p.isDragging&&p.draggedNodeId!==e(z).data.id,"being-dragged":p.isDragging&&p.draggedNodeId===e(z).data.id,growing:e(I)&&e(D)===e(z).data.id&&!e(M),shrinking:e(I)&&e(D)===e(z).data.id&&e(M)})]),H(Be,ae)}),H(O,q)},N=O=>{var q=Zo(),Ce=A(q),Be=A(Ce);Be.__click=j;var z=_e(A(Be),2),ae=A(z,!0);B(z),B(Be),B(Ce),B(q),be(()=>je(ae,c[e(w)])),H(O,q)};se(d,O=>{e(S)&&e(S).children&&e(S).children.length>0?O(P):O(N,!1)},g)}};se(Xt,d=>{e(F)?d(qt,!1):d(jt)})}B(Ct),B(pt);var Kt=_e(pt,2);{var Vt=d=>{Wo(d,{get show(){return e(i)},title:"Select Contributor",searchPlaceholder:"Search users...",get dataProvider(){return y},select:L,close:Z})};se(Kt,d=>{e(i)&&d(Vt)})}B(tt),H(n,tt),He(),r()}xt(["click","pointerdown","pointerup","touchstart","touchend","contextmenu"]);var $o=R("your<br/>recognition",1),er=R(`<div class="placeholder svelte-1ghmyps"><p>You have not yet recognized any contributors! Adding contributors to a node makes it a
							contribution!</p></div>`),tr=R("mutual<br/>recognition",1),nr=R(`<div class="placeholder svelte-1ghmyps"><p>You don't have any mutual contributors yet!</p></div>`),or=R('<div class="layout root-page svelte-1ghmyps"><div class="parent svelte-1ghmyps"><!></div> <div class="bars svelte-1ghmyps"><div><div class="bar-label svelte-1ghmyps"><!></div> <div class="bar-area svelte-1ghmyps"><!></div></div> <div><div class="bar-label svelte-1ghmyps"><!></div> <div class="bar-area svelte-1ghmyps"><!></div></div></div></div>');function hr(n,t){Le(t,!0);const[o,r]=Bt(),h=()=>Ye(Ae,"$userTree",o),a=()=>Ye(kt,"$userSogf",o),s=()=>Ye(u,"$barSegments",o),b=()=>Ye(T,"$providerSegments",o);let w=G(!1),c;const u=Ht(kt,S=>!S||Object.keys(S).length===0?[]:Object.entries(S).filter(([f,E])=>E>0).map(([f,E])=>({id:f,value:E*100})).sort((f,E)=>E.value-f.value)),T=Ht(bn,S=>{if(console.log("[UI] providerShares changed:",S),!S||Object.keys(S).length===0)return console.log("[UI] No provider shares data for segments"),[];const f=Object.entries(S).filter(([E,j])=>j>0).map(([E,j])=>({id:E,value:j*100})).sort((E,j)=>j.value-E.value);return console.log("[UI] Generated provider segments:",f),f});st(()=>{const S=h(),f=a();S&&(!f||Object.keys(f).length===0)&&wn(),c=window.matchMedia("(max-width: 768px)");function E(j){_(w,j.matches,!0)}return E(c),c.addEventListener("change",E),()=>{c.removeEventListener("change",E)}});var i=or(),m=A(i),x=A(m);Qo(x,{}),B(m);var y=_e(m,2),l=A(y);let v;var D=A(l),I=A(D);{var M=S=>{var f=$o();Pt(2),H(S,f)},U=S=>{var f=Tt("YR");H(S,f)};se(I,S=>{e(w)?S(M):S(U,!1)})}B(D);var k=_e(D,2),ee=A(k);{var K=S=>{const f=X(()=>!e(w));Lt(S,{get segments(){return s()},width:"100%",height:"100%",get vertical(){return e(f)},showLabels:!1,showValues:!1,rounded:!1})},Q=S=>{var f=er();H(S,f)};se(ee,S=>{s().length>0?S(K):S(Q,!1)})}B(k),B(l);var ye=_e(l,2);let ce;var we=A(ye),F=A(we);{var re=S=>{var f=tr();Pt(2),H(S,f)},ue=S=>{var f=Tt("MR");H(S,f)};se(F,S=>{e(w)?S(re):S(ue,!1)})}B(we);var he=_e(we,2),le=A(he);{var fe=S=>{const f=X(()=>!e(w));Lt(S,{get segments(){return b()},width:"100%",height:"100%",get vertical(){return e(f)},showLabels:!1,showValues:!1,rounded:!1})},Te=S=>{var f=nr();H(S,f)};se(le,S=>{b().length>0?S(fe):S(Te,!1)})}B(he),B(ye),B(y),B(i),be((S,f)=>{v=_t(l,1,"bar-group svelte-1ghmyps",null,v,S),ce=_t(ye,1,"bar-group svelte-1ghmyps",null,ce,f)},[()=>({vertical:!e(w)}),()=>({vertical:!e(w)})]),H(n,i),He(),r()}export{hr as component};
