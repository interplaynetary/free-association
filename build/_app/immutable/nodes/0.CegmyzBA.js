import{t as g,a as d,d as $t,e as Tt}from"../chunks/N0BH6kDF.js";import{F as rt,ad as E,af as J,G as Re,z as Ct,X as i,H as ot,j as e,aq as Et,l as o,I as a,J as r,W as F,V as ce,ar as Ye}from"../chunks/DbFEi_cg.js";import{d as Pt,s as P,e as At}from"../chunks/C1WlvAqj.js";import{i as y,b as Ze,s as St,a as ve}from"../chunks/C8Ri_RvL.js";import{g as b,f as ze,a as It,u as Ue,c as et,b as Nt,d as Lt,i as Ut,s as U,e as Ft,h as Me,j as Rt,r as Te,k as Mt,l as Fe,m as Ot,n as Dt,o as Ht,p as Wt,q as qt}from"../chunks/uskwNHu3.js";import{s as Bt,g as st}from"../chunks/X3OfmcgT.js";import{G as jt}from"../chunks/Bo4nBXrY.js";const Gt=!0,Vt=!0,Jt=!0,Aa=Object.freeze(Object.defineProperty({__proto__:null,csr:Jt,prerender:Gt,ssr:Vt},Symbol.toStringTag,{value:"Module"})),Xt=()=>{const u=Bt;return{page:{subscribe:u.page.subscribe},navigating:{subscribe:u.navigating.subscribe},updated:u.updated}},Kt={subscribe(u){return Xt().page.subscribe(u)}};function tt(u,c,p){o(c,!e(c)),e(c)||p()}function Qt(u,c){u.preventDefault(),o(c,!0)}function Yt(u,c){o(c,!e(c))}function at(u,c,p,Q,Y){o(c,!e(c)),o(p,""),o(Q,""),o(Y,!1)}async function Zt(){try{await Ot(),b.resetState(),b.showToast("Signed out successfully","info"),st("/")}catch(u){console.error("Logout error:",u),b.showToast("Error during sign out","error")}}async function zt(u,c){if(!e(c)){b.showToast("No tree data available to copy","error");return}try{const p=JSON.stringify(e(c),null,2);await navigator.clipboard.writeText(p),b.showToast("Tree data copied to clipboard","success")}catch(p){console.error("Error copying tree:",p),b.showToast("Failed to copy tree data","error")}}var ea=g('<div class="breadcrumb-item loading-path svelte-nwoc83">Loading...</div>'),ta=(u,c)=>c(0,u),aa=g('<a href="/" class="breadcrumb-item auth-root current svelte-nwoc83" tabindex="0"> </a>'),ra=g('<button class="breadcrumb-item loading-path svelte-nwoc83" tabindex="0" aria-label="Show login panel">Login</button>'),oa=g('<div class="breadcrumb-separator svelte-nwoc83">/</div>'),sa=g('<!> <a href="/" tabindex="0"> </a>',1),na=g('<div class="loading-state svelte-nwoc83"><div class="spinner svelte-nwoc83"></div> <p class="svelte-nwoc83">Checking authentication...</p></div>'),ia=(u,c,p)=>c(p()),la=g('<button class="copy-pub-btn svelte-nwoc83" title="Click to copy your public key"><span class="pub-text svelte-nwoc83"> </span> <span class="copy-icon svelte-nwoc83">üìã</span></button>'),ca=g('<div class="welcome-panel svelte-nwoc83"><div class="user-profile svelte-nwoc83"><div class="avatar large svelte-nwoc83"><img class="svelte-nwoc83"></div> <div class="user-details svelte-nwoc83"><h3 class="svelte-nwoc83"> </h3> <p class="user-id svelte-nwoc83"> </p> <!></div></div> <div class="actions svelte-nwoc83"><button class="copy-tree-btn svelte-nwoc83"><span>üå≤üìã</span></button> <button class="logout-btn svelte-nwoc83">Log Out</button> <button class="close-btn svelte-nwoc83">Close</button></div></div>'),va=g('<div class="error-message svelte-nwoc83"> </div>'),da=g('<div class="auth-message svelte-nwoc83"> </div>'),ua=g('<div class="form-group password-group svelte-nwoc83"><label for="confirmPassword" class="svelte-nwoc83">Confirm Password</label> <div class="password-input-container svelte-nwoc83"><input id="confirmPassword" placeholder="Confirm password" autocomplete="new-password" class="svelte-nwoc83"></div></div> <div class="form-group checkbox-group svelte-nwoc83"><label class="checkbox-label svelte-nwoc83"><input type="checkbox" id="agreedToTerms" class="svelte-nwoc83"> <span class="checkbox-text svelte-nwoc83">I agree to the <a href="/privacy" target="_blank" class="terms-link svelte-nwoc83">Privacy Policy</a> and <a href="/terms" target="_blank" class="terms-link svelte-nwoc83">Terms of Use</a></span></label></div>',1),pa=g('<div class="spinner small svelte-nwoc83"></div> ',1),fa=g('Already have an account? <button type="button" class="text-link svelte-nwoc83">Sign in instead</button>',1),ga=g(`Don't have an account? <button type="button" class="text-link svelte-nwoc83">Create one now</button>`,1),ba=g('<div class="login-form svelte-nwoc83"><h3 class="svelte-nwoc83"> </h3> <p class="form-info svelte-nwoc83"> </p> <!> <!> <form><div class="form-group svelte-nwoc83"><label for="username" class="svelte-nwoc83">Username</label> <input type="text" id="username" placeholder="Enter username" autocomplete="username" class="svelte-nwoc83"></div> <div class="form-group password-group svelte-nwoc83"><label for="password" class="svelte-nwoc83">Password</label> <div class="password-input-container svelte-nwoc83"><input id="password" placeholder="Enter password" class="svelte-nwoc83"> <button type="button" class="toggle-password svelte-nwoc83"><span> </span></button></div></div> <!> <div class="actions svelte-nwoc83"><button type="submit"><!></button> <button type="button" class="cancel-btn svelte-nwoc83">Cancel</button></div> <div class="toggle-auth-mode svelte-nwoc83"><!></div></form></div>'),_a=g('<div class="login-panel svelte-nwoc83"><!></div>'),wa=g('<div class="header svelte-nwoc83"><div class="header-main svelte-nwoc83"><div class="node-name svelte-nwoc83"><div class="breadcrumbs svelte-nwoc83"><!></div></div> <div class="header-controls svelte-nwoc83"><a href="/inventory" class="icon-button inventory-button svelte-nwoc83" title="View inventory"><span>üìä</span></a> <button class="icon-button add-button svelte-nwoc83" title="Add new node"><span>‚ûï</span></button> <button class="icon-button delete-button svelte-nwoc83" title="Toggle delete mode"><span>üóëÔ∏è</span></button></div></div> <!></div>');function ha(u,c){rt(c,!0);const[p,Q]=St(),Y=()=>ve(Ue,"$userTree",p),Ce=()=>ve(et,"$currentPath",p),W=()=>ve(Nt,"$userpub",p),x=()=>ve(Lt,"$username",p),Ee=()=>ve(Ut,"$isAuthenticating",p),we=()=>ve(Kt,"$page",p);function A(t,s=10){return t.length<=s?t:t.slice(0,s-3)+"..."}async function X(t){try{await navigator.clipboard.writeText(t),b.showToast("Public key copied to clipboard","success")}catch(s){console.error("Failed to copy text: ",s),b.showToast("Failed to copy public key","error")}}let k=E(0);function re(){Et(k),console.log("[UI FLOW] Header triggered update",e(k))}const de=J(Y),ue=J(Ce);J(W);const Oe=J(x),De=J(Ee),pe=J(()=>(e(k),!e(de)||e(ue).length===0?[]:e(ue).map(t=>{const s=ze(e(de),t);return{id:t,name:s?s.name:"Unknown"}})));Re(()=>{const t=Ue.subscribe(n=>{n&&(console.log("[UI FLOW] Header userTree updated, triggering UI update"),re())}),s=et.subscribe(n=>{console.log("[UI FLOW] Header path updated:",n),re()});return()=>{t(),s()}});let he=J(()=>we().url.pathname),He=J(()=>e(he).startsWith("/")&&(e(he)==="/"||!e(he).startsWith("/inventory")&&!e(he).startsWith("/contacts"))),$=E(!1),R=E(!1),Z=E(""),q=E(""),fe=E(""),_=E(!1),w=E(""),oe=E(""),se=E(!1),z=E(!1);Ct(()=>{we().url.searchParams.get("error")&&(o(w,"Login failed. Please check your credentials."),o($,!0))});let We=E(null),me=E(null);Re(()=>{function t(s){e($)&&e(me)&&!e(me).contains(s.target)&&(s.target.closest(".header-controls")||o($,!1))}return document.addEventListener("mousedown",t),e(Oe)||setTimeout(()=>{o($,!0)},100),()=>{document.removeEventListener("mousedown",t)}});function ye(){o(Z,""),o(q,""),o(fe,""),o(w,""),o(oe,""),o(se,!1),o(_,!1),o(z,!1)}function nt(){if(!e(de)||e(ue).length===0)return;const t=e(ue)[e(ue).length-1],s=structuredClone(e(de)),n=ze(s,t);if(!n){b.showToast("Error creating node: Current node not found","error");return}const h=`node_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,S="New Node",f=10;try{It(n,h,S,f),Ue.set(s),re(),b.showToast("New node created","success"),setTimeout(()=>b.setNodeToEditMode(h),50)}catch(N){console.error("Error in handleAddNode:",N),b.showToast("Error creating node","error")}}function qe(t,s){if(s.preventDefault(),!e(Oe)){o($,!0);return}if(t===0&&e(pe).length===1&&e(He)){o($,!e($));return}b.navigateToPathIndex(t),e(He)||st("/")}function it(){if(!e(Z)||!e(q))return o(w,"Please enter both username and password"),!1;if(e(_)){if(!e(z))return o(w,"Please agree to the Privacy Policy and Terms of Use"),!1;if(e(q)!==e(fe))return o(w,"Passwords do not match"),!1;if(e(q).length<8)return o(w,"Password must be at least 8 characters"),!1}return!0}async function lt(t){if(t.preventDefault(),!!it()&&!e(R)){o(w,""),o(oe,""),o(R,!0);try{e(_)?await vt():await ct()}catch(s){console.error("Authentication error:",s),o(w,s instanceof Error?s.message:"Authentication error",!0)}finally{o(R,!1)}}}async function ct(){try{Ht(e(Z).trim(),e(q)),o($,!1),ye(),b.showToast("Signed in successfully","success")}catch(t){console.error("Authentication error:",t),o(w,t instanceof Error?t.message:"Authentication error",!0)}}async function vt(){try{Dt(e(Z).trim(),e(q)),o($,!1),ye(),b.showToast("Account created successfully!","success")}catch(t){console.error("Registration error:",t),o(w,t instanceof Error?t.message:"Registration error",!0)}}function dt(t,s=null,n=32){if(s&&s.length>=87)try{return jt({pub:s,size:n,round:!0,draw:"circles"})}catch(h){console.warn("Failed to generate gun-avatar:",h)}if(!t)return`data:image/svg+xml,${encodeURIComponent(`
				<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 ${n} ${n}">
					<rect width="100%" height="100%" fill="#6b7280" rx="${n/4}" ry="${n/4}" />
					<text x="50%" y="50%" font-family="Arial" font-size="${n/2}px" fill="white" 
						text-anchor="middle" dominant-baseline="middle">
						?
					</text>
				</svg>
			`)}`;try{const h=Math.abs(t.split("").reduce((ee,M)=>ee+M.charCodeAt(0),0)%360),S=70,f=60,N=t.charAt(0).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
				<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 ${n} ${n}">
					<rect width="100%" height="100%" fill="hsl(${h}, ${S}%, ${f}%)" rx="${n/4}" ry="${n/4}" />
					<text x="50%" y="50%" font-family="Arial" font-size="${n/2}px" fill="white" 
						text-anchor="middle" dominant-baseline="middle">
						${N}
					</text>
				</svg>
			`)}`}catch(h){return console.error("Error generating avatar:",h),`data:image/svg+xml,${encodeURIComponent(`
				<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${n}" viewBox="0 0 ${n} ${n}">
					<rect width="100%" height="100%" fill="#6b7280" rx="${n/4}" ry="${n/4}" />
					<text x="50%" y="50%" font-family="Arial" font-size="${n/2}px" fill="white" 
						text-anchor="middle" dominant-baseline="middle">
						!
					</text>
				</svg>
			`)}`}}var xe=wa(),Pe=a(xe),Ae=a(Pe),Be=a(Ae),ut=a(Be);{var pt=t=>{var s=ea();d(t,s)},ft=(t,s)=>{{var n=S=>{var f=aa();f.__click=[ta,qe];var N=a(f,!0);r(f),F(ee=>{U(f,"aria-label",x()),P(N,ee)},[()=>A(x())]),d(S,f)},h=(S,f)=>{{var N=M=>{var I=ra();I.__click=[Qt,$],d(M,I)},ee=M=>{var I=$t(),B=ce(I);Ft(B,17,()=>e(pe),Rt,(j,G,L)=>{var te=sa(),O=ce(te);{var ge=T=>{var D=oa();d(T,D)};y(O,T=>{L>0&&T(ge)})}var m=i(O,2);let ne;m.__click=T=>{qe(L,T)};var ae=a(m,!0);r(m),F((T,D)=>{ne=Me(m,1,"breadcrumb-item svelte-nwoc83",null,ne,T),U(m,"aria-label",e(G).name),U(m,"title",e(G).name),P(ae,D)},[()=>({current:L===e(pe).length-1,"auth-root":L===0}),()=>A(e(G).name)]),d(j,te)}),d(M,I)};y(S,M=>{e(pe).length===0?M(N):M(ee,!1)},f)}};y(t,S=>{e(pe).length===0&&x()?S(n):S(h,!1)},s)}};y(ut,t=>{e(De)?t(pt):t(ft,!1)})}r(Be),r(Ae);var je=i(Ae,2),Ge=i(a(je),2);Ge.__click=nt;var gt=i(Ge,2);gt.__click=function(...t){var s;(s=b.toggleDeleteMode)==null||s.apply(this,t)},r(je),r(Pe);var bt=i(Pe,2);{var _t=t=>{var s=_a(),n=a(s);{var h=f=>{var N=na();d(f,N)},S=(f,N)=>{{var ee=I=>{var B=ca(),j=a(B),G=a(j),L=a(G);r(G);var te=i(G,2),O=a(te),ge=a(O);r(O);var m=i(O,2),ne=a(m);r(m);var ae=i(m,2);{var T=H=>{var V=la();V.__click=[ia,X,W];var le=a(V),ke=a(le);r(le),Ye(2),r(V),F(Se=>P(ke,`üîë ${Se??""}`),[()=>A(W(),20)]),d(H,V)};y(ae,H=>{W()&&H(T)})}r(te),r(j);var D=i(j,2),ie=a(D);ie.__click=[zt,de];var be=i(ie,2);be.__click=[Zt];var K=i(be,2);K.__click=[tt,$,ye],r(D),r(B),F((H,V,le)=>{U(L,"src",H),U(L,"alt",x()),U(O,"title",x()),P(ge,`Welcome, ${V??""}`),U(m,"title","@"+(x()||"anonymous")),P(ne,`@${le??""}`)},[()=>dt(x(),W(),60),()=>A(x(),15),()=>A(x()||"anonymous",15)]),d(I,B)},M=I=>{var B=ba(),j=a(B),G=a(j,!0);r(j);var L=i(j,2),te=a(L,!0);r(L);var O=i(L,2);{var ge=l=>{var v=va(),C=a(v,!0);r(v),F(()=>P(C,e(w))),d(l,v)};y(O,l=>{e(w)&&l(ge)})}var m=i(O,2);{var ne=l=>{var v=da(),C=a(v,!0);r(v),F(()=>P(C,e(oe))),d(l,v)};y(m,l=>{e(oe)&&l(ne)})}var ae=i(m,2),T=a(ae),D=i(a(T),2);Te(D),r(T);var ie=i(T,2),be=i(a(ie),2),K=a(be);Te(K);var H=i(K,2);H.__click=[Yt,se];var V=a(H),le=a(V,!0);r(V),r(H),r(be),r(ie);var ke=i(ie,2);{var Se=l=>{var v=ua(),C=ce(v),Xe=i(a(C),2),$e=a(Xe);Te($e),r(Xe),r(C);var Ke=i(C,2),Qe=a(Ke),Ne=a(Qe);Te(Ne),Ye(2),r(Qe),r(Ke),F(()=>{U($e,"type",e(se)?"text":"password"),$e.disabled=e(R),Ne.disabled=e(R)}),Fe($e,()=>e(fe),Le=>o(fe,Le)),Wt(Ne,()=>e(z),Le=>o(z,Le)),d(l,v)};y(ke,l=>{e(_)&&l(Se)})}var Ie=i(ke,2),_e=a(Ie),wt=a(_e);{var ht=l=>{var v=pa(),C=i(ce(v));F(()=>P(C,` ${(e(_)?"Creating account...":"Signing in...")??""}`)),d(l,v)},mt=l=>{var v=Tt();F(()=>P(v,e(_)?"Create Account":"Sign In")),d(l,v)};y(wt,l=>{e(R)?l(ht):l(mt,!1)})}r(_e);var Ve=i(_e,2);Ve.__click=[tt,$,ye],r(Ie);var Je=i(Ie,2),yt=a(Je);{var xt=l=>{var v=fa(),C=i(ce(v));C.__click=[at,_,w,oe,z],d(l,v)},kt=l=>{var v=ga(),C=i(ce(v));C.__click=[at,_,w,oe,z],d(l,v)};y(yt,l=>{e(_)?l(xt):l(kt,!1)})}r(Je),r(ae),r(B),F(()=>{P(G,e(_)?"Create Account":"Sign In"),P(te,e(_)?"Enter your details to create a new account":"Enter your details to sign in"),D.disabled=e(R),U(K,"type",e(se)?"text":"password"),K.disabled=e(R),U(K,"autocomplete",e(_)?"new-password":"current-password"),U(H,"title",e(se)?"Hide password":"Show password"),P(le,e(se)?"üôà":"üêµ"),Me(_e,1,Mt(e(_)?"signup-btn":"login-btn"),"svelte-nwoc83"),_e.disabled=e(R)||!e(Z)||!e(q)||e(_)&&(!e(fe)||!e(z)),Ve.disabled=e(R)}),At("submit",ae,lt),Fe(D,()=>e(Z),l=>o(Z,l)),Fe(K,()=>e(q),l=>o(q,l)),d(I,B)};y(f,I=>{x()?I(ee):I(M,!1)},N)}};y(n,f=>{e(De)?f(h):f(S,!1)})}r(s),Ze(s,f=>o(me,f),()=>e(me)),d(t,s)};y(bt,t=>{e($)&&t(_t)})}r(xe),Ze(xe,t=>o(We,t),()=>e(We)),d(u,xe),ot(),Q()}Pt(["click"]);var ma=g('<div class="toast-container svelte-5bofqz"><div> </div></div>'),ya=g('<main class="svelte-5bofqz"><div class="app-header svelte-5bofqz"><!></div> <div class="app-content svelte-5bofqz"><!></div> <!></main>');function Sa(u,c){rt(c,!0);let p=J(()=>b.toast);Re(()=>{function A(X){if(X.key==="Escape"){const k=document.activeElement;k&&(k.tagName==="INPUT"||k.tagName==="TEXTAREA"||k.isContentEditable||k.closest(".node-edit-input"))||(X.preventDefault(),b.zoomOut())}}return document.addEventListener("keydown",A),()=>{document.removeEventListener("keydown",A)}});var Q=ya(),Y=a(Q),Ce=a(Y);ha(Ce,{}),r(Y);var W=i(Y,2),x=a(W);qt(x,()=>c.children),r(W);var Ee=i(W,2);{var we=A=>{var X=ma(),k=a(X),re=a(k,!0);r(k),r(X),F(()=>{Me(k,1,`toast toast-${e(p).type??""}`,"svelte-5bofqz"),P(re,e(p).message)}),d(A,X)};y(Ee,A=>{e(p).visible&&A(we)})}r(Q),d(u,Q),ot()}export{Sa as component,Aa as universal};
