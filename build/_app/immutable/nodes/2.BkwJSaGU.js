import{t as R,a as A,d as Ue,e as dt}from"../chunks/N0BH6kDF.js";import{aa as ct,E as Mt,ay as Ht,az as Lt,a2 as Dt,u as Ot,aA as Ft,w as At,a4 as Wt,K as ye,ag as ut,ah as ht,ai as Bt,F as Ee,ad as j,af as F,j as e,z as ze,l as b,I as W,J as O,X as ve,W as ne,H as Te,V as Me,aw as Ge,G as et,av as ft,k as $e,aq as vt,ar as gt}from"../chunks/DbFEi_cg.js";import{i as de,b as je,s as xt,a as Be}from"../chunks/C8Ri_RvL.js";import{t as we,r as yt,l as Ct,e as Je,j as ot,s as Qe,q as Xe,F as qe,f as Ae,u as Le,c as Rt,b as Ut,G as zt,g as $,h as it,H as jt,I as Gt,J as Yt,a as Xt,K as qt,L as Kt,M as mt,N as Vt,O as Zt}from"../chunks/uskwNHu3.js";import{a as Jt,w as Qt,d as at,e as $t,s as Re}from"../chunks/C1WlvAqj.js";import{b as en,T as tn,g as Et,d as nn,B as pt}from"../chunks/BCenFq9J.js";import{p as _e,r as Ke}from"../chunks/pSULSj9T.js";import{c as tt}from"../chunks/O1vTzp8p.js";import{d as bt}from"../chunks/LezPCy1M.js";const on=()=>performance.now(),De={tick:n=>requestAnimationFrame(n),now:()=>on(),tasks:new Set};function Tt(){const n=De.now();De.tasks.forEach(t=>{t.c(n)||(De.tasks.delete(t),t.f())}),De.tasks.size!==0&&De.tick(Tt)}function rn(n){let t;return De.tasks.size===0&&De.tick(Tt),{promise:new Promise(o=>{De.tasks.add(t={c:n,f:o})}),abort(){De.tasks.delete(t)}}}function nt(n,t){Qt(()=>{n.dispatchEvent(new CustomEvent(t))})}function sn(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const t=n.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(o=>o[0].toUpperCase()+o.slice(1)).join("")}function _t(n){const t={},o=n.split(";");for(const r of o){const[h,s]=r.split(":");if(!h||s===void 0)break;const a=sn(h.trim());t[a]=s.trim()}return t}const an=n=>n;function St(n,t,o,r){var h=(n&Ft)!==0,s="both",a,g=t.inert,w=t.style.overflow,c,l;function C(){var d=Bt,u=ct;ut(null),ht(null);try{return a??(a=o()(t,(r==null?void 0:r())??{},{direction:s}))}finally{ut(d),ht(u)}}var i={is_global:h,in(){t.inert=g,nt(t,"introstart"),c=st(t,C(),l,1,()=>{nt(t,"introend"),c==null||c.abort(),c=a=void 0,t.style.overflow=w})},out(d){t.inert=!0,nt(t,"outrostart"),l=st(t,C(),c,0,()=>{nt(t,"outroend"),d==null||d()})},stop:()=>{c==null||c.abort(),l==null||l.abort()}},p=ct;if((p.transitions??(p.transitions=[])).push(i),Jt){var m=h;if(!m){for(var v=p.parent;v&&(v.f&Mt)!==0;)for(;(v=v.parent)&&(v.f&Ht)===0;);m=!v||(v.f&Lt)!==0}m&&Dt(()=>{Ot(()=>i.in())})}}function st(n,t,o,r,h){var s=r===1;if(At(t)){var a,g=!1;return Wt(()=>{if(!g){var d=t({direction:s?"in":"out"});a=st(n,d,o,r,h)}}),{abort:()=>{g=!0,a==null||a.abort()},deactivate:()=>a.deactivate(),reset:()=>a.reset(),t:()=>a.t()}}if(o==null||o.deactivate(),!(t!=null&&t.duration))return h(),{abort:ye,deactivate:ye,reset:ye,t:()=>r};const{delay:w=0,css:c,tick:l,easing:C=an}=t;var i=[];if(s&&o===void 0&&(l&&l(0,1),c)){var p=_t(c(0,1));i.push(p,p)}var m=()=>1-r,v=n.animate(i,{duration:w});return v.onfinish=()=>{var d=(o==null?void 0:o.t())??1-r;o==null||o.abort();var u=r-d,E=t.duration*Math.abs(u),T=[];if(E>0){var S=!1;if(c)for(var M=Math.ceil(E/16.666666666666668),U=0;U<=M;U+=1){var ee=d+u*C(U/M),V=_t(c(ee,1-ee));T.push(V),S||(S=V.overflow==="hidden")}S&&(n.style.overflow="hidden"),m=()=>{var X=v.currentTime;return d+u*C(X/E)},l&&rn(()=>{if(v.playState!=="running")return!1;var X=m();return l(X,1-X),!0})}v=n.animate(T,{duration:E,fill:"forwards"}),v.onfinish=()=>{m=()=>r,l==null||l(r,1-r),h()}},{abort:()=>{v&&(v.cancel(),v.effect=null,v.onfinish=ye)},deactivate:()=>{h=ye},reset:()=>{r===0&&(l==null||l(1,0))},t:()=>m()}}function ln(n){var t=0,o=n.children,r=o&&o.length;if(!r)t=1;else for(;--r>=0;)t+=o[r].value;n.value=t}function dn(){return this.eachAfter(ln)}function cn(n,t){let o=-1;for(const r of this)n.call(t,r,++o,this);return this}function un(n,t){for(var o=this,r=[o],h,s,a=-1;o=r.pop();)if(n.call(t,o,++a,this),h=o.children)for(s=h.length-1;s>=0;--s)r.push(h[s]);return this}function hn(n,t){for(var o=this,r=[o],h=[],s,a,g,w=-1;o=r.pop();)if(h.push(o),s=o.children)for(a=0,g=s.length;a<g;++a)r.push(s[a]);for(;o=h.pop();)n.call(t,o,++w,this);return this}function fn(n,t){let o=-1;for(const r of this)if(n.call(t,r,++o,this))return r}function vn(n){return this.eachAfter(function(t){for(var o=+n(t.data)||0,r=t.children,h=r&&r.length;--h>=0;)o+=r[h].value;t.value=o})}function gn(n){return this.eachBefore(function(t){t.children&&t.children.sort(n)})}function mn(n){for(var t=this,o=pn(t,n),r=[t];t!==o;)t=t.parent,r.push(t);for(var h=r.length;n!==o;)r.splice(h,0,n),n=n.parent;return r}function pn(n,t){if(n===t)return n;var o=n.ancestors(),r=t.ancestors(),h=null;for(n=o.pop(),t=r.pop();n===t;)h=n,n=o.pop(),t=r.pop();return h}function bn(){for(var n=this,t=[n];n=n.parent;)t.push(n);return t}function _n(){return Array.from(this)}function wn(){var n=[];return this.eachBefore(function(t){t.children||n.push(t)}),n}function xn(){var n=this,t=[];return n.each(function(o){o!==n&&t.push({source:o.parent,target:o})}),t}function*yn(){var n=this,t,o=[n],r,h,s;do for(t=o.reverse(),o=[];n=t.pop();)if(yield n,r=n.children)for(h=0,s=r.length;h<s;++h)o.push(r[h]);while(o.length)}function lt(n,t){n instanceof Map?(n=[void 0,n],t===void 0&&(t=Tn)):t===void 0&&(t=En);for(var o=new rt(n),r,h=[o],s,a,g,w;r=h.pop();)if((a=t(r.data))&&(w=(a=Array.from(a)).length))for(r.children=a,g=w-1;g>=0;--g)h.push(s=a[g]=new rt(a[g])),s.parent=r,s.depth=r.depth+1;return o.eachBefore(Pn)}function Cn(){return lt(this).eachBefore(Sn)}function En(n){return n.children}function Tn(n){return Array.isArray(n)?n[1]:null}function Sn(n){n.data.value!==void 0&&(n.value=n.data.value),n.data=n.data.data}function Pn(n){var t=0;do n.height=t;while((n=n.parent)&&n.height<++t)}function rt(n){this.data=n,this.depth=this.height=0,this.parent=null}rt.prototype=lt.prototype={constructor:rt,count:dn,each:cn,eachAfter:hn,eachBefore:un,find:fn,sum:vn,sort:gn,path:mn,ancestors:bn,descendants:_n,leaves:wn,links:xn,copy:Cn,[Symbol.iterator]:yn};function Nn(n){if(typeof n!="function")throw new Error;return n}function Ve(){return 0}function Ze(n){return function(){return n}}function kn(n){n.x0=Math.round(n.x0),n.y0=Math.round(n.y0),n.x1=Math.round(n.x1),n.y1=Math.round(n.y1)}function In(n,t,o,r,h){for(var s=n.children,a,g=-1,w=s.length,c=n.value&&(r-t)/n.value;++g<w;)a=s[g],a.y0=o,a.y1=h,a.x0=t,a.x1=t+=a.value*c}function Mn(n,t,o,r,h){for(var s=n.children,a,g=-1,w=s.length,c=n.value&&(h-o)/n.value;++g<w;)a=s[g],a.x0=t,a.x1=r,a.y0=o,a.y1=o+=a.value*c}var Hn=(1+Math.sqrt(5))/2;function Ln(n,t,o,r,h,s){for(var a=[],g=t.children,w,c,l=0,C=0,i=g.length,p,m,v=t.value,d,u,E,T,S,M,U;l<i;){p=h-o,m=s-r;do d=g[C++].value;while(!d&&C<i);for(u=E=d,M=Math.max(m/p,p/m)/(v*n),U=d*d*M,S=Math.max(E/U,U/u);C<i;++C){if(d+=c=g[C].value,c<u&&(u=c),c>E&&(E=c),U=d*d*M,T=Math.max(E/U,U/u),T>S){d-=c;break}S=T}a.push(w={value:d,dice:p<m,children:g.slice(l,C)}),w.dice?In(w,o,r,h,v?r+=m*d/v:s):Mn(w,o,r,v?o+=p*d/v:h,s),v-=d,l=C}return a}const Dn=function n(t){function o(r,h,s,a,g){Ln(t,r,h,s,a,g)}return o.ratio=function(r){return n((r=+r)>1?r:1)},o}(Hn);function On(){var n=Dn,t=!1,o=1,r=1,h=[0],s=Ve,a=Ve,g=Ve,w=Ve,c=Ve;function l(i){return i.x0=i.y0=0,i.x1=o,i.y1=r,i.eachBefore(C),h=[0],t&&i.eachBefore(kn),i}function C(i){var p=h[i.depth],m=i.x0+p,v=i.y0+p,d=i.x1-p,u=i.y1-p;d<m&&(m=d=(m+d)/2),u<v&&(v=u=(v+u)/2),i.x0=m,i.y0=v,i.x1=d,i.y1=u,i.children&&(p=h[i.depth+1]=s(i)/2,m+=c(i)-p,v+=a(i)-p,d-=g(i)-p,u-=w(i)-p,d<m&&(m=d=(m+d)/2),u<v&&(v=u=(v+u)/2),n(i,m,v,d,u))}return l.round=function(i){return arguments.length?(t=!!i,l):t},l.size=function(i){return arguments.length?(o=+i[0],r=+i[1],l):[o,r]},l.tile=function(i){return arguments.length?(n=Nn(i),l):n},l.padding=function(i){return arguments.length?l.paddingInner(i).paddingOuter(i):l.paddingInner()},l.paddingInner=function(i){return arguments.length?(s=typeof i=="function"?i:Ze(+i),l):s},l.paddingOuter=function(i){return arguments.length?l.paddingTop(i).paddingRight(i).paddingBottom(i).paddingLeft(i):l.paddingTop()},l.paddingTop=function(i){return arguments.length?(a=typeof i=="function"?i:Ze(+i),l):a},l.paddingRight=function(i){return arguments.length?(g=typeof i=="function"?i:Ze(+i),l):g},l.paddingBottom=function(i){return arguments.length?(w=typeof i=="function"?i:Ze(+i),l):w},l.paddingLeft=function(i){return arguments.length?(c=typeof i=="function"?i:Ze(+i),l):c},l}function Fn(n,t,o,r,h){var s=n.children,a,g=s.length,w,c=new Array(g+1);for(c[0]=w=a=0;a<g;++a)c[a+1]=w+=s[a].value;l(0,g,n.value,t,o,r,h);function l(C,i,p,m,v,d,u){if(C>=i-1){var E=s[C];E.x0=m,E.y0=v,E.x1=d,E.y1=u;return}for(var T=c[C],S=p/2+T,M=C+1,U=i-1;M<U;){var ee=M+U>>>1;c[ee]<S?M=ee+1:U=ee}S-c[M-1]<c[M]-S&&C+1<M&&--M;var V=c[M]-T,X=p-V;if(d-m>u-v){var ge=p?(m*X+d*V)/p:d;l(C,M,V,m,v,ge,u),l(M,i,X,ge,v,d,u)}else{var z=p?(v*X+u*V)/p:u;l(C,M,V,m,v,d,z),l(M,i,X,m,z,d,u)}}}function An(n,t,o){n.stopPropagation();const r=t.node.id;r&&o()({nodeId:r,clientX:n.clientX,clientY:n.clientY})}function wt(n,t,o,r){n.stopPropagation(),n.preventDefault(),"stopImmediatePropagation"in n&&n.stopImmediatePropagation(),t.node.id&&(b(o,!0),b(r,t.node.name||"",!0))}function Wn(n,t,o){n.key==="Enter"?(n.preventDefault(),t()):n.key==="Escape"&&(n.preventDefault(),b(o,!1))}var Bn=R('<input type="text" class="node-edit-input svelte-l7k9jp">'),Rn=R('<span class="title-segment svelte-l7k9jp"> </span>'),Un=R('<div class="node-title svelte-l7k9jp"></div>'),zn=R('<div class="mini-contributor svelte-l7k9jp"></div>'),jn=R('<div class="more-contributors svelte-l7k9jp" title="More contributors"> </div>'),Gn=R("<!> <!>",1),Yn=R('<div class="contributors-area svelte-l7k9jp"><div class="contributors-layout"><button class="add-contributor-button svelte-l7k9jp" title="Add contributor">+</button> <!></div></div>'),Xn=R(`<div class="treemap-node svelte-l7k9jp"><div class="unified-node-content svelte-l7k9jp"><div class="node-title-area svelte-l7k9jp" style="
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        max-width: 90%;
        z-index: 2;
      "><!></div> <!></div></div>`);function qn(n,t){Ee(t,!0);let o=_e(t,"addContributor",3,L=>{}),r=_e(t,"removeContributor",3,L=>{}),h=_e(t,"onTextEdit",3,L=>{}),s=_e(t,"shouldEdit",3,!1),a=j(!1),g=j(""),w=j(null);const c=F(()=>t.node.name==="Unnamed"?[t.node.name]:t.node.name.split(/(?=[A-Z][^A-Z])/g)),l=F(()=>t.dimensions.x1-t.dimensions.x0),C=F(()=>t.dimensions.y1-t.dimensions.y0),i=F(()=>Math.min(e(l),e(C))*100),p=F(()=>Math.max(.5,Math.min(2,e(i)*.1))),m=F(()=>e(l)>=.999&&e(C)>=.999),v=F(()=>t.node.contributors.length>0),d=33.33,u=F(()=>t.node.contributors.length+1),E=F(()=>e(v)?Math.max(d,100/e(u)):100),T=F(()=>e(v)?100-e(E):0);F(()=>e(v)?Math.min(1.2,e(T)/(t.node.contributors.length*33.33)):1),F(()=>Math.min(e(E)*.3,32));const S=F(()=>Math.min(1,Math.max(0,(e(i)-5)/7))),M=F(()=>e(i)>=25),U=F(()=>Math.floor(Math.max(3,Math.min(12,e(i)*.15)))),ee=F(()=>Math.max(1,Math.min(8,e(i)*.1))),V=F(()=>Math.max(2,Math.min(8,e(i)*.08))),X=F(()=>Math.max(12,Math.min(40,e(i)*.5))),ge=F(()=>e(c).length*e(p)*1.1),z=F(()=>e(ge)*16),oe=F(()=>e(C)*100),pe=F(()=>50+e(z)/e(oe)*50),re=F(()=>100-e(pe)-e(ee)/e(oe)*100),ie=F(()=>(e(X)+e(V)*2)/e(oe)*100);F(()=>e(re)>=e(ie));function He(L){const D=t.node.id;D&&r()({nodeId:D,contributorId:L})}function Se(L,D){D&&(D.stopPropagation(),D.preventDefault()),console.log(`Clicked on contributor: ${L}`)}function J(L){const D=t.node.id;D&&h()({nodeId:D,newName:L})}function he(){const L=e(g).trim();L&&L!==t.node.name&&J(L),b(a,!1)}function N(L){e(a)&&e(w)&&!e(w).contains(L.target)&&he()}ze(()=>(e(a)?(document.addEventListener("mousedown",N),e(w)&&setTimeout(()=>{var L,D;(L=e(w))==null||L.focus(),(D=e(w))==null||D.select()},10)):document.removeEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)})),ze(()=>{s()&&!e(a)&&t.node.id&&(b(a,!0),b(g,t.node.name||"",!0))});var H=Xn(),Q=W(H),se=W(Q),Pe=W(se);{var x=L=>{var D=Bn();yt(D),D.__keydown=[Wn,he,a],je(D,te=>b(w,te),()=>e(w)),ne(te=>we(D,`
          font-size: ${e(p)??""}rem;
          width: 100%;
          max-width: ${te??""}px;
        `),[()=>Math.min(200,e(i)*3)]),$t("blur",D,he),Ct(D,()=>e(g),te=>b(g,te)),A(L,D)},q=L=>{var D=Un();D.__mousedown=[wt,t,a,g],D.__touchstart=[wt,t,a,g],Je(D,21,()=>e(c),ot,(te,G)=>{var K=Rn(),le=W(K,!0);O(K),ne(()=>Re(le,e(G))),A(te,K)}),O(D),ne(()=>{we(D,`
          font-size: ${e(p)??""}rem;
          text-align: center;
          max-width: 100%;
        `),Qe(D,"title",t.node.name)}),A(L,D)};de(Pe,L=>{e(a)?L(x):L(q,!1)})}O(se);var B=ve(se,2);{var ae=L=>{var D=Yn(),te=W(D),G=W(te);G.__click=[An,t,o];var K=ve(G,2);{var le=xe=>{var Ne=Ue(),me=Me(Ne);{var fe=be=>{var Z=Ue(),ce=Me(Z);Je(ce,17,()=>t.node.contributors,ot,(ue,_)=>{tn(ue,{get userId(){return e(_)},get truncateLength(){return e(U)},onClick:(f,y)=>Se(f,y),onRemove:He})}),A(be,Z)},Oe=be=>{var Z=Gn(),ce=Me(Z);Je(ce,17,()=>t.node.contributors,ot,(f,y)=>{var k=zn();ne((P,I,Y)=>{Qe(k,"title",e(y)),we(k,`
                  background: ${P??""};
                  width: ${I??""}px;
                  height: ${Y??""}px;
                `)},[()=>Et(e(y)),()=>Math.max(6,e(X)*.4),()=>Math.max(6,e(X)*.4)]),A(f,k)});var ue=ve(ce,2);{var _=f=>{var y=jn(),k=W(y);O(y),ne((P,I,Y)=>{we(y,`
                    width: ${P??""}px;
                    height: ${I??""}px;
                    font-size: ${Y??""}px;
                  `),Re(k,`+${t.node.contributors.length-3}`)},[()=>Math.max(8,e(X)*.5),()=>Math.max(8,e(X)*.5),()=>Math.max(6,e(X)*.3)]),A(f,y)};de(ue,f=>{t.node.contributors.length>3&&f(_)})}A(be,Z)};de(me,be=>{e(M)?be(fe):be(Oe,!1)})}A(xe,Ne)};de(K,xe=>{e(v)&&xe(le)})}O(te),O(D),ne(xe=>{we(D,`
          position: absolute;
          opacity: ${e(S)??""};
          z-index: 1;
          top: 50%; 
          left: 70%; 
          transform: translateY(-50%);
        `),we(te,`
            display: flex;
            align-items: center;
            justify-content: center;
            gap: ${xe??""}px;
            flex-wrap: wrap;
            flex-direction: column;
          `),we(G,`
            width: ${e(X)??""}px;
            height: ${e(X)??""}px;
            font-size: ${e(X)*.5}px;
          `)},[()=>Math.max(2,e(V)*.5)]),A(L,D)};de(B,L=>{e(S)>.1&&L(ae)})}O(Q),O(H),ne(L=>{we(H,`
    background-color: ${L??""};
    border: ${(e(m)?"none":"1px solid #fff")??""};
    width: 100%;
    height: 100%;
    overflow: hidden;
    box-sizing: border-box;
  `),we(Q,`
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: ${e(ee)??""}px;
      box-sizing: border-box;
      position: relative;
    `)},[()=>en(t.node.name)]),A(n,H),Te()}at(["keydown","mousedown","touchstart","click"]);var Kn=R('<div class="scroll-clip svelte-1vbeh9n"><div><!></div></div>');function Vn(n,t){Ee(t,!0);const o=Ge("sheetContext");if(!o)throw new Error("BottomSheet.Content must be inside a BottomSheet component");let r=Ke(t,["$$slots","$$events","$$legacy","children"]);et(()=>{h()});const h=()=>{const c=o.settings.contentAlignment==="start-fit",l=o.settings.position==="left"||o.settings.position==="right";if(o.sheetContent&&c&&l){const C=o.sheetContent,i=getComputedStyle(C),p=parseFloat(i.paddingLeft),m=parseFloat(i.paddingRight),d=C.offsetWidth-p-m;C.style.width=`${d}px`}};var s=Kn(),a=W(s);let g;var w=W(a);Xe(w,()=>t.children??ye),O(a),je(a,c=>o.sheetContent=c,()=>o==null?void 0:o.sheetContent),O(s),ne(()=>{we(s,`${o.settings.position==="left"&&"direction: rtl;"}`),g=qe(a,g,{...r,class:`bottom-sheet-content ${t.class??""}`,role:"document"},"svelte-1vbeh9n")}),A(n,s),Te()}function Pt(n){const t=n-1;return t*t*t+1}const We=(n,t)=>n>1?t-n:t-n*t,Nt=n=>{for(;n&&n!==document.documentElement;){const t=window.getComputedStyle(n),o=t.overflowY,r=t.overflowX,h=o!=="visible"&&o!=="hidden"&&n.scrollHeight>n.clientHeight,s=r!=="visible"&&r!=="hidden"&&n.scrollWidth>n.clientWidth;if(n.className.split(" ").includes("bottom-sheet")&&(h||s)||h||s)return n;n=n.parentElement}return null},Zn=(n,{delay:t=0,duration:o=400,easing:r=Pt,axis:h="y",position:s="bottom",sheetHeight:a=0})=>{const g=getComputedStyle(n);a===0&&(a=n.offsetHeight);const w=s=="top"||s=="left",c=parseFloat(g.opacity),l=h==="y"?"translateY":"translateX",C=a,i=h==="y"?["top","bottom"]:["left","right"],p=i.map(S=>`${S[0].toUpperCase()}${S.slice(1)}`),m=parseFloat(g[`padding${p[0]}`]),v=parseFloat(g[`padding${p[1]}`]),d=parseFloat(g[`margin${p[0]}`]),u=parseFloat(g[`margin${p[1]}`]),E=parseFloat(g[`border${p[0]}Width`]),T=parseFloat(g[`border${p[1]}Width`]);return{delay:t,duration:o,easing:r,css:S=>`
            overflow: hidden;
            opacity: ${Math.min(S*20,1)*c};
            transform: ${l}(${(1-S)*(w?-1:1)*C}px);
            padding-${i[0]}: ${S*m}px;
            padding-${i[1]}: ${S*v}px;
            margin-${i[0]}: ${S*d}px;
            margin-${i[1]}: ${S*u}px;
            border-${i[0]}-width: ${S*E}px;
            border-${i[1]}-width: ${S*T}px;
        `}};var Jn=R("<div><!></div>");function Qn(n,t){Ee(t,!0);let o=Ke(t,["$$slots","$$events","$$legacy","children"]);const r=Ge("sheetContext"),h=Ge("sheetIdentificationContext");let s,a=r.settings.position==="left"||r.settings.position==="right"?"x":"y";if(!r)throw new Error("BottomSheet.Sheet must be inside a BottomSheet component");const g=d=>{r.sheetElement&&!r.sheetElement.contains(d.target)&&!r.settings.disableClosing&&r.closeSheet()},w=()=>r.sheetElement?Array.from(r.sheetElement.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])')):[],c=d=>{if(d.key==="Tab"){const u=w();if(!u.length)return;const E=u[0],T=u[u.length-1],S=!d.shiftKey;d.shiftKey&&document.activeElement===E&&(T.focus(),d.preventDefault()),S&&document.activeElement===T&&(E.focus(),d.preventDefault())}},l=()=>{switch(r.settings.position){case"bottom":case"top":return`height: 100%;  max-height: ${r.maxHeightPx-r.sheetHeight}px`;case"left":case"right":return`height: 100%; width: 100%; max-width: ${r.maxHeightPx-r.sheetHeight}px`}},C=()=>{if(!r.isDragging&&a==="x")return"transition: max-width 0.3s ease";if(!r.isDragging&&a==="y")return"transition: max-height 0.3s ease"},i=d=>{const u=d.target,E=Nt(u);if(!E||a==="x")return;const T=E.scrollTop,S=E.scrollHeight,M=E.clientHeight;let U=T<=0;const ee=T+M>=S-1;let V=d.deltaY<0;if(r.settings.position==="top"?U=T>=0:(U=T<=0,V=!V),U&&V||!V&&ee||!U&&!ee){d.stopPropagation();return}else{if(U&&!V)return;if(ee&&V)return}};ze(()=>{r.isSheetOpen?(s=document.activeElement,setTimeout(()=>{var u;const d=w();d.length?d[0].focus():(u=r.sheetElement)==null||u.focus(),document.addEventListener("click",g)},100)):(document.removeEventListener("click",g),s==null||s.focus())});var p=Ue(),m=Me(p);{var v=d=>{var u=Jn();let E;var T=W(u);Xe(T,()=>t.children??ye),O(u),je(u,S=>r.sheetElement=S,()=>r==null?void 0:r.sheetElement),ne((S,M)=>E=qe(u,E,{...o,class:`bottom-sheet position-${r.settings.position??""} ${r.isDragging&&"prevent-select"} ${t.class??""}`,style:`${S??""};  ${M??""}; ${t.style??""}`,role:"dialog","aria-modal":"true","aria-labelledby":h.headingId,"aria-describedby":h.descriptionId,id:h.sheetId,tabindex:"-1","aria-live":"polite",onkeypress:c,ontouchstart:r.touchStartEvent,ontouchmove:r.touchMoveEvent,ontouchend:r.moveEnd,onmousedown:r.mouseDownEvent,onmouseup:r.moveEnd,onwheel:i},"svelte-1o7orpt"),[l,C]),St(3,u,()=>Zn,()=>({duration:500,easing:Pt,axis:a,position:r.settings.position,sheetHeight:r.maxHeightPx})),A(d,u)};de(m,d=>{r.isSheetOpen&&d(v)})}A(n,p),Te()}var $n=R("<div><!></div>");function eo(n,t){var se,Pe;Ee(t,!0);let o=_e(t,"isSheetOpen",15,!1),r=_e(t,"settings",19,()=>({closeThreshold:.9,autoCloseThreshold:0,maxHeight:.7,snapPoints:[1],startingSnapPoint:1,disableDragging:!1,position:"bottom",disableClosing:!1,contentAlignment:"flex"}));const h={closeThreshold:.9,autoCloseThreshold:0,maxHeight:.7,snapPoints:[1],startingSnapPoint:1,disableDragging:!1,position:"bottom",disableClosing:!1,contentAlignment:"flex"};(se=r().snapPoints)!=null&&se.includes(1)||(Pe=r().snapPoints)==null||Pe.push(1);const s=F(()=>({...h,...r()}));let a=new AbortController;et(()=>{b(g,window.innerWidth,!0),b(w,window.innerHeight,!0)}),ze(()=>{var x,q;o()?((x=t.onopen)==null||x.call(t),a=new AbortController,document.addEventListener("wheel",B=>{B.preventDefault()},{passive:!1,signal:a.signal}),document.addEventListener("touchmove",B=>{B.cancelable&&B.preventDefault()},{passive:!1,signal:a.signal}),document.addEventListener("mouseup",J),document.addEventListener("mousemove",ie),document.addEventListener("touchmove",V,{passive:!1}),document.addEventListener("keydown",X)):((q=t.onclose)==null||q.call(t),ee(e(s).startingSnapPoint,!1),document.removeEventListener("mouseup",J),document.removeEventListener("touchmove",V),document.removeEventListener("keydown",X),document.removeEventListener("mousemove",ie),a.abort())});let g=j(0),w=j(0),c=j(0),l=j(!1),C=F(()=>{const{maxHeight:x,position:q}=e(s);return x>1?x:(q==="left"||q==="right"?e(g):e(w))*x}),i=j(null),p=j(null),m=j(!1),v=j(!1),d,u,E=0,T=0;const S=`bottom-sheet-${Math.random().toString(36).substr(2,9)}`,M=`${S}-heading`,U=`${S}-description`,ee=(x,q=!0)=>{var B;return e(s).snapPoints.includes(x)?(b(c,We(x,e(C)),!0),q&&((B=t.onsnap)==null||B.call(t,x)),!0):!1},V=x=>{window.scrollY===0&&x.touches[0].clientY>50&&x.preventDefault()},X=x=>{x.key==="Escape"&&!e(s).disableClosing&&he.closeSheet()},ge=()=>{if(e(c)>We(e(s).autoCloseThreshold,e(C))){b(c,0),he.closeSheet(),J();return}},z=x=>{pe(x.touches[0].clientY,x.touches[0].clientX)},oe=x=>{pe(x.clientY,x.clientX)},pe=(x,q)=>{var B,ae;e(s).disableDragging||(d=x,T=q,u=e(c),b(m,!0),E=((B=e(p))==null?void 0:B.scrollTop)??0,(ae=t.onsheetdragstart)==null||ae.call(t))},re=(x,q)=>{let B=0;return e(s).position==="bottom"?e(l)?B=Math.max(0,x-d+u):B=Math.max(0,x-d-E+u):e(s).position==="top"?e(l)?B=Math.max(0,d-x+u):B=Math.max(0,d-x-E+u):e(s).position==="left"?e(l)?B=Math.max(0,T-q+u):B=Math.max(0,T-q-E+u):e(s).position==="right"&&(e(l)?B=Math.max(0,q-T+u):B=Math.max(0,q-T-E+u)),B},ie=x=>{var B;if(!e(m))return;b(l,!0);let q=re(x.clientY,x.clientX);e(c)!=0&&b(v,!0),b(c,q,!0),(B=t.onsheetdrag)==null||B.call(t),ge()},He=x=>{var L;if(!e(m)||!e(p))return;const q=x.target,B=Nt(q);if(!e(l)&&!e(v)&&B){const{clientY:D,clientX:te}=x.touches[0],{scrollTop:G,scrollLeft:K,scrollHeight:le,clientHeight:xe,scrollWidth:Ne,clientWidth:me}=B,fe=e(s).position==="top"||e(s).position==="bottom";let Z=(fe?D:te)>(fe?d:T);const ce=fe?Math.round(G)+xe>=le:Math.round(K)+me>=Ne;let ue;switch(e(s).position){case"top":ue=G>=0;break;case"bottom":ue=G<=0,Z=!Z;break;case"left":ue=K>=0;break;case"right":ue=K<=0,Z=!Z;break}if(ue&&Z||!Z&&ce||!ue&&!ce){x.stopPropagation();return}else if(ue&&!Z){b(v,!0);return}else if(ce&&Z)return}let ae=re(x.touches[0].clientY,x.touches[0].clientX);e(c)!=0&&b(v,!0),b(c,ae,!0),(L=t.onsheetdrag)==null||L.call(t),ge()},Se=()=>{var D,te;if(e(s).disableDragging)return;if((D=t.onsheetdragend)==null||D.call(t),e(s).snapPoints.length===1){e(c)>We(e(s).closeThreshold,e(C))?(he.closeSheet(),b(c,0)):b(c,0),J();return}let x=e(s).snapPoints.map(G=>We(G,e(C)));const q=Math.max(...x);if(e(c)>q){b(c,0),he.closeSheet(),J();return}const B=e(c)<u,ae=We(.95,e(C));if(B&&e(c)>u-ae||!B&&e(c)<u+ae){b(c,u,!0),J();return}const L=e(s).snapPoints.map(G=>({original:G,converted:We(G,e(C))})).filter(G=>B?G.converted<e(c):G.converted>e(c));if(L.length>0){const G=L.reduce((K,le)=>B?le.converted>K.converted?le:K:le.converted<K.converted?le:K);(te=t.onsnap)==null||te.call(t,G.original),b(c,G.converted,!0)}J()},J=()=>{b(m,!1),b(v,!1),b(l,!1)},he={get sheetHeight(){return e(c)},set sheetHeight(x){b(c,x,!0)},get isSheetOpen(){return o()},set isSheetOpen(x){o(x)},get isDragging(){return e(m)},set isDragging(x){b(m,x,!0)},get isMovingSheet(){return e(v)},set isMovingSheet(x){b(v,x,!0)},get isDraggingFromHandle(){return e(l)},set isDraggingFromHandle(x){b(l,x,!0)},get sheetContent(){return e(i)},set sheetContent(x){b(i,x,!0)},get sheetElement(){return e(p)},set sheetElement(x){b(p,x,!0)},get maxHeightPx(){return e(C)},get settings(){return e(s)},touchStartEvent:z,mouseDownEvent:oe,mouseMoveEvent:ie,touchMoveEvent:He,moveEnd:Se,openSheet:()=>{o(!0)},closeSheet:()=>{o(!1)},toggleSheet:()=>{o(!o())}};let N={sheetId:S,headingId:M,descriptionId:U};ee(e(s).startingSnapPoint,!1),ft("sheetContext",he),ft("sheetIdentificationContext",N);var H=$n(),Q=W(H);return Xe(Q,()=>t.children??ye),O(H),A(n,H),Te({setSnapPoint:ee})}var to=R("<div><!></div>");function no(n,t){Ee(t,!0);let o=Ke(t,["$$slots","$$events","$$legacy","children"]);const r=Ge("sheetContext"),h=Ge("sheetIdentificationContext");if(!r)throw new Error("BottomSheet.Trigger must be inside a BottomSheet component");const s=()=>{r.toggleSheet()};var a=to(),g=l=>{(l.key==="Enter"||l.key===" ")&&s()};let w;var c=W(a);Xe(c,()=>t.children??ye),O(a),ne(()=>w=qe(a,w,{...o,role:"button",tabindex:"0","aria-haspopup":"dialog","aria-controls":h.sheetId,"aria-expanded":r.isSheetOpen?"true":"false",onclick:s,onkeydown:g})),A(n,a),Te()}const oo=n=>n;function ro(n,{delay:t=0,duration:o=400,easing:r=oo}={}){const h=+getComputedStyle(n).opacity;return{delay:t,duration:o,easing:r,css:s=>`opacity: ${s*h}`}}var io=R("<div></div>"),so=R("<!> <!>",1);function ao(n,t){Ee(t,!0);const o=Ge("sheetContext");if(!o)throw new Error("BottomSheet.Overlay must be inside a BottomSheet component");let r=Ke(t,["$$slots","$$events","$$legacy","children"]);var h=so(),s=Me(h);{var a=w=>{var c=io();let l;ne(()=>l=qe(c,l,{...r,role:"presentation","aria-hidden":"true",class:`bottom-sheet-overlay ${t.class??""}`},"svelte-msj0u3")),St(3,c,()=>ro,()=>({duration:200})),A(w,c)};de(s,w=>{o.isSheetOpen&&w(a)})}var g=ve(s,2);Xe(g,()=>t.children??ye),A(n,h),Te()}var lo=R("<div></div>");function kt(n,t){Ee(t,!0);let o=Ke(t,["$$slots","$$events","$$legacy"]);var r=lo();let h;ne(()=>h=qe(r,h,{...o,class:`bottom-sheet-grip ${t.class??""}`,"aria-hidden":"true"},"svelte-hvzhvz")),A(n,r),Te()}var co=R('<div class="handle-grip-wrapper svelte-1keauf3"><!></div>'),uo=R('<div class="handle-grip-wrapper svelte-1keauf3"><!></div>'),ho=R("<div><!></div>");function fo(n,t){Ee(t,!0);const o=Ge("sheetContext");if(!o)throw new Error("BottomSheet.Overlay must be inside a BottomSheet component");let r=Ke(t,["$$slots","$$events","$$legacy","children"]),h=j($e({})),s=j($e({}));et(()=>{(o.settings.position==="left"||o.settings.position==="right")&&(e(h).style.width=`${e(s).getBoundingClientRect().width}px`)});const a=m=>{if(o.settings.disableDragging)return;const v=o.maxHeightPx;let u=o.settings.snapPoints.map(T=>We(T,v)).sort((T,S)=>S-T);const E=u.findIndex(T=>Math.abs(T-o.sheetHeight)<10);switch(m.key){case"ArrowUp":m.preventDefault(),E<u.length-1&&(o.sheetHeight=u[E+1]);break;case"ArrowDown":m.preventDefault(),E>0?o.sheetHeight=u[E-1]:o.settings.disableClosing||o.closeSheet();break;case"Home":m.preventDefault(),o.sheetHeight=u[u.length-1];break;case"End":m.preventDefault(),o.sheetHeight=u[0];break}};var g=ho(),w=()=>o.isDraggingFromHandle=!0,c=()=>o.isDraggingFromHandle=!0;let l;var C=W(g);{var i=m=>{var v=co(),d=W(v);Xe(d,()=>t.children??ye),O(v),je(v,u=>b(s,u),()=>e(s)),A(m,v)},p=m=>{var v=uo(),d=W(v);kt(d,{}),O(v),je(v,u=>b(s,u),()=>e(s)),A(m,v)};de(C,m=>{t.children?m(i):m(p,!1)})}O(g),je(g,m=>b(h,m),()=>e(h)),ne(m=>l=qe(g,l,{...r,class:`handle-container position-${o.settings.position??""} ${t.class??""}`,onmousemove:w,ontouchmove:c,role:"slider",tabindex:"0","aria-label":"Sheet height control","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":m,onkeydown:a},"svelte-1keauf3"),[()=>Math.round((1-o.sheetHeight/window.innerHeight)*100)]),A(n,g),Te()}const Ce=eo;Ce.Content=Vn;Ce.Sheet=Qn;Ce.Trigger=no;Ce.Overlay=ao;Ce.Handle=fo;Ce.Grip=kt;var vo=R('<div class="message svelte-87ggls">Loading...</div>'),go=R('<div class="message svelte-87ggls"> </div>'),mo=(n,t,o)=>t(e(o).id,e(o).name,e(o).metadata),po=R('<div class="item-meta svelte-87ggls"> </div>'),bo=R('<div class="item svelte-87ggls"><div class="color-dot svelte-87ggls"></div> <div class="item-content svelte-87ggls"><div class="item-name svelte-87ggls"> </div> <!></div></div>'),_o=R('<div class="bottomsheet-container svelte-87ggls"><div class="header svelte-87ggls"><h3 class="title svelte-87ggls"> </h3> <input type="text" class="search-input svelte-87ggls"></div> <div class="results svelte-87ggls"><!></div></div>'),wo=R("<!> <!>",1);function xo(n,t){Ee(t,!0);function o(T,S=20){return!T||T.length<=S?T:T.slice(0,S-3)+"..."}let r=_e(t,"title",3,"Select Item"),h=_e(t,"searchPlaceholder",3,"Search..."),s=_e(t,"maxHeight",3,.8),a=_e(t,"filterText",3,""),g=_e(t,"show",3,!1),w=_e(t,"select",3,T=>{}),c=_e(t,"close",3,()=>{}),l=j(null),C=j(!1),i=j($e(a())),p=j($e(g()));ze(()=>{b(p,g())}),ze(()=>{b(i,a())});function m(){b(p,!1),c()()}function v(T,S,M){w()({id:T,name:S,metadata:M}),m()}function d(){e(C)||(setTimeout(()=>{e(l)&&e(l).focus()},100),b(C,!0))}ze(()=>{e(i)!==void 0&&t.dataProvider.search(e(i))});function u(){b(C,!1),m()}const E=F(()=>({maxHeight:s(),disableClosing:!1,position:"bottom"}));Ce(n,{get settings(){return e(E)},onopen:d,onclose:u,get isSheetOpen(){return e(p)},set isSheetOpen(T){b(p,T,!0)},children:(T,S)=>{var M=Ue(),U=Me(M);tt(U,()=>Ce.Overlay,(ee,V)=>{V(ee,{children:(X,ge)=>{var z=Ue(),oe=Me(z);tt(oe,()=>Ce.Sheet,(pe,re)=>{re(pe,{children:(ie,He)=>{var Se=wo(),J=Me(Se);tt(J,()=>Ce.Handle,(N,H)=>{H(N,{})});var he=ve(J,2);tt(he,()=>Ce.Content,(N,H)=>{H(N,{children:(Q,se)=>{var Pe=_o(),x=W(Pe),q=W(x),B=W(q,!0);O(q);var ae=ve(q,2);yt(ae),je(ae,K=>b(l,K),()=>e(l)),O(x);var L=ve(x,2),D=W(L);{var te=K=>{var le=vo();A(K,le)},G=(K,le)=>{{var xe=me=>{var fe=go(),Oe=W(fe,!0);O(fe),ne(()=>Re(Oe,e(i)?"No matching items found":"No items available")),A(me,fe)},Ne=me=>{var fe=Ue(),Oe=Me(fe);Je(Oe,17,()=>t.dataProvider.items,be=>be.id,(be,Z)=>{var ce=bo();ce.__click=[mo,v,Z];var ue=W(ce),_=ve(ue,2),f=W(_),y=W(f,!0);O(f);var k=ve(f,2);{var P=I=>{var Y=po(),ke=W(Y);O(Y),ne(()=>Re(ke,`(${e(Z).metadata.contributorCount??""} contributors)`)),A(I,Y)};de(k,I=>{var Y;((Y=e(Z).metadata)==null?void 0:Y.contributorCount)!==void 0&&I(P)})}O(_),O(ce),ne((I,Y)=>{Qe(ce,"data-id",e(Z).id),we(ue,`background-color: ${I??""}`),Qe(f,"title",e(Z).name||e(Z).id),Re(y,Y)},[()=>e(Z).color||Et(e(Z).id),()=>o(e(Z).name||e(Z).id,20)]),A(be,ce)}),A(me,fe)};de(K,me=>{t.dataProvider.items.length===0?me(xe):me(Ne,!1)},le)}};de(D,K=>{t.dataProvider.loading&&t.dataProvider.items.length===0?K(te):K(G,!1)})}O(L),O(Pe),ne(()=>{Re(B,r()),Qe(ae,"placeholder",h())}),Ct(ae,()=>e(i),K=>b(i,K)),A(Q,Pe)},$$slots:{default:!0}})}),A(ie,Se)},$$slots:{default:!0}})}),A(X,z)},$$slots:{default:!0}})}),A(T,M)},$$slots:{default:!0}}),Te()}at(["click"]);var yo=(n,t,o)=>t(n,e(o)),Co=(n,t)=>t(n),Eo=(n,t,o)=>t(n,e(o)),To=(n,t)=>t(n),So=n=>n.preventDefault(),Po=R("<div><!></div>"),No=R('<div class="empty-state svelte-7hj7rp"><div class="add-node-prompt svelte-7hj7rp"><button class="add-node-button svelte-7hj7rp"><span class="add-icon svelte-7hj7rp">âž•</span> <span class="add-text"> </span></button></div></div>'),ko=R('<div class="node-container svelte-7hj7rp"><div class="app-content svelte-7hj7rp"><div class="treemap-container svelte-7hj7rp"><!></div></div> <!></div>');function Io(n,t){Ee(t,!0);const[o,r]=xt(),h=()=>Be(Le,"$userTree",o),s=()=>Be(Rt,"$currentPath",o),a=()=>Be(Ut,"$userpub",o);let g=j(0);const w=["Node","Value","Goal","Dependency","Desire","Contribution"];let c=j(0);function l(){vt(c),console.log("[UI FLOW] Triggered update",e(c))}let C=j(!1),i=j($e({x:0,y:0})),p=j(null),m=nn([]),v=j(0),d=j(!1),u=j(null),E=j(!1),T=j(!1),S=j(null),M=j(null);const U=350,ee=16,V=.04,X=-.04,ge=250,z=F(h),oe=F(s),pe=F(a),re=F(()=>e(oe).length===0&&e(pe)?e(pe):e(oe).length>0?e(oe)[e(oe).length-1]:null),ie=F(()=>!e(z)&&e(re)&&e(pe)&&e(re)===e(pe)?(console.log("[UI FLOW] Waiting for tree to be loaded"),null):!e(z)||!e(re)?null:Ae(e(z),e(re))),He=F(()=>e(ie)?e(ie).children:[]),Se=F(()=>{if(!e(ie))return{id:"",selfPoints:0,children:[]};const _=e(He).map(f=>({id:f.id,points:f.type==="NonRootNode"?f.points:0,nodeName:f.name,contributors:f.type==="NonRootNode"?f.contributor_ids:[],children:[]}));return{id:e(ie).id,selfPoints:e(ie).type==="NonRootNode"?e(ie).points:0,children:_}}),J=F(()=>{e(c);const _=e(Se),f={id:_.id,points:_.selfPoints,children:_.children},y=lt(f,I=>I.children);y.sum(I=>I.points),y.sort((I,Y)=>Y.value-I.value);function k(I,Y,ke,Ye,Fe){Fn(I,0,0,1,1);for(const Ie of I.children||[])Ie.x0=Y+Ie.x0*(Ye-Y),Ie.x1=Y+Ie.x1*(Ye-Y),Ie.y0=ke+Ie.y0*(Fe-ke),Ie.y1=ke+Ie.y1*(Fe-ke)}return On().tile(k).size([1,1]).padding(.005).round(!1)(y)});et(()=>{document.addEventListener("mouseup",G),document.addEventListener("touchend",G),document.addEventListener("touchcancel",G);const _=setInterval(()=>{b(g,(e(g)+1)%w.length)},4e3),f=Le.subscribe(y=>{y&&(console.log("[UI FLOW] userTree updated, triggering UI update"),l())});return()=>{e(S)!==null&&clearInterval(e(S)),e(M)!==null&&clearTimeout(e(M)),clearInterval(_),document.removeEventListener("mouseup",G),document.removeEventListener("touchend",G),document.removeEventListener("touchcancel",G),f()}});function he(_){console.log("[UI FLOW] zoomInto called for node:",_),$.zoomInto(_),console.log("[UI FLOW] Navigation handled")}async function N(){if(console.log("[UI FLOW] handleAddNode started"),!e(re)){console.log("[UI FLOW] No currentNodeId, aborting");return}const f=(()=>{var Y;if(!((Y=e(J))!=null&&Y.children)||e(J).children.length===0)return console.log("[UI FLOW] No siblings, setting new node to 100 points"),100;const P=e(J).children.reduce((ke,Ye)=>{var Fe;return ke+(((Fe=Ye.data)==null?void 0:Fe.points)||0)},0),I=Math.max(1,P*.1);return console.log("[UI FLOW] Calculated points based on siblings:",I),I})(),y=`node_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,k="New Node";console.log("[UI FLOW] Creating new node:",{id:y,points:f,name:k}),console.log("[UI FLOW] Current parent:",e(re)),console.log("[UI FLOW] Current path:",e(oe));try{if(!e(z)){$.showToast("Error creating node: No tree found","error");return}if(!e(ie)){$.showToast("Error creating node: Current node not found","error");return}const P=structuredClone(e(z)),I=Ae(P,e(re));if(!I){$.showToast("Error creating node: Current node not found in updated tree","error");return}Xt(I,y,k,f),Le.set(P),l(),console.log("[UI FLOW] addNode successful"),$.showToast("New node created","success"),console.log("[UI FLOW] Setting node to edit mode:",y),setTimeout(()=>{$.nodeToEdit=y,console.log("[UI FLOW] Node edit mode set"),console.log("userTree Parent.275",h())},50)}catch(P){console.error("[UI FLOW] Error in handleAddNode:",P),$.showToast("Error creating node","error")}}function H(_){const{nodeId:f,newName:y}=_;try{if(!e(z))return;const k=structuredClone(e(z));Gt(k,f,P=>{Yt(P,y)}),Le.set(k),l(),$.nodeToEdit="",$.showToast(`Node renamed to "${y}"`,"success")}catch(k){console.error(`Error updating name for node ${f}:`,k),$.showToast("Error updating node name","error")}}function Q(_){const{nodeId:f,clientX:y,clientY:k}=_;b(p,f,!0),b(i,{x:y,y:k},!0),b(C,!0)}function se(_){const{nodeId:f,contributorId:y}=_;try{if(!e(z))return;const k=structuredClone(e(z)),P=Ae(k,f);if(!P||P.type!=="NonRootNode")return;const I=P.contributor_ids.filter(Y=>Y!==y);P.contributor_ids=I,Le.set(k),l(),$.showToast("Contributor removed successfully","success")}catch(k){console.error("Error removing contributor:",k),$.showToast("Error removing contributor","error")}}function Pe(_){const{id:f}=_;if(!e(p)){console.error("No node selected for adding contributor");return}q(e(p),f),b(C,!1),b(p,null)}function x(){b(C,!1),b(p,null)}function q(_,f){try{if(!e(z))return;const y=structuredClone(e(z)),k=Ae(y,_);if(!k||k.type!=="NonRootNode")return;if(!k.contributor_ids.includes(f)){const I=[...k.contributor_ids];I.push(f),Kt(k,I),Le.set(y),l(),$.showToast("Contributor added successfully","success")}}catch(y){console.error("Error adding contributor:",y),$.showToast("Error adding contributor","error")}}function B(_){if(!e(z))return 0;const f=Ae(e(z),_);return f?jt(f,e(z)):0}function ae(_,f=!1){$.deleteMode||(e(S)!==null&&clearInterval(e(S)),e(M)!==null&&clearTimeout(e(M)),b(E,!1),b(T,!1),b(M,window.setTimeout(()=>{e(d)&&e(u)===_.data.id&&(b(E,!0),b(T,f,!0),b(S,window.setInterval(()=>{if(!e(d)){L();return}let y;const k=_.data.points;f?y=k*X:y=k*V;const P=Math.max(1,k+y);if(isNaN(P)){console.error("Growth calculation resulted in NaN:",{currentPoints:k,rate:y,isShrinking:f});return}D(_,P)},ee),!0))},U),!0))}function L(){var _;if(b(d,!1),e(E)&&e(u)&&e(J)){const f=(_=e(J).children)==null?void 0:_.find(y=>y.data.id===e(u));f&&f.data&&f.data.id&&te(f.data.id,f.data.points)}b(u,null),e(M)!==null&&clearTimeout(e(M)),e(S)!==null&&clearInterval(e(S)),b(S,null),b(E,!1),b(T,!1)}function D(_,f){_.data.points=f,vt(c)}function te(_,f){try{if(!e(z))return;const y=structuredClone(e(z)),k=Ae(y,_);if(!k||k.type!=="NonRootNode")return;zt(k,f),Le.set(y),l()}catch(y){console.error(`Error saving points for node ${_}:`,y),$.showToast("Error saving node points","error")}}function G(){e(d)&&L()}function K(_,f){b(d,!0),b(v,Date.now(),!0),b(u,f.data.id,!0);const y=_ instanceof MouseEvent?_.button===2:_.touches.length===2;ae(f,y)}function le(_){const f=_.target;if(f&&(f.closest(".node-text")||f.closest(".node-text-edit-container")||f.closest(".add-contributor-button")||f.closest(".tag-container")||f.closest(".contributor-container")||f.closest(".node-title")||f.closest(".node-title-area")||f.closest(".title-segment")||f.closest(".node-edit-input")||f.closest(".contributors-area")))return;const k=Date.now()-e(v)>=ge||e(E),P=e(u);L(),!k&&P&&($.deleteMode?xe(P):he(P))}function xe(_){if(confirm("Delete this node?"))try{if(!e(z))return;const f=structuredClone(e(z)),y=qt(f,_);if(!y){console.error("Cannot find parent node");return}if(_===e(oe)[0]){console.error("Cannot delete root node"),$.showToast("Cannot delete root node","error");return}if(e(re)===_){if(e(oe).length<=1){console.error("Cannot delete current node with no parent");return}$.zoomOut()}if(!Ae(f,_)){$.showToast("Node not found","error");return}const I=y.children.findIndex(Y=>Y.id===_);I!==-1&&y.children.splice(I,1),Le.set(f),l(),$.showToast("Node deleted successfully","success")}catch(f){console.error(`Error in deletion process: ${f}`),$.showToast("Error deleting node","error")}}var Ne=ko(),me=W(Ne),fe=W(me),Oe=W(fe);{var be=_=>{var f=Ue(),y=Me(f);Je(y,17,()=>e(J).children,ot,(k,P)=>{var I=Po();let Y;I.__mousedown=[yo,K,P],I.__mouseup=[Co,le],I.__touchstart=[Eo,K,P],I.__touchend=[To,le],I.__contextmenu=[So];var ke=W(I);const Ye=F(()=>({id:e(P).data.id,name:e(P).data.nodeName||"Unnamed",points:e(P).data.points,contributors:e(P).data.contributors||[],fulfillment:B(e(P).data.id)})),Fe=F(()=>({x0:e(P).x0,y0:e(P).y0,x1:e(P).x1,y1:e(P).y1})),Ie=F(()=>$.nodeToEdit===e(P).data.id);qn(ke,{get node(){return e(Ye)},get dimensions(){return e(Fe)},addContributor:Q,removeContributor:se,onTextEdit:H,get shouldEdit(){return e(Ie)}}),O(I),ne(It=>{Y=it(I,1,"clickable",null,Y,It),we(I,`
							position: absolute;
							left: ${e(P).x0*100}%;
							top: ${e(P).y0*100}%;
							width: ${(e(P).x1-e(P).x0)*100}%;
							height: ${(e(P).y1-e(P).y0)*100}%;
							box-sizing: border-box;
						`)},[()=>({deleting:$.deleteMode,growing:e(E)&&e(u)===e(P).data.id&&!e(T),shrinking:e(E)&&e(u)===e(P).data.id&&e(T)})]),A(k,I)}),A(_,f)},Z=_=>{var f=No(),y=W(f),k=W(y);k.__click=N;var P=ve(W(k),2),I=W(P,!0);O(P),O(k),O(y),O(f),ne(()=>Re(I,w[e(g)])),A(_,f)};de(Oe,_=>{e(J)&&e(J).children&&e(J).children.length>0?_(be):_(Z,!1)})}O(fe),O(me);var ce=ve(me,2);{var ue=_=>{xo(_,{get show(){return e(C)},title:"Select Contributor",searchPlaceholder:"Search users...",dataProvider:m,select:Pe,close:x})};de(ce,_=>{e(C)&&_(ue)})}O(Ne),A(n,Ne),Te(),r()}at(["mousedown","mouseup","touchstart","touchend","contextmenu","click"]);var Mo=R("your<br>recognition",1),Ho=R(`<div class="placeholder svelte-ioemw5"><p>You have not yet recognized any contributors! Adding contributors to a node makes it a
							contribution!</p></div>`),Lo=R("mutual<br>recognition",1),Do=R(`<div class="placeholder svelte-ioemw5"><p>You don't have any mutual contributors yet!</p></div>`),Oo=R('<div class="layout svelte-ioemw5"><div class="parent svelte-ioemw5"><!></div> <div class="bars svelte-ioemw5"><div><div class="bar-label svelte-ioemw5"><!></div> <div class="bar-area svelte-ioemw5"><!></div></div> <div><div class="bar-label svelte-ioemw5"><!></div> <div class="bar-area svelte-ioemw5"><!></div></div></div></div>');function Yo(n,t){Ee(t,!0);const[o,r]=xt(),h=()=>Be(Le,"$userTree",o),s=()=>Be(mt,"$userSogf",o),a=()=>Be(l,"$barSegments",o),g=()=>Be(C,"$providerSegments",o);let w=j(!1),c;const l=bt(mt,N=>!N||Object.keys(N).length===0?[]:Object.entries(N).filter(([H,Q])=>Q>0).map(([H,Q])=>({id:H,value:Q*100})).sort((H,Q)=>Q.value-H.value)),C=bt(Vt,N=>{if(console.log("[UI] providerShares changed:",N),!N||Object.keys(N).length===0)return console.log("[UI] No provider shares data for segments"),[];const H=Object.entries(N).filter(([Q,se])=>se>0).map(([Q,se])=>({id:Q,value:se*100})).sort((Q,se)=>se.value-Q.value);return console.log("[UI] Generated provider segments:",H),H});et(()=>{const N=h(),H=s();N&&(!H||Object.keys(H).length===0)&&Zt(),c=window.matchMedia("(max-width: 768px)");function Q(se){b(w,se.matches,!0)}return Q(c),c.addEventListener("change",Q),()=>{c.removeEventListener("change",Q)}});var i=Oo(),p=W(i),m=W(p);Io(m,{}),O(p);var v=ve(p,2),d=W(v);let u;var E=W(d),T=W(E);{var S=N=>{var H=Mo();gt(2),A(N,H)},M=N=>{var H=dt("YR");A(N,H)};de(T,N=>{e(w)?N(S):N(M,!1)})}O(E);var U=ve(E,2),ee=W(U);{var V=N=>{const H=F(()=>!e(w));pt(N,{get segments(){return a()},width:"100%",height:"100%",get vertical(){return e(H)},showLabels:!1,showValues:!1,rounded:!1})},X=N=>{var H=Ho();A(N,H)};de(ee,N=>{a().length>0?N(V):N(X,!1)})}O(U),O(d);var ge=ve(d,2);let z;var oe=W(ge),pe=W(oe);{var re=N=>{var H=Lo();gt(2),A(N,H)},ie=N=>{var H=dt("MR");A(N,H)};de(pe,N=>{e(w)?N(re):N(ie,!1)})}O(oe);var He=ve(oe,2),Se=W(He);{var J=N=>{const H=F(()=>!e(w));pt(N,{get segments(){return g()},width:"100%",height:"100%",get vertical(){return e(H)},showLabels:!1,showValues:!1,rounded:!1})},he=N=>{var H=Do();A(N,H)};de(Se,N=>{g().length>0?N(J):N(he,!1)})}O(He),O(ge),O(v),O(i),ne((N,H)=>{u=it(d,1,"bar-group svelte-ioemw5",null,u,N),z=it(ge,1,"bar-group svelte-ioemw5",null,z,H)},[()=>({vertical:!e(w)}),()=>({vertical:!e(w)})]),A(n,i),Te(),r()}export{Yo as component};
